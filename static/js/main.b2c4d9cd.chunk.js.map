{"version":3,"sources":["api/masterData.js","helper/treefilter.js","helper/localStorageHelper.js","actions/index.js","reducers/reducer_designer.js","helper/dummyMetadata.js","reducers/reducer_mainApp.js","helper/util.js","reducers/reducer_hierarchyDesigner.js","reducers/reducer_reportApp.js","components/chartApiManager.js","reducers/reducer_dashboard.js","reducers/reducer_datadesigner.js","reducers/index.js","components/navbar.js","components/noobSplitter.js","containers/designerContentBase.js","containers/hierearchyTree.js","hoc/noobControlsHoc.js","controls/section.js","controls/richtext.js","controls/combo.js","controls/textbox.js","helper/wordSplitter.js","controls/table.js","controls/label.js","helper/notification.js","charts/dcjsBarChart.js","components/toolItem.js","components/toolbox.js","form/FormText.js","form/FormCheckbox.js","form/FormDropDown.js","form/IconSelector.js","form/ColorSelector.js","form/FormRadio.js","form/FormDateRange.js","form/FormFilterInput.js","form/FormImageCoord.js","form/FormRichText.js","form/formFilterDyanamicInput.js","form/Form.js","form/FormTreeDropDown.js","controls/treeDropdown.js","helper/chartHelper.js","helper/metadataManager.js","charts/pieChart.js","charts/barChart.js","charts/lineChart.js","charts/gauge_rechart.js","charts/gauge.js","components/noobForm.js","constants.js","components/noobControlLandingPad.js","components/editDialog.js","components/noobControl.js","charts/gaugejs_react.js","controls/pagebreak.js","controls/imageMapperLib.js","controls/imageMap.js","controls/datepicker.js","containers/externalContainer.js","components/noobControlContent.js","components/reportControl.js","api/pageApiManager.js","api/ExecutiveSummaryLogic.js","components/reportForm.js","components/toolbar.js","containers/hierarchyConfigPanel.js","containers/dashboardContent.js","components/treeView.js","components/toolAvailableData.js","components/scrollTracker.js","containers/settingsContent.js","components/imageMapConfigDialog.js","containers/propertiesPanel.js","components/toolPanel.js","components/designerForm.js","components/designerToolbar.js","containers/dashboardDesignerContent.js","components/saveAs.js","components/openDialog.js","containers/formsDesignerContent.js","components/hierDesignerToolbar.js","containers/hierarchyDesigner.js","containers/specialTabContent.js","containers/downloadCenterContent.js","components/MyEditor.js","containers/dataDesignerContent.js","containers/trialPage.js","containers/mainContent.js","ReportApp.js","App.js","index.js"],"names":["axios","create","baseURL","toks","document","URL","replace","split","length","getDocUrlWithoutPort","aprFrontEndApi","getDocUrlWithoutPortFrontEnd","titleMatcher","filterText","node","title","toLowerCase","indexOf","nodeExists","filter","matcher","children","find","child","filterTree","filtered","map","Object","assign","findNodeByKey","data","key","i","item","index","parentArr","childFind","sanitizeTreeData","nodeList","retList","currNode","cleanNode","parent","hierStack","push","reconstructHierarchyStack","apiNodes","stack","apiNode","localSaveLayout","layout","name","layoutData","Storage","savedLayouts","savedLayoutsStr","localStorage","getItem","JSON","parse","ret","createOrReplaceLayout","setItem","stringify","console","log","error","newObj","layoutJson","numRows","rows","numCols","columns","pageFilterFields","pageApiData","existingLayoutIdx","findIndex","x","localFetchLayouts","layoutsStr","localFetchHierarchies","hierarchiesStr","localSaveHierarchy","hierarchyJson","nodeSettingsJson","savedHierarchies","savedHierarchiesStr","createOrReplaceHierarchies","viewName","existingHierIdx","getImageListFromLocal","allImagesStr","getImageFromLocal","allImages","findImageIndex","CLICK_MENU","DRAG_TOOLITEM_START","SELECT_TOOLPANEL_TREE","SELECT_HIER_DESIGNER_TREE","UPDATE_HIER_DESIGNER_TREE","INSERT_HIER_DESIGNER_TREE","FILTER_HIER_DESIGNER_TREE","FETCH_HIERARCHY","FETCH_HIERARCHYCONSO","FETCH_AVAILABLEDATA","FETCH_HIERARCHYVIEWS","FETCH_DIMENSIONS","FETCH_HIERARCHYKPI","FETCH_IMAGES","SAVE_DESIGNER_LAYOUT","SAVE_HIER_DESIGN_NODE","menuClicked","menuName","type","payload","selectToolPanelTree","hierarchyNode","selectHierDesignerTree","updateHierDesignerTree","hierarchyArr","filterHierDesignerTree","insertNewNode","saveNodeConfig","nodeInfo","fetchHierarchyViews","dispatch","a","response","get","selectedControl","controlId","selectedPage","updateLayout","updatedControls","openLayout","controls","saveLayout","post","saveHierarchyView","hierarchyData","userSettings","formattedHierarchyData","requestDownloadReport","requestParams","responseType","headers","updateControlProps","newControlData","updateLayoutProps","newLayoutProps","deleteControl","controlData","selectDashboardTree","selectedNodeKey","clickChartSlice","sliceInfo","seriesInfo","groupingStackStr","datasetId","selectChartGroup","groupVal","metadata","clickPageLink","DUMMY_APR_METADATA","server","requestTypes","description","dataType","enumValues","defaultValue","dimensions","items","aggregations","defaultState","activeMenu","tabIndex","draggingToolItem","toolPanelTreeSelected","masterHierarchy","masterAvailableData","masterLayouts","masterHierarchyViews","masterMetadata","masterImages","tabIndexMapping","mapView","analysisView","home","downloadCenter","formsDesigner","hierarchyDesigner","settings","addOrUpdateLayout","stateLayouts","newLayout","findSameLayoutIndex","s","splice","uuidv4","c","r","Math","random","toString","getMonthEndDate","inDate","Date","getFullYear","getMonth","createMonthDate","dateStr","d","isNaN","isValidDate","resizingControlId","y","w","h","ctrlType","level","dashLayout","dashLayoutData","dataKey","RequestParams","dataTypes","Dimensions","measures","expression","value","pageSelected","defaultControlData","label","apiFieldName","placeholder","richTextData","dataProps","requestType","filterName","filterValue","options","text","showFilters","showPaginator","showFooter","specifyColumns","categories","seriesName","stacked","icon","backgroundColor","color","fontSize","alignment","linkedPage","groupings","filtersList","imageProps","image","areas","unit","url","assignIdAndDefaultData","control","currId","ctrl","forEach","layoutCtrl","setControlSelected","affectedControls","selected","unselectAllControls","updatedControl","findControlIndex","newControl","updateControlImgMapProps","actionPayload","newMap","updatedLayoutProps","parseInt","handleDeleteControl","deletedControl","hierarchyMaster","hierarchyTree","selectedNode","handleInsert","newState","newNode","nodeType","category","selectedNodeObj","lastIndex","handleFilter","filteredData","nodes","reduce","acc","curr","concat","filterTreeEx","handleSaveHierDesignNode","state","inputSetting","userSettingsFindIdx","dropdownOptions","computeMaxIndex","maxIndex","currCtrlBtmIdx","currEndIdx","data1","start","offset","percent","endIndex","render1Section_1","bigLayout","getOtherControlFilters","datasetFilters","currCtrlId","controlFilterInfo","stacks","keys","longestStack","e","stackInfo","prop","origObj","Name","Value","getOwnControlHigherLevelFilters","currGroupingsArr","currGroupingStr","ReformatControlFilters","postObj","Array","isArray","parameters","currFilter","fetchData","setIsLoading","setApiData","currControlGrouping","pageFilters","Grouping","otherControlFilters","ownHigherLevelFilters","catch","result","chartClickFilters","chartTempGroupings","processChartClick","filtersRoot","controlFilters","sliceInfoClone","processChartGroups","removeLowerLevelFilters","groupValStr","groupsToRemove","g","hierarchyConso","hierarchyKpi","convertTreeData","apiTreeData","fullPath","nodeName","rest","convertDropDownOptions","apiDropdowns","columnName","datatype","rootReducer","combineReducers","mainApp","action","includes","designer","newStateSelectCtrl","newStateSelectPage","newStateUpdProps","newStateUpdImageMapProps","newStateUpdLayoutProps","newStateDeleteControl","reformatted","insertedState","filterState","saveNodeState","fetchedViewState","reportApp","dashboard","defaultView","treeData","firstNode","newFilters","newFilter","newGroupings","dataDesigner","NavBarMobile","props","handleMenuClick","menuClickDispatcher","handleSidebarToggle","handleSidebarHide","bind","burgerPushed","this","setState","Sidebar","Pushable","as","Menu","animation","inverted","vertical","visible","width","direction","size","getNavBarMenuItemElements","activeItem","Pusher","dimmed","style","height","onClick","className","Component","NavBarDesktop","withAlignment","navBarMenuItems","itemClass","evt","onMenuClicked","getNavbarChildren","connect","bindActionCreators","Responsive","onlyMobile","minWidth","onlyTablet","DEFAULT_SPLIT_SIZES","NoobSplitter","getCurrentPixels","currPercent","window","innerWidth","isVerySmall","currPixels","getMinsize","sizes","getDefaultSizes","id","onSplitDragEnd","onSplitDragStart","handleSplitterBtnClick","createGutter","defaultSize","addRemoveContentTransition","newSize","showCollapseArrow","showExpandArrow","onDragEnd","gutterBtnArrow","getElementById","classList","remove","add","args","bAdd","contentElems","getElementsByClassName","elem","transition","gutterElem","createElement","gutterBtn","appendChild","addEventListener","minSize","child1","child2","gutterSize","onDragStart","snapOffset","cursor","gutter","overflow","DesignerContentBase","onWindowResize","rightPixels","currRightPercent","leftPixels","defaultSizes","React","HierarchyDesignerTree","componentDidMount","firstLevelKeys","getFirstLevelKeys","expandedKeys","componentDidUpdate","prevProps","nodeSelectedObj","parentObj","onExpand","Icon","getSwitcherIcon","isLeaf","expanded","onDrop","info","bUpdated","dropKey","eventKey","dragKey","dragNode","dragParentPos","getParentPosStr","pos","dropPos","isBottomGap","dropPosition","Number","dragObj","dropObj","dropToGap","newDropIdx","onHierarchyChanged","defaultExpandedKeys","defaultSelectedKeys","defaultCheckedKeys","nodePos","lastIndexOf","substr","nodeItem","searchText","currChild","satisfiesFilter","hiddenSettingsNames","nodeSettings","listNodes","currItem","findUserSettings","shouldHide","hiddenNodesSettings","tempSettings","dispName","renderTreeNodes","padding","showLine","selectable","draggable","onDragEnter","checkable","defaultExpandAll","selectedKeys","onSelect","onSelectCb","onCheck","switcherIcon","defaultProps","noobControlHoc","WrappedComponent","stopPropagation","onMouseDown","controlSelected","domNode","ReactDOM","findDOMNode","styles","classNames","combinedStyle","sectionProps","propType","styleMap","CODE","fontFamily","getBlockStyle","block","getType","initialState","apiDataAvailable","apiData","EditorState","createWithContent","ContentState","createFromText","html","jsonObj","retHtml","formatJsonObjAsHtml","stateFromHTML","convertFromRaw","useState","editorState","setEditorState","useEffect","contentState","getCurrentContent","hasText","getBlockMap","first","blockStyleFn","customStyleMap","spellCheck","readOnly","richTextProps","toolTip","metadataField","metadataPropType","Dropdown","fluid","multiple","selection","search","button","fontWeight","right","left","Input","string","str","toUpperCase","statuses","computeKpi","kpiName","totalTargets","good","sampleColumns","Header","Footer","TestCustomProp","accessor","FooterColSpan","customColSpan","colType","DefaultColumnFilter","column","preFilteredRows","setFilter","onChange","target","undefined","TableBase","columnsToUse","dataToUse","designMode","iArea","targetName","timeInControl","timeInAlarm","timeMvOutOfLimits","kpi1","kpi2","kpi3","kpi4","kpi5","kpi6","kpi7","kpi8","kpi9","kpi10","subRows","getSampleData","firstData","splitWord","generateColumns","totalCols","getTotalNumColumns","colArray","origArr","memoColumns","useMemo","memoData","filterTypes","row","rowValue","values","String","startsWith","getPageSize","defaultColumn","Filter","useTable","pageIndex","pageSize","useFilters","useSortBy","usePagination","getTableProps","getTableBodyProps","headerGroups","footerGroups","prepareRow","page","canPreviousPage","canNextPage","pageOptions","pageCount","gotoPage","nextPage","previousPage","setPageSize","headerGroup","iHeaderGrp","getHeaderGroupProps","thisWidth","custProp","getHeaderProps","getSortByToggleProps","render","isSorted","isSortedDesc","col","canFilter","hasFilterableColumn","getRowProps","cells","cell","getCellProps","getAdditionalCellProps","colSpan","disabled","tableProps","watchedField","watchedValue","watchableField","labelToShow","labelStyles","justifyContent","handleLinkClick","paddingLeft","marginLeft","labelProps","NotifType","insert","container","animationIn","animationOut","dismiss","duration","onScreen","pauseOnHover","showIcon","ShowMessage","titleIn","typeIn","messageIn","store","addNotification","message","dc","require","dimensionKpi","crossfilter","diagKpis","kpiStatuses","diags","iDiag","kpis","iKpi","diagName","kpiname","kpiStatus","kpiValue","generateData","dimension","groupKpi","group","theChart","rowChart","myRefChart","current","ordinalColors","elasticX","createRef","ref","ToolItemDragTypes","ToolItem","useDrag","minW","controlType","minH","toolItemTypeName","end","monitor","didDrop","handleEndDrag","collect","isDragging","drag","iconClass","displayName","toolBoxItems","getToolItemByName","tool","ToolBox","containerWidth","toolItem","FormText","rules","numeric","small","useContext","FormContext","register","setValue","unregister","paddingTop","paddingBottom","Field","Popup","basic","opacity","content","trigger","display","FormCheckbox","Checkbox","onChangeEvent","checked","FormDropDown","isRequired","required","fieldWrapperStyle","FormIconSelector","intialicon","currVal","myState","setMyState","onInput","FormColorSelector","intialcolor","FormRadio","dateRangeDropdownOptions","FormDateRange","initialValue","alwaysCustomRange","showMonthYearPicker","dateFormat","startDate","setStartDate","endDate","setEndDate","disableDatePicker","setDisableDatePicker","effectiveFormat","errors","selectsStart","date","selectsEnd","minDate","conditionOptions","FormFilterInput","FormImageCoord","currColor","setCurrColor","handleChangeName","handleChangeColor","StyleButton","onToggle","preventDefault","active","BLOCK_TYPES","BlockStyleControls","getSelection","blockType","getBlockForKey","getStartKey","INLINE_STYLES","InlineStyleControls","currentStyle","getCurrentInlineStyle","has","FormRichText","initialData","refEditor","useRef","getInitialState","currEditorState","inlineStyle","RichUtils","toggleInlineStyle","toggleBlockType","focus","handleKeyCommand","command","onTab","rawContent","convertToRaw","FormFilterDynamicInput","filterFieldOptions","initialFilters","parentId","filters","setFilters","currParentId","setCurrParentId","Button","primary","filterToUse","renderFilters","createContext","Form","onSubmit","inputObj","inputObjId","setControlValues","setStateCb","setStateHook","useForm","handleSubmit","watch","obj","sanitizeObj","Provider","handleChange","path","iStyle","viewBox","fill","verticalAlign","getSvg","transform","iconProps","iconPropsFunction","FormTreeDropDown","labelClassName","searchPlaceholder","showSearch","allowClear","maxTagTextLength","treeNodeFilterProp","treeIcon","treeCheckStrictly","pointing","TreeDropdown","dropdownStyle","maxHeight","dropdownPopupAlign","adjustY","adjustX","extractName","groupingArr","join","filterObj","fields","_","pick","getMetadataOptions","field","descriptionJsx","subheader","getMetadataTreeDropdownOptions","names","treeFields","treeOptions","convertApiMetadataDims","apiMetadataDims","stackValue","getMetadataDimTreeDropdownOptions","dimName","findDimName","findInTree","arrTree","findChildren","sampleData","sampleGroups","COLORS","PieForReport","PI","chartContainerEl","rect","getClientRects","margin","top","bottom","renderPie","renderLegend","renderActiveShape","RADIAN","cx","cy","midAngle","innerRadius","outerRadius","startAngle","endAngle","sin","cos","PieResponsiveDataBase","onPieClick","sectorInfo","activeIndex","handleChartClick","getGroupingStackStr","groupingStack","groupingBoundVal","renderPieWithData","formattedData","formatApiData","datasetFilter","controlIdFilter","dataIndex","propVal","calculateActiveIndex","labelLine","isAnimationActive","activeShape","entry","onGroupSelect","initialGroupingVal","handleGroupSelect","grouping","previousProps","previousState","layoutName","treeDefaultExpandAll","PieResponsiveData","PieWithData","pieClickCallback","wrapperStyle","pieProps","BarChartForReport","renderChartContents","bAnimate","stackId","tick","interval","axisLine","CustomizedAxisTick","stroke","dy","textAnchor","PureComponent","CustomizedAxisTickTrial","BarChartWithData","seriesList","secondaryList","strokeWidth","BarResponsiveData","handleClick","seriesVal","activeCategoryIndex","activeSeries","origCatObj","origSeriesName","renderBars","uniqSeriesVals","seriesIndex","renderCustomizedLabel","mySeriesName","trianglePts","sideLen","points","getDataIndex","currDataCatObj","renderChartContentsUngroupedData","aggregation","uniq","getUniqueValues","currData","currCategoryVal","currCategoryObj","findRetList","formatBarchartData","stackStr","filterAtGroup","findFilterAtGroup","newStackStr","getChartContents","barProps","Series1","CustomizedLabel","textVal","dateParsed","dateObj","toLocaleDateString","renderLineChartContents","strokeDasharray","dot","animationDuration","currSeriesName","currSeriesVal","reformatLineChartData","allUniqeSeriesVals","reportMode","lineProps","nrOfLevels","textColor","colors","marginInPercent","maxWidth","chartValue","parseFloat","colorData","activeSectorIndex","cur","arr","curMax","b","sumValues","arrowData","pieRadius","Arrow","mx","my","strokeLinecap","ActiveSectorMark","renderGaugePlate","renderGaugeNeedle","gaugeProps","NoobForm","onMouseLeave","onMouseMove","onResizerMouseDown","onMouseUp","onDropControl","checkDroppable","controlIds","domControl","findControlDomById","rectContainer","yDelta","touches","clientY","xDelta","clientX","contains","origHeight","origWidth","rectResizing","checkOverlaps","checkLandingPadOverlap","findLandingPadsByParentControl","landingPad","rectLandingPad","hasOverlap","landingPadPotDrops","keyQuery","querySelectorAll","rect1","rect2","noHorzCollision","noVertCollision","bot","foundInvalid","overlapsFound","dataset","controltype","layoutw","layouth","dom","event","clearAllTemporaryClasses","domResizing","calculateNewSize","resizedControlPojo","findControlPojo","controlDom","layoutx","layouty","findControl","from","resizedControlDom","domControls","findPotentialDrops","maxX","maxY","currControl","currX","currY","retEl","firstChild","nextSibling","resizer","inX","inY","draggedItem","landingPadInfo","ControlDragTypes","CONTROL","checkDroppableControlLandingPad","checkDroppableControl","checkDroppableToolItem","droppedControl","retVal","landingPadX","layoutPos","landingPadY","landingPadsAll","landingPadsCovered","findCoveredLandingPads","controlsCovered","findCoveredControls","potentialDropsAll","removePreviousPotentialDrops","deficitW","deficitH","designerDom","query","querySelector","currLandingPadDom","potentialDropsNow","getPotentialDropsForMoving","potentialDropsPrevious","getPotentialDropsForNewItem","draggedItemW","draggedItemH","hoveredControlData","rectDraggedItem","foundOverlapWithDraggedItem","rectCurr","hasOverlapStrict","overlappedDom","prev","ctrlDest","itemDropped","landingPadPos","handleToolItemDrop","handleControlMoveWithLandingPad","handleControlMove","newDate","itemDroppedNew","ctrlDestNew","parentDropCallback","resizerMouseDown","parentCheckDroppable","isSelected","layoutWidth","iRow","iCol","adjustedX","adjustedY","fillMap","flatCoord","n","controlJsx","renderControl","jsx","newFills","getFills","emptyControlPojo","createEmptyControl","emptyControlJsx","renderControlsWithLayout","renderControlsAsSingleCol","controlsList","renderControls","controlsJsx","divStyle","onTouchEnd","onTouchMove","canDropCollectHandler","keyLandingPad","canDrop","ex","LandingPad","domParentCtrlId","canDropParentCallback","dropParentCallback","useDrop","accept","layoutPosIn","canDropCallback","isOver","canDropInLandingPad","drop","droppedItem","shallow","parentctrlid","LandingPads","droppingItemType","droppingItem","noobControlCanDropCallback","noobControlDropCallback","landingPadStyle","gridTemplateColumns","gridTemplateRows","j","createLandingPads","modalStyle","EditDialog","controlInfo","Modal","closeIcon","closeOnDimmerClick","Content","Description","ownProps","myId","stateControlData","canDropMe","isOverShallow","getItemType","ctrlStyle","widthOfCtrl","gridRowEnd","gridColumnEnd","domCtrlId","onTouchStart","Gauge","canvas","span","gauge","observer","MutationObserver","mutationsList","textChangeHandler","innerText","observe","characterData","attributes","childList","subtree","disconnect","donut","Donut","CanvasGauge","setTextField","setOptions","maxValue","setMinValue","minValue","animationSpeed","set","textRenderer","TextRenderer","percentage","displayedValue","el","innerHTML","toFixed","heightPx","widthPx","angle","lineWidth","radiusScale","pointer","limitMax","limitMin","strokeColor","generateGradient","highDpiSupport","staticZones","strokeStyle","min","max","staticLabels","font","labels","fractionDigits","ImageMapper","f","absPos","position","pointerEvents","zIndex","img","userSelect","watchedProps","nextProps","propChanged","some","isEqual","updateCacheMap","initCanvas","coords","fillColor","ctx","fillStyle","strokeRect","fillRect","beginPath","arc","closePath","v","slice","unshift","moveTo","lineTo","clientWidth","clientHeight","getContext","onLoad","renderPrefilledAreas","area","shape","getAttribute","onMouseEnter","clearRect","onImageClick","onImageMouseMove","imgWidth","scale","coord","preFillColor","scaleCoords","scaledCoords","val","idx","center","computeCenter","extendedArea","_id","onMouseOver","hoverOn","onMouseOut","hoverOff","mouseMove","click","href","src","useMap","alt","imageClick","imageMouseMove","renderAreas","MAP","MAP2","imageLoaded","scaledImgW","scaledImgH","hoveredArea","imageLoadHandler","origImgW","srcElement","origImgH","Image","onload","getImageUrl","maxWidthPx","propsMaxWidth","useOther","areaName","lowestProp","getLastGroupingItem","findApiData","kvPairsStr","imageUrl","mapToUse","getMapToUse","computedSize","computeWidthHeight","enterArea","leaveArea","getTipPosition","getTooltip","imageMapProps","buttonName","btnOnclick","ExternalContainerBase","getContentDiv","mode","isReporting","NoobControlContent","canDrag","isLoading","controlDataClone","groupValue","groupingValue","Dimmer","Loader","fetchPageData","fetchPageDataAsync","bogusDataUuids","findExecSummaryRecords","downloadParams","analysisPeriodFilter","analysisPeriod","cleanApiDataList","uuid","sort","aprStart","aprEnd","currAnalysisDate","analysisEndDate","closestApiDataStart","refDate","currApiData","currApiStart","findClosestStartDate","closestApiDataEndDate","filterExecSummaryByUuid","uuidParam","p","latestRecord","currLatestDate","currRecord","findRecordWithLatestEndDate","ReportForm","filteredApiData","isControlSolo","formWidth","groupsList","maxRow","findLastNonEmptyRow","currGroup","currGroupPagination","bSetPagination","groupType","pageBreak","groups","formStyle","pageBreakBefore","renderGroups","renderToolbarBtn","clsName","btnType","callback","Toolbar","menuItems","titleTooltip","renderFullMenu","renderCollapsedMenu","renderPageOptions","setValueFunc","inherit","pageAssoc","childDefaultPage","displayWeb","displayReport","displayAsMapView","displayAsAnalysisView","findInheritedPage","findUserSetting","formArgs","inheritedPageRowStyle","renderHierPanelContent","DashboardContent","getLayoutName","setting","findNode","getLayoutObj","findLayout","renderDatasetFilters","border","iDataset","currDatasetFilters","iCtrl","currControlFilter","currStackStr","iStack","currStackFilter","onSubmitFilter","filterData","layoutObj","pageFiltersFormatted","layoutFilter","toLocaleLowerCase","AnalysisPeriod","renderPageFilter","setPageFilterControlValues","renderPageToolbar","formData","pageFilter","renderForm","hierarchyView","controlledExpansion","DesignerContentbase","DemoTree","selKey","selectedNodes","tree","domTreeNodes","checkedKeys","onEdit","setTimeout","onDel","confirm","setTreeRef","Filterer","treeDataArr","convertMasterDataToKeys","filterTreeNode","childNodes","availableItems","findMatchHierarchy","m","selectionType","hierarchy","kpiNameList","findMatchCategory","findMatchNodeType","kpi","GetAvailableItems","convertToDropdownOptions","imagesStrArr","SettingsContent","reduxStoreImages","useSelector","useDispatch","Segment","encType","files","reader","FileReader","file","readAsDataURL","existingImageIdx","createOrReplaceImage","settingsImageDropdown","deleteLocalImage","DEFAULTMAP","DEFAULT_COORDS","ImageMapConfigDialog","initialImage","initialMap","showOpenForm","onCloseOpenConfigDialog","dropdownImage","addingHotspot","setAddingHotspot","setMap","generateSpotName","candidateVal","candidateName","open","areaData","applyImageMapProps","mapParam","toggle","Actions","floated","nativeEvent","layerX","layerY","currCoords","mapClone","toolItemType","filterSettingsObj","setLayoutValues","applyUserTreeSettings","treeDataNoSettings","u","formattedNode","bShow","setShowConfigDialog","submittedData","onSubmitLayoutForm","onDelete","getSpecialProps","specialProps","renderCommonProps","renderProps","controlProps","namePrefix","foundSpecialProp","propDisabled","watchableFieldName","watchedFieldValue","shouldDisableProp","IconSelector","ColorSelector","renderMetadataField","metaFieldName","metaSpecialProps","renderLayoutProps","watchableFieldInitialValue","findWatchableField","getWatchableFieldName","showConfigDialog","setWatchedFieldValue","Divider","horizontal","renderControlProps","Message","header","DEFAULT_SIZES","AccordionPanel","onClickCollapseExpand","isCollapsed","panelContent","iconName","defaultPanelItems","helpText","ToolPanel","recalculatePanelSizes","panelsData","oneSize","panel","getPanelSizes","addRemovePanelTransition","panelEls","panelEl","panelDataClone","selectedPanelData","newPanelsData","getPanelContent","panelId","createPanels","panelItems","initializedPanelData","clonePanelsData","currPanelData","ResponsiveReactGridLayout","generateDOM","layouts","lg","l","static","borderRadius","comboInfo","renderContent","DesignerForm","mounted","initialLayout","measureBeforeMount","useCSSTransforms","isDroppable","rowHeight","onLayoutChange","cols","md","sm","xs","xxs","compactType","DesignerToolbar","DashboardDesignerContent","SaveAsDialog","showSaveForm","formLabel","onSave","onClose","scrolling","OpenDialog","onOpen","formsDesignerContent","configPageSettings","saveCallback","handleSave","saveAsCallback","openedLayoutName","handleCloseSave","layoutToUse","getLayoutToUse","openCallback","handleCloseOpenDlg","handleOpenLayout","defaultReturn","layoutFromApi","lastUpdateDate","HierarchyToolbar","onInsert","onSearchText","clsNamesDeleteBtn","bEnableDelete","ToolbarPanel","HierarchyDesigner","deletedNode","deletedNodeObj","currentTarget","SpecialTabContent","hierarchyPropName","findSettingNode","findFirstNode","setPdfFormValues","createLinkifyPlugin","component","alert","downloadOptions","formatDate","constructReportTitle","execReport","DownloadCenterContent","downloadExecReport","createObjectURL","Blob","link","setAttribute","body","downloading","setDownloading","downloadProgress","setDownloadProgress","then","apiResponse","execReports","tag","convertApiMetadataFilters","apiMetadata","metadataDims","requestItems","onTreeSelect","extra","renderFilterSegment","filterFields","filtersMetadata","renderFilterFields","DataDesignerForm","previewIcon","previewText","fetchingPreview","formInvalid","renderPreviewTable","renderDataDesignerPanelContent","DataDesignerContainer","HierarchyScope","hierDsgnKpiGroup","dimensionsMetadata","dummyVendorModels","categoryLookup","itemConds","generateApiData","retlist","currVendor","currModel","deviceId","vendor","model","itemCond","getDimensionObj","cfData","groupingsList","pickedData","metaDimHier4Pie","metaDimHier4Bar","reformatMetaDim","metaDimArray","metaNode","panes","menuItem","pane","Tab","Pane","mainAppState","renderActiveOnly","extractLayouts","nodesArr","findNodeLayout","controlsArr","childrenControls","adjustControlCoords","currLayoutControls","currRowOffset","currLayoutName","lastNonEmptyRow","adjustedControls","newY","allControls","allLayouts","apiDataMap","iLayout","reformattedControls","mergeLayoutControls","allControlsLayoutData","vals","getFirstVal","searchParams","getRequestParams","App","fetchSavedLayouts","fetchImages","isTouch","documentElement","DndProvider","backend","HTML5Backend","TouchBackend","fetchHierarchy","masterData","fetchHierarchyKpi","fetchHierarchyConso","fetchDimensions","createStore","reducers","applyMiddleware","thunk"],"mappings":"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","file":"static/js/main.b2c4d9cd.chunk.js","sourcesContent":["import axios from 'axios';\r\n\r\nconst getDocUrlWithoutPort = () => {\r\n    const temp = document.URL.replace(\"http://\", '');\r\n    var toks = temp.split(':');\r\n    if (toks && toks.length > 0) {\r\n        return `http://${toks[0]}:60000/api`;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport default axios.create({\r\n    //baseURL: 'http://localhost:60000/api'\r\n    baseURL: getDocUrlWithoutPort() || 'http://localhost:60000/api'\r\n    //baseURL: 'http://localhost:3001'\r\n});\r\n\r\n\r\nconst getDocUrlWithoutPortFrontEnd = () => {\r\n    const temp = document.URL.replace(\"http://\", '');\r\n    var toks = temp.split(':');\r\n    if (toks && toks.length > 0) {\r\n        return `http://${toks[0]}:5000`;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport const getAprBaseUrl = () => {\r\n    return getDocUrlWithoutPortFrontEnd() || 'http://localhost:5000';\r\n}\r\n\r\nexport const aprFrontEndApi = axios.create({\r\n    baseURL: getAprBaseUrl()\r\n});\r\n\r\n\r\n// Temp: for the demo page\r\n// Todo: should check first if the URL is valid. Otherwise use local storage\r\nexport const isFrontEndApiReachable = () => false;","// Helper functions for tree\r\n// TODO: Rename this file to TreeHelper instead\r\nexport const defaultMatcher = (filterText, node) => {\r\n    return node.name.toLowerCase().indexOf(filterText.toLowerCase()) !== -1;\r\n};\r\n\r\nexport const titleMatcher = (filterText, node) => {\r\n    return node.title.toLowerCase().indexOf(filterText.toLowerCase()) !== -1;\r\n};\r\n\r\n// Returns true or false only\r\nexport const nodeExists = (node, filter, matcher) => {\r\n    return matcher(filter, node) || // i match\r\n        (node.children && // or i have decendents and one of them match\r\n            node.children.length &&\r\n            !!node.children.find(child => nodeExists(child, filter, matcher)));\r\n};\r\n\r\nexport const filterTreeEx = (nodes, filter, matcher = titleMatcher) => {\r\n    return nodes.reduce( (acc, curr) => {\r\n        return acc.concat(filterTree(curr, filter, matcher))\r\n    }, []);\r\n};\r\n\r\n\r\nexport const filterTree = (node, filter, matcher = titleMatcher) => {\r\n    // If im an exact match then all my children get to stay\r\n    if (matcher(filter, node) || !node.children) {\r\n        return node;\r\n    }\r\n    // If not then only keep the ones that match or have matching descendants\r\n    const filtered = node.children\r\n        .filter(child => nodeExists(child, filter, matcher))\r\n        .map(child => filterTree(child, filter, matcher));\r\n    return Object.assign({}, node, {children: filtered});\r\n};\r\n\r\nexport const expandFilteredNodes = (node, filter, matcher = defaultMatcher) => {\r\n    let children = node.children;\r\n    if (!children || children.length === 0) {\r\n        return Object.assign({}, node, {toggled: false});\r\n    }\r\n    const childrenWithMatches = node.children.filter(child => nodeExists(child, filter, matcher));\r\n    const shouldExpand = childrenWithMatches.length > 0;\r\n    // If im going to expand, go through all the matches and see if thier children need to expand\r\n    if (shouldExpand) {\r\n        children = childrenWithMatches.map(child => {\r\n            return expandFilteredNodes(child, filter, matcher);\r\n        });\r\n    }\r\n    return Object.assign({}, node, {\r\n        children: children,\r\n        toggled: shouldExpand\r\n    });\r\n};\r\n\r\nexport const findNodeByKey = (data, key) => {\r\n    if (!data) {\r\n        return null;\r\n    }\r\n    for (let i = 0; i < data.length; i++) {\r\n        let item = data[i];\r\n        if (item.key === key) {        \r\n            return {\r\n                item,\r\n                index: i,\r\n                parentArr: data\r\n            };\r\n        }\r\n        if (item.children) {\r\n            let childFind = findNodeByKey(item.children, key);\r\n            if (childFind) {\r\n                return childFind;\r\n            }\r\n        }\r\n    }\r\n    return null;\r\n}\r\n\r\nexport const findNodeByPos = (data, posArr, currLevel=0) => {\r\n    // if (posArr.length === currLevel) {\r\n    //     return data[posArr]\r\n    // }\r\n}\r\n\r\n\r\n// Remove the 'parent' object so that we can stringify the object\r\nexport const sanitizeTreeData = (nodeList) => {\r\n    let retList = [];\r\n\r\n    //debugger\r\n    for (let i = 0; i < nodeList.length; i++) {\r\n        let currNode = nodeList[i];\r\n        let {parent, hierStack, ...cleanNode} = {...currNode};\r\n        if (cleanNode.children) {\r\n            cleanNode.children = sanitizeTreeData(cleanNode.children)\r\n        }\r\n        retList.push(cleanNode);\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\nexport const reconstructHierarchyStack = (apiNodes, stack=[], parent=null) => {\r\n    if (!apiNodes) {\r\n      return null;\r\n    }\r\n  \r\n    for(let i = 0; i < apiNodes.length; i++) {\r\n      let apiNode = apiNodes[i];\r\n      apiNode.hierStack = [...stack, i];\r\n      apiNode.parent = parent;\r\n      reconstructHierarchyStack(apiNode.children, apiNode.hierStack, apiNode);\r\n    }\r\n  \r\n    return apiNodes;\r\n}\r\n\r\nexport const applyUserTreeSettings = (treeDataNoSettings, userSettings) => {\r\n    if (!treeDataNoSettings || !userSettings) {\r\n        return [];\r\n    }\r\n\r\n    let retList = [];\r\n    for (let i = 0; i < treeDataNoSettings.length; i++) {\r\n        let currNode = treeDataNoSettings[i];\r\n        let findUserSetting = userSettings.find(u => u.key === currNode.key);\r\n        let formattedNode = {...currNode, value: currNode.key};\r\n        retList.push(formattedNode);\r\n        if (findUserSetting) {\r\n            formattedNode.title = findUserSetting.dispName;\r\n        }\r\n        formattedNode.children = applyUserTreeSettings(formattedNode.children, userSettings);\r\n    }\r\n\r\n    return retList;\r\n}","export const localSaveLayout = (layout, name, layoutData) => {\r\n    if (typeof(Storage) === \"undefined\") {\r\n        console.error(\"localSaveLayout: browser does not supoort Local Storage\");\r\n        return;\r\n    }\r\n\r\n    let savedLayouts = [];\r\n    let savedLayoutsStr = localStorage.getItem(\"layouts\");\r\n    if (savedLayoutsStr) {\r\n        savedLayouts = JSON.parse(savedLayoutsStr)\r\n    }\r\n\r\n    // Find any existing layout with same name. Remove it and replace with our new one.\r\n    let ret = createOrReplaceLayout(savedLayouts, layout, name, layoutData);\r\n\r\n    localStorage.setItem(\"layouts\", JSON.stringify(savedLayouts));\r\n    console.log(\"localSaveLayout\");\r\n\r\n    return ret;\r\n}\r\n\r\nconst createOrReplaceLayout = (savedLayouts, layout, name, layoutData) => {\r\n    let newObj = {\r\n        name,\r\n        layoutJson: JSON.stringify(layout),\r\n        numRows: layoutData.rows,\r\n        numCols: layoutData.columns,\r\n        pageFilterFields: JSON.stringify(layoutData.pageFilterFields),\r\n        pageApiData: JSON.stringify(layoutData.pageApiData),\r\n    }\r\n\r\n    let existingLayoutIdx = savedLayouts.findIndex(x => x.name === name);\r\n    if (existingLayoutIdx !== -1) {\r\n        savedLayouts[existingLayoutIdx] = newObj;\r\n    }\r\n    else {\r\n        savedLayouts.push(newObj);\r\n    }\r\n\r\n    return newObj;\r\n}\r\n\r\n\r\nexport const localFetchLayouts = () => {\r\n    let layoutsStr = localStorage.getItem('layouts');\r\n    if (!layoutsStr) {\r\n        return [];\r\n    }\r\n\r\n    return JSON.parse(layoutsStr);\r\n}\r\n\r\n\r\nexport const localFetchHierarchies = () => {\r\n    let hierarchiesStr = localStorage.getItem('hierarchies');\r\n    if (!hierarchiesStr) {\r\n        return [];\r\n    }\r\n\r\n    return JSON.parse(hierarchiesStr);\r\n}\r\n\r\nexport const localSaveHierarchy = (hierarchyJson, nodeSettingsJson) => {\r\n    if (typeof(Storage) === \"undefined\") {\r\n        console.error(\"localSaveHierarchy: browser does not supoort Local Storage\");\r\n        return;\r\n    }\r\n\r\n    let savedHierarchies = [];\r\n    let savedHierarchiesStr = localStorage.getItem(\"hierarchies\");\r\n    if (savedHierarchiesStr) {\r\n        savedHierarchies = JSON.parse(savedHierarchiesStr)\r\n    }\r\n\r\n    // Find any existing layout with same name. Remove it and replace with our new one.\r\n    createOrReplaceHierarchies(savedHierarchies, hierarchyJson, nodeSettingsJson);\r\n\r\n    localStorage.setItem(\"hierarchies\", JSON.stringify(savedHierarchies));\r\n    console.log(\"localSaveHierarchy\");    \r\n}\r\n\r\nconst defaultViewName = \"Default\";\r\nconst createOrReplaceHierarchies = ( savedHierarchies, hierarchyJson, nodeSettingsJson ) => {\r\n    let newObj = {\r\n        viewName: defaultViewName,\r\n        hierarchyJson, \r\n        nodeSettingsJson\r\n    };\r\n\r\n    let existingHierIdx = savedHierarchies.findIndex(x => x.viewName === defaultViewName);\r\n    if (existingHierIdx !== -1) {\r\n        savedHierarchies[existingHierIdx] = newObj;\r\n    }\r\n    else {\r\n        savedHierarchies.push(newObj);\r\n    }    \r\n}\r\n\r\nexport const createOrReplaceImage = (name, data) => {\r\n    let newObj = {\r\n        name,\r\n        data\r\n    };\r\n\r\n    let allImages = [];\r\n    let allImagesStr = localStorage.getItem(\"images\");\r\n    if (allImagesStr) {\r\n        allImages = JSON.parse(allImagesStr);\r\n    }\r\n\r\n    let existingImageIdx = allImages.findIndex(x => x.name === name);\r\n    if (existingImageIdx !== -1) {\r\n        allImages[existingImageIdx] = newObj;\r\n    }\r\n    else {\r\n        allImages.push(newObj);\r\n    }    \r\n\r\n    localStorage.setItem(\"images\", JSON.stringify(allImages));\r\n\r\n}\r\n\r\nexport const getImageListFromLocal = () => {\r\n    let allImagesStr = localStorage.getItem(\"images\");\r\n    if (!allImagesStr) {\r\n        console.error(\"Could not get images from Local Storage\");\r\n        return [];\r\n    }\r\n    let allImages = JSON.parse(allImagesStr);\r\n    return allImages.map(x => x.name);\r\n}\r\n\r\nexport const getImageFromLocal = (name) => {\r\n    let allImagesStr = localStorage.getItem(\"images\");\r\n    let allImages = JSON.parse(allImagesStr);\r\n    const findImageIndex = allImages.findIndex(x => x.name === name);\r\n    if (findImageIndex < 0) {\r\n        return null;\r\n    }\r\n\r\n    const image = allImages[findImageIndex];\r\n    return image.data;\r\n}\r\n\r\nexport const deleteImage = (name) => {\r\n    let allImagesStr = localStorage.getItem(\"images\");\r\n    if (!allImagesStr) {\r\n        console.error(\"Could not get images from Local Storage\");\r\n        return [];\r\n    }\r\n    let allImages = JSON.parse(allImagesStr);\r\n    let existingImageIdx = allImages.findIndex(x => x.name === name);\r\n    if (existingImageIdx !== -1) {\r\n        allImages.splice(existingImageIdx, 1);\r\n        localStorage.setItem(\"images\", JSON.stringify(allImages));\r\n    }\r\n}","import masterData, {aprFrontEndApi, isFrontEndApiReachable} from '../api/masterData';\r\nimport _ from 'lodash';\r\nimport {sanitizeTreeData} from '../helper/treefilter';\r\nimport {localSaveLayout, localFetchLayouts, localFetchHierarchies, localSaveHierarchy, getImageListFromLocal, getImageFromLocal} from '../helper/localStorageHelper';\r\n\r\nexport const CLICK_MENU = \"CLICK_MENU\";\r\nexport const DRAG_TOOLITEM_START = \"DRAG_TOOLITEM_START\";\r\nexport const SELECT_TOOLPANEL_TREE = \"SELECT_TOOLPANEL_TREE\"\r\nexport const SELECT_HIER_DESIGNER_TREE = \"SELECT_HIER_DESIGNER_TREE\"\r\nexport const UPDATE_HIER_DESIGNER_TREE = \"UPDATE_HIER_DESIGNER_TREE\"\r\nexport const INSERT_HIER_DESIGNER_TREE = \"INSERT_HIER_DESIGNER_TREE\"\r\nexport const FILTER_HIER_DESIGNER_TREE = \"FILTER_HIER_DESIGNER_TREE\"\r\nexport const FETCH_HIERARCHY = \"FETCH_HIERARCHY\"\r\nexport const FETCH_HIERARCHYCONSO = \"FETCH_HIERARCHYCONSO\"\r\nexport const FETCH_AVAILABLEDATA = \"FETCH_AVAILABLEDATA\"\r\nexport const FETCH_SAVEDLAYOUTS = \"FETCH_SAVEDLAYOUTS\"\r\nexport const FETCH_HIERARCHYVIEWS = \"FETCH_HIERARCHYVIEWS\"\r\nexport const FETCH_DIMENSIONS = \"FETCH_DIMENSIONS\"\r\nexport const FETCH_HIERARCHYKPI = \"FETCH_HIERARCHYKPI\"\r\nexport const FETCH_IMAGES = \"FETCH_IMAGES\"\r\nexport const SELECT_CONTROL = \"SELECT_CONTROL\"\r\nexport const SELECT_PAGE = \"SELECT_PAGE\"\r\nexport const UPDATE_DESIGNER_LAYOUT = \"UPDATE_DESIGNER_LAYOUT\";\r\nexport const OPEN_LAYOUT = \"OPEN_LAYOUT\";\r\nexport const SAVE_DESIGNER_LAYOUT = \"SAVE_DESIGNER_LAYOUT\";\r\nexport const UPDATE_CONTROL_PROPS = \"UPDATE_CONTROL_PROPS\";\r\nexport const UPDATE_LAYOUT_PROPS = \"UPDATE_LAYOUT_PROPS\";\r\nexport const DELETE_CONTROL = \"DELETE_CONTROL\";\r\nexport const SAVE_HIER_DESIGN_NODE = \"SAVE_HIER_DESIGN_NODE\";\r\nexport const SAVE_HIERARCHYVIEW = \"SAVE_HIERARCHYVIEW\";\r\nexport const SELECT_DASHBOARD_TREE = \"SELECT_DASHBOARD_TREE\";\r\nexport const CLICK_CHART_SLICE = \"CLICK_CHART_SLICE\";\r\nexport const SELECT_CHART_GROUP = \"SELECT_CHART_GROUP\";\r\nexport const APPLY_IMAGEMAP_PROPS = \"APPLY_IMAGEMAP_PROPS\";\r\nexport const CLICK_PAGE_LINK = \"CLICK_PAGE_LINK\";\r\n\r\nexport function menuClicked(menuName) { \r\n    return {\r\n      type: CLICK_MENU,\r\n      payload: menuName\r\n    };\r\n}\r\n\r\nexport function toolItemDragged(toolName) { \r\n  return {\r\n    type: DRAG_TOOLITEM_START,\r\n    payload: toolName\r\n  };\r\n}\r\n\r\nexport function selectToolPanelTree(hierarchyNode) {\r\n  return {\r\n    type: SELECT_TOOLPANEL_TREE,\r\n    payload: {\r\n      ...hierarchyNode\r\n    }\r\n  };\r\n}\r\n\r\nexport function selectHierDesignerTree(hierarchyNode) {\r\n  return {\r\n    type: SELECT_HIER_DESIGNER_TREE,\r\n    payload: {\r\n      ...hierarchyNode\r\n    }\r\n  };\r\n}\r\n\r\nexport function updateHierDesignerTree(hierarchyArr) {\r\n  return {\r\n    type: UPDATE_HIER_DESIGNER_TREE,\r\n    payload: hierarchyArr\r\n  }\r\n}\r\n\r\n// Not used anymore\r\nexport function filterHierDesignerTree(filter) {\r\n  return {\r\n    type: FILTER_HIER_DESIGNER_TREE,\r\n    payload: filter\r\n  }\r\n}\r\n\r\n\r\nexport function insertNewNode() {\r\n  // No payload since the reducer knows who is the selected node\r\n  return {\r\n    type: INSERT_HIER_DESIGNER_TREE\r\n  }\r\n}\r\n\r\n// Actually, this is just \"Apply\" to local state\r\n// This does not persist to the database yet\r\nexport function saveNodeConfig(nodeInfo) {\r\n  return {\r\n    type: SAVE_HIER_DESIGN_NODE,\r\n    payload: nodeInfo\r\n  }\r\n}\r\n\r\nexport const fetchHierarchy = () => async dispatch => { \r\n  console.log('[action] fetchHierarchy');\r\n  let response = await masterData.get('hierarchy');\r\n\r\n  dispatch({\r\n    type: FETCH_HIERARCHY,\r\n    payload: response\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\n// Get the consolidated hierarchy from various collection dates\r\nexport const fetchHierarchyConso = () => async dispatch => { \r\n  console.log('[action] fetchHierarchyConso');\r\n  let response = await masterData.get('hierarchy/conso');\r\n\r\n  dispatch({\r\n    type: FETCH_HIERARCHYCONSO,\r\n    payload: response\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\nexport const fetchSavedLayouts = () => async dispatch => { \r\n  console.log('[action] fetchSavedLayouts');\r\n  let response;\r\n  if (!isFrontEndApiReachable()) {\r\n    response = {data: localFetchLayouts()}\r\n  }\r\n  else {\r\n    //const response = await masterData.get('layout')\r\n    response = await aprFrontEndApi.get('fetchSavedLayouts')\r\n  }\r\n\r\n  dispatch({\r\n    type: FETCH_SAVEDLAYOUTS,\r\n    payload: response\r\n  });    \r\n\r\n}\r\n\r\nexport const fetchHierarchyViews = () => async dispatch => { \r\n  console.log('[action] fetchHierarchyViews');\r\n  let response;\r\n  if (!isFrontEndApiReachable()) {\r\n    response = {\r\n      data: localFetchHierarchies()\r\n    };\r\n  }\r\n  else {\r\n    //const response = await masterData.get('hierarchyviews')  \r\n    response = await aprFrontEndApi.get('fetchHierarchyViews')\r\n  }\r\n  \r\n  dispatch({\r\n    type: FETCH_HIERARCHYVIEWS,\r\n    payload: response\r\n  });\r\n}\r\n\r\nexport const fetchDimensions = () => async dispatch => { \r\n  console.log('[action] fetchDimensions');\r\n  const response = await masterData.get('dimensions')\r\n\r\n  dispatch({\r\n    type: FETCH_DIMENSIONS,\r\n    payload: response\r\n  });\r\n}\r\n\r\nexport const fetchHierarchyKpi = () => async dispatch => { \r\n  console.log('[action] fetchHierarchyKpi');\r\n  const response = await masterData.get('HierarchyKpi')\r\n\r\n  dispatch({\r\n    type: FETCH_HIERARCHYKPI,\r\n    payload: response\r\n  });\r\n}\r\n\r\nexport const fetchImages = () => async dispatch => { \r\n  console.log('[action] fetchImages');\r\n  let response;\r\n  if (!isFrontEndApiReachable()) {\r\n    response = {data: getImageListFromLocal()};\r\n  }\r\n  else {\r\n    response = await aprFrontEndApi.get('getfilelist')\r\n  }\r\n\r\n  dispatch({\r\n    type: FETCH_IMAGES,\r\n    payload: response\r\n  });\r\n}\r\n\r\nexport const deleteImage = (filename) => async dispatch => { \r\n  console.log('[action] fetchImages');\r\n  const response = await aprFrontEndApi.post('deletefile', {\r\n    name: filename\r\n  })\r\n}\r\n\r\nexport const selectedControl = (controlId) => {\r\n  return {\r\n    type: SELECT_CONTROL,\r\n    payload: controlId\r\n  }\r\n}\r\n\r\nexport const selectedPage = () => {\r\n  return {\r\n    type: SELECT_PAGE,\r\n    payload: null\r\n  }\r\n}\r\n\r\n// For UI update only, not yet persisted to the storage like DB or browser storage\r\n// Assumption is that validations have been performed on the updated controls\r\nexport const updateLayout = (updatedControls) => {\r\n  return {\r\n    type: UPDATE_DESIGNER_LAYOUT,\r\n    payload: updatedControls\r\n  }\r\n}\r\n\r\nexport const openLayout = (controls, layoutData) => {\r\n  return {\r\n    type: OPEN_LAYOUT,\r\n    payload: {\r\n      controls,\r\n      layoutData\r\n    }\r\n  };\r\n}\r\n\r\n// Save the layout to persistent storage like database or web local storage\r\n// TODO: Warn user, or inform user about replacing file, if that name already exists\r\nexport const saveLayout = (layout, name, layoutData) => async dispatch => { \r\n  console.log('[action] saveLayout');\r\n\r\n  let response;\r\n  if (!isFrontEndApiReachable()) {\r\n    response = {data: localSaveLayout(layout, name, layoutData)};\r\n  }\r\n  else {\r\n    try {\r\n      response = await aprFrontEndApi.post('createupdatelayout', {\r\n        name,\r\n        layoutJson: JSON.stringify(layout),\r\n        numRows: layoutData.rows,\r\n        numCols: layoutData.columns,\r\n        pageFilterFields: JSON.stringify(layoutData.pageFilterFields),\r\n        pageApiData: JSON.stringify(layoutData.pageApiData),\r\n      });\r\n    }\r\n    catch(err) {\r\n      return err;\r\n    }  \r\n  }\r\n\r\n  dispatch({\r\n    type: SAVE_DESIGNER_LAYOUT,\r\n    payload: {layout, name, response}\r\n  });  \r\n\r\n\r\n  return true;\r\n}\r\n\r\n/*\r\n// Save the layout to persistent storage like database or web local storage\r\n// TODO: Warn user, or inform user about replacing file, if that name already exists\r\nexport const saveLayoutOld = (layout, name, layoutData) => async dispatch => { \r\n  console.log('[action] saveLayout');\r\n\r\n  let response = null;\r\n  try {\r\n    response = await masterData.post('layout', {\r\n      name,\r\n      layoutJson: JSON.stringify(layout),\r\n      numRows: layoutData.rows,\r\n      numCols: layoutData.columns,\r\n      pageFilterFields: JSON.stringify(layoutData.pageFilterFields)\r\n    });  \r\n  }\r\n  catch(err) {\r\n    return err;\r\n  }\r\n\r\n  dispatch({\r\n    type: SAVE_DESIGNER_LAYOUT,\r\n    payload: {layout, name, response}\r\n  });\r\n\r\n  return true;\r\n}\r\n*/\r\n\r\n// Save the layout to persistent storage like database or web local storage\r\n// TODO: Warn user, or inform user about replacing file, if that name already exists\r\nexport const saveHierarchyView = (hierarchyData, userSettings) => async dispatch => { \r\n  console.log('[action] saveHierarchyView');\r\n\r\n  let response = null;  \r\n  let formattedHierarchyData = sanitizeTreeData(hierarchyData);\r\n  let hierarchyJson = JSON.stringify(formattedHierarchyData);\r\n  let nodeSettingsJson = JSON.stringify(userSettings);\r\n\r\n  if(!isFrontEndApiReachable()) {\r\n    localSaveHierarchy(hierarchyJson, nodeSettingsJson)\r\n  }\r\n  else {\r\n    try {\r\n      //response = await masterData.post('hierarchyviews', {\r\n      response = await aprFrontEndApi.post('saveHierarchyView', {\r\n        hierarchyJson,\r\n        nodeSettingsJson,\r\n      });  \r\n    }\r\n    catch(err) {\r\n      return err;\r\n    }  \r\n  }\r\n\r\n  dispatch({\r\n    type: SAVE_HIERARCHYVIEW,\r\n    payload: {hierarchyData, userSettings}\r\n  });\r\n\r\n  return true;\r\n}\r\n\r\nexport const requestDownloadReport = (requestParams) => async dispatch => { \r\n  let response = null;\r\n  try {\r\n    response = await aprFrontEndApi.post('createPdf', \r\n    {\r\n      ...requestParams,\r\n    },\r\n    {\r\n      responseType: 'arraybuffer', // important...because we need to convert it to a blob. If we don't specify this, response.data will be the raw data. It cannot be coverted to blob directly.\r\n      headers: {\r\n          'Content-Type': 'application/json',\r\n          'Accept': 'application/pdf'\r\n      }\r\n  });  \r\n\r\n  }\r\n  catch(err) {\r\n    console.log('[requestDownloadReport][ERROR]', err);\r\n    return err\r\n  }\r\n\r\n  return response;\r\n}\r\n\r\nexport const updateControlProps = (newControlData) => {\r\n  return {\r\n    type: UPDATE_CONTROL_PROPS,\r\n    payload: newControlData\r\n  }\r\n}\r\n\r\nexport const updateLayoutProps = (newLayoutProps) => {\r\n  return {\r\n    type: UPDATE_LAYOUT_PROPS,\r\n    payload: newLayoutProps\r\n  }\r\n}\r\n\r\nexport const deleteControl = (controlData) => {\r\n  return {\r\n    type: DELETE_CONTROL,\r\n    payload: controlData\r\n  }\r\n}\r\n\r\nexport function selectDashboardTree(selectedNodeKey) {\r\n  return {\r\n    type: SELECT_DASHBOARD_TREE,\r\n    payload: {\r\n      selectedNodeKey\r\n    }\r\n  };\r\n}\r\n\r\n\r\nexport function clickChartSlice(sliceInfo, seriesInfo, groupingStackStr, datasetId, controlId) {\r\n  return {\r\n    type: CLICK_CHART_SLICE,\r\n    payload: {\r\n      sliceInfo,\r\n      seriesInfo,\r\n      groupingStackStr,\r\n      datasetId,\r\n      controlId\r\n    }\r\n  };\r\n}\r\n\r\n\r\nexport function selectChartGroup(groupVal, controlData) {\r\n  return {\r\n    type: SELECT_CHART_GROUP,\r\n    payload: {\r\n      groupVal,\r\n      controlData\r\n    }\r\n  };\r\n}\r\n\r\n\r\nexport function applyImageMapProps(image, newMap, updatedControl) {\r\n  return {\r\n    type: APPLY_IMAGEMAP_PROPS,\r\n    payload: {\r\n      image,\r\n      newMap,\r\n      updatedControl\r\n    }\r\n  };\r\n}\r\n\r\nexport const clickPageLink = (controlData) => {\r\n  return {\r\n    type: CLICK_PAGE_LINK,\r\n    payload: {\r\n      controlData\r\n    }\r\n  }\r\n}","import { SELECT_TOOLPANEL_TREE, \r\n          SELECT_CONTROL, \r\n          SELECT_PAGE,\r\n          UPDATE_DESIGNER_LAYOUT,\r\n          OPEN_LAYOUT,\r\n          UPDATE_CONTROL_PROPS,\r\n          UPDATE_LAYOUT_PROPS,\r\n          DELETE_CONTROL,\r\n          SAVE_DESIGNER_LAYOUT,\r\n          APPLY_IMAGEMAP_PROPS,\r\n          deleteControl} from \"../actions/index\";\r\n\r\nimport {DUMMY_APR_METADATA, OLD_DUMMY_DATA, dropdownOptions, dropdownOptionsFew} from '../helper/dummyMetadata';\r\nimport {uuidv4} from '../helper/util';\r\n\r\n// Note: if using CSS grid to populate the layout, the items must be sorted by row and column\r\n// This is for the Forms layout\r\n// TODO: Control Id's: we need to generate a unique one. Because if you open a saved layout and it has the same id but different props, react will pass cached props.\r\n// Ideally, this function should return immediately if metadata has not been fetched yet.\r\n// \r\nconst generateDefaultLayout = (metadata) => {\r\n\r\n  if (!metadata) {\r\n    return [];\r\n  }\r\n\r\n  const suffix = '-'+ uuidv4();\r\n\r\n  // [1] Section\r\n  return [\r\n  // {i: 'ctrl-combo0', x: 0, y: 0, w: 3, h: 1, ctrlType: 'combo', data: {\r\n  //     placeholder: 'Please select...',\r\n  //     options: dropdownOptions,\r\n  //     label: 'Courses:'\r\n  // }},\r\n\r\n\r\n  {i: 'ctrl-section0'+suffix, x: 0, y: 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n      title: 'Default Section',\r\n      //backgroundColor: 'lightsteelblue'\r\n      level: 1\r\n  }},\r\n\r\n  // {i: 'ctrl-label0X'+suffix, x: 0, y: 1, w: 3, h: 1,ctrlType: 'label', data: {\r\n  //   //label: 'This is the default sample layout. In the Page Designer, chart data being displayed below are sample data only!',\r\n  //   label: 'Default label if API data cannot be acquired',\r\n  //   color: 'black',\r\n  //   backgroundColor: 'khaki',\r\n  //   fontSize: '14',\r\n  //   icon: 'lightbulb',\r\n  //   alignment: 'center',\r\n  //   linkedPage: null,\r\n  //   apiFieldName: null,    \r\n  // }},\r\n\r\n  //[2] Description\r\n  // {i: 'ctrl-richText0'+suffix, x: 0, y: 2, w: 3, h: 4, ctrlType: 'richtext',       \r\n  //     data: {\r\n  //         label: 'Description:',\r\n  //         placeholder: 'Enter Description...',\r\n  //         richTextData: null,\r\n  //         apiFieldName: null,\r\n  //         alignment: 'left',\r\n  //         dataProps: {\r\n  //           datasetId: 1,\r\n  //           requestType: null,\r\n  //           filterName: null,\r\n  //           filterValue: null\r\n  //         }\r\n  //     }},\r\n\r\n  // {i: 'ctrl-frame'+suffix, x: 0, y: 2, w: 3, h: 4, ctrlType: 'frame',       \r\n  // data: {\r\n  //     url: 'https://www.youtube.com/embed/cde9qNtaoog'\r\n  // }},\r\n\r\n  // [2 NEW] Gauge chart\r\n  // {i: 'ctrl-gauge0'+suffix, x: 0, y: 2, w: 6, h: 6, ctrlType: 'gauge',       \r\n  //     data: {\r\n  //         label: 'Gauge:',\r\n  //         dataProps: {\r\n  //           datasetId: \"2\",\r\n  //           requestType: 'GetKpi',\r\n  //           groupings: [], // multiselect\r\n  //           filtersList: [] // excluding analysis period...or we just leave the analysis period to the page-filter?\r\n  //           /*\r\n  //           {name: \"\", value: \"\"}\r\n  //           */\r\n  //         }\r\n  //     }},\r\n\r\n  // [3 new] Pie Chart\r\n  // {i: 'ctrl-pie0X'+suffix, x: 0, y: 2, w: 6, h: 8, ctrlType: 'pie',       \r\n  //     data: {\r\n  //         label: 'Pie:',\r\n  //         dataProps: {\r\n  //           datasetId: \"0\",\r\n  //           requestType: 'GetDeviceCounts',\r\n  //           categories: '',\r\n  //           //aggregation: 'count'\r\n  //         }\r\n  //     }},\r\n\r\n  // // [4 new] Bar Chart\r\n  // {i: 'ctrl-bar0X'+suffix, x: 6, y: 2, w: 6, h: 8, ctrlType: 'barchart',       \r\n  //     data: {\r\n  //         label: 'Bar:',\r\n  //         stacked: false,\r\n  //         dataProps: {\r\n  //           datasetId: \"0\",\r\n  //           requestType: 'GetDeviceCounts',\r\n  //           categories: '', // For a vertical bar chart, this is the X-axis\r\n  //           seriesName: '', // For a vertical bar chart, this is the Y-axis (e.g. count)\r\n  //           //aggregation: 'count'\r\n  //         }\r\n  //     }},\r\n\r\n  // //[2 NEW] Gauge chart\r\n  // {i: 'ctrl-gauge0x'+suffix, x: 0, y: 14, w: 6, h: 4, ctrlType: 'gauge',       \r\n  //     data: {\r\n  //         label: 'Gauge:',\r\n  //         percent: 95.5\r\n  // }},\r\n\r\n  // // Image Map\r\n  // {i: 'ctrl-imageMap0Y'+suffix, x: 6, y:14, w: 6, h: 4,ctrlType: 'imageMap', data: {\r\n  //   label: 'Image Map:',\r\n  //   dataProps: {\r\n  //     datasetId: 1,\r\n  //     requestType: 'GetPlantKpi',\r\n  //     columns: []\r\n  //   },\r\n  //   imageProps: {\r\n  //     image: '',\r\n  //     map: {        \r\n  //         name: '',\r\n  //         areas: []\r\n  //     }\r\n  //   },\r\n  // }},\r\n\r\n  // {i: 'ctrl-table0X'+suffix, x: 0, y:2, w: 12, h: 4,ctrlType: 'table', data: {\r\n  //   label: 'Table:',\r\n  //   showFilters: true,\r\n  //   showPaginator: true,\r\n  //   showFooter: true,\r\n  //   dataProps: {\r\n  //     datasetId: '0', // make it a string. Because if the value is 0, it does not appear as default value of FormText\r\n  //     requestType: 'GetDeviceDetails',\r\n\r\n  //     specifyColumns: true,\r\n  //     // A. Will only be visiable if specifyColumns = true\r\n  //     columns: [],\r\n\r\n  //     // B. Will only be visiable if specifyColumns = false\r\n  //     categories: null,\r\n  //     seriesName: null,\r\n\r\n  //     filterName: null,\r\n  //     filterValue: null,\r\n  //     //aggregation: 'count'\r\n  //   }\r\n  // }},\r\n\r\n\r\n  // // [3] Date\r\n  // {i: 'ctrl-date0', x: 6, y: 1, w: 3, h: 1, ctrlType: 'date'},\r\n\r\n  // // [4] Status\r\n  // {i: 'ctrl-status0', x: 6, y: 2, w: 3, h: 1, ctrlType: 'status'},\r\n\r\n  // [5] Priority\r\n  // {i: 'ctrl-combo0X', x: 9, y: 2, w: 3, h: 1, ctrlType: 'combo', data: {\r\n  //     placeholder: 'Please select...',\r\n  //     options: dropdownOptions,\r\n  //     label: 'Courses:'\r\n  // }},\r\n\r\n  // [6] User\r\n  // {i: 'ctrl-user0', x: 6, y: 4, w: 3, h: 1, ctrlType: 'user'},\r\n  // {i: 'combo1', x: 6, y: 4, w: 3, h: 1, ctrlType: 'combo', data: {\r\n  //     placeholder: 'Please Select...',\r\n  //     options: dropdownOptions,\r\n  //     label: 'Please select:'\r\n  // }},    \r\n\r\n  // [7] Attachments\r\n  //{i: 'ctrl-attachment0', x: 9, y: 1, w: 3, h: 2,ctrlType: 'attachment'},\r\n  // [7 New] Label\r\n  // {i: 'ctrl-label0X', x: 9, y: 1, w: 3, h: 1,ctrlType: 'label', data: {\r\n  //   label: 'I am a label',\r\n  //   color: 'blue',\r\n  //   backgroundColor: 'khaki',\r\n  //   fontSize: '18',\r\n  //   icon: 'tag'\r\n  // }},\r\n\r\n\r\n  // [8] Remarks\r\n  // {i: 'ctrl-textbox0', x: 9, y: 4, w: 3, h: 1,ctrlType: 'textbox', data: {\r\n  //   placeholder: 'Input Remarks...',\r\n  //   label: 'Remarks:'\r\n  // }},\r\n\r\n  // [9] DatePicker\r\n  // {i: 'ctrl-date0X', x: 9, y: 3, w: 3, h: 1,ctrlType: 'date', data: {\r\n  //   label: 'Analysis Period:'\r\n  // }},\r\n\r\n  // [B] Subsection\r\n  // {i: 'ctrl-section1', x: 0, y: 5, w: 12, h: 1, ctrlType: 'section', data: {\r\n  //     title: 'Loop Summary',\r\n  //     //backgroundColor: 'lightsteelblue'\r\n  //     level: 2\r\n  // }},\r\n\r\n  // [1] History\r\n  //{i: 'ctrl-history0', x: 0, y: 6, w: 12, h: 2, ctrlType: 'history'},\r\n\r\n  //[2] Table - 1\r\n  // {i: 'ctrl-table0X'+suffix, x: 0, y:6, w: 12, h: 2,ctrlType: 'table', data: {\r\n  //   label: 'Table:'\r\n  // }},\r\n\r\n  // //[2] Table - 2\r\n  // {i: 'ctrl-table1', x: 3, y: 8, w: 3, h: 2,ctrlType: 'table', data: {\r\n  //   label: 'Table:'\r\n  // }},\r\n  // // [2] Table - 3\r\n  // {i: 'ctrl-table2', x: 6, y: 8, w: 3, h: 2,ctrlType: 'table', data: {\r\n  //   label: 'Table:'\r\n  // }},\r\n  // // [2] Table - 4\r\n  // {i: 'ctrl-table3', x: 9, y: 8, w: 3, h: 2,ctrlType: 'table', data: {\r\n  //   label: 'Table:'\r\n  // }},\r\n\r\n  // dc bar chart\r\n  // {i: 'ctrl-dcbar0', x: 6, y:1, w: 3, h: 4,ctrlType: 'dcbar', data: {\r\n  //   label: 'DC Chart:'\r\n  // }},\r\n  // dc bar chart\r\n  // {i: 'ctrl-imageMap0X', x: 6, y:1, w: 3, h: 4,ctrlType: 'imageMap', data: {\r\n  //   label: 'Image Map:'\r\n  // }},\r\n\r\n  // Line Chart\r\n  // {i: 'ctrl-line0' + suffix, x: 0, y: 2, w:6, h: 6, ctrlType: 'line', data: {\r\n  //   label: 'Line Chart',\r\n  //   unit: '%',\r\n  //   dataProps: {\r\n  //     datasetId: 2,\r\n  //     requestType: 'GetAlarmOccurrenceRatio',\r\n  //     categories: null,\r\n  //     seriesName: null,\r\n  //     filterName: null,\r\n  //     filterValue: null,      \r\n  //   }\r\n  // }}\r\n\r\n  ];\r\n}\r\n\r\nconst defaultLayoutData = {\r\n  columns: 12,\r\n  rows: 20,\r\n  pageFilterFields: [],\r\n  pageApiData: 'https://0kwuefbg37.execute-api.ap-south-1.amazonaws.com/Initial/execsummary'\r\n}\r\n\r\n// This is the default layout for the Dashboard\r\nconst generateDefaultDashboard = () => {\r\n  return [\r\n    // [1] Section Title\r\n    {i: 'ctrl-section0', x: 0, y: 0, w: 12, h: 2, ctrlType: 'section', data: {\r\n        title: 'Plant Overall Status',\r\n        level: 1\r\n    }},\r\n\r\n    // [2] Pie Chart\r\n    {i: 'ctrl-pie0', x: 0, y: 2, w: 4, h: 8, ctrlType: 'pie',       \r\n        data: {\r\n        }\r\n    },\r\n\r\n    // [3] Bar Chart\r\n    {i: 'ctrl-barchart0', x: 4, y: 2, w: 4, h: 8, ctrlType: 'barchart',       \r\n        data: {\r\n        }\r\n    },\r\n\r\n    // Sample combobox\r\n    {i: 'ctrl-combo0', x: 8, y: 2, w: 4, h: 2, ctrlType: 'combo',       \r\n        data: {\r\n        }\r\n    }, \r\n    {i: 'ctrl-combo1', x: 8, y: 4, w: 4, h: 2, ctrlType: 'combo',       \r\n        data: {\r\n        }\r\n    }, \r\n       \r\n  ];\r\n}\r\n\r\n\r\n\r\nconst defaultState = {\r\n    toolPanelTreeSelected: null, // to delete...this is used inside the RGL tab only\r\n    //selectedControlId: null, // Don't put here. Just put inside the controls data. This is to avoid rendering all controls.\r\n    // It is OK to put the selectedControlId inside the reducer for showing the Control Props\r\n    resizingControlId: null, // try to just use local state to keep track. The whole designer only needs to know after resizing.\r\n    layout: generateDefaultLayout(DUMMY_APR_METADATA),\r\n    layoutData: defaultLayoutData,\r\n\r\n    // For the dashboard\r\n    dashLayout: generateDefaultDashboard(),\r\n    dashLayoutData: {},\r\n\r\n    // For the metadata in configuring the data sources\r\n    metadata: OLD_DUMMY_DATA,\r\n\r\n    pageSelected: false\r\n}\r\n\r\nconst defaultControlData = {\r\n  'section': {\r\n    title: 'New Section',\r\n    level: 1\r\n  },\r\n  'richtext': {\r\n    label: 'Rich Text:',\r\n    apiFieldName: null, // \r\n    placeholder: 'Enter value...',\r\n    richTextData: null,\r\n    dataProps: {\r\n      datasetId: 1,\r\n      //requestType: 'GetComments',\r\n      requestType: null,\r\n      filterName: null,\r\n      filterValue: null\r\n    }\r\n  },\r\n  'combo': {\r\n    placeholder: 'Please select...',\r\n    options: dropdownOptionsFew,\r\n    label: 'Combobox:'\r\n  },\r\n  'textbox': {\r\n    placeholder: 'Enter value...',\r\n    label: 'Textbox:'\r\n  },\r\n  'table': {\r\n    label: 'Table:',\r\n    showFilters: true,\r\n    showPaginator: true,\r\n    showFooter: true,\r\n\r\n    dataProps: {\r\n      datasetId: \"0\",\r\n      requestType: 'GetDeviceList',\r\n      specifyColumns: true,\r\n      // A. Will only be visiable if specifyColumns = true\r\n      columns: [],\r\n\r\n      // B. Will only be visiable if specifyColumns = false\r\n      categories: null,\r\n      seriesName: null,\r\n\r\n      filterName: null,\r\n      filterValue: null,\r\n    }\r\n  },\r\n  'pie' : {\r\n    label: 'Pie:',\r\n    dataProps: {\r\n      datasetId: \"0\",\r\n      requestType: 'GetDeviceCounts',\r\n      categories: '',\r\n      //aggregation: 'count'\r\n    }\r\n  },\r\n  'barchart' : {\r\n    label: 'Bar:',\r\n    stacked: false,\r\n    dataProps: {\r\n      datasetId: \"0\",\r\n      requestType: 'GetDeviceCounts',\r\n      categories: '', // For a vertical bar chart, this is the X-axis\r\n      seriesName: '', // For a vertical bar chart, this is the Y-axis (e.g. count)\r\n    }\r\n  },\r\n  'label': {\r\n    label: 'New Label',\r\n    apiFieldName: null, // \r\n    icon: 'lightbulb',\r\n    backgroundColor: 'khaki',\r\n    color: 'black',\r\n    fontSize: '14',\r\n    alignment: '',\r\n    linkedPage: null,\r\n  },\r\n  'gauge': {\r\n    label: 'New Gauge:',\r\n    dataProps: {\r\n      datasetId: \"2\",\r\n      requestType: 'GetKpi',\r\n      groupings: [], // multiselect\r\n      filtersList: {} // excluding analysis period...or we just leave the analysis period to the page-filter?\r\n      /*\r\n      {name: \"\", value: \"\"}\r\n      */\r\n    }\r\n  },\r\n  'pagebreak': {\r\n  },\r\n  'imageMap': {\r\n    label: 'Image Map:',\r\n    dataProps: {\r\n      datasetId: 1,\r\n      requestType: 'GetKpi',\r\n      groupings: []\r\n    },    \r\n    imageProps: {\r\n      image: '',\r\n      map: {        \r\n          name: '',\r\n          areas: []\r\n      }\r\n    }    \r\n  },\r\n  'line': {\r\n    label: 'Line Chart',\r\n    unit: null,\r\n    dataProps: {\r\n      datasetId: 2,\r\n      requestType: 'GetAlarmOccurrenceRatio',\r\n      categories: null,\r\n      seriesName: null,\r\n      filterName: null,\r\n      filterValue: null,\r\n    }\r\n  },\r\n  'frame': {\r\n    //url: 'https://www.youtube.com/embed/cde9qNtaoog'\r\n    url: 'https://www.youtube.com/embed/4lX2osRgM_0'\r\n  }\r\n}\r\n\r\nconst assignIdAndDefaultData = (control, layout) => {\r\n  if (!control.ctrlType) {\r\n    return;\r\n  }\r\n\r\n  if (!control.data) {\r\n    control.data = defaultControlData[control.ctrlType];\r\n  }\r\n  \r\n  // find a suitable default id\r\n  let i = 0;\r\n  while (true) {\r\n    //let currId = 'ctrl-' + control.ctrlType + i++;\r\n    let currId = 'ctrl-' + control.ctrlType + '-' + uuidv4();\r\n    if (layout.find(ctrl => ctrl.i === currId)) {\r\n      continue;\r\n    }\r\n    control.i = currId;\r\n    break;\r\n  }\r\n}\r\n\r\nconst updateLayout = (layout, updatedControls) => {\r\n  // updatedControls is an array of controls\r\n  // it may contain existing controls or \"empty\" controls that have been resized\r\n  if (!layout || !updatedControls) {\r\n    return layout;\r\n  }\r\n\r\n  updatedControls.forEach(control => {\r\n    let findIndex = layout.findIndex(layoutCtrl => layoutCtrl.i === control.i);\r\n    if (findIndex === -1) {\r\n      // means we need to create a new control\r\n      assignIdAndDefaultData(control, layout);\r\n      layout.push(control);\r\n    }\r\n    else {\r\n      // in case the data is null (because it's an empty control previously, just resized)\r\n      if (!control.data) {\r\n        assignIdAndDefaultData(control, layout);\r\n      }\r\n      layout[findIndex] = control;  \r\n    }\r\n  })\r\n\r\n  // TODO Sort the controls based on the \"flat coordinates\"\r\n  // Maybe no need...because when rendering, it is looping from topLeft to botoom right\r\n}\r\n\r\n// Does not cause a rerender. Do not update the property in place (mutate) -- create a new object\r\nconst setControlSelectedOrig = (controlId, newLayout) => {\r\n  newLayout.forEach(control => {\r\n    if (control.i === controlId) {\r\n      control.selected = true;\r\n    }\r\n    else {\r\n      control.selected = false;\r\n    }\r\n  })\r\n}\r\n\r\n// This function will cause only the affected controls (1 or 2 controls) to rerender\r\nconst setControlSelected = (controlId, newLayout) => {\r\n  // Create a new object for the affected controls, instead of updating them\r\n  let affectedControls = [];\r\n  newLayout.forEach(control => {\r\n    if (control.selected) {\r\n      if (control.i !== controlId) {\r\n        affectedControls.push({...control, selected: false});\r\n      }\r\n    }\r\n    else if (control.i === controlId) {\r\n      affectedControls.push({...control, selected: true});\r\n    }\r\n  });\r\n\r\n  // Remove the old control and push the new objects\r\n  affectedControls.forEach(ctrl => {\r\n    let index = newLayout.findIndex(x => x.i === ctrl.i);\r\n    newLayout.splice(index, 1);\r\n    newLayout.push(ctrl);\r\n  });  \r\n}\r\n\r\nconst unselectAllControls = (newLayout) => {\r\n  let affectedControls = [];\r\n  newLayout.forEach(control => {\r\n    if (control.selected) {      \r\n        affectedControls.push({...control, selected: false});\r\n      }\r\n    }\r\n  );\r\n\r\n  // Remove the old control and push the new objects\r\n  affectedControls.forEach(ctrl => {\r\n    let index = newLayout.findIndex(x => x.i === ctrl.i);\r\n    newLayout.splice(index, 1);\r\n    newLayout.push(ctrl);\r\n  });  \r\n}\r\n\r\nconst updateControlProps = (updatedControl, newLayout) => {\r\n  let findControlIndex = newLayout.findIndex(ctrl => ctrl.i === updatedControl.i);\r\n  if (findControlIndex < 0) {\r\n    return;\r\n  }\r\n\r\n  let newControl = {...newLayout[findControlIndex], data: updatedControl.data};\r\n  // Remove the old control and push the new object\r\n  newLayout.splice(findControlIndex, 1);\r\n  newLayout.push(newControl);\r\n}\r\n\r\nconst updateControlImgMapProps = (actionPayload, newLayout) => {\r\n  let {image, newMap, updatedControl} = actionPayload;\r\n  let findControlIndex = newLayout.findIndex(ctrl => ctrl.i === updatedControl.i);\r\n  if (findControlIndex < 0) {\r\n    return;\r\n  }\r\n\r\n  let newControl = {...newLayout[findControlIndex], data: updatedControl.data};\r\n  newControl.data.imageProps = {\r\n    image: image,\r\n    map: newMap\r\n  }\r\n  // Remove the old control and push the new object\r\n  newLayout.splice(findControlIndex, 1);\r\n  newLayout.push(newControl);\r\n}\r\n\r\nconst updateLayoutProps = (updatedLayoutProps) => {\r\n  return {...updatedLayoutProps, \r\n    rows: parseInt(updatedLayoutProps.rows)\r\n  };\r\n}\r\n\r\nconst handleDeleteControl = (deletedControl, newLayout) => {\r\n  let findControlIndex = newLayout.findIndex(ctrl => ctrl.i === deletedControl.i);\r\n  if (findControlIndex < 0) {\r\n    return;\r\n  }\r\n\r\n  newLayout.splice(findControlIndex, 1);\r\n}\r\n\r\nexport default function(state = defaultState, action) {  \r\n  switch (action.type) {\r\n    case SELECT_TOOLPANEL_TREE:\r\n      return {\r\n        ...state,\r\n        toolPanelTreeSelected: action.payload\r\n      };\r\n    case SELECT_CONTROL:\r\n      let newStateSelectCtrl = {...state};\r\n      newStateSelectCtrl.pageSelected = false;\r\n      //newStateSelectCtrl.layout = [...state.layout]; // No need. If you do this, the entire designer will rerender, but only the empty controls will rerender\r\n      setControlSelected(action.payload, newStateSelectCtrl.layout);\r\n      return newStateSelectCtrl;\r\n    case SELECT_PAGE:\r\n      // a. unselect selected controls\r\n      // b. \r\n      let newStateSelectPage = {...state};\r\n      newStateSelectPage.pageSelected = true;\r\n      unselectAllControls(newStateSelectPage.layout);\r\n      return newStateSelectPage;  \r\n    case UPDATE_DESIGNER_LAYOUT:\r\n        let updatedControls = action.payload;\r\n        let newState = {\r\n          ...state,          \r\n        };\r\n        // Need to re-initialize the layout array too, otherwise formDesignerContent won't re-render\r\n        // I think minimum we just need to create new objects for the affected controls. \r\n        // ...But the empty controls won't rerender and there might be a need to rerender them. So just update the entire array\r\n        newState.layout = [...state.layout];\r\n        updateLayout(newState.layout, updatedControls);        \r\n\r\n        return newState;\r\n    case UPDATE_CONTROL_PROPS:\r\n        let newStateUpdProps = {\r\n          ...state,          \r\n        };\r\n\r\n        updateControlProps(action.payload, newStateUpdProps.layout); \r\n\r\n        return newStateUpdProps;\r\n    case APPLY_IMAGEMAP_PROPS:\r\n      let newStateUpdImageMapProps = {\r\n        ...state,          \r\n      };\r\n\r\n      updateControlImgMapProps(action.payload, newStateUpdImageMapProps.layout); \r\n\r\n      return newStateUpdImageMapProps;\r\n    case UPDATE_LAYOUT_PROPS:\r\n      let newStateUpdLayoutProps = {\r\n        ...state,          \r\n      };\r\n\r\n      newStateUpdLayoutProps.layoutData = updateLayoutProps(action.payload); \r\n\r\n      return newStateUpdLayoutProps;\r\n    case DELETE_CONTROL:\r\n      let newStateDeleteControl = {\r\n        ...state,          \r\n      };\r\n      newStateDeleteControl.layout = [...state.layout];\r\n\r\n      handleDeleteControl(action.payload, newStateDeleteControl.layout);\r\n      return newStateDeleteControl;\r\n    case SAVE_DESIGNER_LAYOUT:\r\n      // TODO: After a successful Save, server will return the object saved\r\n      // It's expected to be the same, but ideally we should replace local state's object with the one from the server\r\n      // Just update the name\r\n      // debugger\r\n      // return {\r\n      //   ...state,\r\n      //   layoutData: {...state.layoutData, name: action.payload.name},\r\n      // }\r\n      break;\r\n    case OPEN_LAYOUT:\r\n      return {\r\n        ...state,\r\n        layout: [...action.payload.controls],\r\n        layoutData: action.payload.layoutData,\r\n      }\r\n      \r\n  }\r\n  return state;\r\n}\r\n","export const DUMMY_APR_METADATA = {\r\n\tname: \"PRM APR\",\r\n  //server: \"http://10.131.27.49:60000/api/data\",\r\n  //server: \"http://10.48.100.175:5000/device\",\r\n  //server: \"http://localhost:7000/api/device\",\r\n  //server: \"http://10.48.100.175:5000/api/isae/device\",\r\n  server: \"http://10.48.100.175:5001/api/isae/device\",\r\n\t// Will help the server \r\n\trequestTypes: [\r\n\t\t{\r\n\t\t\tname: \"GetKpi\",\r\n\t\t\t// Put the description in a tooltip, to that user/engineer will know which one to choose\r\n\t\t\tdescription: \"For fetching Organization/Site/Plant/PRM Level KPI's\"\r\n\t\t},\r\n\t\t// {\r\n\t\t// \t// For image map\r\n\t\t// \tname: \"GetPlantKpi\",\t\t\t\r\n\t\t// \tdescription: \"For getting plant KPI\"\r\n\t\t// },\t\t\r\n\t\t{\r\n\t\t\tname: \"GetDeviceList\",\r\n\t\t\tdescription: \"For querying device details only, without groupings/aggregations\"\r\n\t\t},\r\n\t\t{\r\n\t\t\tname: \"GetDeviceCounts\",\r\n\t\t\tdescription: \"For performing aggregations on Device properties like Vendor/Model\"\r\n\t\t},\r\n\t\t// {\r\n\t\t// \tname: \"GetDeviceTrendValues\",\r\n\t\t// \tdescription: \"For line charts, e.g. getting ODE/TA/PA for each month/week/day/year\"\r\n\t\t// },\r\n\t\t// {\r\n\t\t// \tname: \"GetAlarmDetails\",\r\n\t\t// \tdescription: \"For querying the alarm properties\"\r\n\t\t// },\r\n\t\t{\r\n      //name: \"GetAlarmCounts\",\r\n      name: \"GetAlarmTypeCounts\",\r\n\t\t\tdescription: \"For querying the count of alarms per day\"\r\n\t\t},\r\n\t\t// {\r\n\t\t// \tname: \"GetAlarmTrendValues\",\r\n\t\t// \tdescription: \"For line charts, e.g. number of alarms per month/week/year\"\r\n    // },\r\n    {\r\n\t\t\tname: \"GetComments\",\r\n\t\t\tdescription: \"For getting the comments (text string) of the given alarm type\"\r\n    },\r\n    {\r\n\t\t\tname: \"GetAlarmTypeRateFrequencyWithLatestStatus\",\r\n\t\t\tdescription: \"For showing the alarm type rate of devices (e.g. Communication Error)\"\r\n    },\r\n    {\r\n\t\t\tname: \"GetAlarmRateFrequencyWithLatestStatus\",\r\n\t\t\tdescription: \"For showing the alarm rate of devices (e.g. PV Out of Limits)\"\r\n    },\r\n    {\r\n\t\t\tname: \"GetAlarmOccurrenceRatio\",\r\n\t\t\tdescription: \"For getting the alarm occurrence ratio of a particular alarm during the given Analysis Period\"\r\n    },\r\n    {\r\n\t\t\tname: \"GetAlarmTypeOccurrenceRatio\",\r\n\t\t\tdescription: \"For getting the alarm type occurrence ratio of a particular alarm during the given Analysis Period\"\r\n    },\r\n    {\r\n\t\t\tname: \"GetPlantInfo\",\r\n\t\t\tdescription: \"For getting the plant info like PRM Station, Name, Revision etc.\"\r\n    },\r\n    {\r\n\t\t\tname: \"GetAchievement\",\r\n\t\t\tdescription: \"For getting the Achievement data of the Plant for a particular phase\"\r\n\t\t},\r\n\t],\r\n\t\r\n\trequestParams: [\r\n\t\t// Place here the user inputs that are not part of the dimensions\r\n\t\t{\r\n\t\t\t// Let the user select/modify the Analysis Period when viewing the pages\r\n\t\t\tname: 'AnalysisPeriod',   \r\n\t\t\tdataType: 'Date Range',   \r\n      enumValues: ['Latest value only', 'Last 1 day', 'Last 7 days', 'Last 30 days', 'Custom Range'],\r\n      defaultValue: 'Last 30 days'\r\n\t\t},\r\n\t],\r\n\t// the groupings is for UI organization only.\r\n\t// the important thing is that all the names must be unique\r\n\t// all unique names must be recognized by the backend\r\n\tdimensions: [\r\n\t\t{\r\n\t\t\t// Put here the Device properties that don't normally change frequently\r\n\t\t\tname: \"Device Properties\",\r\n\t\t\tdataType: \"group\",\r\n\t\t\titems: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Device_Id\",\r\n\t\t\t\t\tdataType: \"string\",\t\t\r\n\t\t\t\t\taggregations: [\"count\"],\r\n\t\t\t\t\t// requestTypes: [\"GetDeviceDetails\", \"GetDeviceCounts\"]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Device_Tag\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Comm_Type\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Device_Path\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"]\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Category\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"]\r\n        },\r\n        {\r\n          // The parent folder of this device (not the full hierarchy)\r\n\t\t\t\t\tname: \"Plant_Hierarchy\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"]\r\n\t\t\t\t},\r\n        {\r\n\t\t\t\t\tname: \"Priority\",\r\n\t\t\t\t\tdataType: \"enum\",\r\n\t\t\t\t\tenumValues: [\"Low\", \"Medium\", \"High\", \"High+\"],\r\n\t\t\t\t\taggregations: [\"count\"]\r\n\t\t\t\t},\r\n\t\t\t\t// Just repeat for other common attributes like Device Description\r\n\t\t\t\t\r\n\t\t\t\t// Hierarchical attributes - start\r\n\t\t\t\t{\r\n\t\t\t\t\t// Hierarchical: so that can perform dynamic grouping in Charts\r\n\t\t\t\t\tname: \"Vendor Model Info\",\r\n\t\t\t\t\tdataType: \"group\",\r\n\t\t\t\t\taggregations: [],\r\n\t\t\t\t\titems: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tname: \"Vendor\",\r\n\t\t\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\t\t\taggregations: [\"count\"],\r\n\t\t\t\t\t\t\titems: [\r\n\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\tname: \"Model\",\r\n\t\t\t\t\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\t\t\t\t\taggregations: [\"count\"],\r\n\t\t\t\t\t\t\t\t\titems: [\r\n                    {\r\n                      name: \"Revision\",\r\n                      dataType: \"string\",\r\n                      aggregations: [\"count\"],\r\n                    }\r\n\t\t\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t},\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"Path\",\r\n\t\t\t\t// \tdataType: \"group\",\r\n\t\t\t\t// \taggregations: [],\r\n\t\t\t\t// \titems: [\r\n\t\t\t\t// \t\t{\r\n\t\t\t\t// \t\t\t// Assume PRM Plant Hierarchy. Repeat similar structure for Network Hierarchy, Class Hierarchy etc.\r\n\t\t\t\t// \t\t\tname: \"Plant Name\",\r\n\t\t\t\t// \t\t\tdataType: \"string\",\r\n\t\t\t\t// \t\t\taggregations: [\"count\"],\r\n\t\t\t\t// \t\t\titems: [\r\n        //         {\r\n        //           name: \"Area\",\r\n        //           dataType: \"string\",\t\t\t\t\t\t\t\r\n        //           aggregations: [\"count\"],\r\n        //           items: [\r\n        //             {\r\n        //               name: \"Unit\",\r\n        //               dataType: \"string\",\r\n        //               aggregations: [\"count\"],\r\n        //             }\r\n        //           ]\r\n        //         }\r\n\t\t\t\t// \t\t\t]\r\n\t\t\t\t// \t\t}\r\n\t\t\t\t// \t]\r\n\t\t\t\t// }\r\n\t\t\t\t// Hierarchical attributes - end\t\t\t\r\n\t\t\t] // END: Device Info - items\r\n\t\t}, // END: Device Info group\r\n\t\t{\r\n\t\t\tname: \"Device KPI's\",\r\n\t\t\tdataType: \"group\",\r\n\t\t\titems: [\r\n\t\t\t\t// {\r\n\t\t\t\t// \t// Repeat for TA and PA\r\n\t\t\t\t// \tname: \"ODE\", // TODO: We can also create another group called \"Device Availability\"\r\n\t\t\t\t// \tdataType: \"group\",\r\n\t\t\t\t// \titems: [\r\n\t\t\t\t// \t\t{\r\n\t\t\t\t// \t\t\tname: \"ODE Value\", // e.g. 99.5%\r\n\t\t\t\t// \t\t\tdataType: \"number\",\r\n\t\t\t\t// \t\t\taggregations: [], // no aggregation\r\n\t\t\t\t// \t\t},\r\n\t\t\t\t// \t\t{\r\n\t\t\t\t// \t\t\tname: \"ODE Status\", // e.g.     \r\n\t\t\t\t// \t\t\tdataType: \"enum\",\r\n\t\t\t\t// \t\t\tenumValues: [1, 2, 3, 4, 5],\r\n\t\t\t\t// \t\t\taggregations: [\"count\"],\r\n\t\t\t\t// \t\t},\t\t\t\t\t\t\r\n\t\t\t\t// \t]\r\n\t\t\t\t// },\r\n\t\t\t\t{\r\n\t\t\t\t\t// Repeat for NE107 Device Status\r\n\t\t\t\t\tname: \"PRM Device Status\", // TODO: We can also create another group called \"Device Availability\"\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n        },\r\n        {\r\n\t\t\t\t\tname: \"Rate (%)\", // used in GetAlarmTypeRateFrequencyWithLatestStatus\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n        },\r\n        {\r\n\t\t\t\t\tname: \"Frequency\", // used in GetAlarmTypeRateFrequencyWithLatestStatus\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n        },\r\n        {\r\n\t\t\t\t\tname: \"LatestStatus\", // Date of last status update, used in GetAlarmTypeRateFrequencyWithLatestStatus\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n        },\r\n        {\r\n\t\t\t\t\tname: \"Status\", // used in GetAlarmTypeRateFrequencyWithLatestStatus\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n\t\t\t\t},\r\n\t\t\t]\r\n    },\r\n    {\r\n      name: 'Device Summaries',\r\n      dataType: \"group\",\r\n\t\t\titems: [\r\n        {\r\n          name: 'Device Count',\r\n          dataType: \"number\",\r\n          aggregations: [], // no aggregation\r\n        }\r\n      ]\r\n    },\r\n\t\t{\r\n\t\t\tname: \"Alarm Info\",\r\n\t\t\tdataType: \"group\",\r\n\t\t\titems: [\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"AlarmTimestamp\",\r\n\t\t\t\t// \tdataType: \"datetime\",\r\n\t\t\t\t// },\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"StartDate\",\r\n\t\t\t\t// \tdataType: \"datetime\",\r\n\t\t\t\t// },\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"EndDate\",\r\n\t\t\t\t// \tdataType: \"datetime\",\r\n\t\t\t\t// },\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"EventType\",\r\n\t\t\t\t// \tdataType: \"string\",\r\n\t\t\t\t// \taggregations: [\"count\"],\r\n\t\t\t\t// },\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"Alarm Message\",\r\n\t\t\t\t// \tdataType: \"string\",\r\n\t\t\t\t// \taggregations: [\"count\"],\r\n\t\t\t\t// },\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Alarm Type\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n        },\r\n        {\r\n\t\t\t\t\tname: \"Alarm_Name\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n        },\r\n        {\r\n\t\t\t\t\tname: \"Alarm\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n\t\t\t\t},\r\n\t\t\t]\r\n    }, // END: Alarms Info\r\n    {\r\n      name: 'Alarm Summaries',\r\n      dataType: \"group\",\r\n\t\t\titems: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Alarm Count\",\r\n          dataType: \"number\",\r\n          aggregations: [], // no aggregation\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Alarm Occurrence Ratio\",\r\n          dataType: \"number\",\r\n          aggregations: [], // no aggregation\r\n\t\t\t\t},\r\n      ]\r\n    },\r\n    {\r\n      name: \"Plant Info\",\r\n      dataType: \"group\",\r\n      items: [\r\n        {\r\n\t\t\t\t\tname: \"Hierarchy\",\r\n\t\t\t\t\tdataType: \"group\",\r\n\t\t\t\t\taggregations: [],\r\n\t\t\t\t\titems: [\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t// Assume PRM Plant Hierarchy. Repeat similar structure for Network Hierarchy, Class Hierarchy etc.\r\n\t\t\t\t\t\t\tname: \"Organization\",\r\n\t\t\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\t\t\taggregations: [\"count\"],\r\n\t\t\t\t\t\t\titems: [\r\n                {\r\n                  name: \"Site\",\r\n                  dataType: \"string\",\t\t\t\t\t\t\t\r\n                  aggregations: [\"count\"],\r\n                  items: [\r\n                    {\r\n                      name: \"Plant\",\r\n                      dataType: \"string\",\r\n                      aggregations: [\"count\"],\r\n                      items: [\r\n                        {\r\n                          name: \"PRM Id\",\r\n                          dataType: \"string\",\r\n                          aggregations: [\"count\"],\r\n                        }\r\n                      ]\r\n                    }\r\n                  ]\r\n                }\r\n\t\t\t\t\t\t\t]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n      ]\r\n    },\r\n\t\t{\r\n\t\t\tname: \"Plant KPI\",\r\n\t\t\tdataType: \"group\",\r\n\t\t\titems: [\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"Plant Id\",\r\n\t\t\t\t// \tdataType: \"string\",\r\n\t\t\t\t// \taggregations: [\"count\"],\r\n\t\t\t\t// },\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"Plant Type\",\r\n\t\t\t\t// \tdataType: \"string\", //e.g. PRM, ISAE\r\n\t\t\t\t// \taggregations: [\"count\"],\r\n\t\t\t\t// },\r\n\t\t\t\t// {\r\n\t\t\t\t// \tname: \"Plant KPI Score\",\r\n\t\t\t\t// \tdataType: \"number\"\r\n        // },\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Phase\",\r\n\t\t\t\t\tdataType: \"string\",\r\n\t\t\t\t\taggregations: [\"count\"],\r\n\t\t\t\t},        \r\n\t\t\t]\r\n\t\t},\r\n\t\t// {\r\n\t\t// \tname: \"Overall KPI\",\r\n\t\t// \tdataType: \"group\",\r\n\t\t// \titems: [\r\n\t\t// \t\t{\r\n\t\t// \t\t\tname: \"Total Organization KPI\",\r\n\t\t// \t\t\tdataType: \"number\",\r\n\t\t// \t\t},\r\n\t\t// \t\t{\r\n\t\t// \t\t\t// It's in the Mockup spec...\r\n\t\t// \t\t\tname: \"PRM Readiness Status\",\r\n\t\t// \t\t\tdataType: \"string\", // e.g. \"3/5\"\r\n\t\t// \t\t},\r\n\t\t// \t\t{\r\n\t\t// \t\t\tname: \"ISAE Readiness Status\",\r\n\t\t// \t\t\tdataType: \"string\", // e.g. \"0/0\"\r\n\t\t// \t\t},\r\n\t\t// \t\t{\r\n\t\t// \t\t\tname: \"CurrentPhase\",\r\n\t\t// \t\t\tdataType: \"string\", // e.g. \"Phase 1\"\r\n\t\t// \t\t},\r\n\t\t// \t\t{\r\n\t\t// \t\t\tname: \"Plant KPI Status\",\r\n\t\t// \t\t\tdataType: \"string\", // e.g. Notmal, High Risk, Non-Visualized\r\n\t\t// \t\t},\t\t\t\t\r\n\t\t// \t]\r\n\t\t\t\r\n    // }, // END: Overall KPI\r\n    {\r\n\t\t\tname: \"Timestamp\",\r\n\t\t\tdataType: \"group\",\r\n\t\t\titems: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Year\",\r\n\t\t\t\t\tdataType: \"string\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Month\",\r\n\t\t\t\t\tdataType: \"string\"\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"Day\",\r\n\t\t\t\t\tdataType: \"datetime\"\r\n\t\t\t\t},\r\n\t\t\t]\r\n\t\t}, // END: Timestamp\r\n\t],\r\n};\r\n\r\n// Keep the old dummy data just for compatibility with some obsoleted features\r\n// DataTypes:\r\n// [Percent]  e.g. ODE, TA, PA. Cannot be used in pie chart\r\n// [Number]   e.g. Total Alarms. Children count can be summed up.\r\n// [Not specified] means it is string value\r\n\r\n// Note: this metadata set is for device-level metadata\r\n//  TODO: We need to fetch the comment library stuff also\r\n// We also need to define a metadata for alarm-level metadata\r\nexport const OLD_DUMMY_DATA = {\r\n    name: 'Device Metadata',\r\n    // Defines how other Dataset-types can link to this Dataset.\r\n    // For example, Alarms data can be linked to this dataset via DeviceId\r\n    // This also defines the unit of Data. Means this data has a DeviceId\r\n    dataKey: 'DeviceId', // This should be one of the dimensions\r\n    RequestParams: [\r\n      {\r\n        name: 'AnalysisPeriod',\r\n        dataTypes: ['Date Range'],\r\n        enumValues: ['Latest value only', 'Last 1 day', 'Last 7 days', 'Last 30 days', 'Custom Range']\r\n      },\r\n      // {\r\n        // I think no need...since this is already defined in the Dimensions. We only include the \"special\" ones that are not inside the Dimensions\r\n        // name: 'Path',\r\n        // dataTypes: ['string'],\r\n      // },    \r\n    ],\r\n    Dimensions: [\r\n      {\r\n        // TODO: Maybe we remove the Device Info layer (i.e. Vendor, Model etc are first level dimensions)\r\n        // In a relational DB, for PRM, we need to put Device Info in another table (separate from Hierarchy table) because there can be multiple hierarchy views\r\n        // In a noSQL DB, we can flatten this out when storing\r\n        name: 'Device Info',\r\n        dataTypes: ['group'],   \r\n        // supported controls: ['pie', 'bar']\r\n        items: [\r\n          {\r\n            name: 'Device ID',\r\n            dataTypes: ['string'],\r\n          },\r\n          {\r\n            name: 'Device Tag',\r\n            dataTypes: ['string'],   \r\n          },\r\n          {\r\n            name: 'Priority',\r\n            dataTypes: ['Enum'],   \r\n            enumValues: ['Low', 'Medium', 'High', 'High+'],\r\n  \r\n            // measures: to be used only in request data if client wants server to provide the calculated value already, instead of client computing for the value\r\n            // But client can use this info to populate some ui configs?\r\n            measures: [\r\n              {\r\n                name: 'Count',\r\n                expression: 'count'\r\n              }\r\n            ]\r\n          },      \r\n          {\r\n            name: 'Category',\r\n            dataTypes: ['string'],   \r\n          },           \r\n          {\r\n            name: 'FullPath',\r\n            dataTypes: ['string'],   \r\n          }        \r\n        ]\r\n      }, // End: Device Info group\r\n      {\r\n        name: 'VendorModel Info',\r\n        dataTypes: ['group'],   \r\n        items: [\r\n          {\r\n            name: 'Vendor',\r\n            dataTypes: ['string', 'group'],\r\n            items: [\r\n              {\r\n                name: 'Model',\r\n                dataTypes: ['string'],\r\n                items: [\r\n                  {\r\n                    name: 'Revision',\r\n                    dataTypes: ['string'],\r\n                  }\r\n                ]    \r\n              }\r\n            ]\r\n          }\r\n        ]\r\n      }, // End: Vendor Model group\r\n      {\r\n        name: 'Device Status',\r\n        dataTypes: ['group'],\r\n        items: [\r\n          {\r\n            name: 'PRM Device Status',          \r\n            enumValues: ['Abnormal', 'Warning', 'Communication Error', 'Uncertain', 'Normal'],\r\n            dataTypes: ['Enum']\r\n          },\r\n          {\r\n            name: 'NE107 Device Status',          \r\n            enumValues: ['Failure', 'Check Function', 'Out of Specification', 'Maintenance Required', 'Communication Error', 'Unknown,Normal'],\r\n            dataTypes: ['Enum']\r\n          },\r\n        ]\r\n      },\r\n      {\r\n        name: 'Device Status Timing Breakdown',\r\n        dataTypes: ['group'],\r\n        items: [\r\n          {\r\n            name: 'Good%',\r\n            dataTypes: ['Percent']\r\n          },\r\n          {\r\n            name: 'Bad%',\r\n            dataTypes: ['Percent']\r\n          },\r\n          {\r\n            name: 'Fair%',\r\n            dataTypes: ['Percent']\r\n          },\r\n          {\r\n            name: 'Uncertain%',\r\n            dataTypes: ['Percent']\r\n          },\r\n        ]\r\n      },\r\n      {\r\n        name: 'Device Availability',\r\n        value: 'Device Availability',\r\n        items: [\r\n          {\r\n            name: 'ODE',\r\n            items: [\r\n              {\r\n                name: 'Status',\r\n                dataTypes: ['Enum'],\r\n                enumValues: [1, 2, 3, 4, 5], // These are these nameless icons in FA KPI \r\n              },\r\n              {\r\n                name: 'Value',\r\n                dataTypes: ['Number'],\r\n              }\r\n            ]          \r\n          },\r\n          {\r\n            name: 'TA',\r\n            items: [\r\n              {\r\n                name: 'Status',\r\n                dataTypes: ['Enum'],\r\n                enumValues: [1, 2, 3, 4, 5], // These are these nameless icons in FA KPI \r\n              },\r\n              {\r\n                name: 'Value',\r\n                dataTypes: ['Number'],\r\n              }\r\n            ]          \r\n          },\r\n          {\r\n            name: 'PA',\r\n            items: [\r\n              {\r\n                name: 'Status',\r\n                dataTypes: ['Enum'],\r\n                enumValues: [1, 2, 3, 4, 5], // These are these nameless icons in FA KPI \r\n              },\r\n              {\r\n                name: 'Value',\r\n                dataTypes: ['Number'],\r\n              }\r\n            ]          \r\n          },\r\n        ]\r\n      },\r\n      {\r\n        name: 'Alarm Info',\r\n        value: 'Alarm Info',\r\n        items: [\r\n          {\r\n            name: 'Alarm Frequency',\r\n            dataTypes: ['Number']\r\n          },\r\n          {\r\n            name: 'AE Occurring',\r\n            dataTypes: ['Boolean']\r\n          },\r\n          {\r\n            name: 'Raw Alarms',\r\n            dataTypes: ['Annotation']\r\n          },\r\n        ]\r\n      },\r\n  \r\n      {\r\n        // Also possible: Network Path, class Path etc.\r\n        // For ISAE case, might not be possible since the hierarchy is not strucured\r\n        // So for ISAE case, it will just be single level Path\r\n        name: 'Path', // Assume Plant Path for now\r\n        value: 'Path',\r\n        items: [\r\n          {\r\n            name: 'Plant', //e.g. MYPJT\r\n            dataTypes: ['string', 'group'],\r\n            items: [\r\n              {\r\n                name: 'Site',\r\n                dataTypes: ['string', 'group'],\r\n                items: [\r\n                  {\r\n                    name: 'Area',\r\n                    dataTypes: ['string', 'group'],\r\n                    items: [\r\n                      {\r\n                        name: 'Unit',\r\n                        dataTypes: ['string'],\r\n                      },\r\n                    ]\r\n                  },\r\n                ]\r\n              },\r\n            ]\r\n          },\r\n        ]\r\n      },  \r\n    ]\r\n  };\r\n  \r\n  const alarmsDummyMetadata = {\r\n    name: 'Alarms Metadata',\r\n    dataKey: 'alarmId', // null, if it's not available. Means this is not open for 'extension'\r\n    RequestParams: [\r\n      {\r\n        // If this is the only parameter, retrievea all the alarms from within the Analysis Period\r\n        // TODO: Consider adding a 'required' flag\r\n        name: 'AnalysisPeriod',   \r\n        dataTypes: ['Date Range'],   \r\n        enumValues: ['Last 1 day', 'Last 7 days', 'Last 30 days', 'Custom Range']\r\n      },\r\n      {\r\n        // Sample only -- no need to declare this as Device Id is already part of the Dimensions\r\n        // name: 'Device Id',   \r\n        // dataTypes: ['string'],   \r\n      },\r\n      {\r\n        name: 'RequestKey',\r\n        dataTypes: ['string'],   \r\n      }\r\n    ],\r\n    Dimensions: [\r\n      {\r\n        name: 'Timestamp',\r\n        dataTypes: ['Datetime']\r\n      },\r\n      {\r\n        name: 'Start Date',\r\n        dataTypes: ['Datetime']\r\n      },\r\n      {\r\n        name: 'End Date',\r\n        dataTypes: ['Datetime']\r\n      },\r\n      {\r\n        name: 'Event Type',\r\n        dataTypes: ['string']\r\n      },\r\n      {\r\n        name: 'Message',\r\n        dataTypes: ['string']\r\n      },\r\n  \r\n    ]\r\n  }\r\n  \r\n  const allDummyMetadata = [];\r\n\r\n\r\n  export const dropdownOptions = [\r\n    { key: 'angular', text: 'Angular', value: 'angular' },\r\n    { key: 'css', text: 'CSS', value: 'css' },\r\n    { key: 'design', text: 'Graphic Design', value: 'design' },\r\n    { key: 'ember', text: 'Ember', value: 'ember' },\r\n    { key: 'html', text: 'HTML', value: 'html' },\r\n    { key: 'ia', text: 'Information Architecture', value: 'ia' },\r\n    { key: 'javascript', text: 'Javascript', value: 'javascript' },\r\n    { key: 'mech', text: 'Mechanical Engineering', value: 'mech' },\r\n    { key: 'meteor', text: 'Meteor', value: 'meteor' },\r\n    { key: 'node', text: 'NodeJS', value: 'node' },\r\n    { key: 'plumbing', text: 'Plumbing', value: 'plumbing' },\r\n    { key: 'python', text: 'Python', value: 'python' },\r\n    { key: 'rails', text: 'Rails', value: 'rails' },\r\n    { key: 'react', text: 'React', value: 'react' },\r\n    { key: 'repair', text: 'Kitchen Repair', value: 'repair' },\r\n    { key: 'ruby', text: 'Ruby', value: 'ruby' },\r\n    { key: 'ui', text: 'UI Design', value: 'ui' },\r\n    { key: 'ux', text: 'User Experience', value: 'ux' },\r\n    { key: 'test1', text: 'A quick brown fox jumps over the lazy dog', value: 'test1' },\r\n    { key: 'test2', text: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&*()_+', value: 'test2' },\r\n    { key: 'test3', text: '', value: 'test3' },\r\n  ];\r\n  \r\nexport const dropdownOptionsFew = [\r\n    { key: 'apple', text: 'Apple', value: 'apple' },\r\n    { key: 'banana', text: 'Banana', value: 'banana' },\r\n    { key: 'carrot', text: 'Carrot', value: 'carrot' },\r\n    { key: 'dolphin', text: 'Dolphin', value: 'dolphin' },\r\n    { key: 'elephant', text: 'Elephant', value: 'elephant' },\r\n    { key: 'fish', text: 'Fish', value: 'fish' },\r\n    { key: 'grapefruit', text: 'Grapefruit', value: 'grapefruit' },\r\n    { key: 'hummingbird', text: 'Humming Bird', value: 'hummingbird' },\r\n    { key: 'iguana', text: 'Iguana', value: 'iguana' },\r\n  ];\r\n","import { CLICK_MENU, \r\n  DRAG_TOOLITEM_START, \r\n  SELECT_TOOLPANEL_TREE, \r\n  FETCH_HIERARCHY, \r\n  FETCH_HIERARCHYVIEWS,\r\n  FETCH_AVAILABLEDATA, \r\n  FETCH_SAVEDLAYOUTS,\r\n  FETCH_IMAGES,\r\n  SAVE_DESIGNER_LAYOUT } from \"../actions/index\";\r\nimport {DUMMY_APR_METADATA} from '../helper/dummyMetadata';\r\n\r\n// Assumption: All these data is for 1 tenant only\r\nconst defaultState = {\r\n    activeMenu: 'formsDesigner',\r\n    tabIndex: 4,\r\n    // temp state only, until react-grid-layout fixes the bug for onDrop parameters\r\n    draggingToolItem: null,\r\n    toolPanelTreeSelected: null,\r\n    masterHierarchy: null,\r\n    masterAvailableData: null,\r\n    masterLayouts: [],\r\n    masterHierarchyViews: null,\r\n    // For the data retrieval\r\n    masterMetadata: DUMMY_APR_METADATA,\r\n    masterImages: []\r\n}\r\n\r\n// TODO: Should move this to a constant location\r\nconst tabIndexMapping = {\r\n  mapView: 0,\r\n  analysisView: 1,  \r\n  home: 2,\r\n  downloadCenter: 3,\r\n  formsDesigner: 4,\r\n  hierarchyDesigner: 5,\r\n  //dataSources: 6,\r\n\r\n  //affiliate: 6,\r\n  // dashboardDesigner: 7,\r\n  // dataDesigner: 8,\r\n  // trialPage: 9,\r\n  settings: 6\r\n}\r\n\r\nconst addOrUpdateLayout = (stateLayouts, newLayout) => {\r\n  let findSameLayoutIndex = stateLayouts.findIndex(s => s.name === newLayout.name);\r\n  if (findSameLayoutIndex < 0) {\r\n    stateLayouts.push(newLayout);\r\n  }\r\n  else {\r\n    stateLayouts.splice(findSameLayoutIndex, 1, newLayout);\r\n  }\r\n}\r\n\r\nexport default function(state = defaultState, action) {\r\n  if ([CLICK_MENU, DRAG_TOOLITEM_START, SELECT_TOOLPANEL_TREE, FETCH_HIERARCHY, FETCH_AVAILABLEDATA, SAVE_DESIGNER_LAYOUT, FETCH_HIERARCHYVIEWS, FETCH_IMAGES].includes(action.type)) {\r\n    console.log('[DEBUG] reducer_mainApp', action, state);\r\n  }\r\n  switch (action.type) {\r\n    case CLICK_MENU:\r\n      return {\r\n          ...state,\r\n          activeMenu: action.payload,\r\n          tabIndex: tabIndexMapping[action.payload]\r\n      };\r\n    case DRAG_TOOLITEM_START:\r\n      return {\r\n        ...state,\r\n        draggingToolItem: action.payload\r\n      }\r\n    case FETCH_HIERARCHY:\r\n      return {\r\n        ...state,\r\n        masterHierarchy: action.payload.data\r\n      }\r\n    case FETCH_AVAILABLEDATA:\r\n      return {\r\n        ...state,\r\n        masterAvailableData: action.payload.data\r\n      }\r\n    case FETCH_SAVEDLAYOUTS:\r\n      return {\r\n        ...state,\r\n        masterLayouts: action.payload.data\r\n      }\r\n    case SAVE_DESIGNER_LAYOUT:\r\n      let newLayout = action.payload.response.data;\r\n      let stateLayouts = [...state.masterLayouts];\r\n      addOrUpdateLayout(stateLayouts, newLayout);\r\n      return {\r\n        ...state,\r\n        masterLayouts: stateLayouts        \r\n      }\r\n    case FETCH_HIERARCHYVIEWS:\r\n      return {\r\n        ...state,\r\n        masterHierarchyViews: action.payload.data\r\n      }\r\n    case FETCH_IMAGES:\r\n      return {\r\n        ...state,\r\n        masterImages: action.payload.data\r\n      }\r\n  }\r\n  return state;\r\n}\r\n","export const uuidv4 = () => {\r\n    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n      var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n      return v.toString(16);\r\n    });\r\n  }\r\n\r\nexport const getMonthEndDate = (inDate) => {\r\n  return new Date(inDate.getFullYear(), inDate.getMonth() + 1, 0);\r\n}\r\n\r\nexport const getMonthStartDate = (inDate) => {\r\n  return new Date(inDate.getFullYear(), inDate.getMonth(), 1);\r\n}\r\n\r\nexport const isValidDate = (d) => {\r\n  return d instanceof Date && !isNaN(d);\r\n}\r\n\r\nexport const createMonthDate = (dateStr) => {\r\n  let d = new Date(dateStr);\r\n  if (!isValidDate(d)) {\r\n    return null;\r\n  }\r\n\r\n  return new Date(d.getFullYear(), d.getMonth());\r\n}\r\n\r\n","import { FETCH_HIERARCHY, \r\n  UPDATE_HIER_DESIGNER_TREE, \r\n  SELECT_HIER_DESIGNER_TREE, \r\n  INSERT_HIER_DESIGNER_TREE,\r\n  FILTER_HIER_DESIGNER_TREE,\r\n  SAVE_HIER_DESIGN_NODE,\r\n  FETCH_HIERARCHYVIEWS } from \"../actions/index\";\r\nimport {findNodeByKey, filterTreeEx} from '../helper/treefilter';\r\n\r\nconst defaultState = {\r\n    hierarchyMaster: null, // Just a backup copy of the hierarchy master data, in case the user haven't saved anything yet.\r\n    hierarchyTree: [],   // This is the tree that the designer will be working on\r\n    selectedNode: null,\r\n    userSettings: [], \r\n    /*\r\n    {\r\n      key: '',\r\n      dispName: '',\r\n      inherit: true/false // if true, pageAssoc should be null/ignored\r\n      pageAssoc: '', \r\n      childDefaultPage: '',\r\n      displayWeb: bool\r\n      displayReport: bool\r\n    }\r\n    */\r\n};\r\n\r\nconst convertMasterDataToKeys = (apiNode, index=0, stack=[], parent=null) => {\r\n    if (!apiNode) {\r\n      return null;\r\n    }\r\n  \r\n    let childNodes = [];\r\n    let treeData = {\r\n      key: apiNode.fullPath,\r\n      title: apiNode.name,\r\n      nodeType: apiNode.nodeType,\r\n      category: apiNode.category,\r\n      hierStack: [...stack, index], // stack of index positions...maybe not needed anymore, but implementation is OK\r\n      parent: parent\r\n    };\r\n  \r\n    if (apiNode.children) {\r\n      for(let i = 0; i < apiNode.children.length; i++) {\r\n        let currNode = apiNode.children[i];\r\n        childNodes.push(convertMasterDataToKeys(currNode, i, treeData.hierStack, treeData));\r\n      }\r\n      // apiNode.children.forEach(node => {\r\n      //   childNodes.push(convertMasterDataToKeys(node));\r\n      // })      \r\n    }\r\n    treeData.children = childNodes;\r\n  \r\n    return treeData;\r\n}\r\n\r\n// TODO: Move this function to treehelper\r\nconst reconstructHierarchyStack = (apiNodes, stack=[], parent=null) => {\r\n  if (!apiNodes) {\r\n    return null;\r\n  }\r\n\r\n  for(let i = 0; i < apiNodes.length; i++) {\r\n    let apiNode = apiNodes[i];\r\n    apiNode.hierStack = [...stack, i];\r\n    apiNode.parent = parent;\r\n    reconstructHierarchyStack(apiNode.children, apiNode.hierStack, apiNode);\r\n  }\r\n\r\n  return apiNodes;\r\n}\r\n\r\n//https://stackoverflow.com/questions/105034/create-guid-uuid-in-javascript\r\nconst uuidv4 = () => {\r\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\r\n    var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);\r\n    return v.toString(16);\r\n  });\r\n}\r\n\r\nconst handleInsert = (newState) => {\r\n  if (!newState || !newState.hierarchyTree) {\r\n    return;\r\n  }\r\n  newState.hierarchyTree = [...newState.hierarchyTree];\r\n  let newNode = {\r\n    key: 'hier-'+uuidv4(),\r\n    title: 'new page',\r\n    nodeType: 'page',\r\n    category: null,\r\n    children: []\r\n  };\r\n  if (!newState.selectedNode || !newState.selectedNode.key) {\r\n    // Means no node is selected, so add it the first level\r\n    newNode.parent = null;\r\n    newNode.hierStack = [newState.hierarchyTree.length];\r\n    newState.hierarchyTree.push(newNode);\r\n  }\r\n  else \r\n  {\r\n    // Find the selected node\r\n    let selectedNodeObj = findNodeByKey(newState.hierarchyTree, newState.selectedNode.key);\r\n    if (!!selectedNodeObj) {\r\n      if (selectedNodeObj.item.children.length > 0) {\r\n        let lastIndex = selectedNodeObj.item.children.length;\r\n        newNode.hierStack = selectedNodeObj.item.children[0].hierStack;\r\n        newNode.hierStack[newNode.hierStack.length - 1] = lastIndex;        \r\n      }\r\n      else {\r\n        selectedNodeObj.item.children = [];\r\n        newNode.hierStack = [...selectedNodeObj.item.hierStack, 0];\r\n      }\r\n      newNode.parent = selectedNodeObj.item;\r\n      selectedNodeObj.item.children.push(newNode)\r\n    }\r\n  }\r\n\r\n  return newNode;\r\n}\r\n\r\n// Not used anymore...there is no way to bring back filtered out nodes\r\nconst handleFilter = (filter, newState) => {\r\n  let filteredData = filterTreeEx(newState.hierarchyTree, filter);\r\n  console.log('handleFilter', filter, filteredData);        \r\n  newState.hierarchyTree = [...filteredData];\r\n}\r\n\r\nconst handleSaveHierDesignNode = (state, inputSetting) => {\r\n  state.userSettings = state.userSettings || [];\r\n  let userSettingsFindIdx = state.userSettings.findIndex(x => x.key === inputSetting.key);\r\n  if (userSettingsFindIdx >= 0) {\r\n    state.userSettings.splice(userSettingsFindIdx, 1);    \r\n  }\r\n  state.userSettings.push({...inputSetting});\r\n}\r\n\r\nexport default function(state=defaultState, action) {\r\n    if ([FETCH_HIERARCHY, UPDATE_HIER_DESIGNER_TREE, SELECT_HIER_DESIGNER_TREE, INSERT_HIER_DESIGNER_TREE, FILTER_HIER_DESIGNER_TREE, SAVE_HIER_DESIGN_NODE].includes(action.type)) {\r\n        console.log('[DEBUG] reducer_hierarchyDesigner', action, state);\r\n    }\r\n    switch (action.type) {\r\n      case FETCH_HIERARCHY:\r\n        return {\r\n          ...state,\r\n          hierarchyMaster: action.payload.data\r\n          //hierarchyTree: [convertMasterDataToKeys(action.payload.data)]\r\n        }\r\n      case UPDATE_HIER_DESIGNER_TREE:\r\n        let reformatted = reconstructHierarchyStack(action.payload);\r\n        return {\r\n          ...state,\r\n          hierarchyTree: reformatted\r\n        }\r\n      case SELECT_HIER_DESIGNER_TREE:\r\n        return {\r\n          ...state,\r\n          selectedNode: action.payload\r\n        }\r\n      case INSERT_HIER_DESIGNER_TREE:\r\n        let insertedState = {...state};\r\n        let newNode = handleInsert(insertedState);\r\n        insertedState.selectedNode = newNode;\r\n        return insertedState;\r\n      case FILTER_HIER_DESIGNER_TREE:\r\n        // Action Not used anymore...we don't manipulate the model anymore\r\n        // Just let the tree control filter out (do not show) nodes that do not satisfy the search string\r\n        let filterState = {...state};\r\n        let filter = action.payload;\r\n        handleFilter(filter, filterState);\r\n        return filterState;\r\n      case SAVE_HIER_DESIGN_NODE:\r\n        let saveNodeState = {...state};\r\n        saveNodeState.userSettings = [...state.userSettings];\r\n        handleSaveHierDesignNode(saveNodeState, action.payload)\r\n        return saveNodeState;\r\n      case FETCH_HIERARCHYVIEWS:\r\n        let fetchedViewState = {...state};           \r\n        /* POC: We don't fetch the Plant Hierarchy anymore\r\n        // If the user hasn't saved the hierarchy view yet (e.g. first time user)\r\n        if ((!action.payload.data || action.payload.data.length === 0) && !!fetchedViewState.hierarchyMaster) {\r\n          fetchedViewState.hierarchyTree = [convertMasterDataToKeys(fetchedViewState.hierarchyMaster)];\r\n        }\r\n        else {\r\n          // Assume [0], for the default\r\n          fetchedViewState.hierarchyTree = reconstructHierarchyStack(JSON.parse(action.payload.data[0].hierarchyJson));\r\n          fetchedViewState.userSettings = JSON.parse(action.payload.data[0].nodeSettingsJson);  \r\n        }\r\n        */\r\n       if (action.payload.data && action.payload.data.length > 0) {\r\n          fetchedViewState.hierarchyTree = reconstructHierarchyStack(JSON.parse(action.payload.data[0].hierarchyJson));\r\n          fetchedViewState.userSettings = JSON.parse(action.payload.data[0].nodeSettingsJson);          \r\n        }\r\n\r\n        return fetchedViewState;\r\n    }\r\n    return state;\r\n  }","const dropdownOptions = [\r\n    { key: 'angular', text: 'Angular', value: 'angular' },\r\n    { key: 'css', text: 'CSS', value: 'css' },\r\n    { key: 'design', text: 'Graphic Design', value: 'design' },\r\n    { key: 'ember', text: 'Ember', value: 'ember' },\r\n    { key: 'html', text: 'HTML', value: 'html' },\r\n    { key: 'ia', text: 'Information Architecture', value: 'ia' },\r\n    { key: 'javascript', text: 'Javascript', value: 'javascript' },\r\n    { key: 'mech', text: 'Mechanical Engineering', value: 'mech' },\r\n    { key: 'meteor', text: 'Meteor', value: 'meteor' },\r\n    { key: 'node', text: 'NodeJS', value: 'node' },\r\n    { key: 'plumbing', text: 'Plumbing', value: 'plumbing' },\r\n    { key: 'python', text: 'Python', value: 'python' },\r\n    { key: 'rails', text: 'Rails', value: 'rails' },\r\n    { key: 'react', text: 'React', value: 'react' },\r\n    { key: 'repair', text: 'Kitchen Repair', value: 'repair' },\r\n    { key: 'ruby', text: 'Ruby', value: 'ruby' },\r\n    { key: 'ui', text: 'UI Design', value: 'ui' },\r\n    { key: 'ux', text: 'User Experience', value: 'ux' },\r\n    { key: 'test1', text: 'A quick brown fox jumps over the lazy dog', value: 'test1' },\r\n    { key: 'test2', text: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&*()_+', value: 'test2' },\r\n    { key: 'test3', text: '', value: 'test3' },\r\n  ];\r\n\r\nconst defaultLayoutData = {\r\n    columns: 12,\r\n    rows: 200\r\n  }\r\n\r\nconst render1Section = (index) => {\r\n    let offset = index * 7; // 7 is the height of 1 section, including the invisible page break\r\n    return [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        title: 'General Information' + index,\r\n        //backgroundColor: 'lightsteelblue'\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 0, y: offset + 1, w: 3, h: 4, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 6, y: offset + 1, w: 3, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: `ctrl-bar${index}`, x: 3, y: offset + 1, w: 3, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [5] Priority\r\n    {i: `ctrl-combo${index}`, x: 9, y: offset + 3, w: 3, h: 1, ctrlType: 'combo', data: {\r\n        placeholder: 'Please select...',\r\n        options: dropdownOptions,\r\n        label: 'Courses:'\r\n    }},\r\n\r\n    // [6] Label\r\n    {i: `ctrl-label${index}`, x: 9, y: offset + 1, w: 3, h: 1,ctrlType: 'label', data: {\r\n        label: index % 2 === 0? 'I am a label' : 'The quick brown fox jumps over the lazy dog. Honesty is the best policy. Time is gold. The early birdy catches the worm.',\r\n        color: 'blue',\r\n        backgroundColor: 'khaki',\r\n        fontSize: '18',\r\n        icon: 'lightbulb'\r\n    }},\r\n\r\n    // [8] Remarks\r\n    {i: `ctrl-textbox${index}`, x: 9, y: offset + 4, w: 3, h: 1,ctrlType: 'textbox', data: {\r\n        placeholder: 'Input Remarks...',\r\n        label: 'Remarks:'\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 0, y:offset+5, w: 12, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:'\r\n    }},\r\n]}\r\n\r\n// convenience func for testing\r\nconst computeMaxIndex = (data) => {\r\n    let maxIndex = 0;\r\n    data.forEach(ctrl => {\r\n        let currCtrlBtmIdx = ctrl.y + ctrl.h - 1;\r\n        if (currCtrlBtmIdx > maxIndex) {\r\n            maxIndex = currCtrlBtmIdx;\r\n        }\r\n    })\r\n\r\n    return maxIndex;\r\n}\r\n\r\n// Scenario1: Table, own row, no Page break after last control\r\nconst render1Section_1 = (index, start) => {\r\n    let offset = start;\r\n    let data = [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        //title: 'General Information' + index,\r\n        //backgroundColor: 'lightsteelblue'\r\n        title: 'Scenario1: Table, own row, no Page break after last control',\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 0, y: offset + 1, w: 3, h: 4, ctrlType: 'dcbar',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 6, y: offset + 1, w: 3, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    // {i: `ctrl-bar${index}`, x: 3, y: offset + 1, w: 3, h: 4, ctrlType: 'barchart',       \r\n    //     data: {\r\n    //         label: 'Bar:',\r\n    // }},\r\n    {i: `ctrl-imageMap${index}`, x: 3, y: offset + 1, w: 3, h: 4, ctrlType: 'imageMap',       \r\n        data: {\r\n            label: 'ImageMap:',\r\n    }},\r\n\r\n    // [5] Priority\r\n    {i: `ctrl-combo${index}`, x: 9, y: offset + 3, w: 3, h: 1, ctrlType: 'combo', data: {\r\n        placeholder: 'Please select...',\r\n        options: dropdownOptions,\r\n        label: 'Courses:'\r\n    }},\r\n\r\n    // [6] Label\r\n    {i: `ctrl-label${index}`, x: 9, y: offset + 1, w: 3, h: 1,ctrlType: 'label', data: {\r\n        label: index % 2 === 0? 'I am a label' : 'The quick brown fox jumps over the lazy dog. Honesty is the best policy. Time is gold. The early birdy catches the worm.',\r\n        color: 'blue',\r\n        backgroundColor: 'khaki',\r\n        fontSize: '18',\r\n        icon: 'lightbulb'\r\n    }},\r\n\r\n    // [8] Remarks\r\n    {i: `ctrl-textbox${index}`, x: 9, y: offset + 4, w: 3, h: 1,ctrlType: 'textbox', data: {\r\n        placeholder: 'Input Remarks...',\r\n        label: 'Remarks:'\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 0, y:offset+5, w: 12, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:'\r\n    }},\r\n    ]; // data end\r\n\r\n    let maxIndex = computeMaxIndex(data);\r\n\r\n    return {\r\n        endIndex: maxIndex,\r\n        data\r\n    }\r\n}\r\n\r\n// Scenario2: Table, own row, has Page break after last control\r\nconst render1Section_2 = (index, start) => {\r\n    let offset = start;\r\n    let data = [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        //title: 'General Information' + index,\r\n        //backgroundColor: 'lightsteelblue'\r\n        title: 'Scenario2: Table, own row, has Page break after last control',\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 0, y: offset + 1, w: 3, h: 4, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 6, y: offset + 1, w: 3, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: `ctrl-bar${index}`, x: 3, y: offset + 1, w: 3, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [5] Priority\r\n    {i: `ctrl-combo${index}`, x: 9, y: offset + 3, w: 3, h: 1, ctrlType: 'combo', data: {\r\n        placeholder: 'Please select...',\r\n        options: dropdownOptions,\r\n        label: 'Courses:'\r\n    }},\r\n\r\n    // [6] Label\r\n    {i: `ctrl-label${index}`, x: 9, y: offset + 1, w: 3, h: 1,ctrlType: 'label', data: {\r\n        label: index % 2 === 0? 'I am a label' : 'The quick brown fox jumps over the lazy dog. Honesty is the best policy. Time is gold. The early birdy catches the worm.',\r\n        color: 'blue',\r\n        backgroundColor: 'khaki',\r\n        fontSize: '18',\r\n        icon: 'lightbulb'\r\n    }},\r\n\r\n    // [8] Remarks\r\n    {i: `ctrl-textbox${index}`, x: 9, y: offset + 4, w: 3, h: 1,ctrlType: 'textbox', data: {\r\n        placeholder: 'Input Remarks...',\r\n        label: 'Remarks:'\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 0, y:offset+5, w: 12, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:'\r\n    }},\r\n\r\n    // [10] Page Break Control\r\n    {i: `ctrl-pagebreak${index}`, x: 0, y: offset + 7, w: 12, h: 1,ctrlType: 'pagebreak', data: {}},\r\n    ];\r\n\r\n    let maxIndex = computeMaxIndex(data, start);\r\n    return {\r\n        endIndex: maxIndex,\r\n        data\r\n    }\r\n}\r\n\r\n// Scenario3: Small table, as 4th control of row, has page break after last control\r\nconst render1Section_3 = (index, start) => {\r\n    let offset = start;\r\n    let data = [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        //title: 'General Information' + index,\r\n        //backgroundColor: 'lightsteelblue'\r\n        title: 'Scenario3: Smal table, as 4th control of row, has page break after last control',\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 0, y: offset + 1, w: 3, h: 4, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 6, y: offset + 1, w: 3, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: `ctrl-bar${index}`, x: 3, y: offset + 1, w: 3, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 9, y:offset+1, w: 3, h: 4,ctrlType: 'table', data: {\r\n        label: 'Table:',\r\n        smallData: true\r\n    }},\r\n\r\n    // [10] Page Break Control\r\n    {i: `ctrl-pagebreak${index}`, x: 0, y: offset + 5, w: 12, h: 1,ctrlType: 'pagebreak', data: {}},\r\n    ];\r\n\r\n    let maxIndex = computeMaxIndex(data, start);\r\n    return {\r\n        endIndex: maxIndex,\r\n        data\r\n    }\r\n}\r\n\r\n// Scenario4: Small table, as 1st control of row, has page break after last control\r\n// Not applicable anymore to new spec\r\nconst render1Section_4 = (index, start) => {\r\n    let offset = start;\r\n    let data = [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        //title: 'General Information' + index,\r\n        //backgroundColor: 'lightsteelblue'\r\n        title: 'Scenario4: Table, as 1st control of row, has page break after last control',\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 3, y: offset + 1, w: 3, h: 4, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 6, y: offset + 1, w: 3, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: `ctrl-bar${index}`, x: 9, y: offset + 1, w: 3, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 0, y:offset+1, w: 3, h: 4,ctrlType: 'table', data: {\r\n        label: 'Table:',\r\n        smallData: true\r\n    }},\r\n\r\n    // [10] Page Break Control\r\n    {i: `ctrl-pagebreak${index}`, x: 0, y: offset + 5, w: 12, h: 1,ctrlType: 'pagebreak', data: {}},\r\n    ];\r\n\r\n    let maxIndex = computeMaxIndex(data, start);\r\n    return {\r\n        endIndex: maxIndex,\r\n        data\r\n    }\r\n}\r\n\r\n// Scenario5: Table solo\r\nconst render1Section_5 = (index, start) => {\r\n    let offset = start;\r\n    let data = [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        //title: 'General Information' + index,\r\n        //backgroundColor: 'lightsteelblue'\r\n        title: 'Scenario5: Table, own row, but only 8 columns (will still be displayed as 12 cols), with Page break',\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 0, y: offset + 1, w: 4, h: 4, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 4, y: offset + 1, w: 4, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: `ctrl-bar${index}`, x: 8, y: offset + 1, w: 4, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 0, y:offset+5, w: 8, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:'\r\n    }},\r\n\r\n    // [10] Page Break Control\r\n    {i: `ctrl-pagebreak${index}`, x: 0, y: offset + 7, w: 12, h: 1,ctrlType: 'pagebreak', data: {}},\r\n    ];\r\n\r\n    let maxIndex = computeMaxIndex(data, start);\r\n    return {\r\n        endIndex: maxIndex,\r\n        data\r\n    }\r\n}\r\n\r\nconst render1Section_6 = (index, start) => {\r\n    let offset = start;\r\n    let data = [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        title: 'Scenario6: Big Charts, Small Table + Gauge placed on top of each other',\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 0, y: offset + 1, w: 4, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: `ctrl-bar${index}`, x: 4, y: offset + 1, w: 4, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 8, y:offset+1, w: 4, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:',\r\n        smallData: true\r\n    }},\r\n\r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 8, y: offset + 3, w: 4, h: 2, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [10] Page Break Control\r\n    {i: `ctrl-pagebreak${index}`, x: 0, y: offset + 5, w: 12, h: 1,ctrlType: 'pagebreak', data: {}},\r\n    ];\r\n\r\n    let maxIndex = computeMaxIndex(data, start);\r\n    return {\r\n        endIndex: maxIndex,\r\n        data\r\n    }\r\n}\r\n\r\nconst render1Section_7 = (index, start) => {\r\n    let offset = start;\r\n    let data = [    {i: `ctrl-section${index}`, x: 0, y: offset + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        title: 'Scenario7: Big Charts, Few but WIDE Table + Gauge placed on top of each other',\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n\r\n    // [3 new] Pie Chart\r\n    {i: `ctrl-pie${index}`, x: 0, y: offset + 1, w: 4, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: `ctrl-bar${index}`, x: 4, y: offset + 1, w: 4, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [9] Scenario 1: Table - Just by itself at the bottom of section\r\n    {i: 'ctrl-table0', x: 8, y:offset+1, w: 4, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:',\r\n        smallData: true,\r\n        wideData: true\r\n    }},\r\n\r\n    // [2 NEW] Gauge chart\r\n    {i: `ctrl-gauge${index}`, x: 8, y: offset + 3, w: 4, h: 2, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: index/100.00\r\n    }},\r\n\r\n    // [10] Page Break Control\r\n    {i: `ctrl-pagebreak${index}`, x: 0, y: offset + 5, w: 12, h: 1,ctrlType: 'pagebreak', data: {}},\r\n    ];\r\n\r\n    let maxIndex = computeMaxIndex(data, start);\r\n    return {\r\n        endIndex: maxIndex,\r\n        data\r\n    }\r\n}\r\n\r\nconst bigLayout = () => {\r\n    let retList = [];\r\n    // for (let i = 0; i < 2; i++) {\r\n    //     retList = [...retList, ...render1Section_1(i)];\r\n    // }\r\n    // retList = [\r\n    //     ...render1Section_1(0, 0),\r\n    //     ...render1Section_2(1, 7),\r\n    // ]\r\n    let currEndIdx = 0;\r\n    let data1 = render1Section_1(0, currEndIdx);\r\n    retList =[...retList, ...data1.data];\r\n    currEndIdx = data1.endIndex + 1;\r\n\r\n    // let data2 = render1Section_2(1, currEndIdx);\r\n    // retList =[...retList, ...data2.data];\r\n    // currEndIdx = data2.endIndex + 1;\r\n\r\n    // let data3 = render1Section_3(2, currEndIdx);\r\n    // retList =[...retList, ...data3.data];\r\n    // currEndIdx = data3.endIndex + 1;\r\n\r\n    // retList = [...retList, {i: `ctrl-section`, x: 0, y: currEndIdx + 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n    //     //title: 'General Information' + index,\r\n    //     //backgroundColor: 'lightsteelblue'\r\n    //     title: 'Scenario4: Table, as 1st control of row, has page break after last control',\r\n    //     level: 1\r\n    // }}];\r\n\r\n    // let data4 = render1Section_4(3, currEndIdx);\r\n    // retList =[...retList, ...data4.data];\r\n    // currEndIdx = data4.endIndex + 1;\r\n    \r\n    // let data5 = render1Section_5(4, currEndIdx);\r\n    // retList =[...retList, ...data5.data];\r\n    // currEndIdx = data5.endIndex + 1;\r\n\r\n    // let data6 = render1Section_6(5, currEndIdx);\r\n    // retList =[...retList, ...data6.data];\r\n    // currEndIdx = data6.endIndex + 1;    \r\n\r\n    // let data7 = render1Section_7(6, currEndIdx);\r\n    // retList =[...retList, ...data7.data];\r\n    // currEndIdx = data7.endIndex + 1;        \r\n\r\n    return retList;\r\n}\r\n\r\nconst defaultReportLayout = [\r\n    {i: 'ctrl-section0', x: 0, y: 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        title: 'General Information',\r\n        //backgroundColor: 'lightsteelblue'\r\n        level: 1\r\n    }},\r\n    \r\n    \r\n    // [2 NEW] Gauge chart\r\n    {i: 'ctrl-gauge0', x: 0, y: 1, w: 3, h: 4, ctrlType: 'gauge',       \r\n    data: {\r\n        label: 'Gauge:',\r\n        percent: 95.5\r\n    }},\r\n\r\n    // [3 new] Pie Chart\r\n    {i: 'ctrl-pie0', x: 6, y: 1, w: 3, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n    }},\r\n\r\n    // [4 new] Bar Chart\r\n    {i: 'ctrl-bar0', x: 3, y: 1, w: 3, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n    }},\r\n\r\n    // [5] Priority\r\n    {i: 'ctrl-combo0', x: 9, y: 3, w: 3, h: 1, ctrlType: 'combo', data: {\r\n        placeholder: 'Please select...',\r\n        options: dropdownOptions,\r\n        label: 'Courses:'\r\n    }},\r\n\r\n    // [6] Label\r\n    {i: 'ctrl-label0', x: 9, y: 1, w: 3, h: 1,ctrlType: 'label', data: {\r\n        label: 'I am a label',\r\n        color: 'blue',\r\n        backgroundColor: 'khaki',\r\n        fontSize: '18',\r\n        icon: 'tag'\r\n    }},\r\n\r\n\r\n    // [8] Remarks\r\n    {i: 'ctrl-textbox0', x: 9, y: 4, w: 3, h: 1,ctrlType: 'textbox', data: {\r\n        placeholder: 'Input Remarks...',\r\n        label: 'Remarks:'\r\n    }},\r\n\r\n\r\n    // [B] Subsection\r\n    {i: 'ctrl-section1', x: 0, y: 5, w: 12, h: 1, ctrlType: 'section', data: {\r\n        title: 'Loop Summary',\r\n        //backgroundColor: 'lightsteelblue'\r\n        level: 2\r\n    }},\r\n\r\n    /*\r\n    //[2] Table - 1\r\n    {i: 'ctrl-table0', x: 0, y:6, w: 12, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:'\r\n    }},\r\n    \r\n    //[2] Table Only\r\n    // {i: 'ctrl-table0', x: 0, y:1, w: 12, h: 2,ctrlType: 'table', data: {\r\n    //     label: 'Table:'\r\n    // }},\r\n    */\r\n];\r\n\r\nconst defaultState = {\r\n    //layout: defaultReportLayout,\r\n    layout: bigLayout(),\r\n    layoutData: defaultLayoutData,     \r\n}\r\n\r\nexport default function(state = defaultState, action) {\r\n    return state;\r\n}","import axios from 'axios';\r\n\r\n// Like crossfilter concept, we filter other control's filters only.\r\n// Do not include current control's filters because we still need to show the other slices but grayed out.\r\nexport const getOtherControlFilters = (controlId, datasetFilters, includeCarryOver=false) => {\r\n    let retList = [];\r\n    for (let currCtrlId in datasetFilters) {\r\n        if (currCtrlId === controlId) {\r\n            continue;\r\n        }\r\n        let controlFilterInfo = datasetFilters[currCtrlId];\r\n\r\n        // Just take the slice info of the deepest stack\r\n        let stacks = Object.keys(controlFilterInfo);\r\n        let longestStack = stacks.reduce((r, e) => r.length < e.length ? e : r, \"\");\r\n        \r\n        let stackInfo = controlFilterInfo[longestStack];\r\n        if (!stackInfo) {\r\n            continue;\r\n        }\r\n\r\n        let sliceInfo = stackInfo.sliceInfo;\r\n        for (let prop in sliceInfo.origObj) {\r\n            retList.push({\r\n                Name: prop,\r\n                Value: sliceInfo.origObj[prop]\r\n            });\r\n        }\r\n\r\n        let seriesInfo = stackInfo.seriesInfo;\r\n        if (!seriesInfo) {\r\n            continue;\r\n        }\r\n\r\n        for (let prop in seriesInfo) {\r\n            retList.push({\r\n                Name: prop,\r\n                Value: seriesInfo[prop]\r\n            });\r\n        }\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\n// purpose: if from parent level, a filter has been made, then user drills down to child level,\r\n// the parent filter must still be applied\r\n// currGroupingsArr: can be null if user never changed the grouping level \r\n//\r\nconst getOwnControlHigherLevelFilters = (controlId, datasetFilters, currGroupingsArr) => {\r\n    let retList = [];\r\n    if (!currGroupingsArr) {\r\n        return retList;\r\n    }\r\n    let currGroupingStr = JSON.stringify(currGroupingsArr);\r\n    for (let currCtrlId in datasetFilters) {\r\n        if (currCtrlId !== controlId) {\r\n            continue;\r\n        }\r\n        let controlFilterInfo = datasetFilters[currCtrlId];     \r\n        for (let stack in controlFilterInfo) {\r\n            if (stack.length >= currGroupingStr.length) {\r\n                continue;\r\n            }\r\n\r\n            let stackInfo = controlFilterInfo[stack];\r\n            if (!stackInfo) {\r\n                continue;\r\n            }\r\n\r\n            let sliceInfo = stackInfo.sliceInfo;\r\n            for (let prop in sliceInfo.origObj) {\r\n                retList.push({\r\n                    Name: prop,\r\n                    Value: sliceInfo.origObj[prop]\r\n                });\r\n            }\r\n    \r\n            let seriesInfo = stackInfo.seriesInfo;\r\n            if (!seriesInfo) {\r\n                continue;\r\n            }\r\n    \r\n            for (let prop in seriesInfo) {\r\n                retList.push({\r\n                    Name: prop,\r\n                    Value: seriesInfo[prop]\r\n                });\r\n            }\r\n        }                \r\n    }\r\n    // TODO: There can be duplicates if there are 3 levels of grouping\r\n    // Should remove duplicates\r\n\r\n    return retList;\r\n}\r\n\r\nconst composeImageMapParams = (controlData) => {\r\n    if (!controlData.data.imageProps || !Array.isArray(controlData.data.imageProps.map.areas)) {\r\n        return null;\r\n    }\r\n\r\n    return {\r\n        name: \"Hotspots\",\r\n        values: controlData.data.imageProps.map.areas.map(a => a.name)\r\n    };\r\n}\r\n\r\n// Filter name and value are currently set as direct fields inside postObj (i.e. postObj.filterName, postObj.filterValue)\r\n// We need to move these 2 fields into RequestParams\r\nconst ReformatControlFilters = (postObj) => {\r\n    // A. Single filter field\r\n    if (postObj.filterName && postObj.filterValue && Array.isArray(postObj.parameters)) {\r\n        postObj.parameters.push({\r\n            name: postObj.filterName,\r\n            value: postObj.filterValue\r\n        })\r\n    }\r\n\r\n    delete postObj.filterName;\r\n    delete postObj.filterValue;\r\n\r\n    // B. Multiple filter fields\r\n    if (postObj.filtersList) {\r\n        for (let prop in postObj.filtersList) {\r\n            let currFilter = postObj.filtersList[prop];\r\n            if (!currFilter.filterName || !currFilter.filterValue) {\r\n\r\n            }\r\n            postObj.parameters.push({\r\n                name: currFilter.filterName,\r\n                value: currFilter.filterValue\r\n            })\r\n        }\r\n\r\n        delete postObj.filtersList;\r\n    }\r\n}\r\n\r\n// This class is responsible for making API calls to get data, or handling click or grouping events\r\nexport const fetchData = async (controlData, setIsLoading, setApiData, datasetFilters, currControlGrouping, metadata, pageFilters) => {\r\n    console.log('[DEBUG] fetchData ReportControl', controlData.i);\r\n\r\n    if (!controlData.data.dataProps.requestType) { // Optimization\r\n        return;\r\n    }\r\n    \r\n    setIsLoading(true);\r\n    let postObj = {...controlData.data.dataProps}; // make a new copy\r\n    if (!!currControlGrouping) {\r\n        // currControlGrouping is from the temp grouping set by the user for Pie and Bar chart\r\n        postObj.Grouping = [...currControlGrouping];\r\n    }\r\n    else if (!!controlData.data.dataProps.categories) {\r\n        // categories is a string value\r\n        postObj.Grouping = [controlData.data.dataProps.categories];\r\n    }\r\n    else if (Array.isArray(postObj.groupings)) {\r\n        postObj.Grouping = postObj.groupings;\r\n        delete postObj.groupings;\r\n    }\r\n    else {\r\n        postObj.Grouping = [];\r\n    }\r\n\r\n    if (controlData.data.dataProps.seriesName) {\r\n        postObj.Grouping.push(controlData.data.dataProps.seriesName);\r\n    }\r\n\r\n    if (!Array.isArray(postObj.parameters)) {\r\n        postObj.parameters = [];\r\n    }\r\n\r\n    ReformatControlFilters(postObj);\r\n\r\n    if (datasetFilters) {\r\n        // Send a filter that excludes current control's filters\r\n        let otherControlFilters = getOtherControlFilters(controlData.i, datasetFilters);\r\n        let ownHigherLevelFilters = getOwnControlHigherLevelFilters(controlData.i, datasetFilters, currControlGrouping ? currControlGrouping : null);\r\n        postObj.parameters = postObj.parameters.concat(otherControlFilters);\r\n        postObj.parameters = postObj.parameters.concat(ownHigherLevelFilters);\r\n        // TODO: if in the final request params, if there are properties that overlap with the current group's own current filter, REMOVE it. \r\n        // It will look weird to see a pie chart with just one wedge. Show also the other inactive slices.\r\n        // Ideally, the groupings of each control should not overlap. This will only happen if there are overlaps.\r\n    }    \r\n\r\n    if (Array.isArray(pageFilters)) {\r\n        // TODO: Only add those filters that do not conflict with the control-lev filters if there is no existing\r\n        postObj.parameters = postObj.parameters.concat(pageFilters);\r\n    }\r\n\r\n    // if (controlData.ctrlType === 'imageMap') {\r\n    //     let imagePropParams = composeImageMapParams(controlData);\r\n    //     if (imagePropParams) {\r\n    //         postObj.parameters.push(imagePropParams);\r\n    //     }        \r\n    // }\r\n\r\n\r\n    const result = await axios\r\n        .post(metadata.server, postObj)\r\n        .catch(error => {\r\n            console.error(\"Error fetching control data\", controlData.i, error);\r\n\r\n        });\r\n\r\n    if (result && result.data) {\r\n        setApiData(result.data);\r\n    }\r\n    setIsLoading(false);\r\n};","import {SELECT_DASHBOARD_TREE, FETCH_HIERARCHYVIEWS, CLICK_CHART_SLICE, SELECT_CHART_GROUP, CLICK_PAGE_LINK} from '../actions';\r\nimport {getOtherControlFilters} from '../components/chartApiManager';\r\nimport {findNodeByKey} from '../helper/treefilter';\r\n\r\n// This is the reducer of the dashboard content\r\nconst defaultState = {\r\n    selectedNodeKey: null,\r\n    // structure:\r\n    // {\r\n    //     <datasetId1>: {\r\n    //             <controlId1>: {groupingStackStr1: {sliceInfo, seriesInfo}, groupingStackStr2: {sliceInfo, seriesInfo} }\r\n    //             <controlId2>: {groupingStackStr1: {sliceInfo, seriesInfo}, groupingStackStr2: {sliceInfo, seriesInfo} }\r\n    //         },\r\n    // }\r\n    chartClickFilters: {},   // DatasetId vs list of filters. Should clear this when new node is selected\r\n    chartTempGroupings: {}, // controlId vs new groupings...default groupings won't come here\r\n\r\n}\r\n\r\nconst findOtherControlFilters = (filtersRoot, datasetFilters, controlId) => {\r\n\r\n}\r\n\r\nconst processChartClick = (filtersRoot, actionPayload) => {\r\n    let {sliceInfo, seriesInfo, groupingStackStr, datasetId, controlId} = actionPayload;\r\n    if (!filtersRoot[datasetId]) {\r\n        filtersRoot[datasetId] = {};\r\n    }\r\n    let datasetFilters = filtersRoot[datasetId];\r\n    let controlFilters = datasetFilters[controlId];\r\n    if (!controlFilters) {\r\n        controlFilters = {};\r\n        datasetFilters[controlId] = controlFilters;\r\n    }\r\n    \r\n    let sliceInfoClone = {...sliceInfo};\r\n\r\n    controlFilters[groupingStackStr] = {\r\n        sliceInfo: sliceInfoClone,\r\n        seriesInfo\r\n    };\r\n    filtersRoot[datasetId] = {...datasetFilters}; // to force re-render (expectation: only controls belonging to this datasetId)\r\n}\r\n\r\nconst processChartGroups = (groupings, actionPayload) => {\r\n    // Just replace the grouping for the controlId directly\r\n    let {controlData, groupVal} = actionPayload;\r\n    groupings[controlData.i] = groupVal;\r\n}\r\n\r\n// actionPayload is same as the payload in processChartGroups\r\n// chartClickFilters is the state's old chartClickFilters\r\n// if there are updates, return the new chartClickFilters; otherwise return null\r\nconst removeLowerLevelFilters = (actionPayload, filtersRoot) => {\r\n    //debugger;\r\n    let {controlData, groupVal} = actionPayload;\r\n    let groupValStr = JSON.stringify(groupVal);\r\n    // find filter for this Id\r\n    if (!controlData || !controlData.i || !controlData.data.dataProps) {\r\n        return null; // sanity check only\r\n    }\r\n\r\n    let datasetFilters = filtersRoot[controlData.data.dataProps.datasetId];\r\n    if (!datasetFilters) {\r\n        return null;\r\n    }\r\n    let controlFilters = datasetFilters[controlData.i];\r\n    if (!controlFilters) {\r\n        return null;\r\n    }\r\n\r\n    let groupsToRemove = Object.keys(controlFilters).filter(x => x.length > groupValStr.length);\r\n    if (groupsToRemove.length > 0) {        \r\n        groupsToRemove.forEach(g => {\r\n            delete controlFilters[g];\r\n        })\r\n\r\n        filtersRoot[controlData.data.dataProps.datasetId] = {...datasetFilters}; // to force re-render (expectation: only controls belonging to this datasetId)\r\n\r\n        return filtersRoot;\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport default function(state=defaultState, action) {\r\n    switch (action.type) {\r\n        case SELECT_DASHBOARD_TREE:              \r\n            return {\r\n                ...state,\r\n                selectedNodeKey: action.payload.selectedNodeKey,\r\n                chartClickFilters: {},   // reset when a new node is clicked      \r\n                chartTempGroupings: {}   \r\n            };\r\n        case FETCH_HIERARCHYVIEWS:\r\n            // Auto select the first node from the the first view\r\n            let defaultView = action.payload.data && action.payload.data[0];\r\n            if (!defaultView) {\r\n                return state;\r\n            }\r\n            let treeData = JSON.parse(defaultView.hierarchyJson);\r\n            let firstNode = treeData && treeData[0]; // TODO: Should be the first node that is not the MapView or AnalysisView\r\n\r\n            return {\r\n                ...state,\r\n                selectedNodeKey: firstNode.key\r\n            };\r\n\r\n        case CLICK_CHART_SLICE:\r\n            let newFilters = {...state.chartClickFilters};\r\n            processChartClick(newFilters, action.payload);\r\n            // We can override the filter previously set by the same control (UI will not allow setting more than 1 different filter for the same control)\r\n            \r\n            return {\r\n                ...state,\r\n                chartClickFilters: newFilters\r\n            };\r\n\r\n        case SELECT_CHART_GROUP:\r\n            // we need to adjust the filters also\r\n            // if prev group is @child level, and there is a filter @child level\r\n            // then the new group is @parent level, we need to remove the filter @child level\r\n\r\n            let newFilter = removeLowerLevelFilters(action.payload, {...state.chartClickFilters});            \r\n\r\n            let newGroupings = {...state.chartTempGroupings};\r\n            processChartGroups(newGroupings, action.payload);\r\n            return {\r\n                ...state,\r\n                chartTempGroupings: newGroupings,\r\n                chartClickFilters: newFilter ? newFilter : state.chartClickFilters\r\n            };\r\n        case CLICK_PAGE_LINK:            \r\n            let linkedPage = action.payload && action.payload.controlData &&action.payload.controlData.data && action.payload.controlData.data.linkedPage;\r\n            if (linkedPage) {\r\n                return {\r\n                    ...state,\r\n                    selectedNodeKey: linkedPage,\r\n                    chartClickFilters: {},   // reset when a new node is clicked      \r\n                    chartTempGroupings: {}   \r\n                };\r\n            }\r\n            break;\r\n    }\r\n\r\n    return state;\r\n}","import { FETCH_HIERARCHYCONSO, FETCH_DIMENSIONS, FETCH_HIERARCHYKPI } from \"../actions/index\";\r\n  \r\nconst defaultState = {\r\n    hierarchyConso: null,\r\n    dimensions: null,\r\n    hierarchyKpi: null\r\n};\r\n\r\n// Convert the API treedata to the format needed by rc-tree-select\r\nconst convertTreeData = (apiTreeData) => {\r\n    if (!apiTreeData) {\r\n        return [];\r\n    }\r\n    return apiTreeData.map(x => {\r\n        let {fullPath, nodeName, children, ...rest} = x;\r\n        return {\r\n            key: fullPath,\r\n            value: fullPath,\r\n            title: nodeName,\r\n            children: convertTreeData(children),\r\n            ...rest\r\n        }\r\n    })\r\n}\r\n\r\n// Convert dimensions from API into a format dropdown expects\r\nconst convertDropDownOptions = (apiDropdowns) => {\r\n    if (!apiDropdowns) {\r\n        return [];\r\n    }\r\n\r\n    return apiDropdowns.map(x => {\r\n        return {\r\n            key: x.columnName,\r\n            text: x.columnName,\r\n            value: x.columnName,\r\n            datatype: x.dataType // datatype, lowercase t, because it will be included into DOM by semantic UI\r\n        }\r\n    });\r\n}\r\n\r\nexport default function(state=defaultState, action) {\r\n    if ([FETCH_HIERARCHYCONSO, FETCH_DIMENSIONS, FETCH_HIERARCHYKPI].includes(action.type)) {\r\n        console.log('[DEBUG] reducer_datadesigner', action, state);\r\n    }    \r\n    \r\n    switch(action.type) {            \r\n        case FETCH_HIERARCHYCONSO:      \r\n            return {\r\n                ...state,\r\n                hierarchyConso: convertTreeData(action.payload.data)\r\n            }\r\n        case FETCH_DIMENSIONS:\r\n            return {\r\n                ...state,\r\n                dimensions: convertDropDownOptions(action.payload.data)\r\n            }\r\n        case FETCH_HIERARCHYKPI:\r\n            return {\r\n                ...state,\r\n                hierarchyKpi: action.payload.data\r\n            }\r\n    }\r\n\r\n    return state;\r\n}","import { combineReducers } from \"redux\";\r\nimport MainAppReducer from \"./reducer_mainApp\";\r\nimport DesignerReducer from \"./reducer_designer\";\r\nimport HierarchyDesignerReducer from \"./reducer_hierarchyDesigner\";\r\nimport ReportAppReducer from \"./reducer_reportApp\";\r\nimport DashboardReducer from \"./reducer_dashboard\";\r\nimport DataDesignerReducer from './reducer_datadesigner';\r\n\r\n\r\nconst rootReducer = combineReducers({\r\n  mainApp: MainAppReducer,\r\n  designer: DesignerReducer,\r\n  hierarchyDesigner: HierarchyDesignerReducer,\r\n  reportApp: ReportAppReducer,\r\n  dashboard: DashboardReducer,\r\n  dataDesigner: DataDesignerReducer\r\n});\r\n\r\nexport default rootReducer;\r\n","import React, {Component} from 'react';\r\nimport {Responsive, Sidebar, Menu} from 'semantic-ui-react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport { menuClicked } from '../actions/index';\r\n\r\n// START: Mobile View\r\nclass NavBarMobile extends Component {    \r\n    constructor(props) {\r\n        super(props);\r\n        this.handleSidebarHide = this.handleSidebarHide.bind(this);\r\n        this.handleSidebarToggle = this.handleSidebarToggle.bind(this);\r\n        this.state = {\r\n            burgerPushed: false\r\n        };\r\n    }\r\n\r\n    handleSidebarHide() {\r\n        if (this.state.burgerPushed) {\r\n            this.setState({burgerPushed: false})\r\n        }\r\n    }\r\n\r\n    handleSidebarToggle() {\r\n        this.setState({burgerPushed: !this.state.burgerPushed})\r\n    }\r\n\r\n    // Create a separate function for the mobile version because we need to hide the sidebar afterwards\r\n    // We also set the active menu item\r\n    // Also, next time maybe we need a dirty check\r\n    handleMenuClick = (menuName) => {\r\n        this.props.menuClickDispatcher(menuName);\r\n        this.handleSidebarToggle();\r\n    }\r\n\r\n    render() {\r\n        return <Sidebar.Pushable>\r\n                {/* Put here the sidebar that appears in and out */}\r\n                <Sidebar\r\n                    as={Menu}\r\n                    animation='overlay'\r\n                    inverted\r\n                    vertical\r\n                    visible={this.state.burgerPushed}\r\n                    width='thin'\r\n                    direction='right'\r\n                    icon='labeled'\r\n                    size='mini'\r\n                >\r\n                    {getNavBarMenuItemElements(this.handleMenuClick, this.props.activeItem, false)}\r\n                </Sidebar>\r\n\r\n                {/* Put here the application content, including the fixed menu...basically this is the whole screen */}\r\n                <Sidebar.Pusher \r\n                    dimmed={this.state.burgerPushed}\r\n                    style={{ height: \"100vh\" }}\r\n                    onClick={this.handleSidebarHide}>\r\n                    <div className=\"ui menu inverted fixed top\">\r\n                        <div className=\"header item\">\r\n                            {/* My Dashboard */}\r\n                        </div>\r\n                        <a className=\"item right\" onClick={this.handleSidebarToggle}>\r\n                            <i className=\"icon sidebar\"/>\r\n                        </a>\r\n                    </div>\r\n                    {this.props.children}\r\n                </Sidebar.Pusher>                \r\n            </Sidebar.Pushable>;\r\n    }\r\n}\r\n// END: Mobile View\r\n\r\n// START: Desktop View\r\nconst NavBarDesktop = (props) => {\r\n    // Note: putting fixed makes the menu position to be absolute. therefore child elemnets need to adjust manually\r\n    return <div className=\"ui menu inverted fixed top\" style={{'backgroundImage': 'linear-gradient(#454545, black)'}}>\r\n        <div className=\"header item\">\r\n            {/* My Dashboard */}\r\n        </div>\r\n        {getNavBarMenuItemElements(props.menuClickDispatcher, props.activeItem, true)}\r\n    </div>;\r\n}\r\n\r\nconst onMenuClicked = (menuName, menuClickDispatcher) => {\r\n    // Dispatch an action to the redux store\r\n    menuClickDispatcher(menuName);\r\n    // Set the active item\r\n}\r\n\r\nconst getNavBarMenuItemElements = (menuClickDispatcher, activeItem, withAlignment) => {\r\n    return navBarMenuItems.map(child => {\r\n        let itemClass = `item`;\r\n        if (withAlignment && child.alignment === 'right') {\r\n            itemClass += ' right';\r\n        }\r\n        if (activeItem == child.name) {\r\n            itemClass += ' active';\r\n        }\r\n\r\n        return <a key={`${child.name}`} className={itemClass} onClick={(evt) => onMenuClicked(child.name, menuClickDispatcher)}>\r\n            <i className={`icon ${child.icon}`}/>\r\n            {child.title}\r\n        </a>});\r\n}\r\n// END: Desktop View\r\n\r\nconst getNavbarChildren = (children) => {\r\n    return <div>{children}</div>\r\n}\r\n\r\n//const settingsChildren = []; // TODO, for 2nd level children\r\n\r\nconst navBarMenuItems = [\r\n    { name: 'mapView',     title: 'Map View',      icon: 'map marker alternate',   alignment: '', },\r\n    { name: 'analysisView',     title: 'Analysis',      icon: 'list alternate',   alignment: '', },\r\n    { name: 'home',     title: 'Plant Manager View',      icon: 'home',   alignment: '', },\r\n    { name: 'downloadCenter',     title: 'Download Center',      icon: 'cloud donwload',   alignment: '', },\r\n\r\n    { name: 'formsDesigner', title: 'Page Designer',  icon: 'edit',   alignment: '' },\r\n    { name: 'hierarchyDesigner', title: 'Hierarchy Designer',  icon: 'list',   alignment: '' },\r\n    // { name: 'dataSources', title: 'Data Sources',  icon: 'database',   alignment: '' },\r\n    //{ name: 'affiliate', title: 'Affiliate Input',  icon: 'users',   alignment: '' },\r\n\r\n    // { name: 'dashboardDesigner', title: '(delete)',  icon: 'chart area',   alignment: '' },    \r\n    // { name: 'dataDesigner', title: '(delete)',  icon: 'cube',   alignment: '' },\r\n    // { name: 'trialPage', title: '(trial)',  icon: 'gavel',    alignment: '' },\r\n    { name: 'settings', title: 'Settings',  icon: 'cog',    alignment: 'right' },\r\n]\r\n\r\nconst NavBar = (props) => {\r\n    let activeItem = props.activeMenu;\r\n    // a. For mobile, the children should be nested inside the Navbar\r\n    // b. For desktop, the children can be a sibling of the Navbar\r\n    return (\r\n        <div>            \r\n            <Responsive {...Responsive.onlyMobile}>\r\n                <NavBarMobile menuClickDispatcher={props.menuClicked} activeItem={activeItem}>\r\n                    {getNavbarChildren(props.children)}\r\n                </NavBarMobile>\r\n            </Responsive>\r\n            <Responsive minWidth={Responsive.onlyTablet.minWidth}>\r\n                <NavBarDesktop menuClickDispatcher={props.menuClicked} activeItem={activeItem}></NavBarDesktop>\r\n                {getNavbarChildren(props.children)}\r\n            </Responsive>\r\n        </div>\r\n    );\r\n}\r\n\r\n// this will become the component props\r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({ menuClicked }, dispatch);\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return { activeMenu: state.mainApp.activeMenu };\r\n  }\r\n\r\n//export default NavBar;\r\nexport default connect(mapStateToProps, mapDispatchToProps)(NavBar)","import React, {Component} from 'react';\r\nimport Split from 'react-split';\r\nimport \"../styles/Split.css\";\r\n\r\nconst ID_PREFIX_SPLITTER = \"noobSplitter\";\r\nconst ID_PREFIX_GUTTER_AROW = \"noobSplitterGutterArrow\";\r\nconst DEFAULT_SPLIT_SIZES = [15, 85];\r\n\r\n// Small reusable class for creating a splitter with a gutter button\r\n// Currently, only limited to 2 items, and direction is only horizontal\r\nclass NoobSplitter extends Component {\r\n\r\n    // *** START: SPLITTER CUSTOMIZATION ***\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            sizes: this.getDefaultSizes(),\r\n            id: props.id,        \r\n        };\r\n\r\n        this.onSplitDragEnd = this.onSplitDragEnd.bind(this);\r\n        this.onSplitDragStart = this.onSplitDragStart.bind(this);\r\n        this.handleSplitterBtnClick = this.handleSplitterBtnClick.bind(this);\r\n        this.createGutter = this.createGutter.bind(this);\r\n    }\r\n\r\n    getDefaultSizes() {\r\n        if (this.props && this.props.defaultSize) {\r\n            return this.props.defaultSize;\r\n        }\r\n\r\n        return DEFAULT_SPLIT_SIZES;\r\n    }\r\n\r\n    handleSplitterBtnClick() {\r\n        this.addRemoveContentTransition(true);\r\n        let currPixels = this.getCurrentPixels(this.state.sizes[0]);\r\n        console.log('handleSplitterBtnClick', currPixels, 'small? ' + this.isVerySmall(currPixels));\r\n        let newSize = null;\r\n        if (this.isVerySmall(currPixels)) {\r\n            // Expand it\r\n            this.setState({\r\n                sizes: this.getDefaultSizes(),\r\n            });\r\n            // Show the Collapse arrow after expanding\r\n            this.showCollapseArrow();\r\n            newSize = this.getDefaultSizes();\r\n        }\r\n        else {\r\n            // Collapse it\r\n            this.setState({\r\n                sizes: [0, 100],             \r\n            });    \r\n\r\n            // Show the expand button after expanding\r\n            this.showExpandArrow();\r\n            newSize = [0, 100];\r\n        }\r\n\r\n        // Fire the callback also.\r\n        // React-split currently does not have any callback when size is changed, so we manually fire the callback\r\n        if (this.props.onDragEnd) {\r\n            this.props.onDragEnd(newSize);\r\n        }\r\n    }\r\n\r\n    showExpandArrow() {\r\n        let gutterBtnArrow = document.getElementById(ID_PREFIX_GUTTER_AROW + this.state.id);\r\n        gutterBtnArrow.classList.remove('arrow-left');\r\n        gutterBtnArrow.classList.add('arrow-right');\r\n    }\r\n\r\n    showCollapseArrow() {\r\n        let gutterBtnArrow = document.getElementById(ID_PREFIX_GUTTER_AROW + this.state.id);\r\n        gutterBtnArrow.classList.remove('arrow-right');\r\n        gutterBtnArrow.classList.add('arrow-left');\r\n    }\r\n\r\n    getCurrentPixels = (currPercent) => {return currPercent / 100.00 * window.innerWidth; }\r\n    isVerySmall = (currPixels) => { return currPixels < 10 || currPixels - this.getMinsize() < 10; }\r\n\r\n\r\n    onSplitDragEnd(args) {        \r\n        this.setState({\r\n            sizes: args\r\n        });\r\n\r\n        let currPixels = this.getCurrentPixels(this.state.sizes[0]);\r\n        //console.log('onSplitDrageEnd', args, currPixels, 'small? ' + this.isVerySmall(currPixels));\r\n        if (this.isVerySmall(currPixels)) {\r\n            this.showExpandArrow();\r\n        }\r\n        else {\r\n            this.showCollapseArrow();\r\n        }\r\n\r\n        this.addRemoveContentTransition(false);\r\n\r\n        if (this.props.onDragEnd) {\r\n            this.props.onDragEnd(args);\r\n        }\r\n    }\r\n\r\n    onSplitDragStart(args) {\r\n        //console.log('onSplitDrageStart', args);\r\n        this.addRemoveContentTransition(false);\r\n    }\r\n\r\n    addRemoveContentTransition(bAdd) {\r\n        // Adds or Removes transition effects from the content classes\r\n        let contentElems = document.getElementsByClassName('splitContent');\r\n        for (let i = 0; i < contentElems.length; i++) {\r\n            let elem = contentElems[i];\r\n            if (bAdd) {\r\n                elem.style.transition = '0.5s';\r\n            }\r\n            else {\r\n                elem.style.transition = '0.0s';\r\n            }\r\n        }\r\n    }\r\n\r\n    // Custom gutter with small expand/collapse button\r\n    // TODO: prevent splitter from being dragged from the small button\r\n    createGutter() {\r\n        let gutterElem = document.createElement('div');\r\n        // These 2 class names are the original class names of the gutter from react-split\r\n        gutterElem.classList.add('gutter');\r\n        gutterElem.classList.add('gutter-horizontal');\r\n\r\n        // Add the small collapse/expand button\r\n        let gutterBtn = document.createElement('div');\r\n        gutterBtn.classList.add('gutterBtn');\r\n\r\n        let gutterBtnArrow = document.createElement('div');\r\n        gutterBtnArrow.classList.add('arrow-left');\r\n        gutterBtnArrow.id = ID_PREFIX_GUTTER_AROW + this.state.id;\r\n        gutterBtn.appendChild(gutterBtnArrow);\r\n\r\n        gutterElem.appendChild(gutterBtn);\r\n        gutterBtn.addEventListener(\"click\", this.handleSplitterBtnClick);\r\n        gutterBtn.addEventListener(\"touchend\", this.handleSplitterBtnClick);\r\n\r\n        return gutterElem;\r\n    }\r\n\r\n    // *** END: SPLITTER CUSTOMIZATION ***    \r\n\r\n    getMinsize () {\r\n        return this.props.minSize ? this.props.minSize : 0;\r\n    }\r\n\r\n    render() {\r\n        console.log('[noobSplitter][render()] ', this.props.children);\r\n        let child1 = <div/>;\r\n        let child2 = <div/>;\r\n        if (this.props.children) {\r\n            if (!Array.isArray(this.props.children)) {\r\n                child1 = this.props.children;\r\n            }\r\n            else if (this.props.children.length > 1) {\r\n                child1 = this.props.children[0];\r\n                child2 = this.props.children[1];\r\n            }\r\n        }\r\n\r\n        return <Split className=\"split\"\r\n            id={ID_PREFIX_SPLITTER + this.state.id}\r\n            direction=\"horizontal\"\r\n            sizes={this.state.sizes}\r\n            minSize={this.getMinsize()}\r\n            gutterSize={8}\r\n            onDragEnd={this.onSplitDragEnd}\r\n            onDragStart={this.onSplitDragStart}\r\n            snapOffset={0}\r\n            cursor=\"col-resize\"\r\n            gutter={this.createGutter}\r\n            >\r\n            <div className=\"content-left splitContent\" >\r\n                {/* <ToolPanel/> */}\r\n                {/* <ScrollTracker/> */}\r\n                {child1}\r\n            </div>\r\n\r\n            <div className=\"splitContent\" style={{width: \"100%\", overflow: \"auto\"}}>\r\n                {/* <DocumentSample/> */}\r\n                {child2}\r\n            </div>\r\n        </Split>;\r\n    }\r\n}\r\n\r\nexport default NoobSplitter;","import React from 'react';\r\n\r\n// Design note: considered using HOC but cannot pass state values declared in HOC as props to wrapped commponent\r\n// So we stick to classic inheritance\r\n\r\n// TODO: vertical scrollbar width is not yet accounted for in the calculation of the width\r\n\r\nconst DEFAULT_SPLIT_SIZES = [15, 85];\r\nconst GRID_GAP = 8;\r\n\r\nclass DesignerContentBase extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.defaultSizes = props.defaultSizes ? props.defaultSizes : DEFAULT_SPLIT_SIZES;\r\n        window.addEventListener('resize', this.onWindowResize);\r\n        this.state = {\r\n            leftPixels: this.defaultSizes[0] * (window.innerWidth - GRID_GAP) / 100.0,\r\n            rightPixels: this.defaultSizes[1] * (window.innerWidth - GRID_GAP) / 100.0,\r\n            currRightPercent: this.defaultSizes[1]\r\n        };\r\n    }\r\n\r\n    componentDidMount() {\r\n        console.log('[designerContentBase] componentDidMount, rightixels supposedly:', this.defaultSizes, this.defaultSizes[1] * window.innerWidth / 100.0);\r\n        // Note: this causes the designer to render twice! Not a good design!\r\n        // Maybe my own designer does not need this.\r\n        // Actually this is only needed with React-grid-layout because the width is a props\r\n        // this.setState({\r\n        //     rightPixels: this.defaultSizes[1] * window.innerWidth / 100.0,\r\n        //     currRightPercent: this.defaultSizes[1]\r\n        // });\r\n    }\r\n\r\n    onWindowResize = () => {        \r\n        let rightPixels = this.state.currRightPercent / 100.0 * (window.innerWidth - GRID_GAP);    \r\n        this.setState({\r\n            rightPixels: rightPixels,\r\n            leftPixels: window.innerWidth - rightPixels\r\n        });\r\n    }\r\n\r\n    onSplitDragEnd = (sizes) => {\r\n        let rightPixels = sizes[1] / 100.0 * (window.innerWidth - GRID_GAP);    \r\n        console.log('onSplitDragEnd designerContent callback');   \r\n        //if there are differences, call setState. We minimize rerenders\r\n        this.setState({\r\n            rightPixels: rightPixels,\r\n            currRightPercent: sizes[1],\r\n            leftPixels: window.innerWidth - rightPixels - GRID_GAP\r\n        });\r\n    }\r\n}\r\n\r\nexport default DesignerContentBase;","import React from 'react';\r\nimport Tree, {TreeNode} from 'rc-tree';\r\nimport {findNodeByKey} from '../helper/treefilter';\r\n\r\nimport 'rc-tree/assets/index.css';\r\nimport './hierarchyTree.css';\r\n\r\n\r\nclass HierarchyDesignerTree extends React.Component {\r\n  static defaultProps = {\r\n    keys: ['//PLANT'],\r\n  };\r\n  constructor(props) {\r\n    super(props);\r\n    const keys = props.keys;\r\n    this.state = {\r\n      defaultExpandedKeys: keys,\r\n      //defaultSelectedKeys: keys,\r\n      defaultSelectedKeys: [],\r\n      defaultCheckedKeys: keys,\r\n      treeData: null,\r\n      expandedKeys: []\r\n    };\r\n  }\r\n\r\n  componentDidMount = () => {\r\n    // Auto expand the first level nodes\r\n    let firstLevelKeys = this.getFirstLevelKeys();\r\n    console.log('[DEBUG][Tree] componentDidMount...', firstLevelKeys);\r\n    if (firstLevelKeys && firstLevelKeys.length) {\r\n      this.setState({expandedKeys: [...this.state.expandedKeys, ...firstLevelKeys]});\r\n    }\r\n  }\r\n\r\n  componentDidUpdate = (prevProps) => {\r\n    console.log('tree componentDidUpdate');\r\n    if (!!this.props.selectedNodeKey && this.props.selectedNodeKey === prevProps.selectedNodeKey) {\r\n      return;\r\n    }\r\n\r\n    // Expand the parent of the (auto-selected) selectedNode if it is not yet expanded\r\n    // Purpose is to automatically expand the parent of the newly insert node.\r\n    // We don't need to recurse upward. \r\n    // Just the parent node is enough because the parentNode's ancestors for sure is already expanded in order for the user to insert into the parent node\r\n    // Bug: parentArr is just the sibling array, not the parent array. This is not a fool-proof solution, but it will do for now, since we will\r\n    // change the implementation to use a tree list view\r\n    let nodeSelectedObj = findNodeByKey(this.props.treeData, this.props.selectedNodeKey);\r\n    if (!nodeSelectedObj) {\r\n      return;\r\n    }\r\n\r\n    let parentObj = nodeSelectedObj.parentArr[nodeSelectedObj.index];\r\n    if (!this.state.expandedKeys.includes(parentObj.key)) {\r\n      this.setState({expandedKeys: [...this.state.expandedKeys, parentObj.key]});\r\n    }\r\n  }\r\n\r\n  onExpand = (expandedKeys) => {\r\n    //console.log('onExpand', ...args);\r\n    this.setState({\r\n      expandedKeys,\r\n    });\r\n  };\r\n\r\n\r\n  Icon = (props) => {\r\n      //console.log('icon', props)\r\n      if (props.nodeType === 'Plant' || props.nodeType === 'Folder' || (props.children && props.children.length > 0) ) {\r\n        return <i className='ui icon folder outline'></i>\r\n      }\r\n      else {\r\n        \r\n        return <i className='ui icon genderless'></i>\r\n      }\r\n      \r\n  }\r\n\r\n  getSwitcherIcon = (node) => {\r\n    if (node.isLeaf) {\r\n      return null;\r\n    }\r\n\r\n    if (node.expanded) {\r\n      return <i className=\"ui icon angle down\"></i>  \r\n    }\r\n    return <i className=\"ui icon angle right\"></i>\r\n  }\r\n\r\n  // No need to do anything for now\r\n  onDragStart(info) {\r\n    //console.log('[tree] onDragStart', info);\r\n  }\r\n\r\n  // No need to do anything for now\r\n  // We allow a leaf node to become a folder node if a node was dragged into it.\r\n  // E.g. maybe the user wants to create 2 pages for a single device\r\n  // But we still need to do some validation on max depth, otherwise testers will abuse.\r\n  onDragEnter(info) {\r\n    //console.log('[tree] onDragEnter', info);\r\n  }\r\n\r\n  // nodePos sample: '0-0-0-0'\r\n  // Even the top level node format is '0-0' or '0-1'\r\n  getParentPosStr(nodePos) {\r\n    let toks = nodePos.split('-');\r\n    let lastIndex = nodePos.lastIndexOf('-');\r\n    if (lastIndex < 0) {\r\n      return null; // Will never happen, just sanity check\r\n    }\r\n\r\n    return nodePos.substr(0, lastIndex);\r\n  }\r\n\r\n  // Need to rearrange the state\r\n  // Some validations have already been performed prior to calling this function\r\n  // e.g. Dropping parent to child\r\n  // rc-tree limiation: onDrop does not fire if you drop into the bottom-most element, if the mouse position is outside the bounds of the tree's dom\r\n  // maybe we can draw an imaginary border while dragging\r\n  onDrop = (info) => {\r\n    console.log('[tree] onDrop', info);\r\n    let bUpdated = true;\r\n    const dropKey = info.node.props.eventKey;\r\n    const dragKey = info.dragNode.props.eventKey;\r\n    const dragParentPos = this.getParentPosStr(info.dragNode.props.pos);\r\n\r\n    const dropPos = info.node.props.pos.split('-');\r\n    const dropPosition = info.dropPosition - Number(dropPos[dropPos.length - 1]);\r\n    const isBottomGap = dropPosition === 1;\r\n    const dropParentPos = this.getParentPosStr(info.node.props.pos);\r\n\r\n    // [1] TODO Do some validation, e.g. depth\r\n\r\n    // Make a copy of the state data\r\n    const data = [...this.props.treeData];\r\n\r\n    // [2] Get the dragged node and dropped node\r\n    let dragObj = findNodeByKey(data, dragKey);\r\n    let dropObj = findNodeByKey(data, dropKey);\r\n\r\n    // [3] Actual logic to modify the arrays\r\n    // [A] If dropped to a gap\r\n    if (info.dropToGap === true) {\r\n      // Note: This block can handle both [a] reorder in same folder [b] moving to a different folder\r\n      // Remove the object first\r\n      dragObj.parentArr.splice(dragObj.index, 1);\r\n      // Find the new index @ dropped folder\r\n      let newDropIdx = dropObj.parentArr.findIndex((item) => item.key === dropKey);\r\n      if (isBottomGap) {\r\n        newDropIdx++;\r\n      }\r\n      dropObj.parentArr.splice(newDropIdx, 0, dragObj.item);\r\n    }\r\n    // [B] Drop to a tree node (folder or target)\r\n    else {//(!info.dropToGap)\r\n      // [B1] If dropping to the same folder: do nothing\r\n      if (info.node.props.pos === dragParentPos) {\r\n        console.log('Dropped to the same folder: do nothing');\r\n        bUpdated = false;\r\n      }\r\n      // [B2] Dropping to a different folder/target\r\n      else {\r\n        // Remove the object first\r\n        dragObj.parentArr.splice(dragObj.index, 1);\r\n        // Add it to back of the folder or target\r\n        dropObj.item.children = dropObj.item.children || []; // create if necessary\r\n        dropObj.item.children.push(dragObj.item);\r\n      }    \r\n    }\r\n\r\n    // Fire redux action to set the new state\r\n    if (bUpdated) {\r\n      this.props.onHierarchyChanged(data);\r\n    }    \r\n  }\r\n\r\n  /*\r\n  Filterer = (node) => {\r\n    if (!this.props.searchText) {\r\n      return false;\r\n    }\r\n\r\n    return node.props.title.includes(this.props.searchText);\r\n  }\r\n  */\r\n\r\n  satisfiesFilter(nodeItem) {\r\n    if (!this.props.searchText || nodeItem.title.includes(this.props.searchText)) {\r\n      return true;\r\n    }\r\n\r\n    // If it contains children, and one of the children satisfies\r\n    if (!nodeItem.children) {\r\n      return false\r\n    }\r\n\r\n    for (var i = 0; i < nodeItem.children.length; i++) {\r\n      var currChild = nodeItem.children[i];\r\n      if (this.satisfiesFilter(currChild)) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  getFirstLevelKeys() {\r\n    if (!this.props.treeData) {\r\n      return [];\r\n    }\r\n\r\n    return this.props.treeData.map(item => item.key);\r\n  }\r\n\r\n  shouldHide(hiddenSettingsNames, nodeSettings)  {\r\n    if (!Array.isArray(hiddenSettingsNames)) {\r\n      return false;\r\n    }\r\n\r\n    for (let i = 0; i < hiddenSettingsNames.length; i++) {\r\n      let hiddenSettingName = hiddenSettingsNames[i];\r\n      if (nodeSettings[hiddenSettingName] === true) {\r\n        return true;\r\n      }\r\n    }\r\n\r\n    return false;\r\n  }\r\n\r\n  renderTreeNodes(listNodes) {\r\n    let retList = [];\r\n    if (!listNodes) {\r\n      return null;\r\n    }\r\n\r\n    // This function might be called very often, avoid anonymous functions\r\n    for (let i = 0; i < listNodes.length; i++) {\r\n      let currItem = listNodes[i];\r\n      if (!this.satisfiesFilter(currItem)) {\r\n        continue;\r\n      }\r\n      // retList.push(<TreeNode key={currItem.key} title={currItem.title} category={currItem.category} nodeType={currItem.nodeType}>\r\n      let findUserSettings = !!this.props.userSettings && this.props.userSettings.find(x => x.key === currItem.key);\r\n      if (findUserSettings) {\r\n        if (this.shouldHide(this.props.hiddenNodesSettings, findUserSettings)) {\r\n          continue;\r\n        }\r\n\r\n        let tempSettings = {...currItem};\r\n        tempSettings.title = findUserSettings.dispName;\r\n        retList.push(<TreeNode {...tempSettings}>      \r\n          {this.renderTreeNodes(currItem.children)}\r\n        </TreeNode>);      \r\n      }\r\n      else {\r\n        retList.push(<TreeNode {...currItem}>      \r\n                      {this.renderTreeNodes(currItem.children)}\r\n                    </TreeNode>);      \r\n      }\r\n    }\r\n\r\n    return retList\r\n  }\r\n\r\n  render() {\r\n    console.log('rendering tree', this.props.userSettings);\r\n    if (!this.props.treeData) {\r\n      return <div>Loading...</div>\r\n    }\r\n\r\n    return (\r\n      <Tree style={{overflow: \"auto\", height: \"100%\", width: \"100%\", padding: \"0 0 20 0\"}}\r\n          className=\"hierarchyTree\"\r\n          showLine\r\n          selectable\r\n          draggable={this.props.draggable}\r\n          onDragStart={this.onDragStart}\r\n          onDragEnter={this.onDragEnter}\r\n          onDrop={this.onDrop}\r\n          checkable={false}\r\n          defaultExpandAll={this.props.defaultExpandAll} // temp: expand everything by default; no need to config which keys to expand          \r\n          onExpand={this.onExpand}\r\n          //expandedKeys={this.state.expandedKeys}\r\n          // defaultExpandedKeys={this.getFirstLevelKeys()}\r\n          selectedKeys={this.props.selectedNodeKey ? [this.props.selectedNodeKey]: []}\r\n          //defaultSelectedKeys={this.state.defaultSelectedKeys}\r\n          //defaultCheckedKeys={this.state.defaultCheckedKeys}\r\n          onSelect={this.props.onSelectCb}\r\n          onCheck={this.onCheck}\r\n        \r\n          // Manually render the tree nodes, so that we can customize the behaviour like hiding filtered out data\r\n          //treeData={[treeDataObj]}\r\n          //treeData={this.props.treeData}\r\n          icon={this.Icon}\r\n          //filterTreeNode={this.Filterer}\r\n          switcherIcon={this.getSwitcherIcon}>\r\n              {this.renderTreeNodes(this.props.treeData)}\r\n      </Tree>\r\n    );\r\n  }\r\n}\r\n\r\n\r\n\r\nexport default HierarchyDesignerTree;\r\n// Remove dependency from redux so that this component may be reused.\r\n// By right, low level component must not be aware of redux anyways.\r\n// export default connect(mapStateToProps, mapDispatchToProps)(HierarchyDesignerTree)","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n\r\nexport default function noobControlHoc(WrappedComponent) {\r\n    return class extends React.Component {\r\n\r\n        onClick = (evt) => {\r\n            console.log(\"[noobControlHoc] onClick\");\r\n            //debugger\r\n            evt.stopPropagation();\r\n        };\r\n\r\n        onMouseDown = (evt) => {\r\n            console.log(\"[noobControlHoc] onMouseDown\");\r\n            // Let the parent know that i am clicked. It's up to the parent to dispatch an action\r\n            if (this.props.controlSelected) {                \r\n                this.props.controlSelected(this.props);\r\n            }\r\n            //evt.stopPropagation();\r\n        }\r\n\r\n        componentDidMount() {\r\n            let domNode = ReactDOM.findDOMNode(this);\r\n            if (domNode) {\r\n                // Changed to mousedown so that dragging the control will also select the control\r\n                domNode.addEventListener('mousedown', this.onMouseDown);\r\n                //domNode.addEventListener('click', this.onClick);\r\n            }\r\n        }\r\n\r\n        render() {\r\n            return <WrappedComponent {...this.props}/>;\r\n        }    \r\n    }\r\n}","import React, {useState, useEffect} from 'react';\r\nimport './section.css';\r\nimport './common.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\n\r\nconst getFontSize = (level) => {\r\n    if (!!level) {\r\n        return 26 - level * 2;\r\n    }    \r\n\r\n    return 20;\r\n}\r\n\r\nconst Section = (props) => {\r\n    console.log('section render', props.style);\r\n    let styles = {\r\n        fontSize: getFontSize(props.data.level)\r\n    };\r\n    let classNames = 'section';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n\r\n    let combinedStyle = {...props.style, ...styles};\r\n\r\n    return <div className={classNames} style={combinedStyle}>\r\n        {props.data.title}\r\n    </div>\r\n}\r\nexport default noobControlHoc(Section);\r\n\r\n\r\n/* This region is for the Props Pane */\r\nconst levelOptions = [\r\n    { key: 'level-1', text: '1', value: 1 },    \r\n    { key: 'level-2', text: '2', value: 2 },    \r\n    { key: 'level-3', text: '3', value: 3 },    \r\n    { key: 'level-4', text: '4', value: 4 },    \r\n];\r\n\r\n// Include the unique props that need to be customized only\r\n// Props that are not included will be automatically rendered as textbox\r\n// Common props like control type and id will be taken care of by the Properties Panel\r\nexport const sectionProps = [\r\n    {\r\n        // label prop: no need to include if no need to customize. Will automatically title-ize the 'name'\r\n        name: 'level', \r\n        propType: 'combo',\r\n        options: levelOptions\r\n    },\r\n]","import React, {useState, useEffect} from 'react';\r\nimport './common.css';\r\nimport './richtext.css';\r\nimport 'draft-js/dist/Draft.css';\r\nimport { stateFromHTML } from 'draft-js-import-html'\r\n\r\n\r\n\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\n\r\nimport { Editor, EditorState, RichUtils, ContentState, convertFromRaw } from 'draft-js';\r\n\r\nconst styleMap = {\r\n    CODE: {\r\n      backgroundColor: 'rgba(0, 0, 0, 0.05)',\r\n      fontFamily: '\"Inconsolata\", \"Menlo\", \"Consolas\", monospace',\r\n      fontSize: 16,\r\n      padding: 2,\r\n    },\r\n  };\r\n\r\n  function getBlockStyle(block) {\r\n    switch (block.getType()) {\r\n      case 'blockquote': return 'RichEditor-blockquote';\r\n      default: return null;\r\n    }\r\n  }\r\n\r\nconst formatJsonObjAsHtml = (jsonObj) => {\r\n  if (!jsonObj) {\r\n    return \"\";\r\n  }\r\n\r\n  let retHtml = \"<div>\";\r\n  for (var prop in jsonObj) {\r\n    retHtml += '<div style=\"padding: 10px\">'\r\n    retHtml += `<div><b>${prop}</b></div>`;\r\n    retHtml += `<div>${jsonObj[prop]}</div>`;\r\n    retHtml += '</div>'\r\n    retHtml += '<div><br/></div>'\r\n  }\r\n\r\n  retHtml += '</div>'\r\n  return retHtml;\r\n}\r\n\r\n// This is now just a Read-only component.\r\n// Let the user modify the contents at the Properties Panel area\r\nconst RichText = (props) => {\r\n    let initialState;\r\n\r\n    debugger\r\n    \r\n    let apiDataAvailable = props.apiData && props.apiData.data && Array.isArray(props.apiData.data) && props.apiData.data.length > 0;\r\n    if (props.pageApiData && props.data.apiFieldName) {\r\n      // parse the pageApiData for apiFieldName\r\n      let value = props.pageApiData[props.data.apiFieldName];\r\n      initialState = EditorState.createWithContent(ContentState.createFromText(value));\r\n    }\r\n    else if (apiDataAvailable) {\r\n      //initialState = EditorState.createWithContent(ContentState.createFromText(JSON.stringify(props.apiData.data[0])));\r\n      let html = formatJsonObjAsHtml(props.apiData.data[0]);\r\n      initialState = EditorState.createWithContent(stateFromHTML(html));\r\n    }\r\n    else if (props.data.richTextData) {\r\n        initialState = EditorState.createWithContent(convertFromRaw(props.data.richTextData));\r\n    }\r\n    else {\r\n        //initialState = EditorState.createEmpty();\r\n        initialState = EditorState.createWithContent(ContentState.createFromText('Hello\\r\\nworld')); // to test if it can handle new line\r\n    }\r\n    const [editorState, setEditorState] = useState(initialState);\r\n\r\n    useEffect(() => {      \r\n      setEditorState(initialState)\r\n    }, [props.data.richTextData, apiDataAvailable, props.pageApiData]);\r\n\r\n    //https://github.com/jpuri/react-draft-wysiwyg/issues/4\r\n    //https://codepen.io/Kiwka/pen/YNYvyG\r\n    let classNames = 'richTextMainContainer ';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n\r\n    // If the user changes block type before entering any text, we can\r\n    // either style the placeholder or hide it. Let's just hide it now.\r\n    let className = 'RichEditor-editor';\r\n    var contentState = editorState.getCurrentContent();\r\n    if (!contentState.hasText()) {\r\n      if (contentState.getBlockMap().first().getType() !== 'unstyled') {\r\n        className += ' RichEditor-hidePlaceholder';\r\n      }\r\n    }\r\n\r\n    return (\r\n        <div className={classNames}>\r\n            <div className=\"controlLabel\">{props.data.label}</div>\r\n            <div className=\"RichEditor-root designerRichTextEditor\">\r\n                <div className={className}>\r\n                    <Editor\r\n                    blockStyleFn={getBlockStyle}\r\n                    customStyleMap={styleMap}\r\n                    editorState={editorState}\r\n                    placeholder={props.data.placeholder}\r\n                    spellCheck={true}\r\n                    readOnly\r\n                    />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default noobControlHoc(RichText);\r\n\r\n// Image Props section\r\nexport const richTextProps = [\r\n  {\r\n    name: 'richTextData', \r\n    propType: 'richText',\r\n    toolTip: 'Optional. This data will not be shown if this control is configured to show contents from API.'\r\n  },\r\n  {\r\n    name: 'dataProps', \r\n    propType: 'section',\r\n  },\r\n  {\r\n    name: 'datasetId', \r\n    propType: 'number',\r\n  },\r\n  {\r\n    name: 'requestType', \r\n    propType: 'metadata',\r\n    metadataField: 'requestTypes',\r\n    metadataPropType: 'dropdown'\r\n  },\r\n  {\r\n    name: 'filterName', \r\n    propType: 'metadata',\r\n    metadataField: 'dimensions',\r\n    metadataPropType: 'treeDropdown'\r\n  },\r\n]","import React from 'react';\r\nimport { Dropdown, Icon } from 'semantic-ui-react'\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\n\r\nimport './combo.css';\r\n\r\nconst noobCombo = (props) => {\r\n    console.log('render combo: ', props.data.label);\r\n    let classNames = 'dropdownContainer ';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n    return <div className={classNames}>\r\n        <div className=\"controlLabel\">{props.data.label}</div>\r\n        <Dropdown placeholder={props.data.placeholder}\r\n        fluid\r\n        multiple\r\n        selection\r\n        search\r\n        options={props.data.options}\r\n        onMouseDown={e => {console.log(\"[Dropdown] onMouseDown!\")}}\r\n        button  // Add button and className so that we can control the size\r\n        className='icon small'\r\n        style={{fontWeight:'normal', color: 'gray', right: '0', left: 'auto'}} // Thi\r\n        //inline\r\n        />\r\n    </div>\r\n}\r\n\r\nexport default noobControlHoc(noobCombo);","import React from 'react';\r\nimport './common.css';\r\nimport { Input } from 'semantic-ui-react'\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\n\r\n\r\nconst Textbox = (props) => {\r\n    console.log('textbox render', props.data.label);\r\n    let classNames = '';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n\r\n    return <div className={classNames} style={{width: '100%'}}>\r\n        <div className=\"controlLabel\">{props.data.label}</div>\r\n        <Input key={props.data.i} \r\n            size='small'\r\n            fluid\r\n            placeholder={props.data.placeholder}/>\r\n    </div>\r\n}\r\nexport default noobControlHoc(Textbox);","//https://stackoverflow.com/questions/4149276/how-to-convert-camelcase-to-camel-case\r\nexport default (string) => {\r\n    return string\r\n        // insert a space between lower & upper\r\n        .replace(/([a-z])([A-Z])/g, '$1 $2')\r\n        // space before last upper in a sequence followed by lower\r\n        .replace(/\\b([A-Z]+)([A-Z])([a-z])/, '$1 $2$3')\r\n        // uppercase the first character\r\n        .replace(/^./, function(str){ return str.toUpperCase(); })\r\n}","import React, { useState, Fragment, useEffect } from 'react';\r\nimport './common.css';\r\nimport './table.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport { useTable, usePagination, useFilters, useSortBy } from 'react-table';\r\nimport splitWord from '../helper/wordSplitter';\r\n\r\n// This control is used in Design Mode and Dashboard Mode\r\n// For PDF, ReportTable is used.\r\n\r\nconst DEFAULT_PAGESIZE = 10;\r\n\r\nconst statuses = ['Good', 'Bad', 'Fair', 'Uncertain']\r\n\r\nconst getSampleData = () => {\r\n    let retList = [];\r\n    let nData = 2;\r\n    for (let iArea = 0; iArea < 10; iArea++) {\r\n        for (let i = 0; i < nData; i++) {\r\n        retList.push({\r\n            targetName: `FIC_${iArea}_${i}`, \r\n            fullPath: `//PLANT/AREA_${iArea}/FIC_${i}`, \r\n            timeInControl: statuses[(i+1) % statuses.length], \r\n            timeInAlarm: statuses[(i+2) % statuses.length], \r\n            timeMvOutOfLimits: statuses[i % statuses.length],\r\n            kpi1: statuses[i % statuses.length],\r\n            kpi2: statuses[i % statuses.length],\r\n            kpi3: statuses[i % statuses.length],\r\n            kpi4: statuses[i % statuses.length],\r\n            kpi5: statuses[i % statuses.length],\r\n            kpi6: statuses[i % statuses.length],\r\n            kpi7: statuses[i % statuses.length],\r\n            kpi8: statuses[i % statuses.length],\r\n            kpi9: statuses[i % statuses.length],\r\n            kpi10: statuses[i % statuses.length],\r\n            subRows: undefined\r\n        })\r\n        }\r\n    }\r\n    \r\n\r\n    return retList;\r\n}\r\n\r\nconst renderFooterTargetNames = (info)=> {\r\n    let total = info.rows.length;\r\n    return 'Footer Target Names: ' + total + ' Records';\r\n}\r\n\r\nconst computeKpi = (kpiName, info) => {\r\n    let totalTargets = info.data.length;\r\n    let good = info.data.filter(x => x[kpiName] === 'Good').length;\r\n    return `${good / totalTargets * 100.00}%`\r\n}\r\n\r\nconst sampleColumns = [\r\n    {\r\n        Header: 'Target Info',\r\n        Footer: 'Target Summary',    \r\n        TestCustomProp: 'helllo',   \r\n        // customColSpan: 4, // should be computed\r\n        width: 200, // does not show up in getFooterGroupProps()\r\n        columns: [{\r\n            Header: 'Name',\r\n            accessor: 'targetName',\r\n            Footer: renderFooterTargetNames,\r\n            FooterColSpan: 2,\r\n        }, \r\n        {\r\n            Header: 'Full Path',\r\n            accessor: 'fullPath',\r\n            customColSpan: 3,\r\n        }]\r\n    },\r\n    {\r\n        Header: 'KPIs',\r\n        Footer: 'KPI Summary',\r\n        columns: [{\r\n            Header: 'Time in Control',\r\n            accessor: 'timeInControl',\r\n            Footer: info => computeKpi('timeInControl', info),\r\n            colType: 'kpi'\r\n        },\r\n        {\r\n            Header: 'Time in Alarm',\r\n            accessor: 'timeInAlarm',\r\n            Footer: info => computeKpi('timeInAlarm', info),\r\n            colType: 'kpi'\r\n        },\r\n        {\r\n            Header: 'Time MV Out of Limits',\r\n            accessor: 'timeMvOutOfLimits',\r\n            Footer: info => computeKpi('timeMvOutOfLimits', info),\r\n            colType: 'kpi'\r\n        },\r\n    \r\n        // {\r\n        //     //Header: 'KPI 1 - Dummy KPI with a very long name',\r\n        //     Header: 'KPI 1',\r\n        //     accessor: 'kpi1',\r\n        //     Footer: info => computeKpi('kpi1', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     // Header: 'KPI 2 - Dummy KPI with a very long name',\r\n        //     Header: 'KPI 2',\r\n        //     accessor: 'kpi2',\r\n        //     Footer: info => computeKpi('kpi2', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     //Header: 'KPI 3 - Dummy KPI with a very long name',\r\n        //     Header: 'KPI 3',\r\n        //     accessor: 'kpi3',\r\n        //     Footer: info => computeKpi('kpi3', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     Header: 'KPI 4 - Dummy KPI with a very long name',\r\n        //     accessor: 'kpi4',\r\n        //     Footer: info => computeKpi('kpi4', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     Header: 'KPI 5 - Dummy KPI with a very long name',\r\n        //     accessor: 'kpi5',\r\n        //     Footer: info => computeKpi('kpi5', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     Header: 'KPI 6 - Dummy KPI with a very long name',\r\n        //     accessor: 'kpi6',\r\n        //     Footer: info => computeKpi('kpi6', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     Header: 'KPI 7 - Dummy KPI with a very long name',\r\n        //     accessor: 'kpi7',\r\n        //     Footer: info => computeKpi('kpi7', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     Header: 'KPI 8 - Dummy KPI with a very long name',\r\n        //     accessor: 'kpi8',\r\n        //     Footer: info => computeKpi('kpi8', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     Header: 'KPI 9 - Dummy KPI with a very long name',\r\n        //     accessor: 'kpi9',\r\n        //     Footer: info => computeKpi('kpi9', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n        // {\r\n        //     Header: 'KPI 10 - Dummy KPI with a very long name',\r\n        //     accessor: 'kpi10',\r\n        //     Footer: info => computeKpi('kpi10', info),\r\n        //     colType: 'kpi'\r\n        // },\r\n\r\n        ]\r\n    },\r\n];\r\n\r\nconst generateColumns = (data) => {\r\n    if (!Array.isArray(data)) {\r\n        return [];\r\n    }\r\n    let firstData = data[0];\r\n    let retList = [];\r\n    for (let prop in firstData) {\r\n        retList.push({\r\n            Header: splitWord(prop),\r\n            accessor: prop\r\n        });\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\nconst getAdditionalCellProps = (cell) => {\r\n    if (cell.column.colType !== 'kpi') {\r\n        return {};\r\n    }\r\n\r\n    if (cell.value === 'Bad') {\r\n        return {\r\n            style: {\r\n                backgroundColor: 'pink'\r\n            }\r\n        }    \r\n    }\r\n    else if (cell.value === 'Good') {\r\n        return {\r\n            style: {\r\n                backgroundColor: 'lime'\r\n            }\r\n        }    \r\n    }\r\n    else if (cell.value === 'Uncertain') {\r\n        return {\r\n            style: {\r\n                backgroundColor: 'lightgray'\r\n            }\r\n        }    \r\n    }\r\n    else if (cell.value === 'Fair') {\r\n        return {\r\n            style: {\r\n                backgroundColor: 'gold'\r\n            }\r\n        }    \r\n    }\r\n    else {\r\n        return {};\r\n    }\r\n}\r\n\r\nconst onFilterChange = (e, f) => {\r\n    //console.log('onFilterChange', e.currentTarget.value);\r\n\r\n}\r\n\r\nconst getColHeaderByAccessor = (colArray, accessor) => {\r\n    if (!colArray) {\r\n        return null;\r\n    }\r\n\r\n    for (var i = 0; i < colArray.length; i++) {\r\n        let currCol = colArray[i];\r\n        if (currCol.accessor === accessor) {\r\n            return currCol;\r\n        }\r\n\r\n        return getColHeaderByAccessor(currCol.columns, accessor);\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nconst getTotalNumColumns = (colArray) => {\r\n    let ret = 0;\r\n    if (!colArray) {\r\n        return 0;\r\n    }\r\n\r\n    ret = colArray.reduce( (acc, curr, index, origArr) => {\r\n        // console.log('reduce', acc, curr.Header, index, origArr);\r\n        let ret = acc + getTotalNumColumns(curr.columns);\r\n\r\n        if (!curr.accessor) {\r\n            return ret;\r\n        }\r\n        if (!curr.customColSpan) {\r\n            return ret + 1;\r\n        }\r\n        else {\r\n            return ret + curr.customColSpan;\r\n        }\r\n    }, 0 )\r\n\r\n    //console.log('reduce ret', ret);\r\n    return ret;\r\n}\r\n\r\n// Define a default UI for filtering\r\nfunction DefaultColumnFilter({\r\n    column: { filterValue, preFilteredRows, setFilter },\r\n  }) {\r\n    const count = preFilteredRows.length;\r\n  \r\n    return (\r\n      <input\r\n        value={filterValue || ''}\r\n        onChange={e => {\r\n          setFilter(e.target.value || undefined) // Set undefined to remove the filter entirely\r\n        }}\r\n        placeholder={`Filter...`}\r\n        onClick = {(e) => {\r\n                e.stopPropagation();\r\n            }\r\n        }\r\n        style={{width: '100%'}}\r\n      />\r\n    )\r\n  }\r\n  \r\nconst hasFilterableColumn = (headerGroup) => {\r\n    let findFilterableColumn = headerGroup.headers.find(col => col.canFilter);\r\n    return !!findFilterableColumn;\r\n}\r\n\r\nexport const TableBase = (props) => {\r\n    let classNames = 'noobTableContainer ';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n\r\n    let columnsToUse, dataToUse;\r\n    if (props.designMode) {\r\n    // if (true) {\r\n        columnsToUse = sampleColumns;\r\n        dataToUse = getSampleData();\r\n    }\r\n    else {\r\n        dataToUse = props.apiData? props.apiData.data : [];\r\n        columnsToUse = props.apiData? generateColumns(props.apiData.data) : [];\r\n    }\r\n\r\n    const totalCols = getTotalNumColumns(columnsToUse);\r\n    const memoColumns = React.useMemo(() => columnsToUse, [props.apiData]);\r\n    const memoData = React.useMemo(() => dataToUse, [props.apiData]);\r\n    const filterTypes = React.useMemo(\r\n        () => ({\r\n          // Or, override the default text filter to use\r\n          // \"startWith\"\r\n          text: (rows, id, filterValue) => {\r\n            return rows.filter(row => {\r\n              const rowValue = row.values[id]\r\n              return rowValue !== undefined\r\n                ? String(rowValue)\r\n                    .toLowerCase()\r\n                    .startsWith(String(filterValue).toLowerCase())\r\n                : true\r\n            })\r\n          },\r\n        }),\r\n        []\r\n      );\r\n\r\n    const getPageSize = () => {\r\n        return props.data.showPaginator || dataToUse.length === 0 ? DEFAULT_PAGESIZE : dataToUse.length;\r\n    }\r\n\r\n    const defaultColumn = React.useMemo(\r\n        () => ({\r\n          // Let's set up our default Filter UI\r\n          // Filter UI can vary depending on column type\r\n          // E.g. numeric, dropdown\r\n          Filter: DefaultColumnFilter,\r\n        }),\r\n        []\r\n      )\r\n\r\n    const {\r\n        getTableProps,\r\n        getTableBodyProps,\r\n        headerGroups,\r\n        footerGroups,\r\n        rows,\r\n        prepareRow,\r\n        page,\r\n\r\n        canPreviousPage,\r\n        canNextPage,\r\n        pageOptions,\r\n        pageCount,\r\n        gotoPage,\r\n        nextPage,\r\n        previousPage,\r\n        setPageSize,\r\n        state: { pageIndex, pageSize },\r\n      } = useTable({\r\n        columns: memoColumns,\r\n        data: memoData,\r\n        defaultColumn,\r\n        filterTypes,\r\n        initialState: { pageIndex: 0, pageSize: getPageSize() },\r\n      }, \r\n      useFilters,\r\n      useSortBy,\r\n      usePagination,\r\n      );\r\n\r\n    useEffect(() => {\r\n        setPageSize(getPageSize());\r\n      }, [props.data.showPaginator, dataToUse.length]);\r\n\r\n    // console.log('table render getTableProps', getTableProps());\r\n    // console.log('table render data', inData);\r\n    // console.log('table render columns', inCol);\r\n    // console.log('table render rows', rows);\r\n    // Can access everything from footerGroups\r\n    //console.log('table render footerGroups all', footerGroups);\r\n    // Cannot access everything from footerGroup. It only includes key and colSpan\r\n    // footerGroups.forEach(footerGroup => {\r\n    //     console.log('table render footerGroup props:', footerGroup.getFooterGroupProps());\r\n    //     footerGroup.headers.forEach(column => {\r\n    //         console.log('table render column props:', column.getFooterProps());\r\n    //     });\r\n    // })\r\n    // console.log('table render page');    \r\n\r\n    headerGroups.forEach(headerGroup => {\r\n        //console.log('table render headerGroup props:', headerGroup.getHeaderGroupProps());\r\n        headerGroup.headers.forEach(column => {\r\n            //console.log('table render column props:', column.getHeaderProps());\r\n        });\r\n    })\r\n\r\n    if (!dataToUse) {\r\n        return <div>Loading data...</div>\r\n    }\r\n\r\n    return <div className={classNames}>\r\n        <div className=\"controlLabel\">{props.data.label}</div>\r\n        <table className=\"noobTable\" {...getTableProps()}>\r\n            <thead>\r\n            {headerGroups.map((headerGroup, iHeaderGrp) => (\r\n                <Fragment key={`headerGroup_${iHeaderGrp}`}>\r\n                <tr {...headerGroup.getHeaderGroupProps()}>\r\n                {headerGroup.headers.map(column => {\r\n                    let thisWidth = 100.0 / totalCols;\r\n                    if (column.customColSpan) {\r\n                        thisWidth = thisWidth * column.customColSpan\r\n                    }\r\n                    let custProp = {width: thisWidth + \"%\"};\r\n                    //let colHeader = getColHeaderByAccessor(columns, )\r\n                    return (<th \r\n                        {...column.getHeaderProps(column.getSortByToggleProps())}\r\n                        {...custProp}\r\n                    >{column.render('Header')}\r\n                    {/* Add a sort direction indicator */}\r\n                    <span>\r\n                        {column.isSorted\r\n                        ? column.isSortedDesc\r\n                            ? ' '\r\n                            : ' '\r\n                        : ''}\r\n                    </span>\r\n                    {/* Render the columns filter UI */}\r\n                    {/* <div>{column.canFilter ? column.render('Filter') : null}</div> */}\r\n                    </th>\r\n                    )\r\n                    }\r\n                )                \r\n                }\r\n                </tr>\r\n\r\n                {props.data.showFilters && hasFilterableColumn(headerGroup) && <tr key={`headerGroupFilter_${iHeaderGrp}`}>{headerGroup.headers.map(column => {\r\n                        return <th key={`headerGroupFilter_${iHeaderGrp}_${column.id}`}><div className=\"colFilter\">{column.canFilter ? column.render('Filter') : null}</div></th>\r\n                        })\r\n                    }                \r\n                </tr>}\r\n                </Fragment>\r\n            ))}\r\n            </thead>\r\n            <tbody {...getTableBodyProps()}>\r\n            {page.map(\r\n                (row, i) => {\r\n                prepareRow(row);\r\n                return (\r\n                    <tr {...row.getRowProps()}>\r\n                    {row.cells.map(cell => {\r\n                        return <td {...cell.getCellProps(getAdditionalCellProps(cell))} \r\n                        >{cell.render('Cell')}</td>\r\n                    })}\r\n                    </tr>\r\n                )}\r\n            )}\r\n            <tr>\r\n            {props.data.showFooter && <td colSpan=\"20\" style={{backgroundColor: '#ccddee'}}>Total of {rows.length} records</td>}\r\n            </tr>\r\n            </tbody>\r\n            {/* <tfoot>\r\n                {footerGroups.map(group => (\r\n                <tr {...group.getFooterGroupProps()}>\r\n                    {group.headers.map(column => (\r\n                        <td {...column.getFooterProps()}>{column.render('Footer')}</td>                                        \r\n                    ))}\r\n                </tr>\r\n                ))}\r\n            </tfoot> */}\r\n        </table>\r\n        {/* for the paginator...maybe separate into its own function */}\r\n        {props.data.showPaginator && pageCount > 0 && \r\n            // false &&\r\n            <div className=\"pagination\">\r\n                <button onClick={() => gotoPage(0)} disabled={!canPreviousPage}>\r\n                {'<<'}\r\n                </button>{' '}\r\n                <button onClick={() => previousPage()} disabled={!canPreviousPage}>\r\n                {'<'}\r\n                </button>{' '}\r\n                <button onClick={() => nextPage()} disabled={!canNextPage}>\r\n                {'>'}\r\n                </button>{' '}\r\n                <button onClick={() => gotoPage(pageCount - 1)} disabled={!canNextPage}>\r\n                {'>>'}\r\n                </button>{' '}\r\n                <span>\r\n                Page{' '}\r\n                <strong>\r\n                {pageIndex + 1} of {pageOptions.length}\r\n                </strong>{' '}\r\n                </span>\r\n                <span>\r\n                &nbsp;\r\n                &nbsp;\r\n                Go to page:{' '}\r\n                &nbsp;\r\n                <input\r\n                    type=\"number\"\r\n                    defaultValue={pageIndex + 1}\r\n                    onChange={e => {\r\n                    const page = e.target.value ? Number(e.target.value) - 1 : 0\r\n                    gotoPage(page)\r\n                    }}\r\n                    style={{ width: '80px' }}\r\n                />\r\n                </span>{' '}\r\n                <select\r\n                value={pageSize}\r\n                onChange={e => {\r\n                    setPageSize(Number(e.target.value))\r\n                }}\r\n                >\r\n                {[5, 10, 20, 30, 40].map(pageSize => (\r\n                    <option key={pageSize} value={pageSize}>\r\n                    Show {pageSize}\r\n                    </option>\r\n                ))}\r\n                </select>\r\n            </div>}\r\n        </div>\r\n    }\r\nexport default noobControlHoc(TableBase);\r\n\r\n\r\n// For the properties panel\r\nexport const tableProps = [\r\n    {\r\n        name: 'showFilters', \r\n        propType: 'bool',\r\n    },    \r\n    {\r\n        name: 'showPaginator', \r\n        propType: 'bool',\r\n    },    \r\n    {\r\n        name: 'showFooter', \r\n        propType: 'bool',\r\n    },    \r\n    {\r\n      name: 'dataProps', \r\n      propType: 'section',\r\n    },\r\n    {\r\n      name: 'datasetId', \r\n      propType: 'number',\r\n    },\r\n    {\r\n      name: 'requestType', \r\n      propType: 'metadata',\r\n      metadataField: 'requestTypes',\r\n      metadataPropType: 'dropdown'\r\n    },\r\n    {\r\n      name: 'columns', \r\n      propType: 'metadata',\r\n      metadataField: 'dimensions',\r\n      metadataPropType: 'treeDropdown',\r\n      multiple: true,\r\n      // Means if specifyColumns===true, this field will be visible or enabled. Otherwise, set to invisible or disabled\r\n      watchedField: 'specifyColumns',\r\n      watchedValue: true,\r\n      \r\n    },\r\n    {\r\n        name: 'aggregation', \r\n        propType: 'metadata',\r\n        metadataField: null,\r\n        metadataPropType: 'textbox',\r\n        toolTip: 'Only count is supported in this version. Also, aggregation may not be applicable, depending on Request Type.',\r\n        readOnly: true\r\n    },\r\n    {\r\n        name: 'specifyColumns',\r\n        propType: 'bool',\r\n        watchableField: true, // means this field can be watched by other fields for changes\r\n        toolTip: \"If [Specify Columns] is ticked, select the [Columns] you wish to include. Otherwise, specify [Categories] and/or [Series Name] just like configuring a piechart/barchart.\"\r\n    },\r\n    {\r\n        name: 'categories',\r\n        propType: 'metadata',\r\n        metadataField: 'dimensions',\r\n        metadataPropType: 'treeDropdown',\r\n        // Means if specifyColumns===true, this field will be visible or enabled. Otherwise, set to invisible or disabled\r\n        watchedField: 'specifyColumns',\r\n        watchedValue: false,\r\n    },\r\n    {\r\n        name: 'seriesName',\r\n        propType: 'metadata',\r\n        metadataField: 'dimensions',\r\n        metadataPropType: 'treeDropdown',\r\n        // Means if specifyColumns===true, this field will be visible or enabled. Otherwise, set to invisible or disabled\r\n        watchedField: 'specifyColumns',\r\n        watchedValue: false,\r\n    },    \r\n    {\r\n        name: 'filterName', \r\n        propType: 'metadata',\r\n        metadataField: 'dimensions',\r\n        metadataPropType: 'treeDropdown'\r\n    },\r\n    {\r\n        name: 'filtersList', \r\n        propType: 'dynamicFilter',\r\n        metadataField: 'dimensions', // Infer metadata field if it is a dynamicFilter\r\n        metadataPropType: 'treeDropdown',\r\n        multiple: true,\r\n        toolTip: \"Select one or more filters by clicking the Add Parameter button\"\r\n      },\r\n];","import React from 'react';\r\nimport './common.css';\r\nimport './label.css';\r\nimport { Input } from 'semantic-ui-react'\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\n\r\n\r\nconst Label = (props) => {\r\n    console.log('textbox render', props.data.label);\r\n    let classNames = 'ctrlLabel ctrlLabel-report';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n\r\n    let labelStyles = {height: '100%'};\r\n    if (!!props.data.color) {\r\n        labelStyles.color = props.data.color;\r\n    }\r\n    if (!!props.data.backgroundColor) {\r\n        labelStyles.backgroundColor = props.data.backgroundColor;\r\n    }\r\n    if (!!props.data.fontSize) {\r\n        labelStyles.fontSize = props.data.fontSize + 'px';\r\n    }\r\n    if(!!props.data.linkedPage) {\r\n        labelStyles.cursor = 'pointer';\r\n    }\r\n    if(!!props.data.alignment) {\r\n        labelStyles.justifyContent = props.data.alignment;\r\n    }\r\n    // For the data\r\n    let labelToShow;\r\n    if (props.pageApiData && props.data.apiFieldName) {\r\n        labelToShow = props.pageApiData[props.data.apiFieldName];\r\n    }\r\n    else {\r\n        labelToShow = props.data.label;\r\n    }\r\n\r\n    const handleClick = () => {\r\n        if (!props.data.linkedPage || !props.data.handleLinkClick) {\r\n            return;\r\n        }\r\n\r\n        props.data.handleLinkClick(props);\r\n    }\r\n\r\n    return <div className={classNames} style={labelStyles} onClick={handleClick}>\r\n        {props.data.icon && <span><i className={`ui icon ${props.data.icon}`} style={{paddingLeft: '5px'}}/></span> }\r\n        <span style={{marginLeft: '5px'}}>{labelToShow}</span>\r\n    </div>\r\n}\r\nexport default noobControlHoc(Label);\r\n\r\n\r\nexport const labelProps = [\r\n    {\r\n        // label prop: no need to include if no need to customize. Will automatically title-ize the 'name'\r\n        name: 'icon', \r\n        propType: 'icon',\r\n    },\r\n    {\r\n        name: 'color', \r\n        propType: 'color',\r\n    },\r\n    {\r\n        name: 'backgroundColor', \r\n        propType: 'color',\r\n    },\r\n    {\r\n        name: 'fontSize', \r\n        propType: 'number',\r\n        toolTip: 'in pixels unit'\r\n    },\r\n    {\r\n        name: 'linkedPage', \r\n        propType: 'pageLinks',\r\n    },\r\n    {\r\n        name: 'alignment', \r\n        propType: 'alignment',\r\n        toolTip: 'Specify CSS justify-content value, e.g. left, center'\r\n    },\r\n]","import React from 'react';\r\nimport './notification.css'\r\nimport 'react-notifications-component/dist/theme.css';\r\nimport { store } from 'react-notifications-component';\r\n\r\nconst DEFAULT_WIDTH = 400;\r\nconst DEFAULT_DURATION = 1200;\r\n\r\nexport const NotifType = {\r\n    default: 'default',\r\n    success: 'success',\r\n    danger: 'danger',\r\n    warning: 'warning',\r\n    info: 'info'\r\n}\r\n\r\nconst NotifIcon = {\r\n    success: 'check circle',\r\n    danger: 'exclamation circle',\r\n    warning: 'exclamation triangle',\r\n    info: 'info circle'\r\n}\r\n\r\nconst defaultProps = {\r\n    type: \"default\",\r\n    insert: \"top\",\r\n    container: \"top-center\",\r\n    animationIn: [\"animated\", \"slideInDown\"],\r\n    animationOut: [\"animated\", \"slideOutUp\"],\r\n    width: DEFAULT_WIDTH,\r\n    dismiss: {\r\n      duration: DEFAULT_DURATION,\r\n      onScreen: false,\r\n      pauseOnHover: true,\r\n      showIcon: true    // X button to dismiss\r\n    }\r\n};\r\n\r\nexport const ShowMessage = (titleIn, typeIn=NotifType.default, messageIn=' ') => {\r\n    if (!messageIn) {\r\n        messageIn = ' '\r\n    }\r\n\r\n    store.addNotification({\r\n        ...defaultProps,\r\n        title: titleIn,\r\n        message: messageIn,\r\n        type: typeIn,        \r\n    });\r\n}\r\n\r\n// TODO: try to show icon\r\nconst renderContentWithIcon = (type, iconClassName, message) => {\r\n    // return (\r\n    //     <div className={`notification-custom-${type}`}>\r\n    //         <div className=\"notification-custom-icon\">\r\n    //             {/* <i className={`ui icon ${iconClassName}`}/> */}\r\n    //             <i className={`ui icon save`}/>\r\n    //         </div>\r\n    //         <div className=\"notification-custom-content\">\r\n    //             <p className=\"notification-message\">{message}</p>\r\n    //         </div>\r\n    //     </div>\r\n    // )\r\n    // return (\r\n    //     <div className={`notification-custom-success`}>\r\n    //         <div className=\"notification-custom-content\">\r\n    //         <p className=\"notification-message\">\r\n    //             HElllllllllllllllllllloooooooo            \r\n    //         </p>\r\n    //         </div>\r\n    //     </div>\r\n    // );\r\n    return (<div style={{border: '1px soild red'}}>Hello!</div>)\r\n\r\n  }\r\n\r\nexport default ShowMessage;","import React from 'react';\r\n\r\n//import dc from 'dc';\r\n//import dc from 'dc';\r\nimport crossfilter from 'crossfilter2';\r\nimport * as d3 from 'd3/dist/d3';\r\nimport \"dc/dist/style/dc.css\";\r\nimport {\r\n    ResponsiveContainer\r\n  } from 'recharts';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\n\r\n\r\nconst dc = require(\"dc\");\r\n\r\nconst generateData = () => {\r\n    let numTargets = 10;\r\n    let diagKpis = {\r\n        \"Loop Controllability\": [\"Time in Control\", \"Time in Preferred Mode\"],\r\n        \"Valve Controllability\": [\"Time in Control\", \"Total Deviation Time\"],\r\n    };\r\n    let kpiStatuses = [\"Good\", \"Bad\", \"Fair\", \"Uncertain\"];\r\n\r\n    let retList = [];\r\n\r\n    for (let i = 0; i < numTargets; i++) {\r\n        let diags = Object.keys(diagKpis);\r\n        for (let iDiag = 0; iDiag < diags.length; iDiag++) {\r\n            let kpis = diagKpis[diags[iDiag]];\r\n            for (let iKpi = 0; iKpi < kpis.length; iKpi++) {\r\n                retList.push({\r\n                    targetName: `Target_${i}`,\r\n                    diagName: diags[iDiag],\r\n                    kpiname: kpis[iKpi],\r\n                    kpiStatus: kpiStatuses[i % kpiStatuses.length],\r\n                    kpiValue: i + iDiag + iKpi\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\nclass DCChart extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.myRefChart = React.createRef();\r\n        this.theChart = null;\r\n    }\r\n\r\n    componentDidMount = () => {\r\n        var kpis = crossfilter(generateData());\r\n        const dimensionKpi = kpis.dimension(function (data) {\r\n            return data.kpiStatus;\r\n        });\r\n        const groupKpi = dimensionKpi.group();\r\n        //const kpiStatusChart = dc.rowChart(this.myRefChart.current)\r\n        this.theChart = dc.rowChart(this.myRefChart.current)\r\n        .dimension(dimensionKpi)\r\n        .group(groupKpi)    \r\n        .ordinalColors(['#00aa00', '#aa2222', '#999900', '#555555'])   \r\n        // .height(null)         \r\n        // .width(null)     \r\n        // .elasticY(true)\r\n        .elasticX(true)  \r\n        .render();\r\n    }\r\n\r\n    componentDidUpdate = (prevProps) => {\r\n        console.log('DC JS componentDidUpdate');\r\n        if (prevProps.w === this.props.w &&\r\n            prevProps.h === this.props.h) {\r\n                return;\r\n        }\r\n\r\n        //debugger\r\n        //this.myRefChart.current.render();\r\n        // dc.renderAll(this.myRefChart.current);\r\n        this.theChart.render();\r\n    }\r\n\r\n    render() {\r\n        let classNames = '';\r\n        if (this.props.selected === true) {\r\n            classNames += ' ctrl-selected'\r\n        }\r\n      \r\n        console.log('DC JS', this.props.w);\r\n        return <div style={{width: '100%', height: '100%'}} className={classNames}>\r\n        <div id=\"myDcBarChart\" style={{width: '100%', height: '100%'}} ref={this.myRefChart}/>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default noobControlHoc(DCChart);\r\n//export default DCChart;","import React from 'react';\r\nimport \"../styles/ToolBox.css\";\r\nimport 'react-grid-layout/css/styles.css';\r\n\r\n//import {connect} from 'react-redux';\r\n//import { bindActionCreators } from \"redux\";\r\nimport {toolItemDragged} from '../actions/index';\r\n\r\nimport { useDrag } from 'react-dnd';\r\nimport ShowMessage, {NotifType} from '../helper/notification';\r\n\r\nexport const ToolItemDragTypes = {\r\n    TOOLITEM: 'toolItem'\r\n}\r\n\r\n\r\nlet onDragStart = (e) => {\r\n    console.log(\"onDragStart!\");\r\n    // temporary code: we tell redux that this item started dragging.\r\n    // This code will not be needed once react-grid-layout code has been updated to pass the mouse event in the onDrop function\r\n}\r\n\r\n/* Original function, without using React-dnd\r\nconst toolItem = (props) => {\r\n    let iconClass = `icon ${props.controlType.icon}`\r\n    return <div className=\"toolItem droppable-element\" draggable={true} unselectable=\"on\" \r\n            onDragStart={(e) => props.toolItemDragged(props.controlType)}>\r\n        <i className={iconClass}></i>\r\n        {props.controlType.displayName}\r\n    </div>\r\n}\r\n*/\r\n\r\nconst handleEndDrag = (item, monitor) => {\r\n    if (monitor.didDrop()) {\r\n        return;\r\n    }\r\n\r\n    ShowMessage('Control was not added', \r\n    NotifType.info, \r\n    'Please drop the control into an empty cell, or make sure there is sufficient space for larger controls.')\r\n}\r\n\r\nconst ToolItem = (props) => {\r\n\r\n    const [{ isDragging }, drag] = useDrag({\r\n        item: {\r\n            type: ToolItemDragTypes.TOOLITEM,\r\n            minW: props.controlType.minW,\r\n            minH: props.controlType.minH,\r\n            toolItemTypeName: props.controlType.name\r\n        },\r\n        end: (item, monitor) => handleEndDrag(item, monitor),\r\n        collect: monitor => ({\r\n          isDragging: !!monitor.isDragging(),\r\n        }),\r\n      })\r\n\r\n    let iconClass = `icon ${props.controlType.icon}`\r\n    return <div className=\"toolItem\" ref={drag} style={{\r\n        backgroundColor: isDragging ? 'lightblue' : '#cacaca',\r\n      }}>\r\n        <i className={iconClass}></i>\r\n        {props.controlType.displayName}\r\n    </div>\r\n}\r\n\r\n// const mapDispatchToProps = dispatch => {\r\n//     return bindActionCreators({ toolItemDragged }, dispatch);\r\n// }\r\n\r\n//export default toolItem;\r\n//export default connect(null, mapDispatchToProps)(toolItem);\r\nexport default ToolItem;","import React from 'react';\r\nimport ToolItem from './toolItem';\r\nimport \"../styles/ToolBox.css\";\r\n\r\n\r\n\r\nexport const toolBoxItems = [\r\n    {\r\n         name: 'section',\r\n         displayName: 'Section',\r\n         icon: 'wpforms',\r\n         category: 'common',\r\n         minW: 12, minH:1,\r\n    },    \r\n//     {\r\n//          name: 'textbox',\r\n//          displayName: 'Textbox',\r\n//          icon: 'text height',\r\n//          category: 'forms'\r\n//     },    \r\n//     {\r\n//          name: 'combo',\r\n//          displayName: 'Combobox',\r\n//          icon: 'caret square down outline',\r\n//          category: 'forms',\r\n//          minW: 3, minH:1,\r\n//     },    \r\n//     {\r\n//          name: 'checkbox',\r\n//          displayName: 'Checkbox',\r\n//          icon: 'check square outline',\r\n//          category: 'forms'\r\n//     },                \r\n    {\r\n         name: 'richtext',\r\n         displayName: 'Rich Text',\r\n         icon: 'paint brush',\r\n         category: 'forms',\r\n         minW: 3, minH:3,\r\n    },                \r\n//     {\r\n//          name: 'numeric',\r\n//          displayName: 'Number',\r\n//          icon: 'sort numeric down',\r\n//          category: 'forms'\r\n//     },                \r\n//     {\r\n//          name: 'user',\r\n//          displayName: 'User',\r\n//          icon: 'user circle outline',\r\n//          category: 'forms'\r\n//     },     \r\n//     {\r\n//           name: 'status',\r\n//           displayName: 'Status',\r\n//           icon: 'circle outline',\r\n//           category: 'forms'\r\n//      },     \r\n     // {\r\n     //      name: 'date',\r\n     //      displayName: 'Date',\r\n     //      icon: 'calendar alternate outline',\r\n     //      category: 'forms'\r\n     // },     \r\n//      {\r\n//           name: 'attachment',\r\n//           displayName: 'Attachments',\r\n//           icon: 'attach',\r\n//           category: 'forms'\r\n//      },     \r\n//      {\r\n//           name: 'history',\r\n//           displayName: 'History',\r\n//           icon: 'history',\r\n//           category: 'forms'\r\n//      },     \r\n     {\r\n         // Should support expressions, like the Target Name, Vendor, Model etc.\r\n       name: 'label',\r\n       displayName: 'Label',\r\n       icon: 'info',\r\n       category: 'common'\r\n    },\r\n//     {\r\n//           // Should provide a configurable URL\r\n//        name: 'image',\r\n//        displayName: 'Image',\r\n//        icon: 'image outline',\r\n//        category: 'common'\r\n//     },\r\n    {\r\n         name: 'barchart',\r\n         displayName: 'Bar Chart',\r\n         icon: 'chart bar',\r\n         category: 'common',\r\n         minW: 4, minH:5,\r\n    },\r\n    {\r\n         name: 'pie',\r\n         displayName: 'Pie Chart',\r\n         icon: 'chart pie',\r\n         category: 'common',\r\n         minW: 4, minH:5,\r\n    },\r\n     {\r\n          name: 'gauge',\r\n          displayName: 'Gauge',\r\n          icon: 'check circle outline',\r\n          category: 'common',\r\n          minW: 2, minH:3,\r\n     },   \r\n    {\r\n         name: 'line',\r\n         displayName: 'Line Chart',\r\n         icon: 'chart line',\r\n         category: 'common',\r\n         minW: 4, minH:5,\r\n    },\r\n    {\r\n         name: 'table',\r\n         displayName: 'Table',\r\n         icon: 'table',\r\n         category: 'common',\r\n         minW: 5, minH:1,\r\n    },\r\n    {\r\n         name: 'frame',\r\n         displayName: 'Frame',\r\n         icon: 'window maximize outline',\r\n         category: 'common',\r\n         minW: 3, minH:4,\r\n    },\r\n   {\r\n     // Should provide a configurable URL\r\n     name: 'imageMap',\r\n     displayName: 'Image Map',\r\n     icon: 'map pin',\r\n     category: 'common',\r\n     minW: 3, minH:3,\r\n   },\r\n//    {\r\n//      // E.g. permits for a page\r\n//      name: 'childtemplate',\r\n//      displayName: 'Child Template',\r\n//      icon: 'clone outline',\r\n//      category: 'form'\r\n//    },\r\n   {\r\n     name: 'pagebreak',\r\n     displayName: 'Page Break',\r\n     icon: 'window minimize',\r\n     category: 'common',\r\n     minW: 12, minH:1,\r\n   },\r\n//    {\r\n//      name: 'dcbar',\r\n//      displayName: 'DC JS Bar',\r\n//      icon: 'bar',\r\n//      category: 'common',\r\n//      minW: 3, minH:3,\r\n//    },   \r\n];\r\n\r\n\r\nconst drawToolItems = () => {\r\n    return toolBoxItems.map( (toolItem) => {\r\n        return <ToolItem controlType={toolItem} key={toolItem.name}/>;\r\n    })\r\n}\r\n\r\nconst ToolBox = ({containerWidth}) => {\r\n     let classNames = 'toolBox';     \r\n     if (containerWidth < 200) {\r\n          classNames += ' toolBox-1row'\r\n     }\r\n     else {\r\n          classNames += ' toolBox-2rows'\r\n     }\r\n     console.log('toolBox containerWidth', containerWidth);\r\n     return <div className={classNames}>\r\n          {drawToolItems()}\r\n     </div>\r\n}\r\n\r\nexport const getToolItemByName = (name) => toolBoxItems.find(tool => {\r\n     return tool.name === name\r\n});\r\n\r\nexport default ToolBox;","import React, { useContext } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm, Popup } from \"semantic-ui-react\";\r\n\r\nfunction FormText({ name, rules, label, numeric, toolTip, small, ...rest }) {\r\n  const { register, setValue, unregister } = useContext(FormContext);\r\n  const styles = small ? {paddingTop: '6px', paddingBottom: '6px'} : {};\r\n\r\n  return (<SemanticForm.Field>\r\n            {label && <label>\r\n              <span key={'label-'+name}>{label}</span>\r\n              &nbsp;\r\n              {!!toolTip && <Popup \r\n                  inverted\r\n                  basic\r\n                  size='tiny' style={{opacity: '0.8'}} \r\n                  content={toolTip}\r\n                  trigger={<div style={{display: 'inline-block', color: 'gray'}}>\r\n                  <i className=\"ui icon info circle\"/>\r\n                  </div>} />\r\n              }\r\n            </label>}\r\n            <RHFInput\r\n                as={<input  \r\n                      key={'text-'+name} \r\n                      type={!!numeric ? 'number':'text'}\r\n                      //className=\"ui small\" \r\n                      style={styles}\r\n                      {...rest}>                        \r\n                      </input>\r\n                }\r\n\r\n            //defaultValue=\"\"\r\n            name={name}      \r\n            register={register}\r\n            unregister={unregister}\r\n            setValue={setValue}\r\n            rules={rules}\r\n            />\r\n        </SemanticForm.Field>\r\n  );\r\n}\r\n\r\nexport default FormText;\r\n","import React, { useContext } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm, Popup } from \"semantic-ui-react\";\r\n\r\nfunction FormCheckbox({ name, label, toolTip, ...rest }) {\r\n  const { register, setValue, unregister } = useContext(FormContext);\r\n\r\n  function handleChange([, props]) {\r\n    return { checked: props.checked };\r\n  }\r\n\r\n  return (<SemanticForm.Field>\r\n    {label && <label>\r\n              <span key={'label-'+name}>{label}</span>\r\n              &nbsp;\r\n              {!!toolTip && <Popup \r\n                  inverted\r\n                  basic\r\n                  size='tiny' style={{opacity: '0.8'}} \r\n                  content={toolTip}\r\n                  trigger={<div style={{display: 'inline-block', color: 'gray'}}>\r\n                  <i className=\"ui icon info circle\"/>\r\n                  </div>} />\r\n              }\r\n    </label>}    \r\n    <RHFInput\r\n      as={<SemanticForm.Checkbox {...rest} />}\r\n      name={name}\r\n      //value={name}\r\n      type=\"checkbox\"\r\n      register={register}\r\n      unregister={unregister}\r\n      setValue={setValue}\r\n      onChangeEvent={handleChange}\r\n    />\r\n    </SemanticForm.Field>\r\n  );\r\n}\r\n\r\nexport default FormCheckbox;\r\n","import React, { useContext } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm } from \"semantic-ui-react\";\r\n\r\nfunction FormDropDown({ name, label, multiple, isRequired, fluid,...rest }) {\r\n  const { register, setValue, unregister } = useContext(FormContext);\r\n\r\n  function handleChange([, props]) {\r\n    return { value: props.value};\r\n  }\r\n\r\n  // TODO: If multiple is set, there is a console log that says value must be an array instead\r\n  // of undefined. Check if the problem still exists after getting rid of RHF.\r\n  let defaultValue = multiple ? [] : null;\r\n\r\n  return (<SemanticForm.Field>\r\n        <label key={'label-'+name}>{label}</label>\r\n        <RHFInput\r\n        as={<SemanticForm.Dropdown \r\n            key={name}\r\n            fluid={fluid}\r\n            multiple={multiple}\r\n            search\r\n            selection             \r\n            style={{fontWeight:'normal', color: 'black', right: '0', left: 'auto'}}\r\n            {...rest} />}\r\n        name={name}\r\n        register={register}\r\n        unregister={unregister}\r\n        setValue={setValue}\r\n        rules={{required: isRequired }}\r\n        onChangeEvent={handleChange}\r\n        />\r\n    </SemanticForm.Field>\r\n  );\r\n}\r\n\r\nexport default FormDropDown;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm, Popup } from \"semantic-ui-react\";\r\n\r\nconst fieldWrapperStyle = {\r\n    display: 'inline-block',\r\n};\r\n\r\nfunction FormIconSelector({ name, rules, label, intialicon, ...rest }) {\r\n  const { register, setValue, unregister } = useContext(FormContext);\r\n  const [myState, setMyState] = useState({\r\n    currVal: intialicon\r\n  });\r\n\r\n  console.log('FormIconSelector render', intialicon);\r\n\r\n  return (<SemanticForm.Field>\r\n            <label key={'label-'+name}>\r\n                <span>{label}</span>\r\n                &nbsp;\r\n                <Popup \r\n                    inverted\r\n                    basic\r\n                    size='tiny' style={{opacity: '0.8'}} \r\n                    content='Semantic UI Icon, e.g. \"home\", \"warning\"' \r\n                    trigger={<div style={{display: 'inline-block', color: 'gray'}}>\r\n                    <i className=\"ui icon info circle\"/>\r\n                    </div>} />\r\n            </label>\r\n            <div className=\"ui icon input fluid\">                \r\n            <RHFInput\r\n                as={<input  key={name} \r\n                    style={fieldWrapperStyle}\r\n                    onInput = {(e) => {\r\n                        console.log('FormIconSelector onInput!', );\r\n                        setMyState({\r\n                            currVal: e.target.value\r\n                        })\r\n                    }}\r\n                    {...rest}>                                \r\n                </input>                        \r\n                }\r\n\r\n            defaultValue=\"\"\r\n            name={name}      \r\n            register={register}\r\n            unregister={unregister}\r\n            setValue={setValue}\r\n            rules={rules}\r\n            />\r\n            <i className={`ui icon large ${myState.currVal}`}/>\r\n            </div>\r\n        </SemanticForm.Field>\r\n  );\r\n}\r\n\r\nexport default FormIconSelector;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm, Popup } from \"semantic-ui-react\";\r\n\r\nconst fieldWrapperStyle = {\r\n    display: 'inline-block',\r\n};\r\n\r\nfunction FormColorSelector({ name, rules, label, intialcolor, ...rest }) {\r\n  const { register, setValue, unregister } = useContext(FormContext);\r\n  const [myState, setMyState] = useState({\r\n    currVal: intialcolor\r\n  });\r\n\r\n  console.log('FormColorSelector render', intialcolor);\r\n\r\n  return (<SemanticForm.Field>\r\n            <label key={'label-'+name}>\r\n                <span>{label}</span>\r\n                &nbsp;\r\n                <Popup \r\n                    inverted\r\n                    basic\r\n                    size='tiny' style={{opacity: '0.8'}} \r\n                    content='CSS color, e.g. \"red\", \"#abcdef\"' \r\n                    trigger={<div style={{display: 'inline-block', color: 'gray'}}>\r\n                    <i className=\"ui icon info circle\"/>\r\n                    </div>} />\r\n            </label>\r\n            <div className=\"ui icon input fluid\">\r\n            <RHFInput\r\n                as={<input  key={name} \r\n                    // name={name}\r\n                    style={fieldWrapperStyle}\r\n                    onInput = {(e) => {\r\n                        console.log('FormIconSelector onInput!', );\r\n                        setMyState({\r\n                            currVal: e.target.value\r\n                        })\r\n                    }}\r\n                    {...rest}>                                \r\n                </input>                        \r\n                }\r\n\r\n            defaultValue=\"\"\r\n            name={name}      \r\n            register={register}\r\n            unregister={unregister}\r\n            setValue={setValue}\r\n            rules={rules}\r\n            />\r\n            <i className={`ui icon large square`} style={{color: myState.currVal}}/>\r\n            </div>\r\n        </SemanticForm.Field>\r\n  );\r\n}\r\n\r\nexport default FormColorSelector;\r\n","import React, { useContext, useState } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm } from \"semantic-ui-react\";\r\nimport './FormRadio.css';\r\n\r\nfunction FormRadio({ name, initialSel, radioGroupContents, ...rest }) {\r\n  const { register, setValue, unregister } = useContext(FormContext);\r\n\r\n  function handleChange(args, {value}) {\r\n    setMyState({value});\r\n    setValue(name, value);\r\n  }\r\n\r\n  const [myState, setMyState] = useState({\r\n    value: initialSel,\r\n  });\r\n\r\n  const renderRadioBtn = (radio) => {\r\n    return <SemanticForm.Radio \r\n    key={'radio_' + radio.value}\r\n    label={radio.label}\r\n    name={radio.name} // radio group name\r\n    value={radio.value}\r\n    checked={myState.value === radio.value}\r\n    onChange={handleChange} />\r\n  }\r\n\r\n  return (\r\n    <RHFInput\r\n      as={<div className=\"radioGroupContainer\">\r\n          {radioGroupContents.map(radio => renderRadioBtn(radio))}\r\n        </div>\r\n      }\r\n      name={name}\r\n      register={register}\r\n      unregister={unregister}\r\n      setValue={setValue}\r\n      onChangeEvent={handleChange}\r\n    />\r\n  );\r\n}\r\n\r\nexport default FormRadio;\r\n","import React, {useState, useContext} from 'react';\r\nimport '../controls/datepicker.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport DatePicker from 'react-datepicker';\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\nimport { Label, Dropdown} from \"semantic-ui-react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\n\r\nexport const dateRangeDropdownOptions = [\r\n    { key: 'Latest value only', text: 'Latest value only', value: 'Latest value only', disabled: true},\r\n    { key: 'Last 1 day', text: 'Last 1 day', value: 'Last 1 day', disabled: true },\r\n    { key: 'Last 7 days', text: 'Last 7 days', value: 'Last 7 days', disabled: true },\r\n    { key: 'Last 30 days', text: 'Last 30 days', value: 'Last 30 days', disabled: true },\r\n    { key: 'Custom Range', text: 'Custom Range', value: 'CustomRange' },\r\n];\r\n\r\nconst FormDateRange = ({ name, label, initialValue, alwaysCustomRange, showMonthYearPicker, dateFormat,...rest }) => {\r\n    //const [startDate, setStartDate] = useState(new Date());\r\n    // No need to set initial values\r\n    const [startDate, setStartDate] = useState(null);\r\n    const [endDate, setEndDate] = useState(null);\r\n    const [disableDatePicker, setDisableDatePicker] = useState(!alwaysCustomRange);\r\n    const { register, setValue, unregister, errors } = useContext(FormContext);\r\n    let effectiveFormat = dateFormat ? dateFormat : \"yyyy / MMM / dd\";\r\n\r\n    function handleChangeStart([date, evt]) {\r\n        setStartDate(date);\r\n        return {\r\n            value: date\r\n        }\r\n    }\r\n\r\n    function handleChangeEnd([date, evt]) {\r\n        setEndDate(date);\r\n        return {\r\n            value: date\r\n        }\r\n    }\r\n\r\n    function handleChangeValue([, props]) {\r\n        if (props.value === 'CustomRange') {\r\n            setDisableDatePicker(false);\r\n        }\r\n        else {\r\n            setStartDate(null);\r\n            setEndDate(null);\r\n        }\r\n\r\n        return { value: props.value};\r\n    }\r\n\r\n    const renderDropdown = () => {\r\n        if (alwaysCustomRange) {\r\n            return <div style={{display: \"none\"}}></div>\r\n        }\r\n\r\n        return <Dropdown \r\n            fluid                 \r\n            selection   \r\n            options={dateRangeDropdownOptions} \r\n            defaultValue={initialValue ? initialValue : dateRangeDropdownOptions[0].value}         \r\n        />;\r\n    }\r\n\r\n    return <>\r\n                {label && <div className=\"dateLabel\">{label}</div>}\r\n\r\n                <RHFInput\r\n                    as={renderDropdown()}\r\n\r\n                name={name+\".value\"}\r\n                //value={name}\r\n                //type=\"daterange\"\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                onChangeEvent={handleChangeValue}\r\n                />\r\n                \r\n                <div className=\"dateLabel\">Start:</div>\r\n                <div className=\"datepickerWrapper\">\r\n                <RHFInput\r\n                    as={<DatePicker\r\n                    selected={startDate}\r\n                    //onChange={date => setStartDate(date)}\r\n                    //onChange={args => {debugger}}\r\n                    selectsStart\r\n                    startDate={startDate}\r\n                    endDate={endDate}\r\n                    disabled={disableDatePicker}        \r\n                    showMonthYearPicker={showMonthYearPicker}            \r\n                    dateFormat={effectiveFormat}\r\n                    />}\r\n\r\n                name={name+\".start\"}\r\n                //value={name}\r\n                //type=\"daterange\"\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                onChangeEvent={handleChangeStart}\r\n                />\r\n            </div>\r\n            <div className=\"dateLabel\">End:</div>\r\n            <div className=\"datepickerWrapper datepickerWrapperEnd\">\r\n            <RHFInput\r\n            as={\r\n                <DatePicker\r\n                selected={endDate}\r\n                //onChange={date => setEndDate(date)}\r\n                selectsEnd\r\n                startDate={startDate}\r\n                endDate={endDate}\r\n                minDate={startDate}\r\n                disabled={disableDatePicker}\r\n                showMonthYearPicker={showMonthYearPicker}            \r\n                dateFormat={effectiveFormat}\r\n                />}\r\n\r\n            name={name + \".end\"}\r\n            //value={name}\r\n            //type=\"daterange\"\r\n            register={register}\r\n            unregister={unregister}\r\n            setValue={setValue}\r\n            onChangeEvent={handleChangeEnd}\r\n\r\n            />\r\n        </div>\r\n        </>\r\n}\r\nexport default FormDateRange\r\n","import React, {useState, useContext} from 'react';\r\nimport '../controls/datepicker.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport DatePicker from 'react-datepicker';\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\nimport { Label, Dropdown} from \"semantic-ui-react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\n\r\nexport const conditionOptions = [\r\n    { key: 'Equal', text: '=', value: 'Equal' },\r\n    { key: 'Greater', text: '>', value: 'Greater', disabled: true},\r\n    { key: 'LessThan', text: '<', value: 'LessThan', disabled: true },\r\n    { key: 'In', text: 'In', value: 'In', disabled: true },\r\n    { key: 'NotIn', text: 'Not In', value: 'NotIn', disabled: true },\r\n];\r\n\r\nconst FormFilterInput = ({ name, label, initialValue, ...rest }) => {\r\n    //const [startDate, setStartDate] = useState(new Date());\r\n    // No need to set initial values\r\n    const { register, setValue, unregister, errors } = useContext(FormContext);\r\n\r\n    function handleChangeValue([, props]) {\r\n        return { value: props.value};\r\n      }\r\n\r\n    return <>\r\n                <div className=\"dateLabel\">Parameter:</div>\r\n\r\n                <RHFInput\r\n                    as={<input  \r\n                        key={name} \r\n                        className=\"ui small\" \r\n                        defaultValue={name}\r\n                        readOnly\r\n                        {...rest}>                        \r\n                        </input>\r\n                    }\r\n\r\n                //name={name}\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                />\r\n                \r\n                <div className=\"dateLabel\">Condition:</div>\r\n                <div className=\"datepickerWrapper\">\r\n                <RHFInput\r\n                    as={<Dropdown \r\n                        fluid                 \r\n                        selection   \r\n                        options={conditionOptions} \r\n                        defaultValue={initialValue ? initialValue : conditionOptions[0].value}         \r\n                     />}\r\n\r\n                name={name+\"Condition\"}\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                />\r\n            </div>\r\n            <div className=\"dateLabel\">Value:</div>\r\n            <div className=\"datepickerWrapper datepickerWrapperEnd\">\r\n            <RHFInput\r\n            as={<input  \r\n                    key={name} \r\n                    className=\"ui small\" \r\n                    {...rest}>                        \r\n                </input>\r\n            }\r\n\r\n            defaultValue=\"\"\r\n            name={name}\r\n            register={register}\r\n            unregister={unregister}\r\n            setValue={setValue}\r\n\r\n            />\r\n        </div>\r\n        </>\r\n}\r\nexport default FormFilterInput;\r\n","\r\nimport React, {useState, useContext} from 'react';\r\nimport '../controls/datepicker.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport DatePicker from 'react-datepicker';\r\nimport { Label, Dropdown} from \"semantic-ui-react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport ShowMessage, { NotifType } from '../helper/notification';\r\n\r\nexport const conditionOptions = [\r\n    { key: 'Equal', text: '=', value: 'Equal' },\r\n    { key: 'Greater', text: '>', value: 'Greater', disabled: true},\r\n    { key: 'LessThan', text: '<', value: 'LessThan', disabled: true },\r\n    { key: 'In', text: 'In', value: 'In', disabled: true },\r\n    { key: 'NotIn', text: 'Not In', value: 'NotIn', disabled: true },\r\n];\r\n\r\nconst handleChangeName = (e, name) => {\r\n    return {\r\n        //[name+\".name\"]: e[0].target.value\r\n        value: e[0].target.value\r\n    }\r\n}\r\n\r\nconst FormImageCoord = ({ name, x, y, color, ...rest }) => {\r\n    //const [startDate, setStartDate] = useState(new Date());\r\n    // No need to set initial values\r\n    const { register, setValue, unregister, errors } = useContext(FormContext);\r\n    const [currColor, setCurrColor] = useState(color);\r\n\r\n    function handleChangeValue([, props]) {\r\n        return { value: props.value};\r\n      }\r\n\r\n    const handleChangeColor = ([e]) => {\r\n        setCurrColor(e.target.value);\r\n        return { value: e.target.value};\r\n    }\r\n\r\n    return <>\r\n                <div className=\"dateLabel\">Name:</div>\r\n                <RHFInput\r\n                    as={<input  \r\n                        key={name} \r\n                        className=\"ui small\" \r\n                        //defaultValue={name}\r\n                        {...rest}>\r\n                        </input>\r\n                    }\r\n\r\n                name={name+\".name\"}\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                onChangeEvent={(e) => handleChangeName(e, name)}\r\n                />\r\n                \r\n                <div className=\"dateLabel\">X:</div>\r\n                <RHFInput\r\n                    as={<input  \r\n                        key={name} \r\n                        className=\"ui small\" \r\n                        //defaultValue={x}\r\n                        readOnly\r\n                        {...rest}>\r\n                        </input>\r\n                    }\r\n\r\n                name={name + \".x\"}\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                />\r\n                \r\n                <div className=\"dateLabel\">Y:</div>\r\n                <RHFInput\r\n                    as={<input  \r\n                        key={name} \r\n                        className=\"ui small\" \r\n                        //defaultValue={y}\r\n                        readOnly\r\n                        {...rest}>\r\n                        </input>\r\n                    }\r\n\r\n                name={name + \".y\"}\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                />\r\n\r\n                <div className=\"dateLabel\">Color:</div>\r\n                <div className=\"ui icon input fluid\">\r\n                <RHFInput\r\n                    as={<input  \r\n                        key={name} \r\n                        className=\"ui small\" \r\n                        //defaultValue={color}\r\n                        // onInput = {(e) => {\r\n                        //     setCurrColor(e.target.value);\r\n                        // }}\r\n                        {...rest}>\r\n                        </input>\r\n                    }\r\n\r\n                name={name + \".color\"}\r\n                register={register}\r\n                unregister={unregister}\r\n                setValue={setValue}\r\n                onChangeEvent={(e) => handleChangeColor(e, name)}\r\n                />\r\n                <i className={`ui icon large square`} style={{color: currColor}}/>\r\n                </div>\r\n\r\n                <i className=\"ui icon trash alternate btnImageFormCoordDelete\" onClick={e => ShowMessage(\"Sorry, not yet implemented!\", NotifType.danger)}/>\r\n\r\n        </>\r\n}\r\nexport default FormImageCoord;\r\n","import React, { useContext, useState, useEffect, useRef } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm, Popup } from \"semantic-ui-react\";\r\nimport 'draft-js/dist/Draft.css';\r\nimport { Editor, EditorState, RichUtils, ContentState, convertToRaw, convertFromRaw } from 'draft-js';\r\nimport './FormRichText.css';\r\n\r\n\r\nconst styleMap = {\r\n    CODE: {\r\n      backgroundColor: 'rgba(0, 0, 0, 0.05)',\r\n      fontFamily: '\"Inconsolata\", \"Menlo\", \"Consolas\", monospace',\r\n      fontSize: 16,\r\n      padding: 2,\r\n    },\r\n  };\r\n\r\n  function getBlockStyle(block) {\r\n    switch (block.getType()) {\r\n      case 'blockquote': return 'RichEditor-blockquote';\r\n      default: return null;\r\n    }\r\n  }\r\n\r\n// class RichText4Form extends React.Component {\r\n//     constructor(props) {\r\n//         super(props);\r\n//         //this.state = {editorState: EditorState.createEmpty()};\r\n//         this.state = {editorState: EditorState.createWithContent(ContentState.createFromText('Hello'))};\r\n//         //let html = '<div><h5>I am an H5 Tag</h5><h4>I am an H4 Tag</h4><p><a href=\"www.google.com\">www.google.com</a></p></div>';\r\n//         //let html = '<p>First sentence</p><p>Second sentence</p><a href=\"www.google.com\">www.google.com</a></p>';\r\n//         let html = '<table><thead><tr><td><b><i>Hello</i></b></td><td>World</td></tr></thead></table>';\r\n//         let options = {\r\n//           entityStyleFn: entity => {\r\n//             const entityType = entity.get('type').toLowerCase();\r\n//             if (entityType === 'link') {\r\n//               const data = entity.getData();\r\n//               return {\r\n//                 element: 'a',\r\n//                 attributes: {\r\n//                   target: data.targetOption,\r\n//                   href: data.url\r\n//                 }\r\n//               };\r\n//             }\r\n//           }\r\n//         }\r\n//         //this.state = {editorState: EditorState.createWithContent(stateFromHTML(html, options))};\r\n\r\n//         this.focus = () => this.refs.editor.focus();\r\n//         this.onChange = (editorState) => {\r\n//             debugger\r\n//             this.setState({editorState});\r\n//         }\r\n\r\n//         this.handleKeyCommand = (command) => this._handleKeyCommand(command);\r\n//         this.onTab = (e) => this._onTab(e);\r\n//         this.toggleBlockType = (type) => this._toggleBlockType(type);\r\n//         this.toggleInlineStyle = (style) => this._toggleInlineStyle(style);\r\n//     }\r\n\r\n//     _handleKeyCommand(command) {\r\n//         const {editorState} = this.state;\r\n//         const newState = RichUtils.handleKeyCommand(editorState, command);\r\n//         if (newState) {\r\n//           this.onChange(newState);\r\n//           return true;\r\n//         }\r\n//         return false;\r\n//       }\r\n\r\n//       _onTab(e) {\r\n//         const maxDepth = 4;\r\n//         this.onChange(RichUtils.onTab(e, this.state.editorState, maxDepth));\r\n//       }\r\n\r\n//       _toggleBlockType(blockType) {\r\n//         this.onChange(\r\n//           RichUtils.toggleBlockType(\r\n//             this.state.editorState,\r\n//             blockType\r\n//           )\r\n//         );\r\n//       }\r\n\r\n//       _toggleInlineStyle(inlineStyle) {\r\n//         this.onChange(\r\n//           RichUtils.toggleInlineStyle(\r\n//             this.state.editorState,\r\n//             inlineStyle\r\n//           )\r\n//         );\r\n//       }\r\n\r\n//     //https://github.com/jpuri/react-draft-wysiwyg/issues/4\r\n//     //https://codepen.io/Kiwka/pen/YNYvyG\r\n//     render() {\r\n//         const {editorState} = this.state;\r\n\r\n//         // If the user changes block type before entering any text, we can\r\n//         // either style the placeholder or hide it. Let's just hide it now.\r\n//         let className = 'RichEditor-editor';\r\n//         var contentState = editorState.getCurrentContent();\r\n//         if (!contentState.hasText()) {\r\n//           if (contentState.getBlockMap().first().getType() !== 'unstyled') {\r\n//             className += ' RichEditor-hidePlaceholder';\r\n//           }\r\n//         }\r\n\r\n//         return (<div className=\"RichEditor-root\">\r\n//                 <div className=\"toolBarStrip\">\r\n//                     {/* Inline Controls: Bold, Italic etc */}\r\n//                     <InlineStyleControls\r\n//                     editorState={editorState}\r\n//                     onToggle={this.toggleInlineStyle}\r\n//                     />\r\n//                     {/* Block Controls: H1, H2, BlockQuote, Code etc */}\r\n//                     <BlockStyleControls\r\n//                     editorState={editorState}\r\n//                     onToggle={this.toggleBlockType}\r\n//                     />\r\n//                 </div>\r\n\r\n//                 <div className={className} onClick={this.focus}>\r\n//                     <Editor\r\n//                     blockStyleFn={getBlockStyle}\r\n//                     customStyleMap={styleMap}\r\n//                     editorState={editorState}\r\n//                     handleKeyCommand={this.handleKeyCommand}\r\n//                     onChange={this.onChange}\r\n//                     onTab={this.onTab}\r\n//                     ref=\"editor\"\r\n//                     spellCheck={true}\r\n//                     backgroundColor={'red'}\r\n//                     />\r\n//                 </div>\r\n//             </div>\r\n//         );\r\n//     }    \r\n// }\r\n\r\n// START: For the toolbar\r\nclass StyleButton extends React.Component {\r\n    constructor() {\r\n      super();\r\n      this.onToggle = (e) => {\r\n        e.preventDefault();\r\n        this.props.onToggle(this.props.style);\r\n      };\r\n    }\r\n\r\n    render() {\r\n      let className = 'RichEditor-styleButton';\r\n      if (this.props.active) {\r\n        className += ' RichEditor-activeButton';\r\n      }\r\n\r\n      return (\r\n        <span className={className} onMouseDown={this.onToggle}>\r\n          {this.props.label}\r\n        </span>\r\n      );\r\n    }\r\n}\r\n\r\nconst BLOCK_TYPES = [\r\n  {label: 'H1', style: 'header-one'},\r\n  {label: 'H2', style: 'header-two'},\r\n  {label: 'H3', style: 'header-three'},\r\n  {label: 'Blockquote', style: 'blockquote'},\r\n  {label: 'UL', style: 'unordered-list-item'},\r\n  {label: 'OL', style: 'ordered-list-item'},\r\n  {label: 'Code', style: 'code-block'},\r\n];\r\n\r\nconst BlockStyleControls = (props) => {\r\n  const {editorState} = props;\r\n  const selection = editorState.getSelection();\r\n  const blockType = editorState\r\n    .getCurrentContent()\r\n    .getBlockForKey(selection.getStartKey())\r\n    .getType();\r\n\r\n  return (\r\n    <div className=\"RichEditor-controls\">\r\n      {BLOCK_TYPES.map((type) =>\r\n        <StyleButton\r\n          key={type.label}\r\n          active={type.style === blockType}\r\n          label={type.label}\r\n          onToggle={props.onToggle}\r\n          style={type.style}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nvar INLINE_STYLES = [\r\n  {label: 'Bold', style: 'BOLD'},\r\n  {label: 'Italic', style: 'ITALIC'},\r\n  {label: 'Underline', style: 'UNDERLINE'},\r\n  {label: 'Monospace', style: 'CODE'},\r\n];\r\n\r\nconst InlineStyleControls = (props) => {\r\n  var currentStyle = props.editorState.getCurrentInlineStyle();\r\n  return (\r\n    <div className=\"RichEditor-controls\">\r\n      {INLINE_STYLES.map(type =>\r\n        <StyleButton\r\n          key={type.label}\r\n          active={currentStyle.has(type.style)}\r\n          label={type.label}\r\n          onToggle={props.onToggle}\r\n          style={type.style}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n// END - For the toolbar\r\n\r\n\r\n// === This is the main control ===\r\n//rules: for isRequired\r\nfunction FormRichText({ name, rules, label, toolTip, initialData, controlId, ...rest }) {\r\n  const { register, setValue, unregister } = useContext(FormContext);\r\n  const refEditor = useRef(null);\r\n\r\n  const getInitialState = () => {\r\n    if (initialData) {\r\n      return EditorState.createWithContent(convertFromRaw(initialData));\r\n    }\r\n    else {\r\n      return EditorState.createWithContent(ContentState.createFromText('Hello\\r\\nworld')); // to test if it can handle new line\r\n    }\r\n  }\r\n\r\n  let initialState = getInitialState();\r\n  // if (initialData) {\r\n  //     initialState = EditorState.createWithContent(convertFromRaw(initialData));\r\n  // }\r\n  // else {\r\n  //     //initialState = EditorState.createEmpty();\r\n  //     initialState = EditorState.createWithContent(ContentState.createFromText('Hello\\r\\nworld')); // to test if it can handle new line\r\n  // }\r\n  const [editorState, setEditorState] = useState(initialState);\r\n\r\n\r\n\r\n  const handleChange = ([e]) => {\r\n      const contentState = editorState.getCurrentContent();\r\n      const rawContent = convertToRaw(contentState);\r\n      setEditorState(e);\r\n      return {\r\n          value: rawContent\r\n      };\r\n  }\r\n\r\n  const onChange = (currEditorState) => {\r\n    setEditorState(currEditorState);\r\n  }\r\n\r\n  const _toggleInlineStyle = (inlineStyle) => {\r\n    onChange(\r\n      RichUtils.toggleInlineStyle(\r\n        editorState,\r\n        inlineStyle\r\n      )\r\n    );\r\n  }\r\n\r\n  const _handleKeyCommand = (command) => {\r\n    const newState = RichUtils.handleKeyCommand(editorState, command);\r\n    if (newState) {\r\n      onChange(newState);\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  const _onTab = (e) => {\r\n    const maxDepth = 4;\r\n    onChange(RichUtils.onTab(e, editorState, maxDepth));\r\n  }\r\n\r\n  const _toggleBlockType = (blockType) => {\r\n    onChange(\r\n      RichUtils.toggleBlockType(\r\n        editorState,\r\n        blockType\r\n      )\r\n    );\r\n  }\r\n\r\n  const focusHandler = () => {\r\n    if (refEditor) {\r\n      refEditor.current.focus();\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    console.log('FormRichText id changed', controlId);\r\n    setEditorState(getInitialState());\r\n  }, [controlId]);\r\n\r\n  let className = 'RichEditor-editor';\r\n  var contentState = editorState.getCurrentContent();\r\n  if (!contentState.hasText()) {\r\n    if (contentState.getBlockMap().first().getType() !== 'unstyled') {\r\n      className += ' RichEditor-hidePlaceholder';\r\n    }\r\n  }\r\n\r\n  console.log('FormRichText', name, initialData);\r\n  return (<SemanticForm.Field>\r\n      {label && <label>\r\n          <span key={'label-'+name}>{label}</span>\r\n          &nbsp;\r\n          {!!toolTip && <Popup \r\n              inverted\r\n              basic\r\n              size='tiny' style={{opacity: '0.8'}} \r\n              content={toolTip}\r\n              trigger={<div style={{display: 'inline-block', color: 'gray'}}>\r\n              <i className=\"ui icon info circle\"/>\r\n              </div>} />\r\n          }\r\n      </label>}\r\n      <div className=\"RichEditor-root\">\r\n        <div className=\"toolBarStrip\">\r\n          {/* Inline Controls: Bold, Italic etc */}\r\n          <InlineStyleControls\r\n          editorState={editorState}\r\n          onToggle={_toggleInlineStyle}\r\n          />\r\n          {/* Block Controls: H1, H2, BlockQuote, Code etc */}\r\n          <BlockStyleControls\r\n          editorState={editorState}\r\n          onToggle={_toggleBlockType}\r\n          />\r\n        </div>\r\n      \r\n      <div className={className} onClick={focusHandler}>\r\n        <RHFInput\r\n            as={<Editor  \r\n                    key={name} \r\n                    editorState={editorState}\r\n                    ref={refEditor}\r\n\r\n                    blockStyleFn={getBlockStyle}\r\n                    customStyleMap={styleMap}\r\n                    handleKeyCommand={_handleKeyCommand}\r\n                    onTab={_onTab}\r\n\r\n                    {...rest}>                        \r\n                    </Editor>\r\n            }\r\n\r\n        defaultValue=\"\"\r\n        name={name}      \r\n        register={register}\r\n        unregister={unregister}\r\n        setValue={setValue}\r\n        rules={rules}\r\n        onChangeEvent={handleChange}\r\n        />\r\n      </div>\r\n    </div>\r\n  </SemanticForm.Field>\r\n  );\r\n}\r\n\r\nexport default FormRichText;","import React, {useState, useContext, useEffect} from 'react';\r\nimport { FormContext, FormTreeDropDown, Text} from \"./Form\";\r\nimport TreeSelect, { SHOW_PARENT } from 'rc-tree-select';\r\nimport {Button, Popup, Form as SemanticForm, Input} from \"semantic-ui-react\";\r\nimport './formFilterDyanamicInput.css';\r\nimport 'rc-tree-select/assets/index.css';\r\nimport './FormTreeDropDown.css';\r\nimport {uuidv4} from '../helper/util';\r\nimport {ShowMessage, NotifType} from '../helper/notification';\r\n\r\n// Allows the user to dynamically add filters by clicking \"Add\" button.\r\n// Design: Basically just reuse existing FormComponents. We just manage them here.\r\n\r\n// Similar to FormFilterInput except that the first filtered field is a dropdown instead of a textbox\r\n// And we also remove the Condition combobox. Assume that the condition is always \"Equals\"\r\n\r\nconst FormFilterDynamicInput = ({ name, label, initialValue, toolTip, filterFieldOptions, initialFilters, parentId, ...rest }) => {\r\n    const { register, setValue, unregister, errors } = useContext(FormContext);\r\n    const [filters, setFilters] = useState(initialFilters || {});\r\n    const [currParentId, setCurrParentId] = useState(parentId);\r\n\r\n    function handleChangeValue([, props]) {\r\n        return { value: props.value};\r\n    }\r\n\r\n    const addParameter = () => {\r\n        setFilters({\r\n            ...filters,\r\n            [uuidv4()]: {\r\n                filterName: null,\r\n                filterValue: null\r\n            }\r\n        });\r\n    }\r\n\r\n    const renderFilters = () => {\r\n        //console.log(\"renderFilters\", filters, 'initialFilters:', initialFilters);\r\n        // filterToUse+parentId: bug fix for issue where the fields are blank when selecting one gauge to another gauge\r\n        // cause: useState() is only called/effective in the first render. \r\n        // filters state is still holding the old value. Current latest value is in initialFilters\r\n        // But we also cannot use initialFilters all the time, because the UI will not update if \"Add Filter\" is clicked\r\n        // Fix: use initialFilters if it is the first render. Use filters in the succedding renders.\r\n        let filterToUse = currParentId === parentId ? filters : initialFilters;\r\n        let retList = [];\r\n        for (let prop in filterToUse) {\r\n            retList.push(<div className=\"dynamicFilterRow\" key={`dynamicFilterRow-${prop}`}>\r\n            <FormTreeDropDown\r\n                name={`${name}.${prop}.filterName`}\r\n                treeData={filterFieldOptions}\r\n                isRequired={false}\r\n            />\r\n            <Text small\r\n                name={`${name}.${prop}.filterValue`}\r\n            />\r\n            <i className=\"ui icon trash alternate btnImageFormCoordDelete\" onClick={e => ShowMessage(\"Sorry, not yet implemented!\", NotifType.danger)}/>\r\n        </div>);\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n    //console.log(\"FormFilterDynamicInput, render\", initialFilters);\r\n\r\n    useEffect(() => {\r\n        setFilters(initialFilters || {});\r\n        setCurrParentId(parentId);\r\n    }, [initialFilters, parentId]);\r\n\r\n    return <SemanticForm.Field>\r\n        {label && <label>\r\n                    <span key={'label-'+name}>{label}</span>\r\n                    &nbsp;\r\n                    {!!toolTip && <Popup \r\n                        inverted\r\n                        basic\r\n                        size='tiny' style={{opacity: '0.8'}} \r\n                        content={toolTip}\r\n                        trigger={<div style={{display: 'inline-block', color: 'gray'}}>\r\n                        <i className=\"ui icon info circle\"/>\r\n                        </div>} />\r\n                    }\r\n            </label>}            \r\n        <div><Button type=\"button\" size=\"tiny\" primary onClick={addParameter}>Add Parameter</Button></div>\r\n        <div className=\"dynamicFiltersContainer\">\r\n            {renderFilters()}\r\n        </div>\r\n    </SemanticForm.Field>\r\n}\r\nexport default FormFilterDynamicInput;","import React, { createContext, useEffect } from \"react\";\r\nimport useForm from \"react-hook-form\";\r\nimport { Form as SemanticForm } from \"semantic-ui-react\";\r\nimport {getToolItemByName} from '../components/toolbox';\r\nimport * as constants from '../constants';\r\n\r\nexport const FormContext = createContext();\r\n\r\nconst sanitizeObj = (obj) => {\r\n  if (!obj) {\r\n    return;\r\n  }\r\n  Object.keys(obj).forEach(key => obj[key] === undefined && delete obj[key]);\r\n  return obj;\r\n}\r\n\r\n// Nicely designed wrapper class taken from\r\n// https://codesandbox.io/s/dazzling-napier-ne3e6\r\nfunction Form({ children, onSubmit, inputObj, inputObjId, setControlValues, watchedField, setStateCb, setStateHook,...rest }) {\r\n  const { register, setValue, handleSubmit, unregister, watch, errors } = useForm();\r\n  const watchedValue = !!watchedField ? watch(watchedField) : null; // no way for us to pass back the value conveniently, but the form will rerender anyways\r\n  const inputObjVals = !! inputObj ? [...Object.values(inputObj)] : null\r\n  console.log('Form rerenders', inputObj, watchedValue);  \r\n\r\n    // useEffect(() => {\r\n    //   // Called when input object changes\r\n    //   // TODO: If the form is for rendering control props, inputObjVals can be different size, which useEffect will complain\r\n    //   console.log('Form useEffect (inputObj Changed)', watchedValue);\r\n    //     // Set the initial values\r\n    //     // The controls' values are not really bound to any state or props so we have to update it here\r\n    //     if (setControlValues) {\r\n    //       setControlValues(setValue, inputObj);\r\n    //     }\r\n    // }, inputObjVals)\r\n\r\n    useEffect(() => {\r\n      // Called when input object changes\r\n      // TODO: If the form is for rendering control props, inputObjVals can be different size, which useEffect will complain\r\n      console.log('Form useEffect (inputObj Id changed)', inputObjId);\r\n        // Set the initial values\r\n        // The controls' values are not really bound to any state or props so we have to update it here\r\n        if (setControlValues) {\r\n          setControlValues(setValue, inputObj);\r\n        }\r\n    }, [inputObjId])\r\n\r\n    useEffect(() => {\r\n      // Called only when watched value changes\r\n      console.log('Form useEffect watchedValue changed', watchedValue);\r\n      if (setStateHook) {\r\n        setStateHook(watchedValue);\r\n      }\r\n      else if (setStateCb) {\r\n        if (Array.isArray(watchedField)) {\r\n          setStateCb(sanitizeObj(watchedValue));\r\n        }\r\n        else {\r\n          setStateCb({[watchedField]: watchedValue});\r\n        }        \r\n      }\r\n    }, Array.isArray(watchedField) ? Object.values(watchedValue) : [watchedValue]); // Means if inputObj value does not change, don't run useEffect again.\r\n\r\n  return (\r\n    <FormContext.Provider value={{ register, setValue, handleSubmit, unregister, errors }}>\r\n      {onSubmit && <SemanticForm onSubmit={handleSubmit(onSubmit)} {...rest}>\r\n        {children}\r\n      </SemanticForm>\r\n      }\r\n      {!onSubmit && <SemanticForm {...rest}>\r\n        {children}\r\n      </SemanticForm>\r\n      }\r\n    </FormContext.Provider>\r\n  );\r\n}\r\n\r\nexport { default as Text } from \"./FormText\";\r\nexport { default as FormCheckbox } from \"./FormCheckbox\";\r\nexport { default as Dropdown } from \"./FormDropDown\";\r\nexport { default as IconSelector } from \"./IconSelector\";\r\nexport { default as ColorSelector } from \"./ColorSelector\";\r\nexport { default as FormTreeDropDown } from \"./FormTreeDropDown\";\r\nexport { default as FormRadio } from \"./FormRadio\";\r\nexport { default as FormDateRange } from \"./FormDateRange\";\r\nexport { default as FormFilterInput } from \"./FormFilterInput\";\r\nexport { default as FormImageCoord} from \"./FormImageCoord\";\r\nexport { default as FormRichText} from \"./FormRichText\";\r\nexport { default as FormFilterDyanamicInput} from \"./formFilterDyanamicInput\";\r\n\r\nexport default Form;\r\n","import React, { useContext } from \"react\";\r\nimport { FormContext } from \"./Form\";\r\nimport { RHFInput } from \"react-hook-form-input\";\r\nimport { Form as SemanticForm, Label} from \"semantic-ui-react\";\r\n\r\nimport 'rc-tree-select/assets/index.css';\r\nimport './FormTreeDropDown.css';\r\nimport TreeSelect, { SHOW_PARENT } from 'rc-tree-select';\r\n\r\nfunction handleChange([value, props, treeNodeEvt]) {\r\n  debugger\r\n  return {\r\n    value: value === undefined ? null : value\r\n  }\r\n}\r\n\r\nconst Icon = (props) => {\r\n  //console.log('icon', props)\r\n  return <i className='ui icon genderless'></i>\r\n}\r\n\r\nconst arrowPath = 'M765.7 486.8L314.9 134.7c-5.3-4.1' +\r\n  '-12.9-0.4-12.9 6.3v77.3c0 4.9 2.3 9.6 6.1 12.6l36' +\r\n  '0 281.1-360 281.1c-3.9 3-6.1 7.7-6.1 12.6V883c0 6' +\r\n  '.7 7.7 10.4 12.9 6.3l450.8-352.1c16.4-12.8 16.4-3' +\r\n  '7.6 0-50.4z';\r\n\r\nconst getSvg = (path, iStyle = {}, style = {}) => {\r\n  return (\r\n    <i style={iStyle}>\r\n      <svg\r\n        viewBox=\"0 0 1024 1024\"\r\n        width=\"1em\"\r\n        height=\"1em\"\r\n        fill=\"currentColor\"\r\n        style={{ verticalAlign: '-.125em', ...style }}\r\n      >\r\n        <path d={path} />\r\n      </svg>\r\n    </i>\r\n  );\r\n}\r\n\r\n\r\nconst switcherIcon = (obj) => {\r\n  if (obj.isLeaf) {\r\n    return null;\r\n  }\r\n  return getSvg(arrowPath,\r\n    { cursor: 'pointer', backgroundColor: 'white' },\r\n    { transform: `rotate(${obj.expanded ? 90 : 0}deg)` });\r\n};\r\n\r\nexport const iconProps = {\r\n  switcherIcon,\r\n};\r\n\r\nconst iconPropsFunction = {\r\n  //inputIcon: () => inputIcon,\r\n  //clearIcon: () => clearIcon,\r\n  //removeIcon: () => removeIcon,\r\n  switcherIcon,\r\n};\r\n\r\n\r\nfunction FormTreeDropDown({ name, label, treeData, isRequired, multiple, defaultValue, value, disabled,...rest }) {\r\n  const { register, setValue, unregister, errors } = useContext(FormContext);\r\n  let labelClassName = disabled ? \"formLabel-disabled\": \"\";\r\n\r\n  return (<SemanticForm.Field>\r\n        {label && <label key={'label-'+name} className={labelClassName}>{label}</label>}\r\n        <RHFInput\r\n        as={<TreeSelect\r\n          style={{ width: '100%' }}\r\n          // transitionName=\"rc-tree-select-dropdown-slide-up\"\r\n          // choiceTransitionName=\"rc-tree-select-selection__choice-zoom\"\r\n          // dropdownStyle={{ maxHeight: 300, overflow: 'auto' }}\r\n          //dropdownPopupAlign={{ overflow: { adjustY: 0, adjustX: 0 }, offset: [0, 2] }}\r\n          placeholder={<div style={{color: \"gray\"}}>Please select...</div>}\r\n          searchPlaceholder=\"Search...\"\r\n          // treeLine\r\n          showSearch={!multiple}\r\n          allowClear\r\n          maxTagTextLength={10}\r\n          treeData={treeData}\r\n          treeNodeFilterProp=\"title\"\r\n          multiple={multiple}\r\n          treeIcon          \r\n          defaultValue={defaultValue}\r\n          treeCheckStrictly={true}\r\n          disabled={disabled}\r\n          {...iconPropsFunction}\r\n          {...rest}\r\n      />}\r\n        name={name}\r\n        register={register}\r\n        unregister={unregister}\r\n        setValue={setValue}\r\n        onChangeEvent={handleChange}\r\n        rules={{required: isRequired }}\r\n        />\r\n      {errors[name] && \r\n        <div>\r\n        <Label basic color='red' pointing>\r\n          Please select a value\r\n        </Label>\r\n        </div>}\r\n    </SemanticForm.Field>\r\n    );\r\n}\r\n\r\nexport default FormTreeDropDown;\r\n","import React from 'react';\r\nimport 'rc-tree-select/assets/index.css';\r\nimport '../form/FormTreeDropDown.css';\r\nimport {iconProps} from '../form/FormTreeDropDown';\r\nimport TreeSelect, { SHOW_PARENT } from 'rc-tree-select';\r\n\r\n// Version that is not inside of a Form, so that we can easily control the value\r\n// Use this if there is no need to collect the value like during form submit; \r\nconst TreeDropdown = ({treeData, multiple, value, onSelect, ...rest}) => {\r\n    return <TreeSelect\r\n    style={{ width: '100%' }}\r\n    // transitionName=\"rc-tree-select-dropdown-slide-up\"\r\n    // choiceTransitionName=\"rc-tree-select-selection__choice-zoom\"\r\n    dropdownStyle={{ maxHeight: 300, overflow: 'auto' }}\r\n    dropdownPopupAlign={{ overflow: { adjustY: 0, adjustX: 0 }, offset: [0, 2] }}\r\n    placeholder={<div style={{color: \"gray\"}}>Please select...</div>}\r\n    searchPlaceholder=\"Search...\"\r\n    // treeLine\r\n    showSearch={!multiple}\r\n    allowClear\r\n    maxTagTextLength={10}\r\n    treeData={treeData}\r\n    treeNodeFilterProp=\"title\"            \r\n    multiple={multiple}\r\n    treeIcon\r\n    treeCheckStrictly={true}\r\n    value={value}\r\n    onSelect={onSelect}    \r\n    {...iconProps}\r\n    {...rest}\r\n    />\r\n}\r\n\r\nexport default TreeDropdown;","import _ from \"lodash\";\r\n\r\nexport const extractName = (groupingArr, data) => {\r\n    let vals = groupingArr.map(g => data[g]);\r\n    return vals.join(' / ');\r\n}\r\n\r\nexport const filterObj = (obj, fields) => {\r\n    return _.pick(obj, fields);\r\n} \r\n\r\nexport const getUniqueValues = (data, seriesName) => {\r\n    return _.uniq(data.map(d => d[seriesName]));\r\n  }\r\n\r\n// For Pie only, there is no series\r\nexport const calculateActiveIndex = (datasetFilter, data, controlId, groupingStackStr) => {\r\n    if (!datasetFilter) {\r\n        return null;\r\n    }\r\n\r\n    let controlIdFilter = datasetFilter[controlId];\r\n    if (!controlIdFilter) {\r\n        return null\r\n    }\r\n    let stackInfo = controlIdFilter[groupingStackStr];\r\n    if (!stackInfo) {\r\n        return null;\r\n    }\r\n\r\n    let sliceInfo = stackInfo.sliceInfo;\r\n\r\n    let dataIndex = data.findIndex(d => {\r\n        // this data must satisfy all filter criteria\r\n        for (let prop in sliceInfo.origObj) {\r\n            let propVal = sliceInfo.origObj[prop];\r\n            if (d.origObj[prop] !== propVal) {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        return true;\r\n    });\r\n\r\n    return dataIndex >= 0 ? dataIndex : null;\r\n}\r\n\r\n// recursively add the next elements in the groupings array as child of previous element\r\n// For now: groupings is only 1 dimensional i.e. single array list (e.g. [Vendor->Model])\r\n// TODO: groupings should be multidimensional i.e. array of arrays (e.g.[ [Vendor->Model], [Plant->Area->Unit], [CommType] ])\r\nexport const convertGroupingToTreeDropOptions = (groupings) => {\r\n    if (!Array.isArray(groupings)) {\r\n        return [];\r\n    }\r\n\r\n    let retList = [];\r\n    let prevItem = null;\r\n    groupings.forEach(grp => {\r\n        let currItem = {\r\n            key: grp,\r\n            value: grp,\r\n            title: grp,\r\n            children: [],\r\n            parent: prevItem,\r\n            stackValue: prevItem ? [...prevItem.stackValue, grp]: [grp]\r\n        };\r\n        if (retList.length === 0 ) {\r\n            retList.push(currItem); // push first item only\r\n        }\r\n        pushChildToParentArr(prevItem ? prevItem.children : null, currItem);\r\n        prevItem = currItem;\r\n    })\r\n\r\n    return retList;\r\n}\r\n\r\nconst pushChildToParentArr = (parentArray, child) => {\r\n    if (!Array.isArray(parentArray)) {\r\n        return;\r\n    }\r\n\r\n    parentArray.push(child);\r\n}","import React from 'react';\r\nimport {Header} from 'semantic-ui-react';\r\n\r\nexport const getMetadataOptions = (metadata, name) => {\r\n    let fields = metadata[name];\r\n    return fields.map(field => {\r\n        let descriptionJsx = field.description && <Header content={field.name} as=\"h5\" subheader={field.description}/>\r\n        return {\r\n            key: field.name,\r\n            text: field.name,\r\n            value: field.name,\r\n            content: descriptionJsx\r\n        };\r\n    });\r\n}\r\n\r\nexport const getMetadataTreeDropdownOptions = (metadata, names) => {\r\n    let retList = [];\r\n    if (!Array.isArray(names)) {\r\n        return retList;\r\n    }\r\n    \r\n    names.forEach(name => {        \r\n        let treeFields = metadata[name];\r\n        let treeOptions = convertApiMetadataDims(treeFields);\r\n        retList = retList.concat(treeOptions);        \r\n    });    \r\n\r\n    return retList;\r\n}\r\n\r\nconst convertApiMetadataDims = (apiMetadataDims, parent=null) => {\r\n    if (!apiMetadataDims) {\r\n        return null;\r\n    }\r\n\r\n    return apiMetadataDims.map(x => {\r\n        let {name, items, dataType, ...rest} = x;\r\n        let currItem = {\r\n            name: parent ? `${parent.name}.${name}` : name,\r\n            //value: parent ? `${parent.name}.${name}` : name,\r\n            value: name,\r\n            title: name,\r\n            parent,\r\n            stackValue: parent ? [...parent.stackValue, name] : [name],\r\n            disabled: dataType === 'group',\r\n            ...rest\r\n        };\r\n\r\n        currItem.children = convertApiMetadataDims(items, currItem);\r\n\r\n        return currItem;\r\n    });\r\n}\r\n\r\nconst findInTree = (arrTree, name) => {\r\n    if (!Array.isArray(arrTree)) {\r\n        return null;\r\n    }\r\n\r\n    for(let i = 0; i < arrTree.length; i++) {\r\n        let currItem = arrTree[i];\r\n        if (currItem.name === name) {\r\n            return currItem;\r\n        }\r\n\r\n        let findChildren = findInTree(currItem.items, name);\r\n        if (!!findChildren) {\r\n            return findChildren;\r\n        }\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nexport const getMetadataDimTreeDropdownOptions = (dimName, metadata) => {\r\n    let metaDim = metadata.dimensions;\r\n    let findDimName = findInTree(metaDim, dimName);\r\n    if (!findDimName) {\r\n        return [];\r\n    }\r\n    \r\n    return convertApiMetadataDims([findDimName]);\r\n}","import React, { PureComponent, Component, useRef, useEffect, useState } from 'react';\r\nimport {\r\n  PieChart, Pie, Sector, Cell, ResponsiveContainer, Legend, Tooltip\r\n} from 'recharts';\r\nimport TreeDropdown from '../controls/treeDropdown';\r\nimport '../controls/common.css';\r\nimport './pieChart.css';\r\nimport './rechartsCommon.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport {extractName, filterObj, calculateActiveIndex, convertGroupingToTreeDropOptions} from '../helper/chartHelper';\r\nimport {getMetadataDimTreeDropdownOptions} from '../helper/metadataManager';\r\n\r\n// TODO: Due to lack of time during POC, this class design is very messy.\r\n// There are 3 classes being exported for various scenarios (reporting, trial page, design mode)\r\n// The design of gauge chart is cleaner. Try to follow that design.\r\n\r\nconst sampleData = [\r\n  { name: 'Category 1', value: 400 },\r\n  { name: 'Category 2', value: 300 },\r\n  { name: 'Category 3', value: 300 },\r\n  { name: 'Category 4', value: 200 },\r\n];\r\n\r\nconst sampleGroups = [\r\n  {\r\n      key: 'status',\r\n      value: 'status',\r\n      title: 'Status',\r\n  }\r\n]\r\n\r\n////const COLORS = ['green', 'red', 'gold', 'gray', 'cyan', 'magenta', 'black', 'lime', 'teal', 'pink', 'violet', 'orange', 'blue', 'indigo'];\r\nconst COLORS = ['#106b21', '#e71837', 'gold', 'gray', '#669999', '#8b008b', 'black', 'lime', 'teal', 'pink', '#a47eb6', '#fc9303', '#0e4bef', '#4b0082'];\r\n\r\nconst RADIAN = Math.PI / 180;\r\nconst renderCustomizedLabel = ({\r\n  cx, cy, midAngle, innerRadius, outerRadius, percent, index, name\r\n}) => {\r\n   const radius = innerRadius + (outerRadius - innerRadius) * 0.5;\r\n  const x = cx + radius * Math.cos(-midAngle * RADIAN);\r\n  const y = cy + radius * Math.sin(-midAngle * RADIAN);\r\n\r\n  return (\r\n    <text x={x} y={y} fill=\"white\" textAnchor={x > cx ? 'start' : 'end'} dominantBaseline=\"central\">\r\n      {`${name} - ${(percent * 100).toFixed(0)}%`}\r\n    </text>\r\n  );\r\n};\r\n\r\nlet renderLabel = function(entry) {\r\n    return `${entry.name} - ${(entry.percent*100).toFixed(1)}%`;\r\n}\r\n\r\n\r\n// The ResponsiveContainer from recharts is buggy during printing\r\n// We manually set the height and width of the container by querying the DOM\r\nexport const PieForReport = (props) => {\r\n  const chartContainerEl = useRef();\r\n  const [myState, setMyState] = useState({\r\n    height: 0,\r\n    width: 0\r\n  });\r\n\r\n  useEffect(() => {\r\n    console.log('[DEBUG] useEffect pie', chartContainerEl);\r\n    if (!chartContainerEl || !chartContainerEl.current) {\r\n      return;\r\n    }\r\n    let rect = chartContainerEl.current.getClientRects()[0]\r\n    setMyState({\r\n      height: rect.height,\r\n      width: rect.width\r\n    })\r\n    \r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"reChartContainer\" ref={chartContainerEl}>\r\n      <div className=\"controlLabel\">{props.data.label + ' width: ' + myState.width}</div>\r\n      <PieChart \r\n          margin={{top: 20, right: 15, left: 15, bottom: 0}}\r\n          height={myState.height}\r\n          width={myState.width}\r\n      >\r\n        {renderPie()}\r\n        {renderLegend()}\r\n      </PieChart>\r\n    </div>\r\n  );  \r\n}\r\n\r\n// The ResponsiveContainer from recharts is OK when viewing from the web browser,\r\n// but buggy during PDF generation (e.g. not taking entire width and height of the container)\r\n// Not used anymore...\r\nconst PieResponsive = (props) => {\r\n  let classNames = 'reChartContainer';\r\n  if (props.selected === true) {\r\n      classNames += ' ctrl-selected'\r\n  }\r\n  let width = props.containerWidth ? props.containerWidth : '100%'\r\n  return (\r\n    <div id=\"pieContainer1\" className={classNames}>\r\n      <div className=\"controlLabel\">{props.data.label}</div>\r\n      <ResponsiveContainer  width=\"100%\" height=\"100%\">\r\n        <PieChart margin={{top: 20, right: 20, left: 20, bottom: 40}}>\r\n          {renderPie()}\r\n          {renderLegend()}\r\n        </PieChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  );  \r\n}\r\n\r\n// Visual cue to identify which wedge is the active one.\r\nconst renderActiveShape = (props) => {\r\n  const RADIAN = Math.PI / 180;\r\n  const {\r\n    cx, cy, midAngle, innerRadius, outerRadius, startAngle, endAngle,\r\n    fill, payload, percent, value,\r\n  } = props;\r\n  const sin = Math.sin(-RADIAN * midAngle);\r\n  const cos = Math.cos(-RADIAN * midAngle);\r\n  const sx = cx + (outerRadius + 10) * cos;\r\n  const sy = cy + (outerRadius + 10) * sin;\r\n  const mx = cx + (outerRadius + 30) * cos;\r\n  const my = cy + (outerRadius + 30) * sin;\r\n  const ex = mx + (cos >= 0 ? 1 : -1) * 22;\r\n  const ey = my;\r\n  const textAnchor = cos >= 0 ? 'start' : 'end';\r\n\r\n  return (\r\n    <g>\r\n      {/* <text x={cx} y={cy} dy={8} textAnchor=\"middle\" fill={fill}>{payload.name}</text> */}\r\n      <Sector\r\n        cx={cx}\r\n        cy={cy}\r\n        innerRadius={innerRadius}\r\n        outerRadius={outerRadius}\r\n        startAngle={startAngle}\r\n        endAngle={endAngle}\r\n        fill={fill}\r\n      />\r\n      <Sector\r\n        cx={cx}\r\n        cy={cy}\r\n        startAngle={startAngle}\r\n        endAngle={endAngle}\r\n        innerRadius={outerRadius + 3}\r\n        outerRadius={outerRadius + 10}\r\n        fill={fill}\r\n      />\r\n      {/* <path d={`M${sx},${sy}L${mx},${my}L${ex},${ey}`} stroke={fill} fill=\"none\" />\r\n      <circle cx={ex} cy={ey} r={2} fill={fill} stroke=\"none\" />\r\n      <text x={ex + (cos >= 0 ? 1 : -1) * 12} y={ey} textAnchor={textAnchor} fill=\"#333\">{`PV ${value}`}</text>\r\n      <text x={ex + (cos >= 0 ? 1 : -1) * 12} y={ey} dy={18} textAnchor={textAnchor} fill=\"#999\">\r\n        {`(Rate ${(percent * 100).toFixed(2)}%)`}\r\n      </text> */}\r\n    </g>\r\n  );\r\n};\r\n\r\n\r\nconst getDefaultGrouping = (groupingHier) => {\r\n  if (!Array.isArray(groupingHier)) {\r\n    return null;\r\n  }\r\n\r\n  return groupingHier[0];\r\n}\r\n\r\n// This is the latest one that's used\r\nexport class PieResponsiveDataBase extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.onGroupSelect = this.onGroupSelect.bind(this);\r\n    //let initialGroupingVal = props.dataProps? getDefaultGrouping(props.dataProps.categories) : null;\r\n    let initialGroupingVal = props.data.dataProps? props.data.dataProps.categories : null;\r\n    console.log('[pieChart] constructor...initialGroupingVal', initialGroupingVal);\r\n    this.state = {\r\n      activeIndex: props.activeIndex, // not used anymore\r\n      groupingBoundVal: initialGroupingVal, // bound to treedropdown\r\n      //groupingBoundValStack: initialGroupingVal ? [initialGroupingVal] : null, // same as groupingBoundVal but in stack format, store this also, for convenience\r\n    };\r\n  }\r\n\r\n  onPieClick = (sectorInfo, index) => {\r\n    //let sectorIndex = args[1];\r\n    this.setState({\r\n      activeIndex: index\r\n    });\r\n\r\n    if (this.props.handleChartClick) {\r\n      // A control can have 1 filter per grouping level\r\n      // we store the grouping stack as string to make it easier to compare\r\n      let groupingStackStr = this.getGroupingStackStr();\r\n\r\n      this.props.handleChartClick(sectorInfo, null, groupingStackStr);\r\n    }\r\n  }\r\n\r\n  getGroupingStackStr = () => {\r\n    let groupingStack = this.props.currControlGrouping ? this.props.currControlGrouping : [this.state.groupingBoundVal];\r\n    return JSON.stringify(groupingStack);\r\n  }\r\n\r\n  onGroupSelect(value, node) {\r\n    console.log(\"[Piechart] onGroupSelect\", value, node.props);\r\n    this.setState({\r\n      groupingBoundVal: value,\r\n    });\r\n\r\n    // Remove the filter from previous lower groups\r\n    // Send a new API Request to the backend\r\n    // Just fire a callback and let it be handled in upper level?\r\n    // Maybe just store the \"temp\" grouping (non-default) of controls of the dashboard in redux store\r\n    if (this.props.handleGroupSelect) {\r\n      this.props.handleGroupSelect(node.props.stackValue);\r\n    }\r\n  }\r\n\r\n  formatApiData(apiData, dataProps, currControlGrouping) {\r\n    let grouping = currControlGrouping ? currControlGrouping : [dataProps.categories];\r\n    return apiData.map(d => {\r\n      let extractedName = extractName(grouping, d);\r\n\r\n      return {\r\n        name: extractedName,\r\n        value: parseInt(d.value),\r\n        origObj: filterObj(d, grouping)\r\n      }\r\n    })\r\n  }\r\n\r\n  renderPieWithData = (props) => {\r\n    let formattedData = null;\r\n    if (props.designMode) {\r\n      formattedData = sampleData;\r\n    }\r\n    else if (props.data.dataProps) {\r\n      if (!props.apiData || !props.metadata) {\r\n        return null;\r\n      }\r\n      formattedData = this.formatApiData(props.apiData.data, props.data.dataProps, props.currControlGrouping);\r\n    }\r\n\r\n    let activeIndex = calculateActiveIndex(props.datasetFilters, formattedData, props.i, this.getGroupingStackStr())    \r\n\r\n    return <Pie\r\n      data={formattedData}\r\n      labelLine={true}\r\n      //label={renderCustomizedLabel}\r\n      label\r\n      //label={renderLabel}\r\n      //   outerRadius={100}\r\n      fill=\"#8884d8\"\r\n      dataKey=\"value\"\r\n      isAnimationActive={false}\r\n      onClick={this.onPieClick}\r\n      activeIndex={activeIndex}\r\n      activeShape={renderActiveShape}\r\n    >\r\n      { formattedData && formattedData.length > 0 &&\r\n        formattedData.map((entry, index) => {\r\n          return <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n        })\r\n      }\r\n    </Pie>;    \r\n  }\r\n\r\n  componentDidUpdate(previousProps, previousState) {\r\n    // If the layout name changes, the constructor may not be called again (I think if the ID did not change).\r\n    // So we perform the updates here\r\n    if (previousProps.layoutName !== this.props.layoutName) {\r\n      let initialGroupingVal = this.props.data.dataProps? this.props.data.dataProps.categories : null;\r\n      this.setState({\r\n        groupingBoundVal: initialGroupingVal\r\n      });\r\n      console.log('piechart, componentDidUpdate, initialGroupingVal: ', initialGroupingVal, 'previousProps.layoutName', previousProps.layoutName, 'this.props.layoutName', this.props.layoutName);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let classNames = 'reChartContainer';\r\n    if (this.props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }    \r\n\r\n    console.log('[pieChart] render, group:', this.state.groupingBoundVal);\r\n\r\n    return <div id=\"pieContainer1\" className={classNames}>\r\n      <div className=\"controlLabel\">{this.props.data.label}</div>\r\n      <div>\r\n        {!this.props.designMode && this.props.data.dataProps && this.props.metadata &&<TreeDropdown \r\n          //treeData={convertGroupingToTreeDropOptions(this.props.dataProps.categories, props.metadata)} \r\n          treeData={getMetadataDimTreeDropdownOptions(this.props.data.dataProps.categories, this.props.metadata)} \r\n          value={this.state.groupingBoundVal}\r\n          onSelect={this.onGroupSelect}\r\n          treeDefaultExpandAll\r\n          key={`treedropdown-${this.props.i}`}\r\n        />}\r\n        {this.props.designMode && <TreeDropdown \r\n          treeData={sampleGroups} \r\n          value={sampleGroups[0].key}\r\n          treeDefaultExpandAll\r\n          disabled\r\n        />}        \r\n      </div>\r\n      <ResponsiveContainer  width=\"100%\" height=\"100%\">\r\n        <PieChart margin={{top: 20, right: 20, left: 20, bottom: 45}}>\r\n        {this.renderPieWithData(this.props)}\r\n        {renderLegend()}\r\n        <Tooltip />\r\n      </PieChart>\r\n      </ResponsiveContainer>\r\n    </div>\r\n  }\r\n} // end: PieResponsiveDataBase class\r\nexport const PieResponsiveData = noobControlHoc(PieResponsiveDataBase);\r\n\r\n// This is for the trial page only!\r\nexport class PieWithData extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      activeIndex: props.activeIndex\r\n    };\r\n  }\r\n\r\n  onPieClick = (sectorInfo, index) => {\r\n    //let sectorIndex = args[1];\r\n    this.setState({\r\n      activeIndex: index\r\n    });\r\n\r\n    if (this.props.pieClickCallback) {\r\n      this.props.pieClickCallback(sectorInfo);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(previousProps, previousState) {\r\n  }\r\n\r\n  extractName(groupingArr, data) {\r\n    let vals = groupingArr.map(g => data[g]);\r\n    return vals.join(' / ');\r\n  }\r\n\r\n  formatApiData(apiData, dataProps) {\r\n    let grouping = dataProps.grouping;\r\n    return apiData.map(d => {\r\n      let extractedName = this.extractName(grouping, d);\r\n\r\n      return {\r\n        name: extractedName,\r\n        value: d.value\r\n      }\r\n    })\r\n  }\r\n\r\n  renderPieWithData = (props) => {\r\n    let formattedData = props.apiData || sampleData;\r\n    if (props.dataProps) {\r\n      formattedData = this.formatApiData(props.data.data, props.dataProps);\r\n    }\r\n\r\n    return <Pie\r\n      data={formattedData}\r\n      labelLine={true}\r\n      //label={renderCustomizedLabel}\r\n      label\r\n      //label={renderLabel}\r\n      //   outerRadius={100}\r\n      fill=\"#8884d8\"\r\n      dataKey=\"value\"\r\n      isAnimationActive={false}\r\n      onClick={this.onPieClick}\r\n      activeIndex={this.props.activeIndex}\r\n      activeShape={renderActiveShape}\r\n    >\r\n      { formattedData && formattedData.length > 0 &&\r\n        formattedData.map((entry, index) => {\r\n          return <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />\r\n        })\r\n      }\r\n    </Pie>;    \r\n  }\r\n\r\n  render() {\r\n    return <PieChart margin={{top: 20, right: 20, left: 20, bottom: 25}} width={400} height={400}>\r\n      {this.renderPieWithData(this.props)}\r\n      {renderLegend()}\r\n      <Tooltip />\r\n    </PieChart>\r\n  }\r\n} // end: PieWithData class\r\n\r\n// Common function\r\n// Renders Pie Chart and Legends\r\nconst renderPie = () => {\r\n  return <Pie\r\n      data={sampleData}\r\n      labelLine={true}\r\n      //label={renderCustomizedLabel}\r\n      label\r\n      //label={renderLabel}\r\n      //   outerRadius={100}\r\n      fill=\"#8884d8\"\r\n      dataKey=\"value\"\r\n      isAnimationActive={false}      \r\n    >\r\n      {\r\n        sampleData.map((entry, index) => <Cell key={`cell-${index}`} fill={COLORS[index % COLORS.length]} />)\r\n      }\r\n    </Pie>;    \r\n}\r\n\r\nconst renderLegend = () => {\r\n  return <Legend \r\n    wrapperStyle={{overflow: \"auto\", height: \"65px\"}}\r\n    margin={{top: 0, right: 0, left: 0, bottom: 0}}\r\n    verticalAlign=\"bottom\"/>\r\n}\r\n\r\nexport default noobControlHoc(PieResponsive);\r\n\r\n// export default noobControlHoc(Example);\r\n\r\n// Properties Panel Portion\r\nexport const pieProps = [\r\n  {\r\n    name: 'dataProps', \r\n    propType: 'section',\r\n  },\r\n  {\r\n    name: 'datasetId', \r\n    propType: 'number',\r\n    toolTip: 'Put the same datasetId for all controls that are linked. When a filter is applied in one control, other linked controls will also be filtered.'\r\n  },\r\n  {\r\n    name: 'requestType', \r\n    propType: 'metadata',\r\n    metadataField: 'requestTypes',\r\n    metadataPropType: 'dropdown'\r\n  },\r\n  {\r\n    name: 'categories', \r\n    propType: 'metadata',\r\n    metadataField: 'dimensions',\r\n    metadataPropType: 'treeDropdown'\r\n  },\r\n  // {\r\n  //   // TODO: this is for aggregation dropdown\r\n  //   // Value depends on the selected dimension\r\n  //   name: 'aggregation', \r\n  //   propType: 'metadata',\r\n  //   metadataField: null,\r\n  //   metadataPropType: 'dropdown',\r\n  //   metadataAssoc: 'categories',\r\n  //   metadataAssocField: 'aggregations'\r\n  // },\r\n  {\r\n    name: 'aggregation', \r\n    propType: 'metadata',\r\n    metadataField: null,\r\n    metadataPropType: 'textbox',\r\n    toolTip: 'Only count is supported in this version',\r\n    readOnly: true\r\n  },\r\n];","import React, { PureComponent, useRef, useEffect, useState } from 'react';\r\nimport {\r\n    BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer,Cell, LabelList\r\n  } from 'recharts';\r\n  import './barChart.css';  \r\n\r\nimport '../controls/common.css';\r\nimport './rechartsCommon.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport _ from \"lodash\";\r\nimport TreeDropdown from '../controls/treeDropdown';\r\nimport {extractName, filterObj, calculateActiveIndex, convertGroupingToTreeDropOptions} from '../helper/chartHelper';\r\nimport {getMetadataDimTreeDropdownOptions} from '../helper/metadataManager';\r\n\r\n// TODO: Due to lack of time during POC, this class design is very messy.\r\n// There are 3 classes being exported for various scenarios (reporting, trial page, design mode)\r\n// The design of gauge chart is cleaner. Try to follow that design.\r\n\r\n//const COLORS = ['green', 'red', 'gold', 'gray', 'cyan', 'magenta', 'black', 'lime', 'teal', 'pink', 'violet', 'orange', 'blue', 'indigo'];\r\nconst COLORS = ['#106b21', '#e71837', 'gold', 'gray', 'cyan', 'magenta', 'black', 'lime', 'teal', 'pink', 'violet', 'orange', 'blue', 'indigo'];\r\n\r\nexport const sampleData = [\r\n  {\r\n    date: 'Category A', \"Series 3\": 4000, \"Series 1\": 2400, \"Series 2\": 2400,\r\n  },\r\n  {\r\n    date: 'Category B', \"Series 3\": 3000, \"Series 1\": 1398, \"Series 2\": 2210,\r\n  },\r\n  {\r\n    date: 'Category C', \"Series 3\": 2000, \"Series 1\": 9800, \"Series 2\": 2290,\r\n  },\r\n  {\r\n    date: 'Category D', \"Series 3\": 2780, \"Series 1\": 3908, \"Series 2\": 2000,\r\n  },\r\n  {\r\n    date: 'Category E', \"Series 3\": 1890, \"Series 1\": 4800, \"Series 2\": 2181,\r\n  },\r\n  {\r\n    date: 'Category F', \"Series 3\": 2390, \"Series 1\": 3800, \"Series 2\": 2500,\r\n  },\r\n];\r\n\r\nconst sampleGroups = [\r\n  {\r\n      key: 'month',\r\n      value: 'month',\r\n      title: 'Month',\r\n  }\r\n]\r\n\r\nconst monthTickFormatter = (tick) => {\r\n  const date = new Date(tick);\r\n\r\n  return tick;\r\n  //return date.getMonth() + 1;\r\n};\r\n\r\nconst renderQuarterTick = (tickProps) => {\r\n  const { x, y, payload } = tickProps;\r\n  const { value, offset } = payload;\r\n  const date = new Date(value);\r\n  const month = date.getMonth();\r\n  const quarterNo = Math.floor(month / 3) + 1;\r\n  const isMidMonth = month % 3 === 1;\r\n\r\n  if (month % 3 === 1) {\r\n    return <text x={x + offset} y={y - 4} textAnchor=\"middle\">{`Q${quarterNo}`}</text>;\r\n  }\r\n\r\n  const isLast = month === 11;\r\n\r\n  if (month % 3 === 0 || isLast) {\r\n    const pathX = Math.floor(isLast ? x + offset * 2 : x) + 0.5;\r\n\r\n    return <path d={`M${pathX},${y - 4}v${-35}`} stroke=\"darkgray\" />;\r\n  }\r\n  return null;\r\n};\r\n\r\nexport const BarChartForReport = (props) => {\r\n  const chartContainerEl = useRef();\r\n  const [myState, setMyState] = useState({\r\n    height: 0,\r\n    width: 0\r\n  });\r\n\r\n  useEffect(() => {\r\n    console.log('[DEBUG] useEffect bar', chartContainerEl);\r\n    if (!chartContainerEl || !chartContainerEl.current) {\r\n      return;\r\n    }\r\n    let rect = chartContainerEl.current.getClientRects()[0]\r\n    setMyState({\r\n      height: rect.height,\r\n      width: rect.width\r\n    })\r\n    \r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"reChartContainer\" ref={chartContainerEl}>\r\n      <div className=\"controlLabel\">{props.data.label}</div>\r\n        {renderChartContents(true, myState.width, myState.height, sampleData)}\r\n    </div>\r\n  );  \r\n}\r\n\r\n// Just specify null for width and height if the BarChart is going to be placed inside a ResponsiveContainer\r\n// Important to set isAnimationActive to false during printing\r\n// This is for the designer only\r\nconst renderChartContents = (bAnimate, width, height, data, stacked) => {\r\n  let stackId = stacked === true ? 'a' : null;\r\n  return (\r\n    <BarChart\r\n              width={width}\r\n              height={height}\r\n              data={data}\r\n              margin={{\r\n              top: 0, right: 10, left: 5, bottom: 50,\r\n              }}\r\n          >\r\n      <CartesianGrid vertical={false}/>\r\n      <XAxis dataKey=\"date\" tick={<CustomizedAxisTick />} \r\n        height={100} interval={0}\r\n        // tickFormatter={monthTickFormatter} \r\n      />\r\n      {/* <XAxis dataKey=\"date\" axisLine={false} tickLine={false} interval={0} tick={renderQuarterTick} height={1} scale=\"band\" xAxisId=\"quarter\" /> */}\r\n      <YAxis axisLine={false}/>\r\n      <Tooltip />\r\n      <Legend verticalAlign=\"top\" wrapperStyle={{\r\n      paddingBottom: \"20px\"\r\n      }}/>\r\n      <Bar dataKey=\"Series 1\" fill=\"green\" stackId={stackId} isAnimationActive={false} />\r\n      <Bar isAnimationActive={bAnimate} dataKey=\"Series 3\" fill=\"gold\" stackId={stackId}/>      \r\n      <Bar isAnimationActive={bAnimate} dataKey=\"Series 2\" fill=\"gray\" stackId={stackId}/>      \r\n    </BarChart>\r\n  )\r\n}\r\n\r\n// Notes:\r\n// Maybe let the user to customize the following:\r\n// - interval (ticks)\r\n// - X axis height\r\n// seriesList - must contain the actual names (e.g. \"Good\", \"Bad\",\"Fair\")\r\n// This function is for the trial page only\r\nconst renderChartContentsTrial = (bAnimate, width, height, data, category, seriesList) => {\r\n  return (\r\n    <BarChart\r\n              width={width}\r\n              height={height}\r\n              data={data}\r\n              margin={{\r\n              top: 20, right: 10, left: 5, bottom: 30,\r\n              }}\r\n          >\r\n      <CartesianGrid vertical={false}/>\r\n      <XAxis height={100} dataKey={category} tick={<CustomizedAxisTickTrial />} interval={0} />\r\n      <YAxis axisLine={false}/>\r\n      <Tooltip />\r\n      <Legend  verticalAlign=\"top\" wrapperStyle={{\r\n      paddingTop: \"10px\"\r\n      }}/>\r\n\r\n\r\n      <Bar dataKey={seriesList[0]} fill=\"green\" strokeWidth={4} isAnimationActive={true} onClick={(...args) => {\r\n        console.log('Bar clicked first cat', ...args);}\r\n        }>\r\n        {/* {\r\n          data.map((entry, index) => (\r\n            <Cell key={`cell-${index}`} stroke={'black'}  strokeWidth={2} myCellId={secondaryList[0]+index}/>\r\n          ))\r\n        } */}\r\n      </Bar>\r\n      <Bar dataKey={seriesList[1]} fill=\"gold\"/>      \r\n    </BarChart>\r\n  )\r\n}\r\n\r\nconst getUniqueValues = (data, seriesName) => {\r\n  return _.uniq(data.map(d => d[seriesName]));\r\n}\r\n\r\nconst formatBarchartData = (data, groupings, seriesName, aggregation=\"value\") => {\r\n  let retList = [];\r\n  for (let i = 0; i < data.length; i++) {\r\n    let currData = data[i];\r\n    let currCategoryVal = extractName(groupings, currData); //e.g. \"Yokogawa / EJA\"\r\n    let currCategoryObj = filterObj(currData, groupings);\r\n    let findRetList = retList.find(r => r.name === currCategoryVal);\r\n    if (!findRetList) {\r\n      findRetList = {\r\n        name: currCategoryVal, \r\n        origCatObj: currCategoryObj,\r\n        origSeriesName: seriesName // we need this later for filtering\r\n      };\r\n      retList.push(findRetList);\r\n    }\r\n\r\n    let seriesVal = currData[seriesName];\r\n    findRetList[seriesVal] = parseInt(currData[aggregation]);\r\n  }\r\n\r\n  return retList;\r\n}\r\n\r\n\r\n\r\nclass CustomizedAxisTick extends PureComponent {\r\n  render() {\r\n    const {\r\n      x, y, stroke, payload,\r\n    } = this.props;\r\n   \r\n    return (\r\n      <g transform={`translate(${x},${y})`}>\r\n        <text x={0} y={0} dy={16} textAnchor=\"end\" fill=\"#666\" transform=\"rotate(-35)\">{payload.value}</text>\r\n      </g>\r\n    );\r\n  }\r\n}\r\n\r\nclass CustomizedAxisTickTrial extends PureComponent {\r\n  render() {\r\n    const {\r\n      x, y, stroke, payload,\r\n    } = this.props;\r\n\r\n    let jsonObj = JSON.parse(payload.value);\r\n    \r\n    return (\r\n      <g transform={`translate(${x},${y})`}>\r\n        <text x={0} y={0} dy={16} textAnchor=\"end\" fill=\"#666\" transform=\"rotate(-35)\">{Object.values(jsonObj).join(' / ')}</text>\r\n      </g>\r\n    );\r\n  }\r\n}\r\n\r\nexport class BarChartWithData extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n    }\r\n  }\r\n\r\n  render() {\r\n\r\n    return (renderChartContentsTrial(true, 600, 400, \r\n      this.props.apiData, \r\n      this.props.primary, \r\n      this.props.secondaryList));\r\n  }\r\n}\r\n\r\n// This is for the Designer sample only\r\nfunction BarChartResponsive(props) {\r\n  let classNames = 'reChartContainer';\r\n  if (props.selected === true) {\r\n      classNames += ' ctrl-selected'\r\n  }\r\n\r\n  return (\r\n    <div className={classNames}>\r\n      <div className=\"controlLabel\">{props.data.label}</div>\r\n      <ResponsiveContainer width={\"100%\"} height=\"100%\">\r\n        {renderChartContents(true, null, null, sampleData, props.stacked)}\r\n      </ResponsiveContainer>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst getDefaultGrouping = (groupingHier) => {\r\n  if (!Array.isArray(groupingHier)) {\r\n    return null;\r\n  }\r\n\r\n  return groupingHier[0];\r\n}\r\n\r\nclass BarResponsiveDataBase extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    //let initialGroupingVal = props.dataProps? getDefaultGrouping(props.dataProps.configedCategories) : null;\r\n    let initialGroupingVal = props.data.dataProps? props.data.dataProps.categories : null;\r\n    this.state = {\r\n      activeCategoryIndex: null, // This is the active category index (index value follows the formattedData index)\r\n      activeSeries: null, // This is the active series inside the active category (e.g. \"Normal\", \"Warning\")\r\n      groupingBoundVal: initialGroupingVal\r\n    }\r\n    this.onGroupSelect = this.onGroupSelect.bind(this);\r\n  }\r\n\r\n  handleClick = (data, index, seriesVal) => {\r\n    console.log('Bar clicked ', index, seriesVal);\r\n    // TODO: Do not use this\r\n    // Instead, check the redux store filter objects and calculate the index based on the current grouping selected\r\n    this.setState({\r\n      activeCategoryIndex: index,\r\n      activeSeries: seriesVal\r\n    });\r\n\r\n    // Fire a redux action\r\n    // origObj e.g. {vendor: \"Yokogawa\", \"PRM Device Status\": \"Normal\"} ...basically the filter for this bar\r\n    // unlike pie chart, origObj is not readily available at this point so we need to build it\r\n    let origObj = {\r\n      ...data.origCatObj,      \r\n    };\r\n\r\n    let seriesInfo = {[data.origSeriesName]: seriesVal};\r\n\r\n    if (this.props.handleChartClick) {\r\n      // A control can have 1 filter per grouping level\r\n      // we store the grouping stack as string to make it easier to compare\r\n      let groupingStackStr = this.getGroupingStackStr();\r\n\r\n      this.props.handleChartClick({origObj}, seriesInfo, groupingStackStr);\r\n    }\r\n  }\r\n\r\n  getGroupingStackStr = () => {\r\n    let groupingStack = this.props.currControlGrouping ? this.props.currControlGrouping : [this.state.groupingBoundVal];\r\n    return JSON.stringify(groupingStack);\r\n  }\r\n\r\n// For rendering an individual bar (group) inside a barchart\r\n  renderBars = (uniqSeriesVals, activeIndex, activeSeries) => {\r\n    let stackId = this.props.data.stacked === true ? 'a' : null;\r\n    //console.log(\"renderBars\", uniqSeriesNames); // Normal, Error, Warning\r\n    return uniqSeriesVals.map((seriesVal, seriesIndex) => {\r\n      return <Bar \r\n          key={`bar-${seriesVal}-${seriesIndex}`} \r\n          dataKey={seriesVal} \r\n          fill={COLORS[seriesIndex % COLORS.length]} \r\n          // Turn off animation because of rechart bug: the triangles in renderCustomizedLabel() are rendered intermittently\r\n          isAnimationActive={false} \r\n          stackId={stackId}\r\n          onClick={(data, index) => this.handleClick(data, index, seriesVal)}\r\n        >\r\n        <LabelList dataKey={\"name\"} content={(props) => this.renderCustomizedLabel(props, activeIndex, activeSeries)} mySeriesName={seriesVal}/>    \r\n      </Bar>\r\n    }\r\n    );      \r\n  }\r\n\r\n  renderCustomizedLabel = (props, activeIndex, activeSeries) => {    \r\n    const {\r\n      x, y, width, height, value, mySeriesName, index\r\n    } = props;    \r\n\r\n    // Do not use the state activeIndex\r\n    // Parse this.props.datasetFilters to get the active index\r\n    if (activeIndex !== index || \r\n      activeSeries !== mySeriesName) {\r\n      return null;\r\n    }  \r\n    \r\n    const xyOffset = 1;\r\n    const sideLen = 8;\r\n    let trianglePts;\r\n    if (this.props.data.stacked) {\r\n      // draw on left\r\n      trianglePts = `${ x - xyOffset} ${ y + height/2}, ${ x - xyOffset - sideLen} ${ y + height/2 - sideLen /2}, ${ x - xyOffset - sideLen} ${ y + height/2 + sideLen /2}`;\r\n    }\r\n    else {\r\n      // draw on top\r\n      trianglePts = `${x + width / 2 - sideLen /2 } ${y-xyOffset- sideLen}, ${x + width / 2 + sideLen /2 } ${y-xyOffset- sideLen}, ${x+width/2} ${y-xyOffset}`;\r\n    }\r\n\r\n    console.log('renderCustomizedLabel', mySeriesName, index, trianglePts);\r\n  \r\n    // Draw a triangle on top if the bar is the selected series of the selected index\r\n    return (\r\n      <g>\r\n        <polygon id=\"e1_polygon\" points={trianglePts} fill=\"rgba(0, 0, 0, 0.7)\"/>\r\n      </g>\r\n    );\r\n  };\r\n\r\n  getDataIndex = (data, filter) => {    \r\n    return data.findIndex(d => {\r\n      let currDataCatObj = d.origCatObj;\r\n      for (let prop in filter) {\r\n        let propVal = filter[prop];\r\n        if (currDataCatObj[prop] !== propVal) {\r\n            return false;\r\n        }\r\n      }\r\n\r\n      return true;\r\n    });\r\n  }\r\n\r\n  // Input data sample:\r\n  // {PRM Device Status: \"GOOD\", Vendor: \"Yokogawa\", Model: \"EJA\", count: 100},\r\n  // {PRM Device Status: \"BAD\", Vendor: \"Yokogawa\", Model: \"EJA\", count: 100},\r\n  // {PRM Device Status: \"FAIR\", Vendor: \"Yokogawa\", Model: \"EJA\", count: 100},\r\n  // {PRM Device Status: \"GOOD\", Vendor: \"Yokogawa\", Model: \"EJX\", count: 100},\r\n  // {PRM Device Status: \"BAD\", Vendor: \"Yokogawa\", Model: \"EJX\", count: 100},\r\n  // {PRM Device Status: \"FAIR\", Vendor: \"Yokogawa\", Model: \"EJX\", count: 100},\r\n  // \r\n  // Need to transform/compress it to:\r\n  // {name: \"Yokogawa / EJA\", GOOD: 100, BAD: 100, FAIR: 100},\r\n  // {name: \"Yokogawa / EJX\", GOOD: 100, BAD: 100, FAIR: 100},\r\n  // \r\n  // categories: e.g. [\"Vendor\", \"Model\"]\r\n  // seriesName: e.g. \"PRM Device Status\"\r\n  // aggregation: \"count\"\r\n  renderChartContentsUngroupedData = (data, groupings, seriesName, aggregation) => {\r\n    let uniqSeriesVals = getUniqueValues(data, seriesName); // Good, bad, fair, e.g.\r\n    let formattedData = formatBarchartData(data, groupings, seriesName, aggregation);\r\n    // Calculate the active index and series first\r\n    let stackStr = this.getGroupingStackStr();\r\n    let filterAtGroup = this.findFilterAtGroup(stackStr);\r\n    let activeIndex, activeSeries;\r\n\r\n    if (filterAtGroup && filterAtGroup.sliceInfo && filterAtGroup.sliceInfo.origObj) {\r\n      activeIndex = this.getDataIndex(formattedData, filterAtGroup.sliceInfo.origObj);\r\n      activeSeries = filterAtGroup.seriesInfo && Object.values(filterAtGroup.seriesInfo)[0];\r\n    }\r\n\r\n    return (\r\n      <BarChart\r\n                data={formattedData}\r\n                margin={{\r\n                top: 0, right: 10, left: 5, bottom: 50,\r\n                }}\r\n            >\r\n        <CartesianGrid vertical={false}/>\r\n        <XAxis height={100} dataKey={\"name\"} tick={<CustomizedAxisTick />} interval={0} />\r\n        <YAxis axisLine={false}/>\r\n        <Tooltip />\r\n        <Legend  verticalAlign=\"top\" wrapperStyle={{\r\n        paddingBottom: \"20px\"\r\n        }}/>\r\n          {this.renderBars(uniqSeriesVals, activeIndex, activeSeries)}   \r\n\r\n      </BarChart>\r\n    )\r\n  }  \r\n\r\n  findFilterAtGroup = (newStackStr) => {\r\n    if (!this.props.datasetFilters) {\r\n      return null;\r\n    }\r\n\r\n    let controlFilters = this.props.datasetFilters[this.props.i];\r\n    if (!controlFilters) {\r\n      return null;\r\n    }\r\n\r\n    return controlFilters[newStackStr];\r\n  }\r\n\r\n  onGroupSelect(value, node) {\r\n    console.log(\"[Barchart] onGroupSelect\", value, node.props);\r\n\r\n    // calculate the new activeIndex/series from the new groupValue\r\n    // let stackStr = JSON.stringify(node.props.stackValue);\r\n    // let filterAtNewGroup = findFilterAtGroup(stackStr);\r\n    // if (filterAtNewGroup) {\r\n    //   // Find the index from the data\r\n    // }\r\n\r\n    this.setState({\r\n      groupingBoundVal: value,\r\n    });\r\n\r\n    // Remove the filter from previous lower groups\r\n    // Send a new API Request to the backend\r\n    // Just fire a callback and let it be handled in upper level?\r\n    // Maybe just store the \"temp\" grouping (non-default) of controls of the dashboard in redux store\r\n    if (this.props.handleGroupSelect) {\r\n      let stacks = node.props.stackValue;\r\n      this.props.handleGroupSelect(stacks);\r\n    }\r\n  }\r\n  \r\n  getChartContents = () => {\r\n    if (!this.props.designMode) {\r\n      if (!this.props.apiData) {\r\n        // Means API data not yet fetched\r\n        return <div></div>;\r\n      }\r\n\r\n      let grouping = this.props.currControlGrouping ? this.props.currControlGrouping : [this.props.data.dataProps.categories];\r\n\r\n      return this.renderChartContentsUngroupedData(\r\n        this.props.apiData.data, \r\n        grouping, \r\n        this.props.data.dataProps.seriesName,\r\n        this.props.data.dataProps.aggregation)\r\n    }\r\n    else {\r\n      // Show sample data\r\n      return renderChartContents(true, null, null, sampleData, this.props.data.stacked);\r\n    }\r\n  }\r\n\r\n  componentDidUpdate(previousProps, previousState) {\r\n    // If the layout name changes, the constructor may not be called again (I think if the ID did not change).\r\n    // So we perform the updates here\r\n    if (previousProps.layoutName !== this.props.layoutName) {\r\n      let initialGroupingVal = this.props.data.dataProps? this.props.data.dataProps.categories : null;\r\n      this.setState({\r\n        groupingBoundVal: initialGroupingVal\r\n      });\r\n    }\r\n  }\r\n\r\n  render() {\r\n    let classNames = 'reChartContainer';\r\n    if (this.props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n\r\n    return (\r\n      <div className={classNames}>\r\n        <div className=\"controlLabel\">{this.props.data.label}</div>\r\n        <div>\r\n          {!this.props.designMode && this.props.data.dataProps && this.props.metadata && <TreeDropdown \r\n            //treeData={convertGroupingToTreeDropOptions(this.props.dataProps.configedCategories)} \r\n            treeData={getMetadataDimTreeDropdownOptions(this.props.data.dataProps.categories, this.props.metadata)} \r\n            value={this.state.groupingBoundVal}\r\n            onSelect={this.onGroupSelect}\r\n            treeDefaultExpandAll\r\n          />}\r\n          {this.props.designMode && !this.props.dataProps && <TreeDropdown \r\n            treeData={sampleGroups} \r\n            value={sampleGroups[0].key}\r\n            treeDefaultExpandAll\r\n            disabled\r\n          />}                \r\n        </div>\r\n        <ResponsiveContainer width={\"100%\"} height=\"100%\">        \r\n        {this.getChartContents(this.props)}        \r\n        </ResponsiveContainer>\r\n      </div>);\r\n  }\r\n}\r\n\r\nexport const BarResponsiveData = noobControlHoc(BarResponsiveDataBase)\r\n\r\nexport default noobControlHoc(BarChartResponsive);\r\n\r\n// For Properties Panel\r\nexport const barProps = [\r\n  {\r\n    name: 'stacked', \r\n    propType: 'bool',\r\n  },\r\n  {\r\n    name: 'dataProps', \r\n    propType: 'section',\r\n  },\r\n  {\r\n    name: 'datasetId', \r\n    propType: 'number',\r\n  },\r\n  {\r\n    name: 'requestType', \r\n    propType: 'metadata',\r\n    metadataField: 'requestTypes',\r\n    metadataPropType: 'dropdown'\r\n  },\r\n  {\r\n    name: 'categories', \r\n    propType: 'metadata',\r\n    metadataField: 'dimensions',\r\n    metadataPropType: 'treeDropdown'\r\n  },\r\n  {\r\n    name: 'seriesName', \r\n    propType: 'metadata',\r\n    metadataField: 'dimensions',\r\n    metadataPropType: 'treeDropdown'\r\n  },\r\n  {\r\n    name: 'aggregation', \r\n    propType: 'metadata',\r\n    metadataField: null,\r\n    metadataPropType: 'textbox',\r\n    toolTip: 'Only count is supported in this version',\r\n    readOnly: true\r\n  },\r\n\r\n];","import React, { Fragment, useRef, useState, useEffect } from 'react';\r\nimport './lineChart.css';\r\nimport './rechartsCommon.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport {LineChart as RechartLineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer} from 'recharts';\r\nimport {getUniqueValues} from '../helper/chartHelper';\r\n\r\nconst sampleData = [\r\n  {name: 'Category A', Series1: 5.5, },\r\n  {name: 'Category B', Series1: 3.5, },\r\n  {name: 'Category C', Series1: 9.8, },\r\n  {name: 'Category D', Series1: 7.7, },\r\n];\r\n\r\nconst CustomizedLabel = (props) => {\r\n  const {x, y, stroke, value} = props;\r\n\t\t\r\n  return <text x={x} y={y} dy={-10} fill={stroke} fontSize={14} textAnchor=\"middle\">{value}</text>\r\n}\r\n\r\nconst CustomizedAxisTick = (props) => {\r\n  const {x, y, stroke, payload, category} = props;\r\n  let textVal = payload.value;\r\n  \r\n  if (category === 'Day') {\r\n    let dateParsed = Date.parse(payload.value);\r\n    if (!!dateParsed) {\r\n      let dateObj = new Date(dateParsed);      \r\n      if (!!dateObj) {\r\n        textVal = dateObj.toLocaleDateString();\r\n      }\r\n    }\r\n  }\r\n\t\t\r\n  return (\r\n    <g transform={`translate(${x},${y})`}>\r\n      <text x={0} y={0} dy={16} textAnchor=\"end\" fill=\"#666\" transform=\"rotate(-35)\">{textVal}</text>\r\n    </g>\r\n  );\r\n}\r\n\r\n// For now, just support 1 series\r\n// import this class if not in design mode\r\nexport const LineChartBase = (props) => {\r\n\r\n  const reformatLineChartData = (apiData) => {\r\n    // Input:\r\n    // {Day: \"2020-01-01\", Alarm Type: \"Out of Spec\", value: 50}\r\n    // {Day: \"2020-01-01\", Alarm Type: \"Normal\", value: 10}\r\n    // Output:\r\n    // {Day: \"2020-01-01\", Out of Spec: 50, Normal: 10}\r\n\r\n    let retList = [];\r\n    let categories = props.data.dataProps.categories; // e.g. Day\r\n    let seriesName = props.data.dataProps.seriesName; // e.g. Alarm Type\r\n\r\n    for (let i = 0; i < apiData.length; i++) {\r\n      let currData = apiData[i];\r\n      let currCategoryVal = currData[categories];\r\n      let currSeriesName = currData[seriesName];\r\n      let currSeriesVal = currData.value;\r\n      let findRetList = retList.find(r => r[categories] === currCategoryVal);\r\n      if (!findRetList) {\r\n        findRetList = {\r\n          [categories]: currCategoryVal\r\n        }\r\n        retList.push(findRetList);\r\n      }\r\n\r\n      findRetList[currSeriesName] = currSeriesVal;\r\n    }\r\n\r\n    return retList;\r\n  }\r\n\r\n  // Recharts has a bug during printing / saving to PDF\r\n  // Do not use the ResponsiveContainer during printing\r\n  const renderLineChartContainer = () => {\r\n    if (props.reportMode) {\r\n      return renderLineChartContents();\r\n    }\r\n    else {\r\n      return <ResponsiveContainer width={\"100%\"} height=\"100%\">\r\n        {renderLineChartContents()}\r\n      </ResponsiveContainer>\r\n    }\r\n  }\r\n\r\n  const renderLineChartContents = () => {\r\n    // the height and width are just overridden when placed inside a ReponsiveContainer\r\n    return (\r\n      <RechartLineChart data={dataToUse}\r\n      margin={{top: 20, right: 30, left: 0, bottom: 25}}\r\n      height={myState.height}\r\n      width={myState.width}\r\n      >\r\n\r\n        <CartesianGrid strokeDasharray=\"3 3\"/>\r\n        <XAxis dataKey={category} height={60} tick={<CustomizedAxisTick category={category}/>} padding={{ left: 50 }} interval={0}/>\r\n        <YAxis unit={props.data.unit}/>\r\n        <Tooltip/>\r\n        <Legend />\r\n        <Line \r\n          type=\"monotone\" \r\n          dataKey={seriesName}\r\n          stroke=\"blue\" \r\n          label={<CustomizedLabel stroke=\"blue\"/>}\r\n          dot={{ stroke: 'blue', strokeWidth: 10 }}\r\n          animationDuration={500}/>\r\n      </RechartLineChart>\r\n    );\r\n  }\r\n\r\n  const chartContainerEl = useRef();\r\n  const [myState, setMyState] = useState({\r\n    height: 0,\r\n    width: 0\r\n  });\r\n\r\nuseEffect(() => {\r\n    console.log('[DEBUG] useEffect gauge', chartContainerEl);\r\n    if (!chartContainerEl || !chartContainerEl.current || !chartContainerEl.current.getClientRects()) {\r\n      return;\r\n    }\r\n    let rect = chartContainerEl.current.getClientRects()[0]\r\n    if (!rect) {\r\n        return;\r\n    }\r\n    setMyState({\r\n      height: rect.height,\r\n      width: rect.width\r\n    })\r\n    \r\n}, []);\r\n  \r\n  let isAnimationActive = props.designMode ? true : false;  \r\n  let seriesName = props.designMode ? \"Series1\": props.data.dataProps.seriesName;\r\n  let category = props.designMode ? \"name\": props.data.dataProps.categories;\r\n  let dataToUse = [];\r\n  if (props.designMode) {\r\n    dataToUse = sampleData;\r\n  }\r\n  else if (!!props.apiData) {\r\n    debugger\r\n    dataToUse = reformatLineChartData(props.apiData.data)\r\n    let allUniqeSeriesVals = getUniqueValues(props.apiData.data, props.data.dataProps.seriesName);\r\n    if (Array.isArray(allUniqeSeriesVals) && allUniqeSeriesVals.length>0) {\r\n      seriesName = allUniqeSeriesVals[0]; // for POC, we assume only 1 series\r\n    }\r\n  }\r\n\r\n  debugger\r\n  console.log('linechart render', dataToUse);\r\n\r\n  let classNames = 'reChartContainer '; \r\n  if (props.selected) {\r\n    classNames += 'ctrl-selected';\r\n  }\r\n\r\n  return (<div className={classNames} ref={chartContainerEl}>\r\n    <div className=\"controlLabel\">{props.data.label}</div>    \r\n      {renderLineChartContainer()} \r\n    </div>\r\n  );\r\n}\r\n\r\n// import this if Design Mode\r\nexport default noobControlHoc(LineChartBase);\r\n\r\n\r\n// For Properties Panel\r\nexport const lineProps = [\r\n  {\r\n    name: 'dataProps', \r\n    propType: 'section',\r\n  },\r\n  {\r\n    name: 'datasetId', \r\n    propType: 'number',\r\n  },\r\n  {\r\n    name: 'requestType', \r\n    propType: 'metadata',\r\n    metadataField: 'requestTypes',\r\n    metadataPropType: 'dropdown'\r\n  },\r\n  {\r\n    name: 'categories', \r\n    propType: 'metadata',\r\n    metadataField: 'dimensions',\r\n    metadataPropType: 'treeDropdown'\r\n  },\r\n  {\r\n    name: 'seriesName', \r\n    propType: 'metadata',\r\n    metadataField: 'dimensions',\r\n    metadataPropType: 'treeDropdown'\r\n  },\r\n  {\r\n    name: 'filterName', \r\n    propType: 'metadata',\r\n    metadataField: 'dimensions',\r\n    metadataPropType: 'treeDropdown'\r\n  },\r\n\r\n]","import React, {useRef, useState, useEffect} from 'react';\r\nimport { Sector, Cell, PieChart, Pie, ResponsiveContainer, Legend } from 'recharts';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport './rechartsCommon.css';\r\n\r\nconst GaugeChart = (props) => {\r\n    console.log('[DEBUG] render GaugeChart', props);    \r\n    const width = parseInt(props.maxWidth)? parseInt(props.maxWidth) : 300;\r\n    const chartValue = props.apiData && Array.isArray(props.apiData.data) && props.apiData.data.length > 0 ? \r\n                        parseFloat(props.apiData.data[0].value) : 0;\r\n    let unit = \"%\";\r\n    const colorData = [{\r\n            value: 20, // Meaning span is 0 to 20\r\n            color: '#e71837' // 'red' pastel\r\n        }, {\r\n            value: 60, // span 20 to 80\r\n            color: '#fce903' // 'gold pastel'\r\n        }, {\r\n            value: 20, // span 80 to 100\r\n            color: '#106b21' // 'green' pastel\r\n        }\r\n    ];\r\n\r\n    const activeSectorIndex = colorData.map((cur, index, arr) => {\r\n        const curMax = [...arr]\r\n            .splice(0, index + 1)\r\n            .reduce((a, b) => ({ value: a.value + b.value }))\r\n            .value;\r\n        return (chartValue > (curMax - cur.value)) && (chartValue <= curMax);\r\n    })\r\n    .findIndex(cur => cur);\r\n\r\n    const sumValues = colorData\r\n        .map(cur => cur.value)\r\n        .reduce((a, b) => a + b);\r\n\r\n    const arrowData = [\r\n        { value: chartValue },\r\n        { value: 0 },\r\n        { value: sumValues - chartValue }\r\n    ];\r\n\r\n    const pieProps = {\r\n        startAngle: 180,\r\n        endAngle: 0,\r\n        cx: '50%',\r\n        //cy: width / 2\r\n        cy: props.data.label && props.data.label.length > 0 ? '55%' : '65%'\r\n        //cy: '50%'\r\n    };\r\n\r\n    const pieRadius = {\r\n        // innerRadius: (width / 2) * 0.35,\r\n        // outerRadius: (width / 2) * 0.4\r\n        // innerRadius: (width / 4) + width / 16 - 10 - width / 36,\r\n        // outerRadius: (width / 4) + width / 16 - 10\r\n        innerRadius: '90%',\r\n        outerRadius: '100%'\r\n    };\r\n\r\n    const Arrow = ({ cx, cy, midAngle, outerRadius }) => { //eslint-disable-line react/no-multi-comp\r\n        const RADIAN = Math.PI / 180;\r\n        const sin = Math.sin(-RADIAN * midAngle);\r\n        const cos = Math.cos(-RADIAN * midAngle);\r\n        // const mx = cx + (outerRadius + width * 0.03) * cos;\r\n        // const my = cy + (outerRadius + width * 0.03) * sin;\r\n        const mx = cx + (outerRadius) * cos;\r\n        const my = cy + (outerRadius) * sin;\r\n        return (\r\n            <g>\r\n                <circle cx={cx} cy={cy} r={width * 0.03} fill=\"#666\" stroke=\"none\"/>\r\n                <path d={`M${cx},${cy}L${mx},${my}`} strokeWidth=\"6\" stroke=\"#666\" fill=\"none\" strokeLinecap=\"round\"/>\r\n                <text x={cx} y={cy + width/8 } textAnchor=\"middle\" fontSize={width / 13}>{chartValue}{unit}</text>\r\n            </g>\r\n        );\r\n    };\r\n\r\n    const ActiveSectorMark = ({ cx, cy, innerRadius, outerRadius, startAngle, endAngle, fill }) => { //eslint-disable-line react/no-multi-comp\r\n        return (\r\n            <g>\r\n                <Sector\r\n                    cx={cx}\r\n                    cy={cy}\r\n                    innerRadius={innerRadius}\r\n                    outerRadius={outerRadius * 1.0}\r\n                    startAngle={startAngle}\r\n                    endAngle={endAngle}\r\n                    fill={fill}\r\n                />\r\n            </g>\r\n        );\r\n    };\r\n\r\n    // Draws the \"plate\" part of the page (the semicircle part)\r\n    const renderGaugePlate = () => {\r\n        return <Pie\r\n        activeIndex={activeSectorIndex}\r\n        activeShape={ActiveSectorMark}\r\n        data={colorData}\r\n        fill=\"#8884d8\"\r\n        isAnimationActive={false}\r\n        dataKey=\"value\"\r\n        { ...pieRadius }\r\n        { ...pieProps }\r\n    >\r\n        {\r\n            colorData.map((entry, index) => (\r\n                <Cell key={`cell-${index}`} fill={colorData[index].color} />\r\n            ))\r\n        }\r\n        </Pie>\r\n    }\r\n\r\n    // Draws the needle of the gauge\r\n    const renderGaugeNeedle = () => {\r\n        return <Pie\r\n            stroke=\"none\"\r\n            activeIndex={1}\r\n            activeShape={ Arrow }\r\n            data={ arrowData }\r\n            outerRadius={ pieRadius.outerRadius }\r\n            fill=\"none\"\r\n            dataKey=\"value\"\r\n            isAnimationActive={false}\r\n            { ...pieProps }\r\n        />\r\n    }\r\n\r\n    // Recharts has a bug during printing / saving to PDF\r\n    // Do not use the ResponsiveContainer during printing\r\n    const renderGaugeChartArea = () => {\r\n        if (props.reportMode) {\r\n            return <PieChart margin={{top: 0, right: 0, left: 0, bottom: 0}}\r\n                height={myState.height}\r\n                width={myState.width}\r\n            >\r\n                    {renderGaugePlate()}\r\n                    {renderGaugeNeedle()}\r\n                </PieChart>;\r\n        }\r\n        else {\r\n            return <ResponsiveContainer  width=\"100%\" height=\"100%\" >\r\n                <PieChart margin={{top: 0, right: 0, left: 0, bottom: 0}}\r\n                >\r\n                    {renderGaugePlate()}\r\n                    {renderGaugeNeedle()}\r\n                </PieChart>\r\n            </ResponsiveContainer>\r\n        }\r\n    }\r\n\r\n    let classNames = 'reChartContainer '; \r\n    if (props.selected) {\r\n      classNames += 'ctrl-selected';\r\n    }\r\n\r\n    const chartContainerEl = useRef();\r\n    const [myState, setMyState] = useState({\r\n        height: 0,\r\n        width: 0\r\n    });\r\n\r\n    useEffect(() => {\r\n        console.log('[DEBUG] useEffect gauge', chartContainerEl);\r\n        if (!chartContainerEl || !chartContainerEl.current || !chartContainerEl.current.getClientRects()) {\r\n          return;\r\n        }\r\n        let rect = chartContainerEl.current.getClientRects()[0]\r\n        if (!rect) {\r\n            return;\r\n        }\r\n        setMyState({\r\n          height: rect.height,\r\n          width: rect.width\r\n        })\r\n        \r\n    }, []);\r\n\r\n    return (<div className={classNames} ref={chartContainerEl}>\r\n        {props.data.label && props.data.label.length > 0 && <div className=\"controlLabel\">{props.data.label}</div>}\r\n        {renderGaugeChartArea()}\r\n    </div>\r\n    );\r\n};\r\n\r\nexport default noobControlHoc(GaugeChart);\r\n\r\n\r\n// Properties Panel Portion\r\nexport const gaugeProps = [\r\n    {\r\n      name: 'dataProps', \r\n      propType: 'section',\r\n    },\r\n    {\r\n      name: 'datasetId', \r\n      propType: 'number',\r\n      toolTip: 'Put the same datasetId for all controls that are linked. When a filter is applied in one control, other linked controls will also be filtered.'\r\n    },\r\n    {\r\n      name: 'requestType', \r\n      propType: 'metadata',\r\n      metadataField: 'requestTypes',\r\n      metadataPropType: 'dropdown'\r\n    },\r\n    {\r\n      name: 'groupings', \r\n      propType: 'metadata',\r\n      metadataField: 'dimensions',\r\n      metadataPropType: 'treeDropdown',\r\n      multiple: true\r\n    },\r\n    {\r\n        name: 'filtersList', \r\n        propType: 'dynamicFilter',\r\n        metadataField: 'dimensions', // Infer metadata field if it is a dynamicFilter\r\n        metadataPropType: 'treeDropdown',\r\n        multiple: true,\r\n        toolTip: \"Select one or more filters by clicking the Add Parameter button\"\r\n      },\r\n    ];","import React from 'react';\r\nimport '../controls/common.css';\r\nimport './gauge.css'\r\nimport {ResponsiveContainer} from 'recharts';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport GaugeChart from 'react-gauge-chart';\r\n\r\nconst Gauge = (props) => {\r\n    console.log('gauge render', props.h);\r\n    let classNames = 'gauge';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n\r\n    // Bug: This chart does not respect the height; only the width\r\n    return <div className={classNames}>\r\n        <div className=\"controlLabel\">{props.data.label}</div>\r\n        <ResponsiveContainer  width=\"100%\" height=\"90%\">\r\n            <GaugeChart id={props.i}\r\n            nrOfLevels={20} \r\n            percent={props.data.percent} \r\n            textColor={\"black\"}\r\n            colors={['red', 'gold', 'green']}\r\n            marginInPercent={0.055}\r\n            style={{width: '100%'}}\r\n            />\r\n        </ResponsiveContainer>\r\n\r\n    </div>\r\n}\r\nexport default noobControlHoc(Gauge);","import React, { Component } from 'react';\r\nimport './noobForm.css';\r\nimport NoobControl from './noobControl';\r\nimport {connect} from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport { updateLayout } from '../actions/index';\r\nimport {ControlDragTypes} from './noobControlContent';\r\nimport { WIDTH_LARGE } from '../constants';\r\n\r\nconst ROW_HEIGHT = 50;\r\nconst CONTROL_PADDING = 20;\r\nconst GRID_GAP = 5;\r\n\r\n// CSS Grid based layout editor, instead of using react-grid-layout\r\n// problems with RGL:\r\n// [1] combobox multiselect: Griditem size does not expand based on the child content's size\r\n// [2] if {useCssTransform = true}, there will be overlap problems with the combobox dropdown.\r\n//     side effect of setting it to false is that drag and drop becomes unpredictable with Drag-from-outside\r\n// But of course, there are many good features in RGL that might be difficult to recreate:\r\n// [1] Animations, on-the fly preview\r\n//      - might not be feasible with CSS Grid/current design. Anyways, this is just cosmetic.\r\n// [2] Auto-arrange elements on DnD\r\n// [3] Opaque Drag image. RGL's Drag image looks very nice because the Drag Image is 100% Opaque\r\n//     In Chrome, Native DnD from HTML5 looks weird as it is semi-transparent with some gradient\r\n//     In Edge, the drag image also looks different.\r\n//  => React DnD Supports \"Custom Drag Layer\"...TODO: Experiment on this. From the examples, this also works on touch backend.\r\n//  => This way, the drag previews will be consistent across all browsers.\r\n\r\n// use destructuring to capture all the properties passed from upper component\r\n//const NoobForm = ({containerWidth, controls, layoutProps, eventCallbacks}) => {\r\nclass NoobForm extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            // Possible optimization: save all the DOM elements of the controls to the state\r\n            // Because while resizing, there is a need to find all control Id's using DOM query\r\n            // Maybe get a fresh copy of all DOM elements during mousedown of the resizer\r\n            resizingControlId: null,        \r\n        };\r\n        this.onMouseLeave = this.onMouseLeave.bind(this);\r\n        this.onMouseMove = this.onMouseMove.bind(this);\r\n        this.onResizerMouseDown = this.onResizerMouseDown.bind(this);\r\n        this.onMouseUp = this.onMouseUp.bind(this);\r\n        this.onDropControl = this.onDropControl.bind(this);\r\n        this.checkDroppable = this.checkDroppable.bind(this);\r\n    }\r\n\r\n    // for handling resizing operations\r\n    onMouseMove(e, controlIds) {\r\n        if (this.state.resizingControlId == null) {\r\n            return;\r\n        }\r\n\r\n        // [1] Find the DOM Control via document query\r\n        let domControl = this.findControlDomById(this.state.resizingControlId);\r\n        if (domControl === null) {\r\n            return;\r\n        }\r\n\r\n\r\n        let rectContainer = domControl.container.getClientRects()[0];\r\n\r\n        let yDelta = !!e.touches ? e.touches[0].clientY - rectContainer.bottom: e.clientY - rectContainer.bottom;\r\n        let xDelta = !!e.touches ? e.touches[0].clientX - rectContainer.right : e.clientX - rectContainer.right;\r\n\r\n        if (!domControl.container.classList.contains('resizingControl')) {\r\n            domControl.container.classList.add('resizingControl');\r\n            domControl.content.classList.add('resizingContent');\r\n        }   \r\n\r\n        domControl.placeholder.style.height = `${this.state.origHeight - 2}px`;\r\n        domControl.placeholder.style.width = `${this.state.origWidth - 2}px`;\r\n        //debugger\r\n        // console.log('onMouseMove....', this.state.origHeight);\r\n\r\n        //console.log('MouseMove/TouchMove', yDelta, xDelta);\r\n\r\n        // [2] Set the new width and height based on the mouse position\r\n        domControl.content.style.width = `${rectContainer.width + xDelta}px`;\r\n        domControl.content.style.height = `${rectContainer.height + yDelta}px`;\r\n\r\n        let rectResizing = domControl.content.getClientRects()[0];\r\n\r\n        // [3] Check overlaps with other controls - highlight them\r\n        this.checkOverlaps(this.state.resizingControlId, rectResizing, controlIds); // overlap with other controls\r\n\r\n        // [4] Check overlaps with landing pad - highlight them\r\n        this.checkLandingPadOverlap(this.state.resizingControlId, rectContainer, rectResizing);\r\n\r\n    }\r\n\r\n    // While resizing a big control (width/height > 1), its internal landing pads will be displayed as visual cue for the user.\r\n    // If the control is resized smaller during dragging, only the landing pads that are covered ny the mouse position will be highlighted\r\n    checkLandingPadOverlap(resizingControlId, rectContainer, rectResizing) {\r\n        // will only take effect if the resizing rect's height or width is smaller than the container\r\n        // if (rectContainer.width <= rectResizing.width && \r\n        //     rectContainer.height <= rectResizing.height) {\r\n        //         this.removeAllLandingPadPotentialDrops();\r\n        //         return;\r\n        // }    \r\n        \r\n        let landingPadsDom = this.findLandingPadsByParentControl(resizingControlId);\r\n        //console.log('[DEBUG] checkLandingPadOverlap...' + landingPadsDom.length);\r\n        // check if resizing rect covers me\r\n        landingPadsDom.forEach(landingPad => {\r\n            let rectLandingPad = landingPad.getClientRects()[0];\r\n            let isOverlapped = this.hasOverlap(rectResizing, rectLandingPad);\r\n            if (isOverlapped) {\r\n                landingPad.classList.add('landingPadPotentialDrop');\r\n            }\r\n            else if (landingPad.classList.contains('landingPadPotentialDrop')) {\r\n                landingPad.classList.remove('landingPadPotentialDrop');\r\n            }\r\n        });\r\n    }\r\n\r\n    // Maybe no need to call this.\r\n    // Since the landing pad elements are only rendered if there is a resizing element\r\n    removeAllLandingPadPotentialDrops() {\r\n        // TODO: don't search the entire document. Supply the designer root element only\r\n        let landingPadPotDrops = document.getElementsByClassName('landingPadPotentialDrop');\r\n        if (landingPadPotDrops.length > 0) {\r\n            // console.log('[DEBUG] removeAllLandingPadPotentialDrops' + landingPadPotDrops.length);\r\n        }\r\n    \r\n        while (landingPadPotDrops.length > 0) {\r\n            let currPad = landingPadPotDrops[0];\r\n            currPad.classList.remove('landingPadPotentialDrop');\r\n        }\r\n    }\r\n\r\n    findLandingPadsByParentControl(controlId) {\r\n        // TODO: don't search the entire document. Supply the designer root element only\r\n        let ret = {};\r\n        let keyQuery = `[parentctrlid=\"ctrl${controlId}\"]`;\r\n        return document.querySelectorAll(keyQuery);\r\n    }\r\n\r\n    // bFindall: true to find all; false to return just the first one\r\n    // findControlByClassName(rootElem, strClass) {\r\n    //     if (!rootElem || !strClass) {\r\n    //         return null;\r\n    //     }\r\n\r\n    //     return rootElem.getElementsByClassName(strClass);\r\n    // }\r\n\r\n    // also works\r\n    hasOverlapComplicated(rect1, rect2) {\r\n\r\n        //There are less scenarios for no collision so use this instead of checking for collision\r\n        let noHorzCollision = rect2.right < rect1.left || rect2.left > rect1.right;\r\n        let noVertCollision = rect2.bot < rect1.top || rect2.top > rect1.bottom;\r\n\r\n        console.log(`   [DEBUG] NoHorz: ${noHorzCollision}, NoVert: ${noVertCollision}, FINAL: ${noHorzCollision || noVertCollision}`);\r\n        // There is overlap if there is Vertical AND Horizontal collision\r\n        return !noHorzCollision && !noVertCollision;\r\n    }\r\n\r\n    // simpler\r\n    hasOverlap(rect1, rect2) {\r\n        // if one rect is on the left side of the other rect\r\n        if (rect2.right < rect1.left || rect2.left > rect1.right) {\r\n            //console.log(\"   [hasOverlap] No horz overlap\");\r\n            return false;\r\n        }\r\n\r\n        // if one rect is on top of the other\r\n        if (rect2.bottom < rect1.top || rect2.top > rect1.bottom) {\r\n            //console.log(\"   [hasOverlap] No vertical overlap\");\r\n            return false;\r\n        }\r\n\r\n        //console.log(\"   [hasOverlap] has overlap\");\r\n        return true;\r\n    }\r\n\r\n    // Edge overlap is not considered overlap\r\n    hasOverlapStrict(rect1, rect2) {\r\n        // if one rect is on the left side of the other rect\r\n        if (rect2.right <= rect1.left || rect2.left >= rect1.right) {\r\n            //console.log(\"   [hasOverlap] No horz overlap\");\r\n            return false;\r\n        }\r\n\r\n        // if one rect is on top of the other\r\n        if (rect2.bottom <= rect1.top || rect2.top >= rect1.bottom) {\r\n            //console.log(\"   [hasOverlap] No vertical overlap\");\r\n            return false;\r\n        }\r\n\r\n        //console.log(\"   [hasOverlap] has overlap\");\r\n        return true;\r\n    }\r\n    \r\n    // While resizing the control, if it overlaps with other controls,\r\n    // those controls will be highlighted as potential landing spots.\r\n    checkOverlaps(resizingControlId, rectResizing, controlIds) {\r\n        //console.log(`[DEBUG][checkOverlaps][${resizingControlId}][L-R: ${rectResizing.left} - ${rectResizing.right}][T-B: ${rectResizing.top} - ${rectResizing.bottom}]`);\r\n        var foundInvalid = false;\r\n        var overlapsFound = [];\r\n        controlIds.forEach((controlId) => {       \r\n            if (resizingControlId === controlId) {\r\n                return; // continue\r\n            }\r\n            let domControl = this.findControlDomById(controlId);\r\n            if (domControl === null) {\r\n                return;\r\n            }\r\n    \r\n            let rectContainer = domControl.container.getClientRects()[0];\r\n            \r\n            //console.log(`[DEBUG][${controlId}][L-R: ${rectContainer.left} - ${rectContainer.right}][T-B: ${rectContainer.top} - ${rectContainer.bottom}]`);\r\n            let isOverlap = this.hasOverlap(rectResizing, rectContainer);\r\n            if (isOverlap) {\r\n                domControl.container.classList.add('potentialResizeDrop');\r\n                overlapsFound.push(domControl);\r\n                // Check if it's an invalid overalp (non empty control)\r\n                if (!!domControl.container.dataset.controltype || \r\n                    parseInt(domControl.container.dataset.layoutw) > 1 ||\r\n                    parseInt(domControl.container.dataset.layouth) > 1) {\r\n                    foundInvalid = true;\r\n                }\r\n            }\r\n            else if (domControl.container.classList.contains('potentialResizeDrop')) {    \r\n                domControl.container.classList.remove('potentialResizeDrop');\r\n                domControl.container.classList.remove('potentialResizeDrop-invalid');\r\n            }                    \r\n        } );\r\n\r\n        // console.log(\"Overlaps found: \", overlapsFound.length);\r\n        // If there is an invalid drop target, mark all potential drops as invalid\r\n        if (foundInvalid) {\r\n            overlapsFound.forEach(dom => {\r\n                dom.container.classList.add('potentialResizeDrop-invalid');\r\n            })\r\n        }\r\n        else {\r\n            overlapsFound.forEach(dom => {\r\n                dom.container.classList.remove('potentialResizeDrop-invalid');\r\n            })\r\n        }\r\n    }\r\n\r\n    onMouseLeave(event, controlIds) {\r\n        if (this.state.resizingControlId) {\r\n            console.log('onMouseLeave while resizing');\r\n            this.clearAllTemporaryClasses(controlIds);\r\n            this.setState({\r\n                resizingControlId: null,\r\n                // Will be set to the original height of the container at the start of resize operation\r\n                origHeight: null,\r\n                origWidth: null\r\n            });    \r\n        }\r\n    }\r\n\r\n    onResizerMouseDown(event, controlId) {\r\n        console.log('mouse down resizer...', controlId, event);\r\n        let domResizing = this.findControlDomById(controlId);\r\n        // Note: setState will cause the entire form and all the controls to rerender\r\n        this.setState({\r\n            resizingControlId: controlId,\r\n            origHeight: domResizing.container.getClientRects()[0].height,\r\n            origWidth: domResizing.container.getClientRects()[0].width,\r\n        });    \r\n    }\r\n\r\n    // Revert all class changes done during drag operation for resize\r\n    clearAllTemporaryClasses(controlIds) {\r\n        controlIds.forEach( currCtrlId => {\r\n            let domControl = this.findControlDomById(currCtrlId);\r\n            if (domControl === null) {\r\n                return;\r\n            }\r\n    \r\n            domControl.container.classList.remove('potentialResizeDrop');\r\n            domControl.container.classList.remove('potentialResizeDrop-invalid');\r\n            domControl.container.classList.remove('controlPotentialDrop');\r\n    \r\n            if (currCtrlId === this.state.resizingControlId) {\r\n                domControl.container.classList.remove('resizingControl');\r\n                domControl.content.classList.remove('resizingContent');\r\n                domControl.content.style.height = domControl.container.style.height;\r\n                domControl.content.style.width = domControl.container.style.width;    \r\n            }\r\n\r\n            domControl.placeholder.style.height = null;\r\n            domControl.placeholder.style.width = null;\r\n        });\r\n    }\r\n\r\n    // For handling resize only\r\n    onMouseUp(event, controlIds) {\r\n        if (!this.state.resizingControlId) {\r\n            this.clearAllTemporaryClasses(controlIds);\r\n            return;\r\n        }\r\n        console.log('mouseup while resizing');\r\n\r\n        // Calling setState will re-render all the controls\r\n        // But during re-render, if we manually added some classes to the DOM elements, they will still be there during rerender\r\n        // So we still to manually remove all the temprary class names we added during dragging\r\n        //this.removeAllLandingPadPotentialDrops();\r\n\r\n        // if there is an overlap with a nonempty control, do not allow it!\r\n        let formElem = document.getElementById(\"noobForm\");\r\n        let hasInvalidOverlaps = formElem.getElementsByClassName('potentialResizeDrop-invalid').length > 0;\r\n        if (hasInvalidOverlaps) {\r\n            console.log('hasInvalidOverlaps...cancelling resize operation');\r\n            this.clearAllTemporaryClasses(controlIds);\r\n            this.setState({\r\n                resizingControlId: null\r\n            });\r\n            return;\r\n        }\r\n\r\n        let newSize = this.calculateNewSize(this.state.resizingControlId);\r\n\r\n        this.clearAllTemporaryClasses(controlIds);\r\n        this.setState({\r\n            resizingControlId: null\r\n        });\r\n\r\n        // Do this check only after calling clearAllTemporaryClasses() because that is essential regardless if we resize or not\r\n        if (!newSize) {\r\n            return;\r\n        }\r\n\r\n        // Fire an action to let the redux store know that a control has been resized\r\n        let resizedControlPojo = this.findControlPojo(this.state.resizingControlId);\r\n        if (resizedControlPojo) {\r\n            resizedControlPojo.w = newSize.w;\r\n            resizedControlPojo.h = newSize.h;   \r\n            this.props.updateLayout([resizedControlPojo]); \r\n        }\r\n        else {\r\n            // it's an empty control...create and empty control with new dimension\r\n            let controlDom = document.getElementById('ctrl'+this.state.resizingControlId);\r\n            this.props.updateLayout([{\r\n                i: this.state.resizingControlId,\r\n                x: parseInt(controlDom.dataset.layoutx),\r\n                y: parseInt(controlDom.dataset.layouty),\r\n                w: newSize.w,\r\n                h: newSize.h\r\n            }]);\r\n        }\r\n        \r\n    }\r\n\r\n    findControlPojo(controlId) {\r\n        if (!this || !this.props || !this.props.controls) {            \r\n            console.log(\"findControlPojo: props is empty\");\r\n            return null;\r\n        }\r\n\r\n        let findControl = this.props.controls.find(control => control.i === controlId);\r\n        if (!findControl) {\r\n            console.log(\"findControlPojo: did not find the control with ID\", controlId); // just log it\r\n        }\r\n\r\n        return findControl;\r\n    }\r\n\r\n    // For resizing\r\n    findPotentialDrops() {\r\n        let retList = [];\r\n        // Edge does not support spread/rest operator on DOM list, so use Array.from\r\n        // retList.push(...document.getElementsByClassName(\"potentialResizeDrop\"));\r\n        // retList.push(...document.getElementsByClassName(\"landingPadPotentialDrop\"));\r\n        retList.push(...Array.from(document.getElementsByClassName(\"potentialResizeDrop\")));\r\n        retList.push(...Array.from(document.getElementsByClassName(\"landingPadPotentialDrop\")));\r\n        return retList;\r\n    }\r\n\r\n    calculateNewSize(resizingControlId) {\r\n        // check how many of the controls have the 'potentialResizeDrop' class in their DOM\r\n        if (resizingControlId === null) {\r\n            return null;\r\n        }\r\n        \r\n        console.log('[DEBUG][calculateNewSize]' + resizingControlId);\r\n    \r\n        let resizedControlDom = this.findControlDomById(resizingControlId);\r\n    \r\n        let domControls = this.findPotentialDrops();\r\n        if (!domControls || !resizedControlDom || domControls.length === 0) {\r\n            console.log('[DEBUG][calculateNewSize] Cannot find potential drops. Maybe the control was not resized');\r\n            return null; // means control was not resized\r\n        }\r\n        \r\n        let maxX = 0;\r\n        let maxY = 0;\r\n            \r\n        for (let i = 0; i < domControls.length; i++) {\r\n            let currControl = domControls[i];\r\n            let currX = parseInt(currControl.dataset.layoutx);\r\n            let currY = parseInt(currControl.dataset.layouty);\r\n            if (currX && currX > maxX) {\r\n                maxX = currX;\r\n            }\r\n            if (currY && currY > maxY) {\r\n                maxY = currY;\r\n            }\r\n        };\r\n    \r\n        return {\r\n            // no need to include rowspan. There is a validation that we can only resize (even if it's blank) if control is 1x1\r\n            w: maxX - resizedControlDom.container.dataset.layoutx + 1,\r\n            h: maxY - resizedControlDom.container.dataset.layouty + 1,\r\n        }    \r\n    }\r\n    \r\n\r\n    findControlDomById(controlId) {\r\n        let ret = {};\r\n        let keyQuery = `[id=\"ctrl${controlId}\"]`;\r\n        let retEl = document.querySelectorAll(keyQuery);\r\n        if (retEl.length !== 1) {\r\n            return null;\r\n        }\r\n    \r\n        ret.container = retEl[0];\r\n        ret.landingPad = ret.container.firstChild;\r\n        ret.content = ret.landingPad.nextSibling;\r\n        ret.placeholder = ret.content.nextSibling;\r\n        ret.resizer = ret.placeholder.nextSibling;\r\n        \r\n            \r\n        return ret;    \r\n    }\r\n\r\n    createEmptyControl(inX, inY, id) {\r\n        // Return a 1x1 control\r\n        return {\r\n            w: 1,\r\n            h: 1,\r\n            i: id,\r\n            x: inX,\r\n            y: inY\r\n        }        \r\n    }\r\n\r\n    checkDroppable(controlData, draggedItem, landingPadInfo) {\r\n        if (draggedItem.type == ControlDragTypes.CONTROL) {\r\n            if (landingPadInfo) {\r\n                return this.checkDroppableControlLandingPad(controlData, draggedItem, landingPadInfo);    \r\n            }\r\n            return this.checkDroppableControl(controlData, draggedItem);\r\n        }\r\n\r\n        return this.checkDroppableToolItem(controlData, draggedItem) \r\n    }\r\n\r\n    // This will highlight the following:\r\n    // * landing pads that are covered by the control being moved\r\n    // * neighbouring controls covered by the control being moved\r\n    // Return true or false, depending if there is sufficient space\r\n    checkDroppableControlLandingPad(droppedControl, draggedItem, landingPadInfo) {\r\n        // Actually draggedItem and droppedControl are just the same because landing pad is rendered\r\n        //console.log('checkDroppableControlLandingPad', droppedControl, draggedItem, landingPadInfo);\r\n        let retVal = true;\r\n\r\n        // [a] For the landing pads, actually just straightup highlight all landing pads that with x>= landingPadInfo.x and same for y\r\n        let landingPadX = landingPadInfo.layoutPos[\"data-layoutx\"]; // already adjusted to include control's x and y position\r\n        let landingPadY = landingPadInfo.layoutPos[\"data-layouty\"];\r\n        // debugger\r\n        let landingPadsAll = this.findLandingPadsByParentControl(droppedControl.i);\r\n        let landingPadsCovered = this.findCoveredLandingPads(landingPadsAll, landingPadX, landingPadY);\r\n\r\n        // [b] Find neighbouring empty controls to the right and bottom of the droppedControl\r\n        let controlsCovered = this.findCoveredControls(landingPadX, landingPadY, droppedControl);\r\n        if (controlsCovered.length === 0) {\r\n            // \r\n            retVal = false;\r\n        }\r\n\r\n\r\n        // [c] Perform the highlights\r\n        landingPadsAll.forEach(landingPad => {\r\n            if (landingPadsCovered.indexOf(landingPad) < 0) {\r\n                landingPad.classList.remove('landingPadPotentialDrop'); \r\n                landingPad.classList.remove('potentialResizeDrop-invalid'); \r\n            }\r\n            else {\r\n                // Mark all landing pads\r\n                if (retVal) {\r\n                    landingPad.classList.remove('potentialResizeDrop-invalid'); \r\n                    landingPad.classList.add('landingPadPotentialDrop'); \r\n                }\r\n                else {\r\n                    landingPad.classList.add('potentialResizeDrop-invalid'); \r\n                }                \r\n            }\r\n        });\r\n\r\n        controlsCovered.forEach(control => {\r\n            control.classList.add('controlPotentialDrop'); \r\n        });\r\n\r\n        // [d] Remove those that are no longer valid (highlighted green from previous call)\r\n        // Since this is not a JS Arr, use classic for-loop\r\n        let designerDom = document.getElementById('noobForm');\r\n        let potentialDropsAll = designerDom.getElementsByClassName('controlPotentialDrop');\r\n        this.removePreviousPotentialDrops(potentialDropsAll, controlsCovered);\r\n\r\n\r\n        return retVal;\r\n    }\r\n\r\n    // Neighbour controls that should be highligted while moving a control that overlaps with itself\r\n    findCoveredControls(landingPadX, landingPadY, controlData) {\r\n        let retList = [];\r\n        let deficitW = landingPadX - controlData.x;\r\n        let deficitH = landingPadY - controlData.y;\r\n        let designerDom = document.getElementById('noobForm');\r\n\r\n        // debugger\r\n        // Find all controls to the right\r\n        for (let x=0; x < deficitW; x++) {\r\n            for (let y=0; y < controlData.h; y++) {\r\n                let query = designerDom.querySelector(`div[data-layouty=\"${y + landingPadY}\"][data-layoutx=\"${x + controlData.w + controlData.x}\"]`);\r\n                if (!query || !!query.dataset.controltype) {\r\n                    return [];\r\n                }\r\n                retList.push(query);\r\n            }\r\n        }\r\n\r\n        // Find all controls to the bottom\r\n        for (let y=0; y < deficitH; y++) {\r\n            for (let x=0; x < controlData.w; x++) {\r\n                let query = designerDom.querySelector(`div[data-layouty=\"${y + controlData.h + controlData.y}\"][data-layoutx=\"${x + landingPadX}\"]`);\r\n                if (!query || !!query.dataset.controltype) {\r\n                    return [];\r\n                }\r\n                retList.push(query);\r\n            }\r\n        }\r\n        return retList;\r\n    }\r\n\r\n    // Landing pads that should be highligted while moving a control that overlaps with itself\r\n    findCoveredLandingPads(landingPadsAll, x, y) {\r\n        let retList = [];\r\n        for (let i = 0; i < landingPadsAll.length; i++) {\r\n            let currLandingPadDom = landingPadsAll[i];\r\n            if (currLandingPadDom.dataset.layoutx >= x && currLandingPadDom.dataset.layouty >= y) {\r\n                retList.push(currLandingPadDom);\r\n            }\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n    checkDroppableControl(controlData, draggedItem) {\r\n        // if dragged to itself, return false immediately.\r\n        // Do not allow dropping to same position. It's pointless and just a waste of processing.\r\n        if (controlData.i === draggedItem.i)  {\r\n            this.clearAllTemporaryClasses([controlData.i])\r\n            //console.log('checkDroppableControl, dragged to itself...return false', controlData);\r\n            return false;\r\n        }\r\n\r\n        //console.log('checkDroppableControl', controlData);\r\n\r\n        let retVal = true;\r\n        // If dragged to a different control of different dimension, do not allow\r\n        if (draggedItem.i !== controlData.i && !!controlData.ctrlType &&\r\n            (draggedItem.w !== controlData.w || draggedItem.h !== controlData.h)) {\r\n            retVal = false; // We just want to proceed removing the previous potential drops\r\n            console.log('checkDroppableControl: false agad', controlData.i);\r\n        }        \r\n\r\n        // if dragged to an empty space, make sure there is enough space\r\n        let potentialDropsNow = retVal ? this.getPotentialDropsForMoving(controlData, draggedItem) : []; \r\n        retVal = potentialDropsNow.length > 0;\r\n\r\n        // [2] Highlight the neighbours green\r\n        potentialDropsNow.forEach(dom => {dom.classList.add('controlPotentialDrop')})\r\n\r\n        // [3] Remove those that are no longer valid (highlighted green from previous call)\r\n        // Since this is not a JS Arr, use classic for-loop\r\n        let designerDom = document.getElementById('noobForm');\r\n        let potentialDropsPrevious = designerDom.getElementsByClassName('controlPotentialDrop');\r\n        this.removePreviousPotentialDrops(potentialDropsPrevious, potentialDropsNow);\r\n\r\n        return retVal;\r\n    }\r\n\r\n    // Callback triggered by the control, to check if it's OK to drop the draggedItem into the controlData\r\n    // Reason to handle highlighting @parent side: multiple cells can be hihglighted for bigger controls (minH or minW > 1)\r\n    // Checks:\r\n    // - Enough free space is available, if the control is bigger than 1x1\r\n    // - Highlights the siblings that will be potential drop targets also\r\n    // Hope this function is not too slow, as this function can be called many times during duration of Drag\r\n    // Return: true or false -- will affect the mouse cursor (handled by react dnd)\r\n    // Other functions: highlight cells green if valid. If invalid, simply returns false.\r\n    // Assumption controlData isOver() === true\r\n    // Design note: We cannot handle highlighting to red for invalids in this function because there is not way for us to 'erase' red highlights here.\r\n    // We don't need to 'erase' green highlights upon mouseUp because the reducer will be called to re-render the control.\r\n    checkDroppableToolItem(controlData, draggedItem) {\r\n        let retVal = !controlData.ctrlType; // If false, we just want to remove the previous highlights\r\n        let minH = draggedItem.minH ? draggedItem.minH : 1;\r\n        let minW = draggedItem.minW ? draggedItem.minW : 1;\r\n                \r\n        // [1] Find the siblings that are covered by minW and minH. If cannot find, means inValid Drop\r\n        // gather first and highlight only when all controls are found\r\n        let potentialDropsNow = retVal ? this.getPotentialDropsForNewItem(controlData, minW, minH) : []; \r\n\r\n        // [2] Highlight the neighbours green\r\n        potentialDropsNow.forEach(dom => {dom.classList.add('controlPotentialDrop')})\r\n        retVal = potentialDropsNow.length > 0;\r\n\r\n        // [3] Remove those that are no longer valid (highlighted green from previous call)\r\n        // Since this is not a JS Arr, use classic for-loop\r\n        let designerDom = document.getElementById('noobForm');\r\n        let potentialDropsPrevious = designerDom.getElementsByClassName('controlPotentialDrop');\r\n        this.removePreviousPotentialDrops(potentialDropsPrevious, potentialDropsNow);\r\n\r\n        return retVal;\r\n    }\r\n\r\n    // For new item, only allow dropping if ALL the cells are empty and unresized\r\n    getPotentialDropsForNewItem(controlData, draggedItemW, draggedItemH) {\r\n        let designerDom = document.getElementById('noobForm');        \r\n        \r\n\r\n        // Check first if the controlData already has the exact dimension\r\n        if (controlData.w === draggedItemW && controlData.h === draggedItemH) {\r\n            return [document.getElementById('ctrl'+controlData.i)];\r\n        }\r\n\r\n        // Find the siblings that are covered by minW and minH. If cannot find, means inValid Drop\r\n        let potentialDropsNow = []; // gather first and highlight only when all controls are found\r\n        for (let x = draggedItemW - 1; x >= 0; x--) {\r\n            for (let y = draggedItemH - 1; y >= 0; y--) {\r\n                // start with the rightmost and bottom-most; fail faster\r\n                let query = designerDom.querySelector(`div[data-layouty=\"${y + controlData.y}\"][data-layoutx=\"${x + controlData.x}\"]`);       \r\n                if (!query) {\r\n                    return [];\r\n                }\r\n\r\n                potentialDropsNow.push(query);\r\n            }\r\n        }\r\n        //console.log('getPotentialDrops', controlData.i, potentialDropsNow);\r\n        return potentialDropsNow;\r\n    }\r\n\r\n    // For moving control, it is OK to move the control that overlaps with draggedItem's current coordinates\r\n    getPotentialDropsForMoving(hoveredControlData, draggedItem) {\r\n        let designerDom = document.getElementById('noobForm');        \r\n        \r\n        // Check first if the controlData already has the exact dimension\r\n        if (hoveredControlData.w === draggedItem.w && hoveredControlData.h === draggedItem.h) {\r\n            return [document.getElementById('ctrl'+hoveredControlData.i)];\r\n        }\r\n\r\n        // Find the siblings that are covered by minW and minH. If cannot find, means inValid Drop\r\n        let rectDraggedItem = {\r\n            top: draggedItem.y, \r\n            bottom: draggedItem.y + draggedItem.h, \r\n            left: draggedItem.x, \r\n            right: draggedItem.x + draggedItem.w\r\n        };\r\n\r\n        let potentialDropsNow = []; // gather first and highlight only when all controls are found\r\n        let foundOverlapWithDraggedItem = false;\r\n        for (let x = draggedItem.w - 1; x >= 0; x--) {\r\n            for (let y = draggedItem.h - 1; y >= 0; y--) {\r\n                // start with the rightmost and bottom-most; fail faster\r\n\r\n                // Check if this coordinate is covered by the draggedItem\r\n                let rectCurr = {\r\n                    top: hoveredControlData.y + y,\r\n                    bottom: hoveredControlData.y + y + 1,\r\n                    left: hoveredControlData.x + x,\r\n                    right: hoveredControlData.x + x + 1,\r\n                }\r\n\r\n                if (this.hasOverlapStrict(rectCurr, rectDraggedItem)) {\r\n                    if (!foundOverlapWithDraggedItem) {\r\n                        let overlappedDom = document.getElementById('ctrl'+draggedItem.i);\r\n                        potentialDropsNow.push(overlappedDom);\r\n                        foundOverlapWithDraggedItem = true;\r\n                    }\r\n                    continue;\r\n                }                                \r\n\r\n                let query = designerDom.querySelector(`div[data-layouty=\"${y + hoveredControlData.y}\"][data-layoutx=\"${x + hoveredControlData.x}\"]`);       \r\n                if (!query || !!query.dataset.controltype) {\r\n                    return [];\r\n                }\r\n\r\n                potentialDropsNow.push(query);\r\n            }\r\n        }\r\n        //console.log('getPotentialDrops', controlData.i, potentialDropsNow);\r\n        return potentialDropsNow;\r\n    }\r\n\r\n    removePreviousPotentialDrops(potentialDropsPrevious, potentialDropsNow) {\r\n        for (var i = 0; i < potentialDropsPrevious.length; i++) {\r\n            let prev = potentialDropsPrevious[i];\r\n            if (potentialDropsNow.indexOf(prev) >= 0) {\r\n                continue;\r\n            }\r\n            prev.classList.remove('controlPotentialDrop');\r\n        }\r\n    }\r\n\r\n    onDropControl(ctrlDest, itemDropped, landingPadPos) {\r\n        \r\n        if (itemDropped.type === 'toolItem') {\r\n            this.handleToolItemDrop(ctrlDest, itemDropped);\r\n        }\r\n        else if (landingPadPos) {\r\n            this.handleControlMoveWithLandingPad(ctrlDest, itemDropped, landingPadPos);\r\n        }\r\n        else {\r\n            this.handleControlMove(ctrlDest, itemDropped);\r\n        }\r\n\r\n        // Clear the temp classes of ctrlDest\r\n        this.clearAllTemporaryClasses([ctrlDest.i, itemDropped.i]);\r\n    }\r\n\r\n    handleControlMoveWithLandingPad(ctrlDest, itemDropped, landingPadPos) {\r\n        // ctrlDest and itemDropped are expected to be the same\r\n        console.log('handleControlMoveWithLandingPad', ctrlDest, itemDropped, landingPadPos);\r\n        let landingPadX = landingPadPos['data-layoutx'];\r\n        let landingPadY = landingPadPos['data-layouty'];\r\n\r\n        let updatedControl = {\r\n            ...ctrlDest,\r\n            x: landingPadX,\r\n            y: landingPadY\r\n        }\r\n\r\n        this.props.updateLayout([updatedControl]); \r\n    }\r\n\r\n    handleToolItemDrop(ctrlDest, itemDropped) {\r\n        console.log('handleToolItemDrop', ctrlDest, itemDropped);\r\n        let newDate = new Date();\r\n        // Fire an action to let the redux store know that a control has been added\r\n        this.props.updateLayout([{\r\n            i: ctrlDest.i + newDate.toString(),  // TODO: Generate an ID in reducer\r\n            ctrlType: itemDropped.toolItemTypeName,\r\n            x: ctrlDest.x,\r\n            y: ctrlDest.y,\r\n            w: !!itemDropped.minW ? itemDropped.minW : 1,\r\n            h: !!itemDropped.minH ? itemDropped.minH : 1,\r\n        }]); \r\n    }\r\n\r\n    handleControlMove(ctrlDest, itemDropped) {\r\n        console.log('handleControlDrop', ctrlDest, itemDropped);\r\n        // Fire an action to let the redux store know that a control has been added\r\n        let updatedControls = [];\r\n        let itemDroppedNew = {\r\n            ...itemDropped,\r\n            x: ctrlDest.x,\r\n            y: ctrlDest.y,\r\n        };\r\n        updatedControls.push(itemDroppedNew);\r\n\r\n        if (!!ctrlDest.ctrlType) {\r\n            let ctrlDestNew = {\r\n                ...ctrlDest,\r\n                x: itemDropped.x,\r\n                y: itemDropped.y\r\n            }\r\n            updatedControls.push(ctrlDestNew);\r\n        }\r\n\r\n        this.props.updateLayout(updatedControls); \r\n    }\r\n\r\n    renderControl(control, containerWidth, numCols) {\r\n        return <NoobControl \r\n                key={'ctrl'+control.i} \r\n                controlData={{...control}}\r\n                parentDropCallback={this.onDropControl}\r\n                resizerMouseDown={this.onResizerMouseDown}\r\n                resizingControlId={this.state.resizingControlId}\r\n                parentCheckDroppable={this.checkDroppable}\r\n                isSelected={false}\r\n                containerWidth={containerWidth}\r\n                numCols={numCols}/>\r\n    }\r\n\r\n    // Returns an array containing the flat coordinates of the specified control\r\n    // E.g. Control is x:0, y:0, w:3, h:2, layoutWidth:10\r\n    // return: [0,   1,  2,         --> first row\r\n    //          10, 11, 12]         --> second row\r\n    getFills(control, layoutWidth) {\r\n        let retList = [];\r\n        for (var iRow = 0; iRow < control.h; iRow++) {\r\n            for (var iCol = 0; iCol < control.w; iCol++) {\r\n                \r\n                let adjustedX = iCol + control.x; \r\n                let adjustedY = iRow + control.y;\r\n                retList.push(adjustedY * layoutWidth + adjustedX);\r\n            }\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n\r\n    renderControlsWithLayout(layoutData, controls, containerWidth) {\r\n        let retList = [];  \r\n        let fillMap = [];\r\n        for (var iRow = 0; iRow < layoutData.rows; iRow++) {\r\n            for (var iCol = 0; iCol < layoutData.columns; iCol++) {            \r\n                let flatCoord = iRow * layoutData.columns + iCol;\r\n                // if coordinate already filled, skip\r\n                if (fillMap.find(n => n === flatCoord)) {\r\n                    continue;\r\n                }\r\n\r\n                // try to find if there is a control associated\r\n                // otherwise just render an empty control\r\n                let findControl = controls.find(ctrl => ctrl.x == iCol && ctrl.y == iRow );\r\n                if (!findControl) {\r\n                    let emptyControlPojo = this.createEmptyControl(iCol, iRow, flatCoord); // plain old JS obj\r\n                    let emptyControlJsx = this.renderControl(emptyControlPojo, containerWidth, layoutData.columns);\r\n                    retList.push({\r\n                        id: emptyControlPojo.i,\r\n                        jsx: emptyControlJsx\r\n                    });                    \r\n                }\r\n                else {\r\n                    //retList.push(this.renderControl(findControl));\r\n                    console.log('renderControlsWithLayout', findControl.i, findControl.x, findControl.y, findControl.w, findControl.h);\r\n                    let controlJsx = this.renderControl(findControl, containerWidth, layoutData.columns);\r\n                    retList.push({\r\n                        id: findControl.i,\r\n                        jsx: controlJsx\r\n                    });\r\n                    let newFills = this.getFills(findControl, layoutData.columns)\r\n                    fillMap = fillMap.concat(newFills);\r\n                }\r\n            }\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n    renderControlsAsSingleCol(layoutData, controls, containerWidth) {\r\n        let retList = [];\r\n        // We still need the for-loops so that the controls are sorted from top-left to bottom right\r\n        for (var iRow = 0; iRow < layoutData.rows; iRow++) {\r\n            for (var iCol = 0; iCol < layoutData.columns; iCol++) {            \r\n                let flatCoord = iRow * layoutData.columns + iCol;\r\n                // try to find if there is a control associated\r\n                // otherwise just render an empty control\r\n                let findControl = controls.find(ctrl => ctrl.x == iCol && ctrl.y == iRow );\r\n                if (!findControl) {\r\n                    continue;\r\n                }\r\n                else {\r\n                    // pass in null as the containerWidth, to indicate that we don't want to display as grid\r\n                    let controlJsx = this.renderControl(findControl, containerWidth, 1);\r\n                    retList.push({\r\n                        id: findControl.i,\r\n                        jsx: controlJsx\r\n                    });\r\n                }\r\n            }\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n    renderControls(layoutData, controls, containerWidth) {\r\n        // debugger\r\n        // For retlist: we don't use object (KV pair) beacause we need to render them according to the order we pushed them to the list.\r\n        // Retrieving the keys or values via Object.keys()/Object.values() do not come in the order that they were set\r\n        if (containerWidth > WIDTH_LARGE) {\r\n            return this.renderControlsWithLayout(layoutData, controls, containerWidth);\r\n        }\r\n        else {\r\n            return this.renderControlsAsSingleCol(layoutData, controls, containerWidth);\r\n        }\r\n    }\r\n\r\n    render() {\r\n        console.log('render NoobForm...', this.props.selectedPage);\r\n        let {controls, layoutData} = this.props;\r\n        let controlsList = this.renderControls(layoutData, controls, this.props.containerWidth);\r\n        let controlIds = controlsList.map(c => c.id);\r\n        let controlsJsx = controlsList.map(c => c.jsx);\r\n    \r\n        var divStyle = this.props.containerWidth > WIDTH_LARGE ?\r\n        {'gridTemplateColumns': `repeat(${layoutData.columns}, 1fr)`} : \r\n        {'gridTemplateColumns': '1fr'};\r\n\r\n        let classNames = \"noobForm \";\r\n        if (this.props.selectedPage) {\r\n            classNames += \"page-selected\";\r\n        }\r\n    \r\n        return (\r\n        <div id=\"noobForm\"\r\n            className={classNames}\r\n            onMouseLeave={(e) => {this.onMouseLeave(e, controlIds)}}\r\n\r\n            onMouseUp={(e) => {this.onMouseUp(e, controlIds)}}\r\n            onTouchEnd={(e) => {this.onMouseUp(e, controlIds)}}\r\n\r\n            onMouseMove={(e) => {this.onMouseMove(e, controlIds)}}\r\n            onTouchMove={(e) => {this.onMouseMove(e, controlIds)}}\r\n\r\n            //onMouseDown={(e) => {console.log('[noobForm] MouseDown')}}\r\n            style={divStyle}>\r\n            {controlsJsx}            \r\n        </div>    \r\n        );    \r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        selectedPage: state.designer.pageSelected,\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return bindActionCreators({ updateLayout }, dispatch);\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(NoobForm);","export const WIDTH_LARGE = 600;\r\nexport const NAME_CONTROL_ID = 'controlId'\r\nexport const NAME_CONTROL_TYPE = 'controlType'","import React, { Component } from 'react';\r\nimport {ControlDragTypes} from './noobControlContent';\r\nimport { useDrop } from 'react-dnd';\r\nimport './noobForm.css';\r\n\r\nconst LandingPads = ({controlData, resizingControlId, droppingItemType, droppingItem, \r\n                    noobControlCanDropCallback, noobControlDropCallback}) => {\r\n    // If this control is not resizing, no need to render the landing pads\r\n    if (resizingControlId !== controlData.i && droppingItemType !== ControlDragTypes.CONTROL) {\r\n        return null;\r\n    }\r\n\r\n    // If this control is not moving, no need to render the landing pads also\r\n    // If dropping a control, and it's not the same as the dragged control, no need to render also\r\n    if (droppingItemType === ControlDragTypes.CONTROL && controlData.i !== droppingItem.i) {\r\n        return null\r\n    }\r\n\r\n    console.log('renderLandingPads for ', controlData);\r\n\r\n    let landingPadStyle = {\r\n        gridTemplateColumns: `repeat(${controlData.w}, 1fr)`,\r\n        gridTemplateRows: `repeat(${controlData.h}, 1fr)`,\r\n    }\r\n\r\n    return (<div className=\"landingPadContainer\" style={landingPadStyle}>\r\n        {createLandingPads(controlData, noobControlCanDropCallback, noobControlDropCallback)}\r\n    </div>)\r\n}\r\n\r\n// Create a landing pad to allow the user to reduce the size of the control\r\n//function createLandingPads(rowSpan, colSpan, domParentCtrlId, parentX, parentY) {\r\nfunction createLandingPads(controlData, noobControlCanDropCallback, noobControlDropCallback) {    \r\n    let retList = [];\r\n    for (let i=0; i < controlData.h; i++) {\r\n        for (let j=0; j < controlData.w; j++) {\r\n            let layoutPos = {\r\n                'data-layoutx': j + controlData.x,\r\n                'data-layouty': i + controlData.y,\r\n            }\r\n            retList.push(<LandingPad \r\n                domParentCtrlId={'ctrl'+controlData.i}\r\n                layoutPos={layoutPos}\r\n                key={\"landingpadcontainer\"+(i * controlData.w + j)}\r\n                keyLandingPad={\"landingpad\"+(i * controlData.w + j)}\r\n                canDropParentCallback={noobControlCanDropCallback}\r\n                dropParentCallback={noobControlDropCallback}\r\n            />);\r\n        }\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\nconst canDropInLandingPad = (draggedItem, monitor, keyLandingPad, layoutPosIn, canDropCallback) => {\r\n    // Note: this function will be called for each mouse movement, so make sure this is efficient\r\n    // But, unless there is a change in the value, there won't be a re-render.\r\n    //console.log('canDropMe', controlData, draggedItem.type, draggedItem.minW, draggedItem.minH);\r\n    if (!monitor.isOver()) {\r\n        return false;\r\n    }\r\n\r\n    let landingPadInfo = {\r\n        key: keyLandingPad,\r\n        layoutPos: layoutPosIn\r\n    }\r\n\r\n    return canDropCallback(draggedItem, landingPadInfo);\r\n}\r\n\r\n// need a try-catch because inside monitor.canDrop(), it is trying to find the DOM ID first\r\n// however, the monitor function is still being fired even if the element is no longer rendered\r\n// -> The landing pads are only rendered during resizing or moving.\r\n//    No issue with resizing since everything is implemented manually\r\n//    But for moving, the dom id is required by react-dnd\r\nconst canDropCollectHandler = (monitor, keyLandingPad) => {\r\n    //console.log('[collect] canDrop for landingPad', keyLandingPad, 'already dropped:', monitor.didDrop());\r\n    let retVal = false;\r\n    try {\r\n        return !!monitor.canDrop();\r\n    }\r\n    catch(ex) {\r\n        console.log('[collect] canDrop landingPad exception for (note: this exception is expected)', keyLandingPad, 'exception:', ex.name, ex.message);\r\n    }\r\n    return false;\r\n}\r\n\r\nconst LandingPad = ({domParentCtrlId, layoutPos, keyLandingPad, canDropParentCallback, dropParentCallback}) => {\r\n\r\n    //console.log('render LandingPad for ', keyLandingPad);\r\n    const [{ isOver, canDrop}, drop] = useDrop({\r\n        accept: [ControlDragTypes.CONTROL],\r\n        canDrop: (item, monitor) => canDropInLandingPad(item, monitor, keyLandingPad, layoutPos, canDropParentCallback),\r\n        drop: (droppedItem) => dropParentCallback(droppedItem, layoutPos),\r\n        collect: monitor => ({\r\n            // these are the fields that will be added to the component's props/state\r\n            // downside is that it needs to execute the function\r\n            isOver: !!monitor.isOver({ shallow: true }),\r\n            //canDrop: !!monitor.canDrop(),            \r\n            canDrop: canDropCollectHandler(monitor, keyLandingPad),\r\n\t\t}),\r\n    });\r\n\r\n    const styles = {}        \r\n    \r\n    if (isOver) {\r\n        if (!canDrop) {\r\n            styles.backgroundColor = 'red';\r\n        }\r\n    }\r\n\r\n    return <div className=\"landingPadCell\" \r\n        parentctrlid={domParentCtrlId} \r\n        key={keyLandingPad}\r\n        ref={drop}\r\n        style={styles}\r\n        {...layoutPos}>\r\n    </div>\r\n}\r\n\r\nexport default LandingPads;","import React from 'react'\r\nimport { Button, Header, Image, Modal } from 'semantic-ui-react'\r\nimport './editDialog.css';\r\n\r\nconst modalStyle = {\r\n    \r\n  }\r\n\r\nclass EditDialog extends React.Component {\r\n\r\n    render() {\r\n        let {controlInfo} = this.props;\r\n        return (<Modal \r\n            closeIcon={true}\r\n            closeOnDimmerClick={true}\r\n            trigger={<i className=\"ui icon cog editBtn\" style={modalStyle}></i>}>\r\n            <Modal.Header>Edit Control Dialog for {controlInfo.i}</Modal.Header>\r\n            <Modal.Content>\r\n            <Modal.Description>\r\n                <Header>Under Construction...</Header>\r\n                <p>\r\n                Will be available soon\r\n                </p>    \r\n            </Modal.Description>\r\n            </Modal.Content>\r\n        </Modal>)\r\n    }\r\n}\r\nexport default EditDialog\r\n","import React, { Component } from 'react';\r\nimport NoobForm from './noobForm';\r\nimport { ToolItemDragTypes } from './toolItem';\r\nimport { useDrop } from 'react-dnd';\r\nimport NoobControlContent, {ControlDragTypes} from './noobControlContent';\r\nimport LandingPads from './noobControlLandingPad';\r\n\r\nimport {connect} from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\n\r\nimport {selectedControl} from '../actions/index';\r\nimport EditDialog from './editDialog';\r\n\r\n\r\nexport const ROW_HEIGHT = 40;\r\nconst CONTROL_PADDING = 20;\r\nconst GRID_GAP = 5;\r\n\r\n\r\nconst handleControlSelect = (controlData) => {\r\n    console.log('controlSelected, dispatch action...', this);\r\n    selectedControl(controlData.i);\r\n}\r\n\r\nconst canDropMe = (controlData, draggedItem, monitor, parentCheckDroppable) => {\r\n    // Note: this function will be called for each mouse movement, so make sure this is efficient\r\n    // But, unless there is a change in the value, there won't be a re-render.\r\n    //console.log('canDropMe', controlData, draggedItem.type, draggedItem.minW, draggedItem.minH);\r\n    if (!monitor.isOver({shallow: true})) {\r\n        //console.log('canDropMe...not over...return false');\r\n        return false;\r\n    }\r\n    //console.log('canDropMe', controlData, draggedItem.type, monitor.isOver());\r\n    let canDrop = parentCheckDroppable(controlData, draggedItem);\r\n    return canDrop;\r\n}\r\n\r\nconst renderResizer = (controlId, onResizerMouseDown) => {\r\n    return (<div \r\n            className=\"resizer\" \r\n            id={\"ctrlResizer\" + controlId}\r\n            onMouseDown={(e) => {  \r\n                // This event is being called first before the Drag on the control starts\r\n                // Call preventDefault to disable moving of the control\r\n                // Resizing is given a higher priority since it covers a very small area\r\n                onResizerMouseDown(e, controlId);\r\n                e.preventDefault();\r\n            }}\r\n            onTouchStart={\r\n                (e) => {  \r\n                    // This event is being called first before the Drag on the control starts\r\n                    // Call preventDefault to disable moving of the control\r\n                    // Resizing is given a higher priority since it covers a very small area\r\n                    onResizerMouseDown(e, controlId);\r\n                    e.preventDefault();\r\n                }\r\n            }\r\n            ></div>\r\n        );\r\n}\r\n\r\nconst NoobControl = ({controlData, resizerMouseDown, resizingControlId, \r\n                    parentCheckDroppable, parentDropCallback,\r\n                    selectedControl, containerWidth, numCols}) => {\r\n    \r\n    // [a] Hooks setup for drop\r\n    const [{ isOverShallow, canDrop, droppingItemType, droppingItem }, drop] = useDrop({\r\n        accept: [ToolItemDragTypes.TOOLITEM, ControlDragTypes.CONTROL],\r\n        canDrop: (item, monitor) => canDropMe(controlData, item, monitor, parentCheckDroppable),\r\n        drop: (droppedItem) => parentDropCallback(controlData, droppedItem),\r\n        collect: monitor => ({\r\n            // these are the fields that will be added to the component's props/state\r\n            // downside is that it needs to execute the function\r\n            //isOver: !!monitor.isOver(),\r\n            isOverShallow: !!monitor.isOver({ shallow: true }), // shallow: true means it will give way to landing pads (children)\r\n            canDrop: !!monitor.canDrop(),\r\n            // Add checking first. Without checking, once an item in toolbox starts dragging, all controls will rerender\r\n            //droppingItemType: !!monitor.isOver() && !!monitor.canDrop() ? monitor.getItemType() : null\r\n            droppingItemType: !!monitor.isOver() ? monitor.getItemType() : null,\r\n            droppingItem: !!monitor.isOver() ? monitor.getItem() : null,\r\n\t\t}),\r\n      });\r\n\r\n    //console.log('render NoobControl', controlData.i, isOverShallow, canDrop, droppingItemType);\r\n    //console.log('render NoobControl', controlData.i, controlData.x, controlData.y, controlData.w, controlData.h);\r\n    \r\n\r\n    // [b] Preparations\r\n    let classNames = 'noobControl';\r\n    let ctrlStyle = {\r\n        // set the minHeight instead of height. Height will make the height fixed regardless of the content.\r\n        // minHeight allows the parent container to grow depending on content\r\n        //'minHeight': (ROW_HEIGHT * controlData.h) + (CONTROL_PADDING * (controlData.h - 1)) + (GRID_GAP * (controlData.h - 1)), \r\n        // Maybe no need to include padding and grid gap\r\n        'minHeight': (ROW_HEIGHT * controlData.h), \r\n    }\r\n    // [b1] - Normal desktop size layout\r\n    if (numCols > 1) {\r\n        let usableWidth = containerWidth-20; // 20 for the noobform left and right padding of 10 each\r\n        let widthOfCtrl = usableWidth * controlData.w / 12.0 -5; // 12 is the number of columns; minus 5 for the grid gap\r\n        ctrlStyle.gridRowEnd = 'span ' + controlData.h;\r\n        ctrlStyle.gridColumnEnd = 'span ' + controlData.w;\r\n        if (!document.URL.toLowerCase().includes('reporting')) {\r\n            ctrlStyle.maxWidth = `${widthOfCtrl}px`; \r\n        }\r\n    }\r\n    // [b2] - Show as single column if containerWidth is null (if container size is too small, null is passed)\r\n    else {\r\n        ctrlStyle.maxWidth = `${containerWidth-20 - 5}px`; \r\n    }\r\n\r\n    // Highlighting to green is handled in noobForm. Highlighting to pink is handled here because if !canDrop, the mouseUp event was prevented by React Dnd.\r\n    if (isOverShallow && !canDrop) {\r\n        ctrlStyle.backgroundColor = 'pink';\r\n    }\r\n\r\n    // access these in Javascript by x.dataset.layoutx (Note: all lowercase - javascript/html rule)\r\n    // Purpose: convenience when processing resize operations\r\n    let layoutPos = {\r\n        'data-layoutx': controlData.x,\r\n        'data-layouty': controlData.y,\r\n        'data-layouth': controlData.h,\r\n        'data-layoutw': controlData.w,\r\n        'data-controltype': controlData.ctrlType,\r\n    }\r\n    let domCtrlId = \"ctrl\"+controlData.i;\r\n\r\n    console.log('render NoobControl', controlData.i, ctrlStyle.maxWidth, \"containerWidth\", containerWidth);\r\n    \r\n    // [c] Render:\r\n    // [c.1] return the landing pad first, which is only shown when the control is being resized\r\n    // [c.2] followed by the content\r\n    // [c.3] followed by the placeholder which will only be visible during resizing. Purpose is maintain the original size of the container while resizing.\r\n    // [c.4] followed by the small resizer.\r\n    // [c.5] followed by the settings button\r\n    //       This order must be followed to avoid the need for z-index\r\n    return <div id={domCtrlId}\r\n            className={classNames} \r\n            style={ctrlStyle}\r\n            ref={drop}\r\n            onMouseUp={() => {console.log('onMouseUp control level')}}\r\n            {...layoutPos}\r\n            >\r\n        {/* {renderLandingPads(controlData, resizingControlId, droppingItemType)} */}\r\n        <LandingPads \r\n            controlData={controlData}\r\n            resizingControlId={resizingControlId}\r\n            droppingItemType={droppingItemType}\r\n            droppingItem={droppingItem}\r\n            noobControlCanDropCallback={(draggedItem, landingPadInfo) => {\r\n                return parentCheckDroppable(controlData, draggedItem, landingPadInfo)\r\n            }}\r\n            noobControlDropCallback={(droppedItem, landingPadPos) => {\r\n                parentDropCallback(controlData, droppedItem, landingPadPos)\r\n            }}\r\n        />\r\n        <NoobControlContent \r\n            controlSelected={() => selectedControl(controlData.i)}            \r\n            {...controlData} \r\n            maxWidth={ctrlStyle.maxWidth}\r\n        />\r\n        <div className=\"resizePlaceholder\"></div>      \r\n        {renderResizer(controlData.i, resizerMouseDown)}  \r\n        {/* {controlData.ctrlType && <EditDialog controlInfo={controlData}/>}                         */}\r\n    </div>\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    let myId = ownProps.controlData.i;\r\n    let stateControlData = state.designer && state.designer.layout && state.designer.layout.find(control => control.i === myId);\r\n    if (stateControlData) {\r\n        return {\r\n            //isSelected: stateControlData.selected\r\n            controlData: stateControlData\r\n        };    \r\n    }\r\n\r\n    return {};\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return bindActionCreators({ selectedControl }, dispatch);\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(NoobControl);","import React, {useRef, useEffect} from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport {Gauge as CanvasGauge, Donut, TextRenderer} from 'gaugeJS/dist/gauge.min';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport './gauge.css';\r\nimport {ROW_HEIGHT} from '../components/noobControl';\r\n\r\n//https://github.com/keanemind/react-gaugejs/blob/master/Gauge.js\r\n/**\r\n * React wrapper for GaugeJS.\r\n * @param {*} props\r\n * @return {Object} React element\r\n */\r\nfunction Gauge(props) {\r\n  const canvas = useRef();\r\n  const span = useRef();\r\n  const gauge = useRef();\r\n\r\n  useEffect(() => {\r\n    // Observe the span node\r\n    const config = {\r\n      characterData: true,\r\n      attributes: true,\r\n      childList: true,\r\n      subtree: true,\r\n    };\r\n    const observer = new MutationObserver((mutationsList, observer) => {\r\n      props.textChangeHandler(span.current.innerText);\r\n    });\r\n    observer.observe(span.current, config);\r\n\r\n    // var textRenderer = new TextRenderer(document.getElementById('preview-textfield'))\r\n    // textRenderer.render = function(gauge){\r\n    //   var percentage = gauge.displayedValue / gauge.maxValue;\r\n    //   this.el.innerHTML = (percentage * 100).toFixed(2) + \"%\"\r\n    //   debugger\r\n      \r\n    // };\r\n    // gauge.current.setTextField(textRenderer);\r\n\r\n    return () => {\r\n      observer.disconnect();\r\n    };\r\n  }, []); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    gauge.current = (\r\n      props.donut ? new Donut(canvas.current) : new CanvasGauge(canvas.current)\r\n    );\r\n    gauge.current.setTextField(span.current);\r\n    gauge.current.setOptions(props.options);\r\n    gauge.current.maxValue = props.maxValue;\r\n    gauge.current.setMinValue(props.minValue);\r\n    gauge.current.animationSpeed = props.animationSpeed;\r\n    gauge.current.set(props.value);\r\n  }, [props.donut]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    gauge.current.setOptions(props.options);\r\n  }, [props.options]);\r\n\r\n  useEffect(() => {\r\n    gauge.current.maxValue = props.maxValue;\r\n  }, [props.maxValue]);\r\n\r\n  useEffect(() => {\r\n    gauge.current.setMinValue(props.minValue);\r\n  }, [props.minValue]);\r\n\r\n  useEffect(() => {\r\n    gauge.current.animationSpeed = props.animationSpeed;\r\n  }, [props.animationSpeed]);\r\n\r\n  useEffect(() => {\r\n    gauge.current.set(props.data.percent);\r\n\r\n    // To allow decimal values on the label\r\n    var textRenderer = new TextRenderer(span.current)\r\n    textRenderer.render = function(gauge){\r\n      var percentage = gauge.displayedValue / gauge.maxValue;\r\n      this.el.innerHTML = (percentage * 100).toFixed(2) + \"%\"\r\n      \r\n    };\r\n    gauge.current.setTextField(textRenderer);\r\n\r\n  }, [props.data.percent]);\r\n\r\n  /* eslint-disable no-unused-vars */\r\n  const {\r\n    maxValue,\r\n    minValue,\r\n    animationSpeed,\r\n    options,\r\n    donut,\r\n    value,\r\n    textChangeHandler,\r\n    ...passThroughProps\r\n  } = props;\r\n  /* eslint-enable no-unused-vars */\r\n\r\n  let classNames = 'gauge';\r\n  if (props.selected === true) {\r\n      classNames += ' ctrl-selected'\r\n  }\r\n\r\n  // aspect ratio of w:h is 2:1\r\n  // We compute the height based on the number of rows allocated (default height only)\r\n  // then we compute the width\r\n  let height = props.h * ROW_HEIGHT - 50; // subtract 50 for the gauge size\r\n  let width = height*2;\r\n  if (props.maxWidth) {\r\n    let maxWidth = parseInt(props.maxWidth);\r\n    if (width > maxWidth) {\r\n      width = maxWidth;\r\n      height = width / 2;\r\n    }\r\n  }\r\n  \r\n  let heightPx = `${height}px`; // subtract 50 for the gauge size\r\n  let widthPx = `${height*2}px`;\r\n\r\n  // TODO: Ruined the web resizing after fixing the report alignment/sizing\r\n  // Separate the function for web/reporting if necessary\r\n  // Another issue: the gauge canvas does not appear if the gauge is not visible during the time it was rendered (e.g. default tab is not forms designer)\r\n  // Might not need to fix since there won't be any gauge in the default layout\r\n  return (\r\n    <div className={classNames}>\r\n      <div className=\"controlLabel\">{props.data.label}</div>\r\n      <div className=\"gauge-svgContainer\">\r\n      <div className=\"gauge-svgContainer2\">\r\n        <canvas ref={canvas} style={{width:widthPx, height: heightPx}} className=\"canvas-preview\" ></canvas>\r\n        <div ref={span} className=\"preview-textfield gauge-label\"></div>\r\n      </div>      \r\n      </div>      \r\n    </div>\r\n  );\r\n}\r\n\r\nGauge.defaultProps = {\r\n  maxValue: 100,\r\n  minValue: 0,\r\n  animationSpeed: 100000,\r\n  options: {\r\n    angle: 0.0,\r\n    lineWidth: 0.15,\r\n    radiusScale: 0.9,\r\n    pointer: {\r\n      length: 0.5,\r\n      strokeWidth: 0.05,\r\n      color: 'black',\r\n    },\r\n    limitMax: false,\r\n    limitMin: false,\r\n    // colorStart: 'red',\r\n    // colorStop: 'green',\r\n    strokeColor: '#ff0000',\r\n    generateGradient: true,\r\n    highDpiSupport: true,\r\n    staticZones: [\r\n      {strokeStyle: \"red\", min: 0, max: 20}, // Red from 100 to 130\r\n      {strokeStyle: \"gold\", min: 20, max: 80}, // Yellow\r\n      {strokeStyle: \"green\", min: 80, max: 100}, // Green\r\n    ],  \r\n    // These are the small labels around the gauge\r\n    staticLabels: {\r\n      font: \"15px\",  // Specifies font\r\n      labels: [0, 20, 80, 100],  // Print labels at these values\r\n      color: \"#000000\",  // Optional: Label text color\r\n      fractionDigits: 0  // Optional: Numerical precision. 0=round off.\r\n    },\r\n    fractionDigits: 2\r\n  },\r\n  donut: false,\r\n  textChangeHandler: () => {},\r\n  value: 85.5, // Do not set to 0...bug in the library...will render a small dot on upper left corner. set to a very small number instead like 0.0001\r\n};\r\n\r\nGauge.propTypes = {\r\n  maxValue: PropTypes.number.isRequired,\r\n  minValue: PropTypes.number.isRequired,\r\n  animationSpeed: PropTypes.number.isRequired,\r\n  options: PropTypes.object.isRequired,\r\n  donut: PropTypes.bool.isRequired,\r\n  value: PropTypes.number.isRequired,\r\n  textChangeHandler: PropTypes.func.isRequired,\r\n};\r\n\r\nexport default noobControlHoc(Gauge);","import React from 'react';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\n\r\nconst PageBreak = (props) => {\r\n    let classNames = props.selected === true ? 'ctrl-selected' : '';\r\n    return <div style={{width: '100%', height: '100%', backgroundColor: 'lightyellow'}} className={classNames}\r\n    />\r\n}\r\n\r\nexport default noobControlHoc(PageBreak);","// taken from react-image-mapper\r\n// Reason why we ported the entire source code: Hover does not work in Edge\r\n// https://github.com/coldiary/react-image-mapper/issues/36\r\n// Basically, just change mouseEnter and mouseLeave with mouseHover and mouseOut\r\n// We can switch back to the npm module once the issue is fixed\r\n\r\nimport React, { Component } from \"react\";\r\nimport PropTypes from \"prop-types\";\r\nimport isEqual from \"react-fast-compare\";\r\n\r\nexport default class ImageMapper extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\t[\r\n\t\t\t\"drawrect\",\r\n\t\t\t\"drawcircle\",\r\n\t\t\t\"drawpoly\",\r\n\t\t\t\"initCanvas\",\r\n\t\t\t\"renderPrefilledAreas\"\r\n\t\t].forEach(f => (this[f] = this[f].bind(this)));\r\n\t\tlet absPos = { position: \"absolute\", top: 0, left: 0 };\r\n\t\tthis.styles = {\r\n\t\t\tcontainer: { position: \"relative\" },\r\n\t\t\tcanvas: { ...absPos, pointerEvents: \"none\", zIndex: 2 },\r\n\t\t\t// [Ray] Remove the z-index, so that the resizer can be visible\r\n\t\t\t//img: { ...absPos, zIndex: 1, userSelect: \"none\" },\r\n\t\t\timg: { ...absPos, zIndex: 1, userSelect: \"none\" },\r\n\t\t\tmap: (props.onClick && { cursor: \"pointer\" }) || undefined\r\n\t\t};\r\n\t\t// Props watched for changes to trigger update\r\n\t\tthis.watchedProps = [\r\n\t\t\t\"active\",\r\n\t\t\t\"fillColor\",\r\n\t\t\t\"height\",\r\n\t\t\t\"imgWidth\",\r\n\t\t\t\"lineWidth\",\r\n\t\t\t\"src\",\r\n\t\t\t\"strokeColor\",\r\n\t\t\t\"width\"\r\n\t\t];\r\n\t}\r\n\r\n\tshouldComponentUpdate(nextProps) {\r\n\t\tconst propChanged = this.watchedProps.some(\r\n\t\t\tprop => this.props[prop] !== nextProps[prop]\r\n\t\t);\r\n\r\n\t\t//return !isEqual(this.props.map, this.state.map) || propChanged;\r\n\t\treturn !isEqual(this.props.map, this.state.map) || \r\n\t\t\t\tpropChanged ||\r\n\t\t\t\t!isEqual(this.props.map.name, nextProps.map.name) ||\r\n\t\t\t\t!isEqual(this.props.map.areas, nextProps.map.areas);\r\n\t}\r\n\r\n\tcomponentWillMount() {\r\n\t\tthis.updateCacheMap();\r\n\t}\r\n\r\n\tupdateCacheMap() {\r\n\t\tthis.setState(\r\n\t\t\t{ map: JSON.parse(JSON.stringify(this.props.map)) },\r\n\t\t\tthis.initCanvas\r\n\t\t);\r\n\t}\r\n\r\n\tcomponentDidUpdate() {\r\n\t\tthis.updateCacheMap();\r\n\t\tthis.initCanvas();\r\n\t}\r\n\r\n\tdrawrect(coords, fillColor, lineWidth, strokeColor) {\r\n\t\tlet [left, top, right, bot] = coords;\r\n\t\tthis.ctx.fillStyle = fillColor;\r\n\t\tthis.ctx.lineWidth = lineWidth;\r\n\t\tthis.ctx.strokeStyle = strokeColor;\r\n\t\tthis.ctx.strokeRect(left, top, right - left, bot - top);\r\n\t\tthis.ctx.fillRect(left, top, right - left, bot - top);\r\n\t\tthis.ctx.fillStyle = this.props.fillColor;\r\n\t}\r\n\r\n\tdrawcircle(coords, fillColor, lineWidth, strokeColor) {\r\n\t\tthis.ctx.fillStyle = fillColor;\r\n\t\tthis.ctx.beginPath();\r\n\t\tthis.ctx.lineWidth = lineWidth;\r\n\t\tthis.ctx.strokeStyle = strokeColor;\r\n\t\tthis.ctx.arc(coords[0], coords[1], coords[2], 0, 2 * Math.PI);\r\n\t\tthis.ctx.closePath();\r\n\t\tthis.ctx.stroke();\r\n\t\tthis.ctx.fill();\r\n\t\tthis.ctx.fillStyle = this.props.fillColor;\r\n\t}\r\n\r\n\tdrawpoly(coords, fillColor, lineWidth, strokeColor) {\r\n\t\tcoords = coords.reduce(\r\n\t\t\t(a, v, i, s) => (i % 2 ? a : [...a, s.slice(i, i + 2)]),\r\n\t\t\t[]\r\n\t\t);\r\n\t\t\r\n\t\tthis.ctx.fillStyle = fillColor;\r\n\t\tthis.ctx.beginPath();\r\n\t\tthis.ctx.lineWidth = lineWidth;\r\n\t\tthis.ctx.strokeStyle = strokeColor;\r\n\t\tlet first = coords.unshift();\r\n\t\tthis.ctx.moveTo(first[0], first[1]);\r\n\t\tcoords.forEach(c => this.ctx.lineTo(c[0], c[1]));\r\n\t\tthis.ctx.closePath();\r\n\t\tthis.ctx.stroke();\r\n\t\tthis.ctx.fill();\r\n\t\tthis.ctx.fillStyle = this.props.fillColor;\r\n\t}\r\n\r\n\tinitCanvas() {\r\n\t\tif (this.props.width) this.img.width = this.props.width;\r\n\r\n\t\tif (this.props.height) this.img.height = this.props.height;\r\n\r\n\t\tthis.canvas.width = this.props.width || this.img.clientWidth;\r\n\t\tthis.canvas.height = this.props.height || this.img.clientHeight;\r\n\t\tthis.container.style.width =\r\n\t\t\t(this.props.width || this.img.clientWidth) + \"px\";\r\n\t\tthis.container.style.height =\r\n\t\t\t(this.props.height || this.img.clientHeight) + \"px\";\r\n\t\tthis.ctx = this.canvas.getContext(\"2d\");\r\n\t\tthis.ctx.fillStyle = this.props.fillColor;\r\n\t\t//this.ctx.strokeStyle = this.props.strokeColor;\r\n\r\n\t\tif (this.props.onLoad) this.props.onLoad();\r\n\r\n\t\tthis.renderPrefilledAreas();\r\n\t}\r\n\r\n\thoverOn(area, index, event) {\r\n\t\tconst shape = event.target.getAttribute(\"shape\");\r\n\r\n\t\tif (this.props.active && this[\"draw\" + shape]) {\r\n\t\t\tthis[\"draw\" + shape](\r\n\t\t\t\tevent.target.getAttribute(\"coords\").split(\",\"),\r\n\t\t\t\tarea.fillColor,\r\n\t\t\t\tarea.lineWidth || this.props.lineWidth,\r\n\t\t\t\tarea.strokeColor || this.props.strokeColor\r\n\t\t\t);\r\n\t\t}\r\n\t\tif (this.props.onMouseEnter) this.props.onMouseEnter(area, index, event);\r\n\t}\r\n\r\n\thoverOff(area, index, event) {\r\n\t\tif (this.props.active) {\r\n\t\t\tthis.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\r\n\t\t\tthis.renderPrefilledAreas();\r\n\t\t}\r\n\r\n\t\tif (this.props.onMouseLeave) this.props.onMouseLeave(area, index, event);\r\n\t}\r\n\r\n\tclick(area, index, event) {\r\n\t\tif (this.props.onClick) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.props.onClick(area, index, event);\r\n\t\t}\r\n\t}\r\n\r\n\timageClick(event) {\r\n\t\tif (this.props.onImageClick) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.props.onImageClick(event);\r\n\t\t}\r\n\t}\r\n\r\n\tmouseMove(area, index, event) {\r\n\t\tif (this.props.onMouseMove) {\r\n\t\t\tthis.props.onMouseMove(area, index, event);\r\n\t\t}\r\n\t}\r\n\r\n\timageMouseMove(area, index, event) {\r\n\t\tif (this.props.onImageMouseMove) {\r\n\t\t\tthis.props.onImageMouseMove(area, index, event);\r\n\t\t}\r\n\t}\r\n\r\n\tscaleCoords(coords) {\r\n\t\tconst { imgWidth, width } = this.props;\r\n\t\t// calculate scale based on current 'width' and the original 'imgWidth'\r\n\t\tconst scale = width && imgWidth && imgWidth > 0 ? width / imgWidth : 1;\r\n\t\treturn coords.map(coord => coord * scale);\r\n\t}\r\n\r\n\trenderPrefilledAreas() {\r\n\t\tthis.state.map.areas.map(area => {\r\n\t\t\tif (!area.preFillColor) return;\r\n\t\t\tthis[\"draw\" + area.shape](\r\n\t\t\t\tthis.scaleCoords(area.coords),\r\n\t\t\t\tarea.preFillColor,\r\n\t\t\t\tarea.lineWidth || this.props.lineWidth,\r\n\t\t\t\tarea.strokeColor || this.props.strokeColor\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tcomputeCenter(area) {\r\n\t\tif (!area) return [0, 0];\r\n\r\n\t\tconst scaledCoords = this.scaleCoords(area.coords);\r\n\r\n\t\tswitch (area.shape) {\r\n\t\t\tcase \"circle\":\r\n\t\t\t\treturn [scaledCoords[0], scaledCoords[1]];\r\n\t\t\tcase \"poly\":\r\n\t\t\tcase \"rect\":\r\n\t\t\tdefault: {\r\n\t\t\t\t// Calculate centroid\r\n\t\t\t\tconst n = scaledCoords.length / 2;\r\n\t\t\t\tconst { y, x } = scaledCoords.reduce(\r\n\t\t\t\t\t({ y, x }, val, idx) => {\r\n\t\t\t\t\t\treturn !(idx % 2) ? { y, x: x + val / n } : { y: y + val / n, x };\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{ y: 0, x: 0 }\r\n\t\t\t\t);\r\n\t\t\t\treturn [x, y];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trenderAreas() {\r\n\t\treturn this.state.map.areas.map((area, index) => {\r\n\t\t\tconst scaledCoords = this.scaleCoords(area.coords);\r\n\t\t\tconst center = this.computeCenter(area);\r\n\t\t\tconst extendedArea = { ...area, scaledCoords, center };\r\n\t\t\treturn (\r\n\t\t\t\t<area\r\n\t\t\t\t\tkey={area._id || index}\r\n\t\t\t\t\tshape={area.shape}\r\n\t\t\t\t\tcoords={scaledCoords.join(\",\")}\r\n\t\t\t\t\t// [Ray] Fix the Edge mouse hover issue\r\n\t\t\t\t\t// onMouseEnter={this.hoverOn.bind(this, extendedArea, index)}\r\n                    // onMouseLeave={this.hoverOff.bind(this, extendedArea, index)}\r\n\t\t\t\t\tonMouseOver={this.hoverOn.bind(this, extendedArea, index)}\r\n\t\t\t\t\tonMouseOut={this.hoverOff.bind(this, extendedArea, index)}                    \r\n\t\t\t\t\tonMouseMove={this.mouseMove.bind(this, extendedArea, index)}\r\n\t\t\t\t\tonClick={this.click.bind(this, extendedArea, index)}\r\n\t\t\t\t\thref={area.href}\r\n\t\t\t\t/>\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn (\r\n\t\t\t<div style={this.styles.container} ref={node => (this.container = node)}>\r\n\t\t\t\t<img\r\n\t\t\t\t\tstyle={this.styles.img}\r\n\t\t\t\t\tsrc={this.props.src}\r\n\t\t\t\t\tuseMap={`#${this.state.map.name}`}\r\n\t\t\t\t\talt=\"\"\r\n\t\t\t\t\tref={node => (this.img = node)}\r\n\t\t\t\t\tonLoad={this.initCanvas}\r\n\t\t\t\t\tonClick={this.imageClick.bind(this)}\r\n\t\t\t\t\tonMouseMove={this.imageMouseMove.bind(this)}\r\n\t\t\t\t/>\r\n\t\t\t\t<canvas ref={node => (this.canvas = node)} style={this.styles.canvas} />\r\n\t\t\t\t<map name={this.state.map.name} style={this.styles.map}>\r\n\t\t\t\t\t{this.renderAreas()}\r\n\t\t\t\t</map>\r\n\t\t\t</div>\r\n\t\t);\r\n\t}\r\n}\r\n\r\nImageMapper.defaultProps = {\r\n\tactive: true,\r\n\tfillColor: \"rgba(255, 255, 255, 0.5)\",\r\n\tlineWidth: 1,\r\n\tmap: {\r\n\t\tareas: [],\r\n\t\tname: \"image-map-\" + Math.random()\r\n\t},\r\n\tstrokeColor: \"rgba(0, 0, 0, 0.5)\"\r\n};\r\n\r\nImageMapper.propTypes = {\r\n\tactive: PropTypes.bool,\r\n\tfillColor: PropTypes.string,\r\n\theight: PropTypes.number,\r\n\timgWidth: PropTypes.number,\r\n\tlineWidth: PropTypes.number,\r\n\tsrc: PropTypes.string.isRequired,\r\n\tstrokeColor: PropTypes.string,\r\n\twidth: PropTypes.number,\r\n\r\n\tonClick: PropTypes.func,\r\n\tonMouseMove: PropTypes.func,\r\n\tonImageClick: PropTypes.func,\r\n\tonImageMouseMove: PropTypes.func,\r\n\tonLoad: PropTypes.func,\r\n\tonMouseEnter: PropTypes.func,\r\n\tonMouseLeave: PropTypes.func,\r\n\r\n\tmap: PropTypes.shape({\r\n\t\tareas: PropTypes.arrayOf(\r\n\t\t\tPropTypes.shape({\r\n\t\t\t\tarea: PropTypes.shape({\r\n\t\t\t\t\tcoords: PropTypes.arrayOf(PropTypes.number),\r\n\t\t\t\t\thref: PropTypes.string,\r\n\t\t\t\t\tshape: PropTypes.string,\r\n\t\t\t\t\tpreFillColor: PropTypes.string,\r\n\t\t\t\t\tfillColor: PropTypes.string\r\n\t\t\t\t})\r\n\t\t\t})\r\n\t\t),\r\n\t\tname: PropTypes.string\r\n\t})\r\n};\r\n","import React from 'react';\r\nimport ImageMapper from './imageMapperLib';\r\nimport './imageMap.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport {getAprBaseUrl} from '../api/masterData';\r\nimport {getImageFromLocal} from '../helper/localStorageHelper';\r\n\r\n// Should use different names if there are more than 1 instance of maps in the web page\r\n// Otherwise the mouse pointer will have conflicts\r\n// The coordinates are against the orig image dimension because imgWidth is specified\r\nconst MAP ={\r\n    name: \"myMap\",\r\n    areas: [\r\n        {name: \"Room 1\", shape: \"circle\", coords: [170, 50, 15 ], preFillColor: \"red\"},\r\n        {name: \"Room 2\", shape: \"circle\", coords: [300, 120, 15 ], preFillColor: \"#ffcf0c\"},\r\n        {name: \"Room 3\", shape: \"circle\", coords: [70, 100, 15 ], preFillColor: \"lightgreen\"},\r\n    ]\r\n};\r\n\r\nconst MAP2 ={\r\n    name: \"myMap2\",\r\n    areas: [\r\n        {name: \"Room A\", shape: \"circle\", coords: [140, 20, 15 ], preFillColor: \"red\"},\r\n        {name: \"Room B\", shape: \"circle\", coords: [200, 150, 15 ], preFillColor: \"#ffcf0c\"},\r\n        {name: \"Room C\", shape: \"circle\", coords: [90, 120, 15 ], preFillColor: \"magenta\"},\r\n        {name: \"Room D\", shape: \"circle\", coords: [40, 180, 15 ], preFillColor: \"cyan\"},\r\n        {name: \"Room E\", shape: \"circle\", coords: [390, 25, 15 ], preFillColor: \"orange\"},\r\n        {name: \"Room F\", shape: \"circle\", coords: [380, 190, 15 ], preFillColor: \"maroon\"},\r\n    ]\r\n};\r\n\r\n//const DEFAULT_IMG = 'layout.gif'; // This image can be accessed from http://localhost:3000/layout.gif, and deployed inside the public folder of this React App\r\nconst DEFAULT_IMG = 'https://github.com/raymond-ong/noobformsdemo/blob/master/public/DefaultMap.png?raw=true';\r\n\r\nclass ImageMap extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            imageLoaded: false,\r\n            scaledImgW: null,\r\n            scaledImgH: null,\r\n            hoveredArea: null\r\n        }\r\n        this.imageLoadHandler = this.imageLoadHandler.bind(this);\r\n    }\r\n\r\n    imageLoadHandler(e) {\r\n\r\n        let origImgW = e.srcElement.width;\r\n        let origImgH = e.srcElement.height;\r\n        if (!!this.props.maxWidth) {\r\n            \r\n            this.setState({\r\n                imageLoaded: true,\r\n                origImgW,\r\n                origImgH\r\n            });    \r\n        }\r\n        else {\r\n            this.setState({\r\n                imageLoaded: true,\r\n                origImgW,\r\n                origImgH\r\n            });    \r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        var img = new Image();\r\n        img.onload = this.imageLoadHandler;\r\n        img.src = this.getImageUrl();\r\n    }\r\n\r\n    enterArea(area) {\r\n        console.log('enterArea', area)\r\n\t\tthis.setState({\r\n\t\t\thoveredArea: area,\r\n\t\t});\r\n\t}\r\n    \r\n    leaveArea(area) {\r\n\t\tthis.setState({\r\n\t\t\thoveredArea: null,\r\n\t\t});\r\n    }\r\n\r\n    getTipPosition(area) {\r\n        // if (!area) {\r\n        //     return {top: '170px', left: '100px'};\r\n        // }\r\n        console.log('[getTipPosition]', area.center[1], area.center[0]);\r\n\t\treturn { top: `${area.center[1]}px`, left: `${area.center[0]}px` };\r\n    }\r\n    \r\n    computeWidthHeight(origImgW, origImgH, maxWidthPx) {\r\n        if (!!maxWidthPx) {\r\n            let propsMaxWidth = parseFloat(maxWidthPx) - 5;\r\n            let scaledImageH = propsMaxWidth / origImgW * origImgH;\r\n            return {\r\n                w: propsMaxWidth,\r\n                h: scaledImageH\r\n            }\r\n        }\r\n        else {\r\n            return {\r\n                w: origImgW,\r\n                h: origImgH\r\n            }\r\n        }\r\n    }\r\n\r\n    getImageUrl() {\r\n        // return this.props.data && this.props.data.imageProps && this.props.data.imageProps.image ? \r\n        //             `${getAprBaseUrl()}/files/${this.props.data.imageProps.image}` \r\n        //             : DEFAULT_IMG;\r\n        return this.props.data && this.props.data.imageProps && this.props.data.imageProps.image ? \r\n                    `${getImageFromLocal(this.props.data.imageProps.image)}` \r\n                    : DEFAULT_IMG;\r\n    }\r\n\r\n    getMapToUse() {\r\n        if (this.props.data && this.props.data.imageProps && this.props.data.imageProps.image) {\r\n            return this.props.data && this.props.data.imageProps && this.props.data.imageProps.map;\r\n        }\r\n\r\n        return this.props.useOther ? MAP2 : MAP;\r\n    }\r\n\r\n    // e.g. groupings = ['A', 'B', 'C']\r\n    // return 'C'\r\n    getLastGroupingItem() {\r\n        if (!this.props || !this.props.data || !this.props.data.dataProps || !Array.isArray(this.props.data.dataProps.groupings) || this.props.data.dataProps.groupings.length === 0) {\r\n            return null;\r\n        }\r\n\r\n        return this.props.data.dataProps.groupings[this.props.data.dataProps.groupings.length - 1];\r\n    }\r\n\r\n    getTooltip(areaName) {\r\n         debugger\r\n        let lowestProp = this.getLastGroupingItem();\r\n        if (!this.props.apiData || !this.props.apiData.data || !lowestProp) {\r\n            return areaName;\r\n        }\r\n                \r\n        let findApiData = this.props.apiData.data.find(a => a[lowestProp] === areaName);\r\n        if (!findApiData) {\r\n            return areaName;\r\n        }\r\n\r\n        let tipStr = '';\r\n        let kvPairsStr = []\r\n        for (var prop in findApiData) {\r\n            if (prop === lowestProp) {\r\n                kvPairsStr.push(`${prop}: ${findApiData[prop]}`);\r\n            }\r\n            else if (prop === 'value') {\r\n                kvPairsStr.push(`KPI Score: ${findApiData[prop]}`);\r\n            }\r\n        }\r\n        \r\n        return kvPairsStr.join(', ');\r\n    }\r\n   \r\n    \r\n    render() {\r\n        let imageUrl = this.getImageUrl();\r\n        let mapToUse = this.getMapToUse();\r\n\r\n        if (!this.state.imageLoaded) {\r\n            return <div>Loading Image...</div>;\r\n        }\r\n        let classNames = this.props.selected === true ? 'ctrl-selected' : '';\r\n        var computedSize = this.computeWidthHeight(this.state.origImgW, this.state.origImgH, this.props.maxWidth);\r\n        console.log(\"[ImageMap] Computed W, H: \", computedSize, \"max Width: \", this.props.maxWidth, this.props.apiData);\r\n\r\n        return <div style={{ position: \"relative\" }} className={classNames}>\r\n            <ImageMapper src={imageUrl}\r\n                map={mapToUse}\r\n                onMouseEnter={area => this.enterArea(area)}\r\n                onMouseLeave={area => this.leaveArea(area)}\r\n                width={computedSize.w} // get it from the container width\r\n                height={computedSize.h} // calculate based on the image aspect ratio\r\n                imgWidth={this.state.origImgW}\r\n                // onClick={area => this.clickArea(area)}\r\n        >\r\n        </ImageMapper>\r\n        {this.state.hoveredArea && (\r\n            <span className=\"imageMapToolTip\" style={{ ...this.getTipPosition(this.state.hoveredArea) }}>\r\n                {/* {this.state.hoveredArea.name} */}\r\n                {this.getTooltip(this.state.hoveredArea.name)}\r\n            </span>\r\n        )}\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default noobControlHoc(ImageMap);\r\n\r\n// Properties Panel Portion\r\nconst configBtnOnClick = () => {\r\n\r\n    console.log('configBtnOnClick');\r\n}\r\nexport const imageMapProps = [\r\n    {\r\n      name: 'imageProps', \r\n      propType: 'popupConfig',\r\n      buttonName: 'Configure Image...',\r\n      btnOnclick: configBtnOnClick\r\n    },\r\n    {\r\n        name: 'dataProps', \r\n        propType: 'section',\r\n    },\r\n    {\r\n        name: 'datasetId', \r\n        propType: 'number',\r\n        toolTip: 'Put the same datasetId for all controls that are linked. When a filter is applied in one control, other linked controls will also be filtered.'\r\n    },\r\n    {\r\n        name: 'requestType', \r\n        propType: 'metadata',\r\n        metadataField: 'requestTypes',\r\n        metadataPropType: 'dropdown'\r\n    },\r\n    {\r\n        name: 'groupings', \r\n        propType: 'metadata',\r\n        metadataField: 'dimensions',\r\n        metadataPropType: 'treeDropdown',\r\n        multiple: true,\r\n      },\r\n  \r\n];\r\n","import React, {useState} from 'react';\r\nimport './datepicker.css';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport DatePicker from 'react-datepicker';\r\nimport \"react-datepicker/dist/react-datepicker.css\";\r\n\r\nconst DateSelector = (props) => {\r\n    //return <div>Hello</div>\r\n    // const [startDate, setStartDate] = useState(new Date());\r\n    // return (<DatePicker selected={startDate} onChange={date => setStartDate(date)} />);    \r\n\r\n    let classNames = props.selected === true ? 'ctrl-selected' : '';\r\n\r\n    const [startDate, setStartDate] = useState(new Date());\r\n    const [endDate, setEndDate] = useState(new Date());\r\n    return <div className={classNames}>\r\n        <div className=\"controlLabel\">{props.data.label}</div>\r\n        <div className=\"datepickerGrid\">\r\n        <div className className=\"dateLabel\">Start:</div>\r\n        <div className=\"datepickerWrapper\">\r\n            <DatePicker\r\n            selected={startDate}\r\n            onChange={date => setStartDate(date)}\r\n            selectsStart\r\n            startDate={startDate}\r\n            endDate={endDate}\r\n            />\r\n        </div>\r\n\r\n        <div className=\"dateLabel\">End:</div>\r\n        <div className=\"datepickerWrapper datepickerWrapperEnd\">\r\n            <DatePicker\r\n            selected={endDate}\r\n            onChange={date => setEndDate(date)}\r\n            selectsEnd\r\n            startDate={startDate}\r\n            endDate={endDate}\r\n            minDate={startDate}\r\n            />        \r\n        </div>\r\n        </div>\r\n    </div>\r\n}\r\nexport default noobControlHoc(DateSelector);\r\n","import React from 'react';\r\nimport noobControlHoc from '../hoc/noobControlsHoc';\r\nimport './externalContainer.css';\r\n\r\n// Make this a prop, if need to create another external page\r\nconst externalPageDefault = \"http://localhost:3000/IsaeExecSummary/ExecutiveSummary_r1.html\";\r\n\r\nexport const ExternalContainerBase = (props) => {\r\n\r\n    const getContent = () => {\r\n        return <iframe className=\"externalContainerContent\"\r\n            src={props && props.data && props.data.url ? props.data.url : externalPageDefault}\r\n        />;\r\n    }\r\n\r\n    let classNames = 'externalContainer';\r\n    if (props.selected === true) {\r\n        classNames += ' ctrl-selected'\r\n    }\r\n      \r\n    return <div className={classNames}>\r\n        {getContent()}\r\n        </div>\r\n}\r\n\r\nexport default noobControlHoc(ExternalContainerBase);","import React from 'react';\r\nimport './noobForm.css'\r\n// controls\r\nimport Section from '../controls/section';\r\nimport RichText from '../controls/richtext';\r\nimport Combobox from '../controls/combo';\r\nimport Textbox from '../controls/textbox';\r\nimport Table, {TableBase} from '../controls/table';\r\nimport ReportTable from '../controls/reportTable';\r\nimport Label from '../controls/label';\r\nimport ShowMessage, {NotifType} from '../helper/notification';\r\nimport { Popup } from 'semantic-ui-react'\r\nimport DcBar from '../charts/dcjsBarChart';\r\n\r\n\r\nimport { useDrag } from 'react-dnd'\r\nimport PieChart, {PieForReport, PieWithData, PieResponsiveData, PieResponsiveDataBase} from '../charts/pieChart';\r\nimport BarChart, {BarChartForReport, BarResponsiveData} from '../charts/barChart';\r\nimport LineChart from '../charts/lineChart';\r\nimport Gauge from '../charts/gauge';\r\nimport GaugeReChart from '../charts/gauge_rechart';\r\nimport GaugeJs from '../charts/gaugejs_react';\r\nimport PageBreak from '../controls/pagebreak';\r\nimport ImageMap from '../controls/imageMap';\r\nimport Datepicker from '../controls/datepicker';\r\nimport ExternalContainer, {ExternalContainerBase} from '../containers/externalContainer';\r\nimport {isFrontEndApiReachable} from '../api/masterData';\r\n\r\n// Separate the content-part into a standalone component from the control wrapper\r\n// Reason: this will be the only part that will be resized or moved while dragging (moving or resizing)\r\n// We don't want to include the resizer or landing pads in the drag image\r\n\r\nexport const ControlDragTypes = {\r\n    CONTROL: 'Control'\r\n}\r\n\r\n// mode: either \"dashboard\" or \"designMode\"\r\nexport const getContentDiv = (controlData, mode) => {\r\n    // Wrap the contents so that when resizing or moving, they will be together\r\n    // Also this should be floated. We don't want to resize or move the parent\r\n    let content = null;\r\n    let isReporting = document.URL.toLowerCase().includes(\"reporting\");\r\n    let designMode = mode !== 'dashboard' || !isFrontEndApiReachable();\r\n    switch(controlData.ctrlType) {\r\n        case 'section':\r\n            content = <Section {...controlData}></Section>\r\n            break;\r\n        case 'richtext':\r\n            content = <RichText {...controlData}></RichText>\r\n            break;\r\n        case 'combo':\r\n            content = <Combobox {...controlData}></Combobox>\r\n            break;\r\n        case 'textbox':\r\n            content = <Textbox {...controlData}/>\r\n            break;\r\n        case 'table':\r\n            if (isReporting) {\r\n                // content = <ReportTable {...controlData}/> \r\n                content = <TableBase {...controlData} showFilters={false} showPaginator={false} showFooter={false}/> \r\n            }\r\n            else if (designMode){                \r\n                content = <Table {...controlData} designMode={designMode}/> \r\n            }\r\n            else {\r\n                content = <TableBase {...controlData} designMode={designMode}/> \r\n            }\r\n            \r\n            break;\r\n        case 'label':\r\n            content = <Label {...controlData}/> \r\n            break;\r\n        case 'pie':\r\n            if (isReporting) {\r\n                //content = <PieForReport {...controlData}/>\r\n                content = <PieForReport {...controlData}/>\r\n            }\r\n            else if (mode === 'dashboard' && isFrontEndApiReachable()) {\r\n                // Forgot why we need to use the Base. I think there were conflicts with the mouseDown.\r\n                content = <PieResponsiveDataBase {...controlData}/>\r\n            }\r\n            else {\r\n                content = <PieResponsiveData {...controlData} designMode/>\r\n            }                \r\n            break;\r\n        case 'barchart':\r\n            if (isReporting) {\r\n                content = <BarChartForReport {...controlData}/>                \r\n            }\r\n            else {                \r\n                content = <BarResponsiveData {...controlData} designMode={designMode}/>\r\n            }            \r\n            break;\r\n        case 'gauge':\r\n            //content = <Gauge {...controlData}/>\r\n            content = <GaugeReChart {...controlData} designMode={designMode} reportMode={isReporting}/>\r\n            //content=<GaugeJs {...controlData}/>\r\n            break;\r\n        case 'pagebreak':\r\n            // Should not come here if Reporting mode!\r\n            // Parent form must insert page-break-before style into the next control instead\r\n            content = <PageBreak {...controlData}/>\r\n            break;\r\n        case undefined:    \r\n            if (isReporting || mode === 'dashboard') {\r\n                content = <div className=\"emptyReportControl\"></div>\r\n            }\r\n            else {\r\n                content = <div className=\"emptyControl\"></div>\r\n            }\r\n            break;\r\n        case 'dcbar':\r\n            content = <DcBar {...controlData}/>\r\n            break;\r\n        case 'imageMap':\r\n            content = <ImageMap {...controlData} designMode={designMode}/>\r\n            break;\r\n        case 'date':\r\n            content = <Datepicker {...controlData}/>\r\n            break;\r\n        case 'line':\r\n            //content = <LineChart {...controlData} designMode={designMode}/>\r\n            content = <LineChart {...controlData} designMode={designMode} reportMode={isReporting}/> // debug!!\r\n            break;\r\n        case 'frame':\r\n            if (designMode) {\r\n                content = <ExternalContainer {...controlData} designMode={designMode}/>\r\n            }\r\n            else {\r\n                content = <ExternalContainerBase {...controlData} designMode={designMode}/>\r\n            }\r\n            break;\r\n        default:\r\n            content = <div>{controlData.i}</div>\r\n            break;\r\n    }\r\n\r\n    return content;\r\n}\r\n\r\nconst handleEndDrag = (item, monitor) => {\r\n    if (monitor.didDrop()) {\r\n        return;\r\n    }\r\n\r\n    ShowMessage('Control was not moved', \r\n    NotifType.info, \r\n    'Please drop the control into an empty cell, or make sure there is sufficient space for larger controls.')\r\n}\r\n\r\n\r\n// TODO: Need to inform upper level classes that this control is being moved, so that landing pads will only be rendered on the control being moved\r\nconst NoobControlContent = (controlData) => {\r\n    const [{ isDragging }, drag] = useDrag({\r\n        item: { \r\n            ...controlData,\r\n            type: ControlDragTypes.CONTROL,            \r\n        },\r\n        canDrag: !!controlData.ctrlType, // Do not allow empty controls to be dragged\r\n        end: (item, monitor) => handleEndDrag(item, monitor),\r\n        collect: monitor => ({\r\n          isDragging: !!monitor.isDragging(),\r\n        }),\r\n      });\r\n\r\n    const styles = {\r\n        opacity: isDragging? 0 : 1,\r\n    };\r\n    // return <Popup\r\n    //     trigger={<div className=\"contentWrapper\" ref={drag} style={styles}>\r\n    //             {getContentDiv(controlData)}\r\n    //             </div>}\r\n    //     content='Hide the popup on any scroll event'\r\n    //     on='click'\r\n    //     hideOnScroll\r\n    // />\r\n    return <div className=\"contentWrapper\" ref={drag} style={styles}>\r\n        {getContentDiv(controlData, 'designMode')}  \r\n    </div>        \r\n}\r\n\r\nexport default NoobControlContent;","import React, { Component, useState, useEffect } from 'react';\r\nimport {getContentDiv} from './noobControlContent';\r\nimport { Dimmer, Loader, Segment } from 'semantic-ui-react';\r\nimport {fetchData} from './chartApiManager';\r\nimport axios from 'axios';\r\nimport './reportForm.css'\r\n\r\nimport {connect} from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport {clickChartSlice, selectChartGroup, clickPageLink} from '../actions/index';\r\n\r\n\r\nconst ROW_HEIGHT = 40;\r\nconst CONTROL_PADDING = 20;\r\nconst GRID_GAP = 5;\r\n\r\n// a. sliceInfo: the category(ies) of pie chart/bar chart (e.g. vendor=\"Yokogawa\"+model=\"EJA\")\r\n// b.seriesInfo: only applicable to bar chart, e.g. PRM device status = Normal\r\n// c. groupingStackStr: e.g. \"[vendor,model]\"\r\n// For sending request to API, we only need a and b\r\n// For calculating the active index, we need a, b and c\r\nconst handleChartClick = (sliceInfo, seriesInfo, groupingStackStr, controlData, clickChartSlice) => {\r\n    // Fire a redux action\r\n    clickChartSlice(sliceInfo, seriesInfo, groupingStackStr, controlData.data.dataProps.datasetId, controlData.i);\r\n}\r\n\r\nconst handleGroupSelect = (groupingValue, controlData, selectChartGroup) => {\r\n    selectChartGroup(groupingValue, controlData);\r\n}\r\n\r\nconst handleLinkClick = (controlData, clickPageLink) => {\r\n    console.log(\"handleLinkClick\", controlData.i, controlData.data.linkedPage);\r\n    clickPageLink(controlData);\r\n}\r\n\r\nconst ReportControl = ({layoutName, controlData, containerWidth, \r\n                    clickChartSlice, selectChartGroup, clickPageLink,\r\n                    datasetFilters, currControlGrouping, metadata, pageFilters,\r\n                    pageApiData}) => {\r\n    // [a] Data Preparations\r\n    const [apiData, setApiData] = useState();\r\n    const [isLoading, setIsLoading] = useState(!!controlData.dataProps);\r\n\r\n    useEffect(() => {     \r\n        if (controlData.data && controlData.data.dataProps) {                        \r\n            fetchData(controlData, setIsLoading, setApiData, datasetFilters, currControlGrouping, metadata, pageFilters);\r\n        }\r\n    }, [datasetFilters, currControlGrouping, layoutName, pageFilters]); \r\n\r\n\r\n    // [b] UI Preparations    \r\n    // TODO: not sure if this would affect the global object (permanently stored to the global object)\r\n    // If yes, just clone this object\r\n    let controlDataClone = {...controlData};\r\n    if (controlDataClone.data && controlDataClone.data.dataProps && !isLoading) {\r\n        controlDataClone.apiData = apiData;\r\n        controlDataClone.datasetFilters = datasetFilters; // don't put this inside dataProps to avoid sending it over the network\r\n        controlDataClone.currControlGrouping = currControlGrouping;\r\n        controlDataClone.handleChartClick = (sliceInfo, seriesInfo, groupingStackStr) => handleChartClick(sliceInfo, seriesInfo, groupingStackStr, controlData, clickChartSlice);\r\n        controlDataClone.handleGroupSelect = (groupValue) => handleGroupSelect(groupValue, controlData, selectChartGroup);\r\n        controlDataClone.metadata = metadata;        \r\n    }\r\n\r\n    controlDataClone.layoutName = layoutName;\r\n\r\n    if (pageApiData) {\r\n        controlDataClone.pageApiData = pageApiData;\r\n    }\r\n\r\n    if (!!controlDataClone.data && !!controlData.data.linkedPage) {\r\n        controlDataClone.data.handleLinkClick = controlData => handleLinkClick(controlData, clickPageLink);\r\n    }\r\n\r\n    let classNames = 'reportControl';\r\n    if (!!controlDataClone.ctrlType) {\r\n        classNames += \" reportControl-withBorder\";\r\n    }\r\n    let usableWidth = containerWidth; // 20 for the noobform left and right padding of 10 each\r\n    let widthOfCtrl = usableWidth * controlData.w / 12.0; // 12 is the number of columns; minus 5 for the grid gap\r\n    if (controlDataClone.w < 12) {\r\n        widthOfCtrl -= 5;\r\n    }\r\n    \r\n    let ctrlStyle = {\r\n        // set the minHeight instead of height. Height will make the height fixed regardless of the content.\r\n        // minHeight allows the parent container to grow depending on content\r\n        //'minHeight': (ROW_HEIGHT * controlData.h) + (CONTROL_PADDING * (controlData.h - 1)) + (GRID_GAP * (controlData.h - 1)), \r\n        // Maybe no need to include padding and grid gap\r\n        'minHeight': (ROW_HEIGHT * controlData.h), \r\n    }\r\n    // [b1] - Normal desktop size layout\r\n    ctrlStyle.gridRowEnd = 'span ' + controlData.h;\r\n    ctrlStyle.gridColumnEnd = 'span ' + controlData.w;\r\n    ctrlStyle.maxWidth = `${widthOfCtrl}px`; \r\n    \r\n    controlDataClone.selected = false; // Override...so that it won't show up as selected\r\n    controlDataClone.maxWidth = `${widthOfCtrl}px`; \r\n    //console.log('render ReportControl', controlData.i, widthOfCtrl, containerWidth);\r\n    // [c] Render:\r\n    // [c.1] return the landing pad first, which is only shown when the control is being resized\r\n    // [c.2] followed by the content\r\n    // [c.3] followed by the placeholder which will only be visible during resizing. Purpose is maintain the original size of the container while resizing.\r\n    // [c.4] followed by the small resizer.\r\n    // [c.5] followed by the settings button\r\n    //       This order must be followed to avoid the need for z-index\r\n    return <div \r\n                className={classNames} \r\n                style={ctrlStyle}\r\n            >\r\n                {isLoading && <Dimmer active inverted>\r\n                    <Loader>{`Fetching ${controlDataClone.ctrlType} data`}</Loader>\r\n                    </Dimmer>\r\n                }\r\n                {getContentDiv(controlDataClone, \"dashboard\")}\r\n        </div>\r\n}\r\n\r\nconst mapStateToProps = (state, ownProps) => {\r\n    let controlData = ownProps.controlData;\r\n    if (!controlData || !controlData.data || !controlData.data.dataProps) {\r\n        return {};    // to avoid re-rendering controls that do not have dataProps\r\n    }\r\n\r\n    // We are only concerned about changes in the datasetId this control belongs to\r\n    return {\r\n        // Contains the slices/bars clicked by the user\r\n        datasetFilters: state.dashboard.chartClickFilters[controlData.data.dataProps.datasetId],\r\n        currControlGrouping: state.dashboard.chartTempGroupings[controlData.i]\r\n    }\r\n}\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n    return bindActionCreators({ clickChartSlice, selectChartGroup, clickPageLink }, dispatch);\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(ReportControl);","import axios from 'axios';\r\n\r\nexport const fetchPageData = async (url, setIsLoading, setApiData) => {\r\n    setIsLoading(true);\r\n    const result = await axios.get(url)\r\n    .catch(error =>{\r\n        console.error(\"Error fetching page data from url\", url);\r\n    });\r\n    setIsLoading(false);\r\n    setApiData(result);\r\n}\r\n\r\nexport const fetchPageDataSync = async (url) => {\r\n    const result = await axios.get(url)\r\n    .catch(error =>{\r\n        console.error(\"Error fetching page data from url:\", url);\r\n    });\r\n\r\n    return result;\r\n}\r\n\r\nexport const fetchPageDataAsync = async (url) => {\r\n    return axios.get(url)\r\n}","// This file contains the logic needed for filtering and slicing the data from rest api\r\n// Ideally, no need to implement such logic. This logic must be implemented @ the server side (API server)\r\n// -> In the future, should enforce this!\r\n// But because this logic was not implemented @ server side, we implement it here.\r\nimport {createMonthDate} from '../helper/util';\r\n\r\nconst bogusDataUuids = ['136a5d53-e9a8-4d29-a575-b90489df9f74']\r\n\r\n// cleanApiDataList is already sorted in ascending order\r\nconst findClosestStartDate = (refDate, cleanApiDataList) => {\r\n    for (let i = 0; i < cleanApiDataList.length; i++) {\r\n        let currApiData = cleanApiDataList[i];\r\n        let currApiStart = createMonthDate(currApiData.aprStart);\r\n        if (!!currApiStart && currApiStart >= refDate) {\r\n            return currApiData;\r\n        }\r\n    }\r\n}\r\n\r\nexport const findExecSummaryRecords = (apiData, downloadParams) => {\r\n    \r\n    if (!apiData || !apiData.data || !downloadParams) {\r\n        return null;\r\n    }\r\n    \r\n    let analysisPeriodFilter = downloadParams.analysisPeriod;\r\n    if (!analysisPeriodFilter) {\r\n        return null;\r\n    }\r\n\r\n    // temp: remove bogus data from apiData\r\n    let cleanApiDataList = apiData.data.filter(a => !bogusDataUuids.includes(a.uuid));\r\n    cleanApiDataList.sort((a, b) => {\r\n        let dateA = new Date(a.aprStart);\r\n        let dateB = new Date(a.aprEnd);\r\n\r\n        return dateA > dateB;\r\n    })\r\n\r\n    debugger\r\n    let retList = [];\r\n    let currAnalysisDate = createMonthDate(analysisPeriodFilter.start);\r\n    let analysisEndDate = createMonthDate(analysisPeriodFilter.end);\r\n    if (!currAnalysisDate || !analysisEndDate) {\r\n        return null;\r\n    }\r\n\r\n    while(true) {\r\n        debugger\r\n        // Find the closest start date from API \r\n        // If cannot find, end this loop\r\n        let closestApiDataStart = findClosestStartDate(currAnalysisDate, cleanApiDataList);\r\n        if (!closestApiDataStart) {\r\n            break;\r\n        }\r\n\r\n        let closestApiDataEndDate = createMonthDate(closestApiDataStart.aprEnd);\r\n        if (closestApiDataEndDate > analysisEndDate) {\r\n            // Remove the current closest from the array and search again.\r\n            let index = cleanApiDataList.findIndex(a=>a.uuid === closestApiDataStart.uuid);\r\n            cleanApiDataList.splice(index, 1);\r\n            continue;\r\n        }\r\n\r\n        retList.push(closestApiDataStart);\r\n        currAnalysisDate = closestApiDataEndDate;\r\n\r\n        // Remove used records too\r\n        let index = cleanApiDataList.findIndex(a=>a.uuid === closestApiDataStart.uuid);\r\n        cleanApiDataList.splice(index, 1);\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\nconst findRecordWithLatestEndDate = (data) => {\r\n    if (!Array.isArray(data)) {\r\n        return null;\r\n    }\r\n\r\n    let latestRecord = null;\r\n    let currLatestDate = null;\r\n    data.forEach(currRecord => {        \r\n        if (!latestRecord) {\r\n            latestRecord = currRecord;\r\n            currLatestDate = new Date(currRecord.aprEnd);\r\n            return;\r\n        }\r\n\r\n        let currEndDate = new Date(currRecord.aprEnd);\r\n        if (currEndDate > currLatestDate) {\r\n            latestRecord = currRecord;\r\n            currLatestDate = new Date(currRecord.aprEnd);\r\n        }\r\n    })\r\n\r\n    return latestRecord;\r\n}\r\n\r\nexport const filterExecSummaryByUuid = (apiData, pageFilters) => {\r\n    if (!apiData || !Array.isArray(apiData.data)) {\r\n        return null;\r\n    }\r\n    let uuidParam = Array.isArray(pageFilters) && pageFilters.find(p => p.name === 'uuid');\r\n    if (!uuidParam) {\r\n        // just find the apidata with latest APR end date\r\n        return findRecordWithLatestEndDate(apiData.data);\r\n    }\r\n\r\n    return apiData.data.find(a => a.uuid === uuidParam.value);\r\n}","import React, { useState, useEffect } from 'react';\r\nimport './reportForm.css';\r\nimport ReportControl from './reportControl';\r\nimport NoobControl from './noobControl';\r\nimport {fetchPageData} from '../api/pageApiManager';\r\nimport { Dimmer, Loader, Segment } from 'semantic-ui-react';\r\nimport {filterExecSummaryByUuid} from '../api/ExecutiveSummaryLogic';\r\n\r\n// CSS Grid based layout editor, but for reporting purposes only\r\n// This does not contain all the drag and drop functionality\r\nconst ReportForm = (props) => {\r\n\r\n\r\n    const findControlPojo = (controlId) => {\r\n        if (props.controls) {\r\n            console.log(\"findControlPojo: props is empty\");\r\n            return null;\r\n        }\r\n\r\n        let findControl = props.controls.find(control => control.i === controlId);\r\n        if (!findControl) {\r\n            console.log(\"findControlPojo: did not find the control with ID\", controlId); // just log it\r\n        }\r\n\r\n        return findControl;\r\n    }\r\n\r\n    const createEmptyControl = (inX, inY, id) => {\r\n        // Return a 1x1 control\r\n        return {\r\n            w: 1,\r\n            h: 1,\r\n            i: id,\r\n            x: inX,\r\n            y: inY\r\n        }        \r\n    }\r\n\r\n    const renderControl = (control, containerWidth, numCols) => {\r\n        return <ReportControl \r\n                key={'ctrl'+control.i} \r\n                controlData={control}\r\n                containerWidth={containerWidth}\r\n                numCols={numCols}\r\n                metadata={props.metadata}\r\n                layoutName={props.layoutName}\r\n                pageFilters={props.pageFilters}\r\n                pageApiData={filteredApiData}\r\n                />\r\n    }\r\n\r\n    // Returns an array containing the flat coordinates of the specified control\r\n    // E.g. Control is x:0, y:0, w:3, h:2, layoutWidth:10\r\n    // return: [0,   1,  2,         --> first row\r\n    //          10, 11, 12]         --> second row\r\n    const getFills = (control, layoutWidth) => {\r\n        let retList = [];\r\n        for (var iRow = 0; iRow < control.h; iRow++) {\r\n            for (var iCol = 0; iCol < control.w; iCol++) {\r\n                \r\n                let adjustedX = iCol + control.x; \r\n                let adjustedY = iRow + control.y;\r\n                retList.push(adjustedY * layoutWidth + adjustedX);\r\n            }\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n    const findLastNonEmptyRow = (controls, layoutData) => {\r\n        for (var iRow = layoutData.rows - 1; iRow >= 0; iRow--) {\r\n            let findControl = controls.find(ctrl => ctrl.y === iRow);\r\n            if(!!findControl && findControl.ctrlType !== 'pagebreak') {\r\n                return iRow;\r\n            }\r\n        }\r\n\r\n        return 0; // means there is no control; form is empty\r\n    }\r\n\r\n    // Returns true if the control is the only control in the rows where the control is placed\r\n    const isControlSolo = (control, layoutData) => {\r\n        let findOverlap = layoutData.find(layoutCtrl => \r\n            {\r\n                if (layoutCtrl.i === control.i) {\r\n                    return false;\r\n                }\r\n\r\n                // if one rect is on top of the other, there is no overlap\r\n                // if (rect2.bottom < rect1.top || rect2.top > rect1.bottom) {\r\n                if ((layoutCtrl.y + layoutCtrl.h - 1) < control.y || layoutCtrl.y > (control.y + control.h - 1)) {\r\n                    return false\r\n                }\r\n                \r\n                return true;\r\n            });\r\n        return !findOverlap;\r\n    }\r\n\r\n    // Return: array of arrays(1 array = group of controls that will be put together in 1 CSS grid or independent layout)\r\n    // For printing there are limitations with the PDF Renderer:\r\n    // [a] tables cannot be inside CSS grid, otherwise there will be overlaps if more than 1 page.\r\n    // [b] CSS grid does not support page break\r\n    // For the limitations above, we set the following workarounds (basically rearrange/override the layout to make it printer friendly):\r\n    // [a1] If table is the \"solo\" control of row(s), insert a page break and create a new group just for the table\r\n    // [a2] If table is not \"solo\", means the user is expecting the table to be very small.\r\n    //      Table will be rendered as-is. Risk of overlap would be there, but it's user's fault.\r\n\r\n\r\n\r\n    // [a1] while rendering row, if we find a table IN THE MIDDLE, skip rendering it first.\r\n    //      after processing all rows, if there are \"leftover\" tables, create a new group just for each leftover table.\r\n    // [a2] while rendering row, if we find tables FIRST, create a new group just for it already. \r\n    //      Render rest of controls of current row following [a1] or [a2] rule\r\n    // [b] Put a CSS page break for the succeeding section. User is expected to put the page breaks in the layout manually in order to make sure pagination is handled properly while printing.\r\n    //     If user puts 2 consecutive page breaks, will end up with 1 page break only.\r\n    // Should also skip the blank rows at the end (like trim-end, but retain blank rows in between or at the beginning)\r\n    const renderControls = (layoutData, controls, containerWidth) => {\r\n        let retList = [];  \r\n        if (!layoutData || !layoutData) {\r\n            return retList;            \r\n        }        \r\n        let fillMap = []; // way for us to monitor which cells are already filled up\r\n        let maxRow = findLastNonEmptyRow(controls, layoutData);\r\n        let currGroup = []; // List of controls that will be put together in 1 CSS-Grid layout\r\n        let currGroupPagination = false;\r\n        let bSetPagination = false; // Put a page-break-before in the next control to be rendered. \r\n\r\n        for (var iRow = 0; iRow <= maxRow; iRow++) {\r\n            let tableControls = []; // table controls to be rendered after we're done processing the entire row\r\n            for (var iCol = 0; iCol < layoutData.columns; iCol++) {\r\n                let flatCoord = iRow * layoutData.columns + iCol;\r\n                // if coordinate already filled, skip (to avoid misaligning controls)\r\n                // If user configured the XYWH coords properly, should not come here\r\n                if (fillMap.find(n => n === flatCoord)) {\r\n                    continue;\r\n                }\r\n\r\n                if (bSetPagination && iCol === 0) { // iCol should be 0 if there is pagination because pagebreak control will take up whole width\r\n                    // todo: add page break to the next empty/nonempty control\r\n                    // create a new group and push the previous group to retList\r\n                    if (currGroup.length > 0) {\r\n                        retList.push({groupType: 'section', pageBreak: currGroupPagination, items: currGroup});                        \r\n                    }\r\n                    currGroup = [];\r\n                    bSetPagination = false;\r\n                    currGroupPagination = true;\r\n                }\r\n\r\n                // try to find if there is a control associated\r\n                // otherwise just render an empty control\r\n                let findControl = controls.find(ctrl => ctrl.x == iCol && ctrl.y == iRow );\r\n                if (!findControl) {\r\n                    let emptyControlPojo = createEmptyControl(iCol, iRow, flatCoord); // plain old JS obj\r\n                    let emptyControlJsx = renderControl(emptyControlPojo, containerWidth, layoutData.columns);\r\n                    currGroup.push({\r\n                        id: emptyControlPojo.i,\r\n                        jsx: emptyControlJsx\r\n                    });\r\n                }\r\n                else if (findControl.ctrlType === 'pagebreak') {\r\n                    bSetPagination = true; // to be processed in the next iteration\r\n                    // Fill up the fillmap so that empty controls won't be rendered here\r\n                    let newFills = getFills(findControl, layoutData.columns)\r\n                    fillMap = fillMap.concat(newFills);\r\n                }\r\n                else if (findControl.ctrlType === 'table' && isControlSolo(findControl, controls)) {\r\n                                \r\n                    // finish up currGroup first\r\n                    if (currGroup.length > 0) {\r\n                        retList.push({groupType: 'section', pageBreak: currGroupPagination, items: currGroup});\r\n                        currGroupPagination = false;\r\n                    }\r\n                    currGroup = [];\r\n\r\n\r\n                    // render table now with full width...\r\n                    findControl.w = 12;\r\n                    let controlJsx = renderControl(findControl,  containerWidth, layoutData.columns);\r\n                    retList.push({groupType: 'table', pageBreak: currGroupPagination, \r\n                        items:[{\r\n                            id: findControl.i,\r\n                            jsx: controlJsx\r\n                        }\r\n                    ]});   \r\n                    currGroupPagination = false;                    \r\n\r\n                    // Update the fill map also\r\n                    let newFills = getFills(findControl, layoutData.columns)\r\n                    fillMap = fillMap.concat(newFills);\r\n                }\r\n\r\n                else {\r\n                    let controlJsx = renderControl(findControl, containerWidth, layoutData.columns);\r\n                    currGroup.push({\r\n                        id: findControl.i,\r\n                        jsx: controlJsx\r\n                    });\r\n                    let newFills = getFills(findControl, layoutData.columns)\r\n                    fillMap = fillMap.concat(newFills);\r\n                }\r\n            } // End of Column for-loop\r\n        } // End of Row for-loop\r\n        \r\n        if (currGroup.length > 0) {\r\n            retList.push({groupType: 'section', pageBreak: currGroupPagination, items: currGroup});\r\n        }\r\n\r\n        //debugger\r\n\r\n        return retList;\r\n    }\r\n\r\n    const renderGroups = (groups, divStyle) => {\r\n        return groups.map((group, index) => {\r\n            let formStyle = index > 0 && group.pageBreak ? {...divStyle, pageBreakBefore: \"always\"} : divStyle;\r\n            return <div className=\"reportForm\"\r\n                        style={formStyle}\r\n                        key={`reportForm-${group}-${index}`}\r\n                    >{group.items.map(control => {\r\n                return control.jsx\r\n            })}</div>\r\n        })\r\n    }\r\n\r\n    // Start of logic:\r\n    let {controls, layoutData, metadata,} = props;\r\n\r\n    // [A] Data preparation, in case there is page data\r\n    const [apiData, setApiData] = useState();\r\n    const [isLoading, setIsLoading] = useState(layoutData && layoutData.pageApiData);\r\n    useEffect(() => {     \r\n        if (layoutData && layoutData.pageApiData) {\r\n            fetchPageData(layoutData.pageApiData, setIsLoading, setApiData);\r\n        }\r\n    }, [layoutData && layoutData.pageApiData]); \r\n    let filteredApiData = filterExecSummaryByUuid(apiData, props.pageFilters);\r\n\r\n\r\n    // [B] Controls and layout preparation    \r\n    if (!layoutData || !controls || !metadata) {\r\n        console.log('render ReportForm...return null beacuse layout/controls/metadata is not yet fetched');\r\n        return null;\r\n    }\r\n    \r\n    console.log('render ReportForm...', layoutData);\r\n    //debugger\r\n\r\n\r\n    // minus 50 for the left and right margin of PDF\r\n    let formWidth = document.URL.toLowerCase().includes('reporting') ? \r\n        window.innerWidth-50:\r\n        props.containerWidth;\r\n\r\n    //let groupsList = this.renderControls(layoutData, controls, window.innerWidth-50); // minus 50 for the left and right margin of PDF\r\n    let groupsList = renderControls(layoutData, controls, formWidth);\r\n\r\n    //let controlsJsx = controlsList.map(c => c.jsx);\r\n\r\n    var divStyle = {'gridTemplateColumns': `repeat(${layoutData.columns}, 1fr)`};\r\n\r\n    let reportTableData = {i: 'ctrl-table0', x: 0, y:1, w: 12, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:'\r\n    }};\r\n    let sectionData = {i: 'ctrl-section0', x: 0, y: 0, w: 12, h: 1, ctrlType: 'section', data: {\r\n        title: 'General Information',\r\n        //backgroundColor: 'lightsteelblue'\r\n        level: 1\r\n    }};\r\n\r\n    let tableData = {i: 'ctrl-table0', x: 0, y:6, w: 12, h: 2,ctrlType: 'table', data: {\r\n        label: 'Table:'\r\n    }};\r\n\r\n    return (\r\n    <div className=\"reportFormsContainer\" style={{maxWidth: `${formWidth}px`}}>\r\n        {/* {'[DEBUG] ContainerWidth: ' + window.innerWidth} */}\r\n        {renderGroups(groupsList, divStyle)}\r\n        {isLoading && <Dimmer active inverted>\r\n            <Loader>{`Fetching Page Data`}</Loader>\r\n            </Dimmer>\r\n        }\r\n    </div>\r\n    );    \r\n}\r\n\r\nexport default ReportForm;","import React from 'react';\r\nimport './designerToolbar.css';\r\nimport {Popup, Dropdown, Menu} from 'semantic-ui-react';\r\nimport {WIDTH_LARGE} from '../constants';\r\n\r\n// Generic toolbar Control that accepts the menu items and callbacks as props, e.g.\r\n/*\r\nconst menuItems = {\r\n    'left': [\r\n        {key:'designertb_save', icon: 'save', text: 'Save'},\r\n        {key:'designertb_saveas', icon: 'save outline', text: 'Save As...'},\r\n        {key:'designertb_open', icon: 'open folder outline', text: 'Open...'},\r\n    ],\r\n    'right': [\r\n        {key:'designertb_preview', icon: 'eye', text: 'Hold to Preview', disabled: true},\r\n    ]\r\n}\r\n*/\r\n\r\nconst renderToolbarBtn = (item) => {\r\n    let clsName = \"toolbarButton\";\r\n    if (item.disabled) {\r\n        clsName += \" toolbarButton-disabled\"\r\n    }\r\n    let btnType = item.type || null; // e.g. submit button, so that no need to specify callback\r\n    let callback = item.callback || null;    \r\n\r\n    return <button key={item.key} className={clsName} type={btnType} onClick={callback}>\r\n        <i className={'ui icon ' + item.icon}/>\r\n        {item.text}\r\n    </button>\r\n}\r\n\r\nconst renderFullMenu = (menuItems, title, titleTooltip) => {\r\n    return <div className=\"designerToolbar\">\r\n        <div className=\"left\">\r\n            {menuItems.left.map(item => renderToolbarBtn(item))}\r\n        </div>\r\n\r\n        <div className=\"center\">\r\n            {title && <div className=\"title\">{title}</div>}\r\n            {titleTooltip && <Popup \r\n                inverted\r\n                basic\r\n                size='tiny' style={{opacity: '0.8'}} \r\n                content={titleTooltip}\r\n                trigger={<div className=\"infoContainer\">\r\n                <i className=\"ui icon info circle\"/>\r\n            </div>} />}\r\n            \r\n            \r\n        </div>\r\n                \r\n        {menuItems.right && <div className=\"rightTb\">\r\n            {menuItems.right.map(item => renderToolbarBtn(item))}\r\n        </div>}\r\n        \r\n    </div>\r\n}\r\n\r\nconst renderCollapsedMenu = (menuItems, title, titleTooltip) => {\r\n    return <div className=\"designerToolbar\">\r\n        <div className=\"desginerDropdown\">\r\n            <i className=\"desginerDropbtn ui icon th\"/>\r\n            <div className=\"desginerDropdown-content\">\r\n                {menuItems.left.map(item => (<div key={item.key} className=\"desginerDropdown-item\">\r\n                    <i className={'ui icon ' + item.icon}/>\r\n                    <a>{item.text}</a>\r\n                </div>))}\r\n            </div>\r\n        </div>\r\n        &nbsp;\r\n        &nbsp;\r\n        {title && <div className=\"title\">{title}</div>}\r\n        {titleTooltip && <Popup \r\n            inverted\r\n            size='tiny' style={{opacity: '0.8'}} \r\n            content={titleTooltip} \r\n            trigger={<div className=\"infoContainer\">\r\n                <i className=\"ui icon info circle\"/>\r\n            </div>} \r\n        />}\r\n    </div>\r\n}\r\n\r\n\r\nconst Toolbar = ({containerWidth, menuItems, title, titleTooltip}) => {\r\n    if (containerWidth > WIDTH_LARGE || !containerWidth) {\r\n        return renderFullMenu(menuItems, title, titleTooltip);\r\n    }\r\n    else {\r\n        return renderCollapsedMenu(menuItems, title, titleTooltip);\r\n    }\r\n}\r\n\r\nexport default Toolbar;","import React, {useState} from 'react';\r\nimport Toolbar from '../components/toolbar';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport {saveNodeConfig} from '../actions/index';\r\nimport './hierarchyConfigPanel.css';\r\nimport Form, {Text as FormText, FormCheckbox, Dropdown as FormDropDown} from '../form/Form';\r\nimport ShowMessage, {NotifType} from '../helper/notification';\r\n\r\n\r\n// This is the  Right hand panel of the Hierarchy Designer, containing the toolbar and hierarchy page settings\r\n\r\nconst onSave = () => {\r\n\r\n}\r\n\r\nconst defaultInherit = true;\r\nconst defaultDisplay = true;\r\nconst defaultSpecialView = false;\r\nconst defaultPage = null;\r\nconst defaultPdf = false;\r\n\r\nconst menuItems = {\r\n    'left': [\r\n        {key:'designertb_save', icon: 'check', text: 'Apply', type:'submit'},\r\n    ],\r\n}\r\n\r\n/*\r\nconst dummyPages = ['None - Do not show',\r\n    'Default Page',\r\n    'Plant Hierarchy Page',\r\n    'Area Summary Page',\r\n    'Target Default Page',\r\n    'Loops Summary Page',\r\n    'Valves Summary Page',\r\n    'Rotating Equipment Summary Page',\r\n    'Loop KPI Page',\r\n    'Loop Diagnostics Page',\r\n    'Valve KPI Page',\r\n    'Valve Diagnostics Page',\r\n];\r\n*/\r\n\r\nconst renderPageOptions = (name, savedLayouts, disabled=false) => {\r\n    // return <select>\r\n    //     {dummyPages.map((page) => <option key={'option_'+page} value={page}>{page}</option>)};\r\n    // </select>\r\n    let options = savedLayouts.map((layout) => {return {key: `option_${layout.name}`, text: layout.name, value: layout.name}});\r\n    return <FormDropDown\r\n        name={name}\r\n        label={null}\r\n        options={options}    \r\n        disabled={disabled}\r\n    />\r\n}\r\n\r\n// Called when component mounts\r\n// Purpose is to set the initial values\r\nconst setControlValues = (setValueFunc, inputObj) => {\r\n    if (!inputObj || !inputObj.selectedNode) {\r\n        return;\r\n    }\r\n\r\n    setValueFunc('key', inputObj.selectedNode.key); // invisible field\r\n\r\n    let findUserSettings = null || inputObj.userSettings && inputObj.userSettings.find(x => x.key === inputObj.selectedNode.key);\r\n    if (!findUserSettings) {\r\n        setValueFunc('name', inputObj.selectedNode.title);\r\n        setValueFunc('inherit', defaultInherit);\r\n        setValueFunc('pageAssoc', defaultPage);\r\n        setValueFunc('childDefaultPage', defaultPage);\r\n        setValueFunc('displayWeb', defaultDisplay);\r\n        setValueFunc('displayReport', defaultPdf);\r\n        setValueFunc('displayAsMapView', defaultSpecialView);\r\n        setValueFunc('displayAsAnalysisView', defaultSpecialView);\r\n    }\r\n    else {\r\n        setValueFunc('name', findUserSettings.dispName);\r\n        setValueFunc('inherit', findUserSettings.inherit);\r\n        setValueFunc('pageAssoc', findUserSettings.pageAssoc);\r\n        setValueFunc('childDefaultPage', findUserSettings.childDefaultPage);\r\n        setValueFunc('displayWeb', findUserSettings.displayWeb);\r\n        setValueFunc('displayReport', findUserSettings.displayReport);\r\n        setValueFunc('displayAsMapView', findUserSettings.displayAsMapView || defaultSpecialView);\r\n        setValueFunc('displayAsAnalysisView', findUserSettings.displayAsAnalysisView || defaultSpecialView);\r\n    }\r\n\r\n    if (!inputObj.selectedNode.parent) {\r\n        setValueFunc('inherit', false); // for first level children, always uncheck inherit\r\n    }\r\n\r\n}\r\n\r\nconst onSubmit = (formArgs, action) => {\r\n    console.log('hier config panel submit!', formArgs, action);\r\n    action({\r\n        key: formArgs.key,\r\n        dispName: formArgs.name,\r\n        inherit: formArgs.inherit,\r\n        pageAssoc: formArgs.pageAssoc,\r\n        childDefaultPage: formArgs.childDefaultPage,\r\n        displayWeb: formArgs.displayWeb,\r\n        displayReport: formArgs.displayReport,\r\n        displayAsMapView: formArgs.displayAsMapView,\r\n        displayAsAnalysisView: formArgs.displayAsAnalysisView\r\n    });\r\n\r\n    ShowMessage('Properties Applied!', NotifType.success, 'Please click Save to persist the settings to database')\r\n}\r\n\r\n// TODO: export this to a common module\r\nexport const findInheritedPage = (selectedNode, userSettings) => {\r\n    //console.log('findInheritedPage', selectedNode);\r\n    if (!selectedNode) {\r\n        return null;\r\n    }\r\n    let currNode = selectedNode;\r\n    while (currNode.parent) {\r\n        let findUserSetting = userSettings.find(s => s.key === currNode.parent.key);\r\n        if (!findUserSetting || !findUserSetting.childDefaultPage) {\r\n            currNode = currNode.parent;\r\n            continue;\r\n        }\r\n\r\n        return findUserSetting.childDefaultPage;\r\n    }\r\n\r\n    return 'Not set';\r\n}\r\n\r\nconst renderHierPanelContent = (selectedNode, userSettings, myState, savedLayouts) => {\r\n    console.log('renderHierPanelContent', selectedNode);\r\n    if (!selectedNode || !selectedNode.key) {\r\n        return <div className=\"ui message orange\">No node is selected</div>\r\n    }\r\n\r\n    const inheritedPageRowStyle = !selectedNode.parent ? {display: 'none'} : {};\r\n    const inheritedPageSpanStyle = !myState.inherit ? {display: 'none'} : {};\r\n\r\n    return <div className=\"hierconfigPanelContent\">\r\n        <div className=\"ui message\">Showing properties for: <b>{selectedNode.key}</b></div>        \r\n        <table className=\"formTable\">\r\n            <tbody>\r\n                <tr style={{display: 'none'}}>\r\n                    <th>Key</th>\r\n                    <td>\r\n                        {/* <input defaultValue={selectedNode.title}></input> */}\r\n                        <FormText\r\n                            key={selectedNode.key+'_key'}\r\n                            name={'key'}\r\n                            label={null}\r\n                        />\r\n                    </td>\r\n                </tr>                \r\n                <tr>\r\n                    <th>Display Name</th>\r\n                    <td>\r\n                        {/* <input defaultValue={selectedNode.title}></input> */}\r\n                        <FormText\r\n                            key={selectedNode.key+'_name'}\r\n                            name={'name'}\r\n                            label={null}\r\n                        />\r\n                    </td>\r\n                </tr>\r\n                <tr style={inheritedPageRowStyle}>\r\n                    <th>Inherit Default Page from Parent</th>\r\n                    <td>\r\n                        <FormCheckbox\r\n                            name='inherit'\r\n                        />\r\n                        {myState.inherit && <span>Inherited Page: </span>}\r\n                        {myState.inherit && <span>{findInheritedPage(selectedNode, userSettings)}</span>}\r\n                    </td>\r\n                </tr>                \r\n                <tr>\r\n                    <th>Page Associated</th>\r\n                    <td>\r\n                        {renderPageOptions('pageAssoc', savedLayouts, myState.inherit)}\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <th>Children Default Page</th>\r\n                    <td>\r\n                        {renderPageOptions('childDefaultPage', savedLayouts)}\r\n                    </td>\r\n                </tr>\r\n                <tr>\r\n                    <th>Display in Web Browser</th>\r\n                    <td>\r\n                        <FormCheckbox\r\n                            name='displayWeb'\r\n                            disabled\r\n                        />\r\n                    </td>\r\n                </tr>                    \r\n                <tr>\r\n                    <th>Display in PDF Report</th>\r\n                    <td>\r\n                        <FormCheckbox\r\n                            name='displayReport'\r\n                        />\r\n                    </td>\r\n                </tr>   \r\n\r\n                <tr>\r\n                    <th>Display as Map View tab</th>\r\n                    <td>\r\n                        <FormCheckbox\r\n                            name='displayAsMapView'\r\n                        />\r\n                    </td>\r\n                </tr>                                    \r\n\r\n                <tr>\r\n                    <th>Display as Analysis View tab</th>\r\n                    <td>\r\n                        <FormCheckbox\r\n                            name='displayAsAnalysisView'\r\n                        />\r\n                    </td>\r\n                </tr>                                    \r\n            </tbody>\r\n        </table>\r\n        {/* <div className=\"ui message olive\">TODO: Implement this panel as Tree List View to allow bulk edit</div> */}\r\n    </div>\r\n}\r\n\r\n// saveNodeConfig: redux action to save the node settings\r\n// selectedNode: from redux store\r\n// userSettings: from redux store\r\nconst HierConfigPanel = ({containerWidth, selectedNode, userSettings, saveNodeConfig, savedLayouts}) => {\r\n    console.log('render HierConfigPanel', userSettings);\r\n\r\n    const [myState, setMyState] = useState({\r\n        inherit: defaultInherit});\r\n\r\n    return <Form \r\n        className=\"hierConfigPanelContainer\" \r\n        // key='form' \r\n        onSubmit={(args) => onSubmit(args, saveNodeConfig)} \r\n        inputObj={{selectedNode, userSettings}}\r\n        inputObjId={selectedNode && selectedNode.key}\r\n        //inputObj={selectedNode} \r\n        setControlValues={setControlValues}\r\n        watchedField={'inherit'}\r\n        setStateCb={setMyState}\r\n        >        \r\n        <Toolbar \r\n            containerWidth={containerWidth}\r\n            menuItems={menuItems}\r\n        />\r\n        {renderHierPanelContent(selectedNode, userSettings, myState, savedLayouts)}\r\n        </Form>\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        hierarchyTree: state.hierarchyDesigner.hierarchyTree,\r\n        selectedNode: state.hierarchyDesigner.selectedNode,\r\n        userSettings: state.hierarchyDesigner.userSettings,\r\n        savedLayouts: state.mainApp.masterLayouts\r\n    }\r\n}\r\n  \r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({ saveNodeConfig }, dispatch);\r\n}\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(HierConfigPanel);","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport NoobSplitter from '../components/noobSplitter';\r\nimport DesignerContentbase from './designerContentBase';\r\nimport HierarchyTree from './hierearchyTree';\r\nimport ReportForm from '../components/reportForm';\r\nimport {selectDashboardTree} from '../actions';\r\nimport {findInheritedPage} from '../containers/hierarchyConfigPanel';\r\nimport {reconstructHierarchyStack, findNodeByKey} from '../helper/treefilter';\r\nimport './dashboardContent.css';\r\nimport { Button } from 'semantic-ui-react';\r\n//import ShowMessage, { NotifType } from '../helper/notification';\r\nimport Form, {FormDateRange, FormFilterInput} from '../form/Form';\r\nimport {dateRangeDropdownOptions} from '../form/FormDateRange';\r\n\r\nconst DEFAULT_SPLIT_SIZES = [15, 85];\r\n\r\n\r\n// Main Dashboard containing the Treeview (designed using Hierarchy Designer)\r\n// and Dashboard contents (layout designed using Forms Designer)\r\nclass DashboardContent extends DesignerContentbase { \r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            ...this.state,\r\n            pageFilters: []\r\n        };\r\n    }\r\n\r\n    onSelect = (selectedKeys, info) => {\r\n        console.log(\"dashboard tree onSelect...\", selectedKeys, info);\r\n        if (selectedKeys.length > 0) {\r\n            this.props.selectDashboardTree(\r\n              selectedKeys[0]\r\n            );\r\n        }\r\n        else {\r\n            this.props.selectDashboardTree(null);\r\n        }\r\n\r\n        // Reset the page filter\r\n        this.setState({pageFilters: []});\r\n    }\r\n\r\n    getLayoutName = (userSettings, treeData) => {\r\n        let selectedNodeKey = this.props.selectedNodeKey;\r\n        if (!selectedNodeKey || !userSettings) {\r\n            return null;\r\n        }\r\n\r\n        // if there is an associated page, use that directly.\r\n        let findUserSetting = userSettings.find(setting => setting.key === selectedNodeKey);        \r\n        if (findUserSetting && findUserSetting.inherit === false) {\r\n            return findUserSetting.pageAssoc;\r\n        }\r\n        else {\r\n            // otherwise, use the inherited page\r\n            let findNode = findNodeByKey(treeData, selectedNodeKey);\r\n            if (!!findNode && findNode.item) {\r\n                return findInheritedPage(findNode.item, userSettings);\r\n            }            \r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    getLayoutObj = (layoutName) => {\r\n        let findLayout = this.props.masterLayouts && this.props.masterLayouts.find(layout => layout.name === layoutName);\r\n        return {\r\n            controls: findLayout && JSON.parse(findLayout.layoutJson),\r\n            layoutData: findLayout && {\r\n                rows: findLayout.numRows,\r\n                columns: findLayout.numCols,\r\n                pageFilterFields: findLayout.pageFilterFields && JSON.parse(findLayout.pageFilterFields),\r\n                pageApiData: findLayout.pageApiData && JSON.parse(findLayout.pageApiData)\r\n            }\r\n        }\r\n    }\r\n\r\n    // This is for debugging only!\r\n    renderDatasetFilters = () => {\r\n        if (!this.props.chartClickFilters || Object.keys(this.props.chartClickFilters).length <= 0) {\r\n            return null;\r\n        }\r\n\r\n        return (<table id=\"dashboardFiltersTable\">\r\n            <thead>\r\n                <tr style={{border: \"1px solid gray\"}}>\r\n                    <td>Dataset ID</td>\r\n                    <td>Control ID</td>\r\n                    <td>Stack ID</td>\r\n                    <td>Own Filter</td>\r\n                    <td>Own Series</td>\r\n                    {/* <td>Carryover Filter</td> */}\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n            {\r\n                Object.keys(this.props.chartClickFilters).map((datasetId, iDataset) => {\r\n                    let currDatasetFilters = this.props.chartClickFilters[datasetId];\r\n                    return Object.keys(currDatasetFilters).map((currCtrlId, iCtrl) => {\r\n                        let currControlFilter = currDatasetFilters[currCtrlId];   \r\n                        return Object.keys(currControlFilter).map((currStackStr, iStack) => {\r\n                            let currStackFilter = currControlFilter[currStackStr];\r\n                            let sliceInfo = currStackFilter.sliceInfo;\r\n                            let seriesInfo = currStackFilter.seriesInfo;\r\n                            return <tr key={`filterTable-${iStack}`} style={{border: \"1px solid gray\"}}>\r\n                                <td>Dataset: {datasetId}, </td>\r\n                                <td>ControlId: {currCtrlId}, </td>\r\n                                <td>Group: {currStackStr}, </td>\r\n                                <td>{JSON.stringify(sliceInfo.origObj)}</td>\r\n                                <td>{JSON.stringify(seriesInfo)}</td>\r\n                                {/* <td>{JSON.stringify(currStackFilter.carryOverFilters)}</td> */}\r\n                            </tr>\r\n                        })\r\n                        \r\n                    })\r\n                })\r\n            }\r\n            </tbody>\r\n        </table>)\r\n    }\r\n\r\n    // For now, just hard code \"analysis period\". No time to implement proper checking!\r\n    onSubmitFilter = (filterData, layoutObj) => {\r\n        console.log('[dashboard filter submit]', filterData);\r\n        if (!Array.isArray(layoutObj.layoutData.pageFilterFields)) {\r\n            return;\r\n        }\r\n        let pageFiltersFormatted = [];\r\n        layoutObj.layoutData.pageFilterFields.forEach(layoutFilter => {\r\n            if (layoutFilter.toLocaleLowerCase() === 'analysisperiod') {\r\n                pageFiltersFormatted.push({\r\n                    name: \"AnalysisPeriod\",\r\n                    value: filterData.AnalysisPeriod.value,\r\n                    startDate: filterData.AnalysisPeriod.start,\r\n                    endDate: filterData.AnalysisPeriod.end\r\n                });\r\n            }\r\n            else if (!!filterData[layoutFilter] && filterData[layoutFilter].length > 0){\r\n                pageFiltersFormatted.push({\r\n                    name: layoutFilter,\r\n                    value: filterData[layoutFilter]\r\n                });\r\n            }\r\n    \r\n        });\r\n\r\n        this.setState({\r\n            pageFilters: pageFiltersFormatted\r\n        })\r\n    }\r\n\r\n    // Renders 1 filter\r\n    renderPageFilter = (filterName, metadata) => {\r\n        // Find the metadata first, then get the datatype, then render the filter based on the datatype\r\n        // TODO: check the metadata\r\n        if (filterName.toLocaleLowerCase() === 'analysisperiod') {\r\n            return <FormDateRange key={'pageFilter_'+filterName} name={filterName} label=\"Analysis Period:\"\r\n            />\r\n        }\r\n        else {\r\n            return <FormFilterInput key={'pageFilter_'+filterName} name={filterName}/>\r\n        }\r\n    }\r\n\r\n    setPageFilterControlValues = (setValueFunc, pageFilterFields) => {\r\n        if (!Array.isArray(pageFilterFields)) {\r\n            return;\r\n        }\r\n\r\n        pageFilterFields.forEach(filterName => {\r\n            if (filterName.toLocaleLowerCase() === 'analysisperiod') {\r\n                setValueFunc(\"AnalysisPeriodValue\", dateRangeDropdownOptions[0].value)\r\n            }\r\n        });\r\n    }\r\n\r\n    renderPageToolbar = (layoutObj, metadata, layoutName) => {\r\n        if (!layoutObj || !layoutObj.layoutData || !Array.isArray(layoutObj.layoutData.pageFilterFields) || layoutObj.layoutData.pageFilterFields.length <= 0) {\r\n            return null;\r\n        }\r\n\r\n        return <Form className=\"pageToolbar\" \r\n            key='formDataDesigner' \r\n            onSubmit={(formData) => {this.onSubmitFilter(formData, layoutObj)}} \r\n            // onSubmit={data => {debugger}}\r\n            setControlValues={this.setPageFilterControlValues}\r\n            // watchedField={[]}\r\n            // // inputObj: set it to the loaded data source when saving is implemented\r\n            inputObj={layoutObj.layoutData.pageFilterFields} \r\n            inputObjId={layoutName}\r\n            // setStateCb={setStateCb}\r\n            >\r\n            <div className=\"pageToolbarFieldContainer\">\r\n            {layoutObj.layoutData.pageFilterFields.map(pageFilter => {\r\n                return (this.renderPageFilter(pageFilter, metadata));\r\n            })}\r\n            </div>    \r\n            <div className=\"toolbarButtonContainer\">\r\n            <Button primary fluid={false} size='small'>Apply Filter</Button>\r\n            </div>  \r\n            </Form>\r\n    }\r\n\r\n    renderForm = (layoutName, layoutObj, metadata) => {\r\n        if (!this.props.selectedNodeKey) {\r\n            return <div className=\"ui message orange\">Please select a node from the treeview on the left!</div>\r\n        }\r\n        return <div>\r\n            {this.renderPageToolbar(layoutObj, metadata, layoutName)}\r\n            {/* {this.renderDatasetFilters()} */}\r\n            <ReportForm\r\n                containerWidth={this.state.rightPixels}\r\n                layoutData={layoutObj.layoutData}\r\n                controls={layoutObj.controls}\r\n                metadata={metadata}\r\n                layoutName={layoutName}\r\n                pageFilters={this.state.pageFilters}\r\n            />\r\n        </div>\r\n    }\r\n    \r\n    render() {\r\n        console.log('render dashboard...', this.props.selectedNodeKey);\r\n        let treeData = this.props.hierarchyView && reconstructHierarchyStack(JSON.parse(this.props.hierarchyView.hierarchyJson));\r\n        let userSettings = this.props.hierarchyView && JSON.parse(this.props.hierarchyView.nodeSettingsJson)\r\n        let layoutName = this.getLayoutName(userSettings, treeData);\r\n        let layoutObj = this.getLayoutObj(layoutName);\r\n        // TODO: Put a minsize first. Should make the toolbar buttons responsive.\r\n        // Given the selectedNode, render the appropriate layout\r\n        return <NoobSplitter id=\"hierarchyDesigner\" onDragEnd={this.onSplitDragEnd} defaultSize={DEFAULT_SPLIT_SIZES} minSize={230}>\r\n            {this.props.hierarchyView && <HierarchyTree \r\n                    onSelectCb={this.onSelect} \r\n                    selectedNodeKey={this.props.selectedNodeKey}\r\n                    // onHierarchyChanged={this.onHierarchyChanged}\r\n                    treeData={treeData}\r\n                    userSettings={userSettings}\r\n                    controlledExpansion\r\n                    hiddenNodesSettings={['displayAsMapView', 'displayAsAnalysisView']}\r\n                    defaultExpandAll={true}\r\n            />\r\n            }\r\n            {this.renderForm(layoutName, layoutObj, this.props.metadata)}            \r\n        </NoobSplitter>\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    // Select the appropriate hierarchy tree to be included into the props\r\n    let masterHierarchyViews = state.mainApp.masterHierarchyViews;\r\n    let defaultView = masterHierarchyViews && masterHierarchyViews[0];\r\n    \r\n    return {\r\n        hierarchyView: defaultView,\r\n        masterLayouts: state.mainApp.masterLayouts,\r\n        selectedNodeKey: state.dashboard.selectedNodeKey,\r\n        chartClickFilters: state.dashboard.chartClickFilters,\r\n        metadata: state.mainApp.masterMetadata\r\n    }\r\n}\r\n  \r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({selectDashboardTree }, dispatch);\r\n}\r\n  \r\nexport default connect(mapStateToProps, mapDispatchToProps)(DashboardContent);","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport PropTypes from 'prop-types';\r\nimport ReactDOM from 'react-dom';\r\nimport Tree, { TreeNode } from 'rc-tree';\r\nimport 'rc-tree/assets/index.css';\r\nimport './treeview.css';\r\n//import './basic.less';\r\nimport { selectToolPanelTree } from '../actions/index';\r\n\r\nconst treeDataSample = [\r\n  { key: '0-0', title: 'Plant', children:\r\n    [\r\n      { key: '0-0-0', title: 'Area1', isCollapsed: true, children:\r\n        [\r\n          { key: '0-0-0-0', title: 'Apple' },\r\n        ],\r\n      },\r\n      { key: '0-0-1', title: 'Area2', children:\r\n          [\r\n            { key: '0-0-1-0', title: 'Banana',},\r\n            { key: '0-0-1-1', title: 'Carrot' },\r\n            { key: '0-0-1-2', title: 'Dolphin' },\r\n            { key: '0-0-1-3', title: 'Elephant' },\r\n            { key: '0-0-1-4', title: 'Father' },\r\n            { key: '0-0-1-5', title: 'Germany' },\r\n            { key: '0-0-1-6', title: 'Holland' },\r\n            { key: '0-0-1-7', title: 'India' },\r\n            { key: '0-0-1-8', title: 'Japan' },\r\n            { key: '0-0-1-9', title: 'Kristaps' },\r\n            { key: '0-0-1-10', title: 'Lion' },\r\n            { key: '0-0-1-11', title: 'Mexico' },\r\n            { key: '0-0-1-12', title: 'Nigeria' },\r\n            { key: '0-0-1-13', title: 'Carrot Apple' },\r\n            { key: '0-0-1-14', title: 'Strawberry Banana' },\r\n            { key: '0-0-1-15', title: 'Godfather' },\r\n            { key: '0-0-1-16', title: 'Indian Mango' },\r\n            { key: '0-0-1-17', title: 'Dandelion' },\r\n            { key: '0-0-1-18', title: 'Lionel' },\r\n            { key: '0-0-1-19', title: 'Millionaire' },\r\n            { key: '0-0-1-20', title: 'The quick brown fox jumps over the lazy dog' },\r\n            { key: '0-0-1-21', title: 'abcdefghijklmnopqrstuvwxyz123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ' },\r\n            { key: '0-0-1-22', title: ',,,' },\r\n          ],\r\n      },\r\n    ],\r\n  },\r\n];\r\n\r\nclass DemoTree extends React.Component {\r\n  static propTypes = {\r\n    keys: PropTypes.array,\r\n  };\r\n  static defaultProps = {\r\n    keys: ['0-0', '0-0-1', '//Plant'],\r\n  };\r\n  constructor(props) {\r\n    super(props);\r\n    const keys = props.keys;\r\n    this.state = {\r\n      defaultExpandedKeys: keys,\r\n      //defaultSelectedKeys: keys,\r\n      defaultSelectedKeys: [],\r\n      defaultCheckedKeys: keys,\r\n    };\r\n  }\r\n  onExpand = (...args) => {\r\n    console.log('onExpand', ...args);\r\n  };\r\n  onSelect = (selectedKeys, info) => {\r\n    console.log('selected', selectedKeys, info);\r\n    this.selKey = info.node.props.eventKey;\r\n    // Fire an action to save the selected node to Redux\r\n    //this.props.selectToolPanelTree(this.selKey);\r\n    if (selectedKeys.length > 0) {\r\n        this.props.selectToolPanelTree({\r\n          key: selectedKeys[0], \r\n          ...info.selectedNodes[0].props\r\n        });\r\n    }\r\n    else {\r\n        this.props.selectToolPanelTree(null);\r\n    }\r\n\r\n    if (this.tree) {\r\n      console.log(\r\n        'Selected DOM node:',\r\n        selectedKeys.map(key => ReactDOM.findDOMNode(this.tree.domTreeNodes[key])),\r\n      );      \r\n    }\r\n  };\r\n  onCheck = (checkedKeys, info) => {\r\n    console.log('onCheck', checkedKeys, info);\r\n  };\r\n  onEdit = () => {\r\n    setTimeout(() => {\r\n      console.log('current key: ', this.selKey);\r\n    }, 0);\r\n  };\r\n  onDel = (e) => {\r\n    if (!window.confirm('sure to delete?')) {\r\n      return;\r\n    }\r\n    e.stopPropagation();\r\n  };\r\n  setTreeRef = (tree) => {\r\n    this.tree = tree;\r\n  };\r\n\r\n  Icon = (props) => {\r\n      //console.log('icon', props)\r\n      if (props.nodeType === 'Plant' || props.nodeType === 'Folder' || props.children.length > 0) {\r\n        return <i className='ui icon folder outline'></i>\r\n      }\r\n      else {\r\n        \r\n        return <i className='ui icon genderless'></i>\r\n      }\r\n      \r\n  }\r\n\r\n  // Sample filter...\r\n  // It only highlights the node, instead of hiding everything else.\r\n  // TODO: change this behaviour\r\n  Filterer = (node) => {\r\n      //console.log('Filterer', node);\r\n    //   if (node.props.title === 'Apple') {\r\n    //       return true\r\n    //   }\r\n      return false;\r\n  }\r\n\r\n  getSwitcherIcon = (node) => {\r\n    if (node.isLeaf) {\r\n      return null;\r\n    }\r\n\r\n    if (node.expanded) {\r\n      return <i className=\"ui icon angle down\"></i>  \r\n    }\r\n    return <i className=\"ui icon angle right\"></i>\r\n  }\r\n\r\n  render() {\r\n    let treeDataArr = convertMasterDataToKeys(this.props.masterHierarchy);\r\n    if(!treeDataArr) {\r\n      return <div>Loading...</div>\r\n    }\r\n\r\n    console.log('render demo tree...', this.props.masterHierarchy);\r\n    return (    \r\n    <div>\r\n        <div className=\"ui icon input small\" style={{margin: \"5px\", width: \"calc(100% - 10px)\"}}>\r\n            <input type=\"text\" placeholder=\"Search tree...\"/>\r\n            <i className=\"inverted circular filter icon\"></i>\r\n        </div>\r\n        <Tree style={{overflow: \"auto\", height: \"100%\", width: \"calc(100%)\", padding: \"0 0 20 0\"}}\r\n            className=\"myCls\"\r\n            showLine\r\n            selectable\r\n            checkable={false}\r\n            //defaultExpandAll\r\n            onExpand={this.onExpand}\r\n            defaultExpandedKeys={this.state.defaultExpandedKeys}\r\n            defaultSelectedKeys={this.state.defaultSelectedKeys}\r\n            defaultCheckedKeys={this.state.defaultCheckedKeys}\r\n            onSelect={this.onSelect}\r\n            onCheck={this.onCheck}\r\n            //treeData={treeData}\r\n            treeData={[treeDataArr]}\r\n            icon={this.Icon}\r\n            filterTreeNode={this.Filterer}\r\n            switcherIcon={this.getSwitcherIcon}\r\n        />\r\n    </div>\r\n    );\r\n  }\r\n}\r\n\r\nconst convertMasterDataToKeys = (apiNode) => {\r\n  if (!apiNode) {\r\n    return null;\r\n  }\r\n\r\n  let childNodes = [];\r\n  let treeData = {\r\n    key: apiNode.fullPath,\r\n    title: apiNode.name,\r\n    nodeType: apiNode.nodeType,\r\n    category: apiNode.category\r\n  };\r\n\r\n  if (apiNode.children) {\r\n    apiNode.children.forEach(node => {\r\n      childNodes.push(convertMasterDataToKeys(node));\r\n    })\r\n\r\n    treeData.children = childNodes;\r\n  }\r\n\r\n  return treeData;\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n  return {\r\n    masterHierarchy: state.mainApp.masterHierarchy\r\n  }\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({ selectToolPanelTree }, dispatch);\r\n}\r\n\r\n//export default DemoTree;\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DemoTree)","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport './toolAvailableData.css';\r\n\r\nconst renderAvailableData = (items) => {\r\n    if (!items) {\r\n        return null;\r\n    }\r\n     \r\n    return items.map( (item) => {\r\n        //debugger\r\n        return <div key={item.name} className=\"ui grey horizontal label large availableData\" draggable=\"true\">{item.name}</div>\r\n    })\r\n}\r\n\r\nconst GetAvailableItems = (node, masterAvailableData) => {\r\n    let retList = [];\r\n    if (!masterAvailableData || !node) {\r\n        return retList;\r\n    }\r\n   \r\n    // [1] Check if there is any hierarchy that matches\r\n    let findMatchHierarchy = masterAvailableData.find(m => m.selectionType === 'HierarchyName' && m.hierarchy === node.key);\r\n    if (!!findMatchHierarchy) {\r\n        retList = retList.concat(findMatchHierarchy.kpiNameList);    \r\n    }\r\n    \r\n\r\n    // [2] Check Categories that match\r\n    if (!!node.category) {\r\n        let findMatchCategory = masterAvailableData.find(m => m.selectionType === 'Category' && m.category === node.category);\r\n        if (!!findMatchCategory) {\r\n            retList = retList.concat(findMatchCategory.kpiNameList);    \r\n        }\r\n    }\r\n\r\n    // [3] Check Node Types that match\r\n    if (!!node.nodeType) {\r\n        let findMatchNodeType = masterAvailableData.find(m => m.selectionType === 'NodeType' && m.nodeType === node.nodeType);\r\n        if (!!findMatchNodeType) {\r\n            retList = retList.concat(findMatchNodeType.kpiNameList);  \r\n        }\r\n    }\r\n\r\n    console.log('GetAvailableItems', retList);\r\n    return retList.map(kpi => {return {name: kpi}});\r\n}\r\n\r\nconst ToolAvailableData = (props) => {\r\n\r\n    let {selectedNode} = props;\r\n    if (!selectedNode) {\r\n        return <div className=\"ui warning message\">\r\n            <i className=\"ui icon exclamation circle large\"></i>\r\n            Please select a target or folder from the Hierarchy tree above\r\n        </div>\r\n    }\r\n\r\n    let availableItems = GetAvailableItems(selectedNode, props.masterAvailableData);\r\n    return <div className=\"dataContainer\">\r\n        Showing Available Data for key: {selectedNode.key}\r\n        {renderAvailableData(availableItems)}\r\n    </div>\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return { \r\n        selectedNode: state.designer.toolPanelTreeSelected ,\r\n        masterAvailableData: state.mainApp.masterAvailableData,\r\n    };\r\n}\r\n\r\n//export default ToolAvailableData;\r\nexport default connect(mapStateToProps)(ToolAvailableData)","// Testing the scrollspy library\r\nimport React from 'react';\r\nimport Scrollspy from 'react-scrollspy';\r\nimport '../styles/Scrollspy.css';\r\n\r\nclass scrollTracker extends React.Component {\r\n    // return <div>\r\n    render() {\r\n        return <Scrollspy \r\n            items={ ['section-title', 'section-1', 'section-2', 'section-3', 'section-4']} \r\n            rootEl=\"#homeRight\"\r\n            currentClassName=\"current\">\r\n            <li><a href=\"#section-title\">Title</a></li>\r\n            <li><a href=\"#section-1\">Sunflower</a></li>\r\n            <li><a href=\"#section-2\">Happier</a></li>\r\n            <li><a href=\"#section-3\">I Took a Pill in Ibiza</a></li>\r\n            <li><a href=\"#section-4\">Animals</a></li>\r\n            {/* </div> */}\r\n        </Scrollspy>;\r\n    }\r\n  \r\n}\r\n\r\nexport default scrollTracker;","import React from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport { Form as SemanticForm, Segment, Button} from \"semantic-ui-react\";\r\nimport Form, {Dropdown as FormDropDown} from '../form/Form';\r\nimport './settingsContent.css';\r\nimport ShowMessage, {NotifType} from '../helper/notification';\r\nimport {deleteImage, fetchImages} from '../actions';\r\nimport {createOrReplaceImage, deleteImage as deleteLocalImage} from '../helper/localStorageHelper';\r\n\r\n\r\n\r\nexport const convertToDropdownOptions = (imagesStrArr) => {\r\n    if (!Array.isArray(imagesStrArr)) {\r\n        return [];\r\n    }\r\n\r\n    return imagesStrArr.map(image => {\r\n        return {\r\n            key: image,\r\n            text: image,\r\n            value: image\r\n        };\r\n    })\r\n}\r\n\r\n\r\nconst SettingsContent = () => {\r\n    const reduxStoreImages = useSelector(state => state.mainApp.masterImages);\r\n    const dispatch = useDispatch();\r\n\r\n    const handleFormSubmit = (args) => {\r\n        if (!args || !args.target || !args.target.length > 0 || !args.target[0].files || !args.target[0].files.length > 0 ) {\r\n            ShowMessage(\"Image uploaded!\", NotifType.danger, \"Cannot open file!\");\r\n            return;\r\n        }\r\n\r\n        debugger\r\n\r\n\r\n        var reader = new FileReader();\r\n        let file = args.target[0].files[0]\r\n        reader.readAsDataURL(file);\r\n        reader.onload = function () {\r\n            //console.log(reader.result);\r\n            // reader.result is in base64 format\r\n            createOrReplaceImage(file.name, reader.result);\r\n            ShowMessage(\"Image uploaded!\", NotifType.success, \"Please refresh the browser to see it in the image lists!\");\r\n          };        \r\n    }\r\n\r\n    const onSubmitDelete = (formData) => {\r\n        if (!formData || !formData.settingsImageDropdown) {\r\n            return;\r\n        }\r\n    \r\n        let fileName = formData.settingsImageDropdown;\r\n        // dispatch(deleteImage(fileName)).then( () => {            \r\n        //     console.log('deleted image!');\r\n        //     ShowMessage(\"Deleted Image!\");\r\n        //     dispatch(fetchImages());\r\n        // });\r\n        deleteLocalImage(fileName);\r\n        ShowMessage(\"Deleted Image!\");\r\n    }\r\n    \r\n    return <div className=\"settingsContentContainer\">\r\n        <iframe name=\"hiddenFrame\" className=\"hiddenFrame\"></iframe>\r\n        <Segment>\r\n            <div className=\"segmentTitle\">Upload Image</div>\r\n            <form \r\n                className=\"uploadImageForm\"\r\n                encType=\"multipart/form-data\" \r\n                // action=\"http://localhost:5000/fileupload\"                 \r\n                target=\"hiddenFrame\"\r\n                onSubmit={handleFormSubmit}>\r\n                <input className=\"ui button fileInputImageUpload\" type=\"file\" name=\"uploadedFile\" accept=\"image/*\"/>\r\n                <br/>\r\n                <br/>\r\n                <input className=\"ui button primary submitBtnImageUpload\" type=\"submit\" name=\"upload\"/>\r\n            </form>\r\n        </Segment>\r\n\r\n        <Segment>\r\n            <div className=\"segmentTitle\">Delete Image</div>\r\n            <Form className=\"deleteImageForm\" onSubmit={onSubmitDelete}>\r\n                <FormDropDown\r\n                    name=\"settingsImageDropdown\"\r\n                    options={convertToDropdownOptions(reduxStoreImages)}\r\n                    fluid={false}\r\n                />\r\n                <Button color=\"red\">Delete</Button>\r\n            </Form>\r\n        </Segment>\r\n    </div>\r\n}\r\n\r\nexport default SettingsContent;","import React, {useState, useEffect} from 'react';\r\nimport { useSelector, useDispatch } from 'react-redux';\r\nimport {Modal, Header, Button, Icon, Image} from 'semantic-ui-react';\r\nimport Form, {Text as FormText, Dropdown as FormDropdown, FormImageCoord} from '../form/Form';\r\nimport './imageMapConfigDialog.css';\r\nimport ImageMapper from '../controls/imageMapperLib';\r\nimport {convertToDropdownOptions} from '../containers/settingsContent';\r\nimport {getAprBaseUrl} from '../api/masterData';\r\nimport {applyImageMapProps} from '../actions';\r\nimport {getImageFromLocal} from '../helper/localStorageHelper';\r\n\r\nconst KEY_NAME = \"dropdownImage\";\r\n\r\nconst DEFAULTMAP = {\r\n\tname: \"imageConfigMap\",\r\n    areas: [],\r\n}\r\n\r\nconst DEFAULT_COORDS = {x: -1, y: -1};\r\nconst DEFAULT_NAME = 'SPOT X';\r\n\r\nconst ImageMapConfigDialog = ({showOpenForm, onCloseOpenConfigDialog, selectedControl}) => {\r\n    let initialImage, initialMap;\r\n    if (selectedControl && selectedControl.data && selectedControl.data.imageProps) {\r\n        initialImage = selectedControl.data.imageProps.image;\r\n        initialMap = selectedControl.data.imageProps.map;\r\n    }\r\n\r\n    // Watch the state, to disable the Save button if it's empty\r\n    const [myState, setMyState] = useState({dropdownImage: initialImage}); // bound to the dropdown watch field\r\n    // TODO: Remove all existing hostpots if user changed the image?\r\n    //const [imageName, setImageName] = useState(null); // our own tracking\r\n\r\n    const [addingHotspot, setAddingHotspot] = useState(false);\r\n    const [coords, setCoords] = useState(DEFAULT_COORDS); // Current mouse move coordinates\r\n    const [map, setMap] = useState(initialMap || DEFAULTMAP); // For the image mapper\r\n    const reduxStoreImages = useSelector(state => state.mainApp.masterImages);\r\n    const dispatch = useDispatch();\r\n\r\n    useEffect(() => {\r\n        console.log(\"imagemap config useEffect\", initialMap);\r\n        if (initialImage) {\r\n            setMyState({dropdownImage: initialImage});\r\n        }\r\n        if (initialMap) {\r\n            setMap(initialMap);\r\n        }\r\n    }, [initialImage, initialMap]);\r\n\r\n    const handleHostpotBtnClick = () => {\r\n        setAddingHotspot(!addingHotspot);\r\n    }\r\n\r\n    // This will be the \"permanent name\" of the spot.\r\n    // Purpose is just for unique identifier.\r\n    // The user can still change the \"display name\" though\r\n    const generateSpotName = () => {\r\n        if (!map || !Array.isArray(map.areas)) {\r\n            return \"SPOT 0\";\r\n        }\r\n        let candidateVal = 0;\r\n        while(true) {\r\n            let candidateName = `SPOT ${candidateVal}`;\r\n            if (!map.areas.find(a => a.name === candidateName)) {\r\n                return candidateName;\r\n            }\r\n            candidateVal++;\r\n        }\r\n    }\r\n\r\n    const handleMouseMove = (evt) => {\r\n        if (!addingHotspot) {\r\n            return;\r\n        }     \r\n        const coords = { x: evt.nativeEvent.layerX, y: evt.nativeEvent.layerY };\r\n        //console.log('handleMouseMove', coords);\r\n        //setCoords(coords);\r\n    }\r\n\r\n    const handleMouseClick = (evt) => {\r\n        const currCoords = { x: evt.nativeEvent.layerX, y: evt.nativeEvent.layerY };\r\n        console.log('handleMouseClick', currCoords);\r\n        setAddingHotspot(false);\r\n        if (!addingHotspot) {\r\n            return;\r\n        }\r\n        if (currCoords.x  < 0 || currCoords.y < 0) {\r\n            return;\r\n        }\r\n        \r\n        let mapClone = {...map};\r\n        setMap(mapClone);\r\n        mapClone.areas = [...map.areas];\r\n        mapClone.areas.push({\r\n            name: generateSpotName(), shape: \"circle\", coords: [currCoords.x, currCoords.y, 15 ], preFillColor: \"red\"\r\n        });\r\n\r\n        //setCoords(DEFAULT_COORDS);\r\n    }\r\n\r\n    const renderCoordsForm = () => {\r\n        console.log('renderCoordsForm', map.areas)\r\n        return <div className=\"coordContainer\">\r\n        {map.areas.map(area => {\r\n            return <FormImageCoord key={\"formImageArea-\" + area.name} name={area.name}\r\n                x={area.coords[0]}\r\n                y={area.coords[1]}\r\n                color={area.preFillColor}\r\n                />\r\n            })\r\n        }\r\n        </div>\r\n    }\r\n\r\n    const handleChangeImage = (evt, data) => {\r\n        // Does not work. Anticipate changes using watchFields\r\n    }\r\n\r\n    const handleClose = () => {\r\n        if (!onCloseOpenConfigDialog) {\r\n            return;\r\n        }\r\n        onCloseOpenConfigDialog(false);\r\n    }\r\n\r\n    const handleSubmit = (formData) => {\r\n        console.log('handleSubmit, formData:', formData);\r\n        let image = null;\r\n        let areas = [];\r\n\r\n        for (let prop in formData) {\r\n            if (prop === \"dropdownImage\") {\r\n                image = formData[prop];\r\n            }\r\n            else {\r\n                let areaData = formData[prop];\r\n                areas.push({\r\n                    name: areaData.name,\r\n                    shape: \"circle\", \r\n                    coords: [areaData.x, areaData.y, 15 ], \r\n                    preFillColor: areaData.color\r\n                })\r\n            }\r\n        }\r\n        \r\n        let newMap = {\r\n            name: `${selectedControl.i}-imageConfigMap`,\r\n            areas: areas\r\n        };\r\n\r\n        console.log('handleSubmit, newMap:', newMap);\r\n        setMap(newMap);\r\n        \r\n        //console.log('handleSubmit, map', map);\r\n        // Fire a redux action\r\n        dispatch(applyImageMapProps(image, newMap, selectedControl));        \r\n    }\r\n\r\n    // This function is called every render to initialize the values\r\n    const setHotspotValues = (setValueFunc, mapParam) => {\r\n        if (!map || !Array.isArray(map.areas)) {\r\n            return;\r\n        }\r\n\r\n        // if (!Array.isArray(mapParam)) {\r\n        //     return;\r\n        // }\r\n\r\n        console.log(\"setHotspotValues\", );\r\n        setValueFunc('dropdownImage', myState.dropdownImage);\r\n\r\n        map.areas.forEach(area => {\r\n            setValueFunc(area.name+'.name', area.name); // this is just the display name\r\n            setValueFunc(area.name+'.x', area.coords[0]);\r\n            setValueFunc(area.name+'.y', area.coords[1]);\r\n            setValueFunc(area.name+'.color', area.preFillColor);\r\n        });\r\n    }\r\n\r\n    console.log('ImageMapConfigDialog render', selectedControl.i, map);\r\n    // We just need a unique identifier for the form to rerender itself\r\n    let inputObjId = JSON.stringify({\r\n        controlId: selectedControl.i,\r\n        map: map\r\n    });\r\n\r\n    return <Modal open={showOpenForm}  \r\n        closeOnDimmerClick={true}\r\n        className=\"imageMapConfigDialog\"\r\n        size=\"fullscreen\"\r\n    >\r\n    <Modal.Content className=\"imageMapContent\">\r\n        <div className=\"imageMapContentContainer\">\r\n            <Form className=\"imageMapForm\" onSubmit={handleSubmit} \r\n                watchedField={'dropdownImage'}\r\n                setStateCb={setMyState}\r\n                setControlValues={setHotspotValues}\r\n                inputObj={map}\r\n                inputObjId={inputObjId}>\r\n                <div className=\"formBodyImgMapConfig\">\r\n                    <h4>Configure ImageMap Control</h4>\r\n                    <div className=\"ui message green\">Tip: Upload Image from the Settings Page</div>\r\n\r\n                    <FormDropdown key={'dropdownImage'}\r\n                        name={'dropdownImage'}\r\n                        label=\"Select Image:\"\r\n                        options={convertToDropdownOptions(reduxStoreImages)}\r\n                        size=\"small\"\r\n                        // onChange={handleChangeImage}\r\n                    />\r\n                    <Button toggle type=\"button\" active={addingHotspot} onClick={handleHostpotBtnClick} disabled={addingHotspot || !myState || !myState.dropdownImage}>\r\n                        <Icon name=\"plus\"/>\r\n                        {addingHotspot ? \"Click on a spot in image\" : \"Add Hotspot\"}\r\n                    </Button>\r\n                    {addingHotspot && <div>{`Image coords: ${coords.x}, ${coords.y}`}</div>}\r\n                    {renderCoordsForm()}\r\n                </div>\r\n\r\n                <div className=\"footerToolbarImgMapConfig\">\r\n                <Modal.Actions>\r\n                    <Button floated={'left'}\r\n                            color='green'\r\n                            type=\"submit\"\r\n                    >\r\n                        Apply\r\n                    </Button>\r\n                    <Button floated={'left'} onClick={() => handleClose()}>\r\n                        Close            \r\n                    </Button>\r\n                </Modal.Actions>\r\n                </div>\r\n            </Form>\r\n            <div className=\"imageContainer\">\r\n                {!!myState && !!myState.dropdownImage &&\r\n                <ImageMapper \r\n                            //src={`${getAprBaseUrl()}/files/${myState.dropdownImage}`}\r\n                            src={getImageFromLocal(myState.dropdownImage)}\r\n                            onImageMouseMove={handleMouseMove}\r\n                            onImageClick={handleMouseClick}\r\n                            map={map}\r\n                />}          \r\n            </div>\r\n        </div>\r\n    </Modal.Content>\r\n    </Modal>;\r\n}\r\n\r\nexport default ImageMapConfigDialog;","import React, {useState} from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport {updateControlProps, deleteControl, updateLayoutProps} from '../actions';\r\n\r\nimport './propertiesPanel.css';\r\nimport {getToolItemByName} from '../components/toolbox';\r\nimport splitWord from '../helper/wordSplitter';\r\nimport {reconstructHierarchyStack, applyUserTreeSettings} from '../helper/treefilter';\r\n\r\nimport {sectionProps} from '../controls/section';\r\nimport {labelProps} from '../controls/label';\r\nimport {pieProps} from '../charts/pieChart';\r\nimport {barProps} from '../charts/barChart';\r\nimport {lineProps} from '../charts/lineChart';\r\nimport {tableProps} from '../controls/table';\r\nimport {imageMapProps} from '../controls/imageMap';\r\nimport {richTextProps} from '../controls/richtext';\r\nimport {gaugeProps} from '../charts/gauge_rechart';\r\nimport * as constants from '../constants';\r\nimport Form, {Text as FormText, IconSelector, ColorSelector, FormTreeDropDown, FormCheckbox, FormRichText, FormFilterDyanamicInput} from '../form/Form';\r\nimport FormDropDown from '../form/FormDropDown';\r\nimport ShowMessage, {NotifType} from '../helper/notification';\r\nimport {Divider, Header, Icon, Message, Button} from 'semantic-ui-react';\r\nimport {getMetadataOptions, getMetadataTreeDropdownOptions} from '../helper/metadataManager';\r\nimport ImageMapConfigDialog from '../components/imageMapConfigDialog';\r\n\r\nconst PREFIX_DATAPROPS = 'dataProps.'; // Purpose: React hook form, during form submit, will nest the controls with this prefix inside dataProps field.\r\n\r\nconst renderDivider = (name, icon) => {\r\n    return <Divider horizontal>\r\n        <Header as='h5'>\r\n        <Icon name={icon} />\r\n        {name}\r\n        </Header>\r\n    </Divider>\r\n}\r\n\r\n// This is the function that will be called when the form component mounts\r\n// Use this function to set the initial values\r\nconst setControlValues = (setValueFunc, selectedControl) => {\r\n    if (!selectedControl) {\r\n        return;\r\n    }\r\n\r\n    // Common props\r\n    let toolItemType = getToolItemByName(selectedControl.ctrlType);\r\n\r\n    setValueFunc(constants.NAME_CONTROL_ID, selectedControl.i);\r\n    setValueFunc(constants.NAME_CONTROL_TYPE, toolItemType.displayName);\r\n    \r\n    Object.keys(selectedControl.data).forEach((key, index) => {\r\n        // skip the dataProps\r\n        if (key === 'dataProps') {\r\n            return;\r\n        }\r\n        setValueFunc(key, selectedControl.data[key]);\r\n    });\r\n\r\n    //console.log('setControlValues', selectedControl);\r\n\r\n    if (selectedControl.data.dataProps) {\r\n        Object.keys(selectedControl.data.dataProps).forEach((key, index) => {\r\n            if (key === \"filtersList\") {\r\n                let filterSettingsObj = selectedControl.data.dataProps[key];\r\n                if (Object.keys(filterSettingsObj).length === 0) {\r\n                    setValueFunc(`${PREFIX_DATAPROPS}${key}`, {}); // set it to an empty object\r\n                }\r\n                else {\r\n                    for (let prop in filterSettingsObj) {\r\n                        setValueFunc(`${PREFIX_DATAPROPS}${key}.${prop}.filterName`, filterSettingsObj[prop].filterName);\r\n                        setValueFunc(`${PREFIX_DATAPROPS}${key}.${prop}.filterValue`, filterSettingsObj[prop].filterValue);\r\n                    }    \r\n                }\r\n            }\r\n            else {\r\n                setValueFunc(PREFIX_DATAPROPS+key, selectedControl.data.dataProps[key]);\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n// This is the function that will be called when the form component mounts\r\n// Use this function to set the initial values\r\nconst setLayoutValues = (setValueFunc, layoutData) => {\r\n    if (!layoutData || !setValueFunc) {\r\n        return;\r\n    }\r\n\r\n    for (var prop in layoutData) {\r\n        setValueFunc(prop, layoutData[prop]);\r\n    }\r\n}\r\n\r\n// TODO: Refactor this class\r\n// Nest all functions inside this big function so that they have access to the props and state, and no need to pass each time\r\nconst PropertiesPanel = ({selectedControl, metadata, updateControlProps, deleteControl, selectedPage, layoutData, updateLayoutProps, hierarchyTree}) => {\r\n    const onCloseOpenConfigDialog = (bShow) => {\r\n        setShowConfigDialog(bShow);\r\n    }\r\n\r\n    // Declare this function inline so that it has access to updateControlProps\r\n    const onSubmit = (submittedData, evt) => {\r\n        console.log('submit control props', submittedData);\r\n        let formattedData = {\r\n            i: submittedData.controlId,\r\n            data: submittedData\r\n        }\r\n    \r\n        delete formattedData.data.controlId;\r\n        delete formattedData.data.controlType;\r\n        if (selectedControl.data.imageProps) {\r\n            // manually bring back the imageProps because the data is not found inside this form\r\n            formattedData.data.imageProps = {...selectedControl.data.imageProps};\r\n        }\r\n    \r\n        // Fire redux action to update store\r\n        updateControlProps(formattedData);\r\n        ShowMessage('Control Properties Applied!', NotifType.success, '');\r\n    }\r\n\r\n    const onSubmitLayoutForm = (submittedData) => {\r\n        console.log('submit layout props', submittedData);   \r\n        // Fire redux action to update store\r\n        updateLayoutProps(submittedData);\r\n        ShowMessage('Layout Properties Applied!', NotifType.success, '');        \r\n    }\r\n\r\n    const onDelete = () => {\r\n        deleteControl(selectedControl)\r\n        ShowMessage('Control Deleted!', NotifType.success, '');\r\n    };\r\n\r\n    const getSpecialProps = () => {\r\n        let specialProps = [];\r\n        switch(selectedControl.ctrlType) {\r\n            case 'section':\r\n                //return RenderSectionProps(selectedControl, onSubmit);\r\n                specialProps = sectionProps;\r\n                break;\r\n            case 'label':\r\n                specialProps = labelProps;\r\n                break;\r\n            case 'pie':\r\n                specialProps = pieProps;\r\n                break;\r\n            case 'barchart':\r\n                specialProps = barProps;\r\n                break;\r\n            case 'line':\r\n                specialProps = lineProps;\r\n                break;\r\n            case 'table':\r\n                specialProps = tableProps;\r\n                break;\r\n            case 'imageMap':\r\n                specialProps = imageMapProps;\r\n                break;\r\n            case 'richtext':\r\n                specialProps = richTextProps;\r\n                break;\r\n            case 'gauge':\r\n                specialProps = gaugeProps;\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n\r\n        return specialProps;\r\n    }\r\n\r\n    const renderControlProps = (watchableFieldName)  => {\r\n        let specialProps = getSpecialProps();        \r\n    \r\n        return <>\r\n                <Form className=\"propsFormContainer ui small form\" \r\n                key='formControlProps' \r\n                onSubmit={onSubmit} \r\n                inputObj={selectedControl} \r\n                inputObjId={selectedControl.i}\r\n                setControlValues={setControlValues}\r\n                watchedField={watchableFieldName}\r\n                setStateHook={setWatchedFieldValue}\r\n                >\r\n                <div className=\"propsForm\">\r\n                {renderCommonProps(selectedControl)}\r\n                {renderProps(specialProps, selectedControl.data, '')}\r\n                {selectedControl.data.dataProps && renderDivider(\"Data Config\", \"database\")}\r\n                {selectedControl.data.dataProps && renderProps(specialProps, selectedControl.data.dataProps, PREFIX_DATAPROPS)}\r\n                </div>\r\n                <div className=\"footerToolbar\">\r\n                    <button key='deleteBtn' type=\"button\" className=\"ui negative button mini\" onClick={onDelete}>Delete</button>\r\n                    <button key='submitBtn' type=\"submit\" className=\"ui button secondary mini\">Apply</button>\r\n                </div>\r\n            </Form>\r\n            {selectedControl.ctrlType === 'imageMap' && <ImageMapConfigDialog \r\n            //onClose={}\r\n            showOpenForm={showConfigDialog}\r\n            onCloseOpenConfigDialog={onCloseOpenConfigDialog}\r\n            selectedControl={selectedControl}\r\n            />}\r\n            </>\r\n        \r\n    }\r\n    \r\n    const renderCommonProps = () => {\r\n        let toolItemType = getToolItemByName(selectedControl.ctrlType);\r\n        let retList = [];\r\n        retList.push(<FormText key={constants.NAME_CONTROL_TYPE}\r\n                                 name={constants.NAME_CONTROL_TYPE}\r\n                                label=\"Control Type:\"\r\n                                readOnly                                                                             \r\n        />);\r\n    \r\n        retList.push(<FormText key={constants.NAME_CONTROL_ID}\r\n            name={constants.NAME_CONTROL_ID}\r\n            label=\"Control Id:\"\r\n            readOnly\r\n        />);\r\n    \r\n        return retList;    \r\n    }\r\n\r\n    const shouldDisableProp = (foundSpecialProp) => {\r\n        if (!watchableFieldName || !foundSpecialProp || !foundSpecialProp.watchedField || foundSpecialProp.watchedField !== watchableFieldName) {\r\n            //console.log('[propertiesPanel] shouldDisableProp: no need to watch', foundSpecialProp.name);\r\n            return false;\r\n        }\r\n\r\n        let retVal = watchedFieldValue !== foundSpecialProp.watchedValue;\r\n        //console.log('[propertiesPanel] shouldDisableProp', foundSpecialProp.name, retVal);\r\n\r\n        return retVal;\r\n    }\r\n    \r\n    // namePrefix: set to 'dataProps.' for dataProps. Purpose is to nest the value.\r\n    const renderProps = (specialProps, controlProps, namePrefix) => {\r\n        if (!controlProps) {\r\n            return;\r\n        }\r\n    \r\n        let retList = [];\r\n    \r\n        Object.keys(controlProps).forEach((key, index) => {            \r\n            let foundSpecialProp = specialProps.find(x => x.name === key);\r\n            if (foundSpecialProp) {\r\n                let propDisabled = shouldDisableProp(foundSpecialProp); // Check against current watched field value\r\n\r\n                switch(foundSpecialProp.propType) {\r\n                    case 'combo':\r\n                        retList.push(<FormDropDown\r\n                            key={selectedControl.i+'_'+key}\r\n                            name={namePrefix+key}\r\n                            label={splitWord(key)+\":\"}\r\n                            options={foundSpecialProp.options}\r\n                        />);\r\n                        break;\r\n                    case 'icon':\r\n                        retList.push(<IconSelector\r\n                            key={selectedControl.i+'_'+key}\r\n                            name={namePrefix+key}\r\n                            label={splitWord(key)+\":\"}\r\n                            intialicon={controlProps.icon}\r\n                        />);\r\n                        break;\r\n                    case 'color':\r\n                        retList.push(<ColorSelector\r\n                            key={selectedControl.i+'_'+key}\r\n                            name={namePrefix+key}\r\n                            label={splitWord(key)+\":\"}\r\n                            intialcolor={controlProps[foundSpecialProp.name]} // can be color or backgroundColor\r\n                        />);\r\n                        break;\r\n                    case 'number':                        \r\n                        retList.push(<FormText key={selectedControl.i+'_'+key}\r\n                            numeric\r\n                            name={namePrefix+key}\r\n                            label={splitWord(key)+':'}\r\n                            toolTip={foundSpecialProp.toolTip}\r\n                        />);\r\n                        break;\r\n                    case 'bool':\r\n                        retList.push(<FormCheckbox key={selectedControl.i+'_'+key}\r\n                            name={namePrefix+key}\r\n                            label={splitWord(key)+':'}\r\n                            toolTip={foundSpecialProp.toolTip}\r\n                        />);\r\n                        break;\r\n                    case 'section':\r\n                        // Just skip this. (not to be confused with section control)\r\n                        // There should be another call to this function to render the contents of that section\r\n                        break;\r\n                    case 'metadata':\r\n                        retList.push(renderMetadataField(key, foundSpecialProp, namePrefix, propDisabled));\r\n                        break;\r\n                    case 'popupConfig':\r\n                        retList.push(<Button \r\n                            type=\"button\" \r\n                            key={`${foundSpecialProp.name}Btn`} \r\n                            primary\r\n                            onClick={() => onCloseOpenConfigDialog(true)}                            \r\n                            >\r\n                                {foundSpecialProp.buttonName}\r\n                                &nbsp;&nbsp;\r\n                                <Icon name='external square alternate' />\r\n                            </Button>);\r\n                        break;\r\n                    case 'richText':\r\n                        retList.push(<FormRichText \r\n                            label={splitWord(key)+':'}\r\n                            name={namePrefix+key}\r\n                            key={`${foundSpecialProp.name}Btn`}\r\n                            toolTip={foundSpecialProp.toolTip}\r\n                            initialData={controlProps.richTextData}\r\n                            controlId={selectedControl.i}\r\n                        />);\r\n                        break;\r\n                    case 'pageLinks':\r\n                        retList.push(<FormTreeDropDown \r\n                            key='linkedPage'\r\n                            name='linkedPage'\r\n                            treeData={hierarchyTree} \r\n                            isRequired={false}\r\n                            label={splitWord(key)+':'}\r\n                            dropdownStyle={{ height: 300, overflow: 'auto' }}\r\n                            />);\r\n                        break;\r\n                    case 'dynamicFilter':\r\n                        retList.push(<FormFilterDyanamicInput\r\n                            label={splitWord(key)+':'}\r\n                            name={namePrefix+key}\r\n                            key={`${foundSpecialProp.name}Btn`}\r\n                            toolTip={foundSpecialProp.toolTip}\r\n                            filterFieldOptions={getMetadataTreeDropdownOptions(metadata, [foundSpecialProp.metadataField])}\r\n                            initialFilters={controlProps.filtersList}\r\n                            parentId={selectedControl.i}\r\n                        /> \r\n                        );\r\n                        break;\r\n                    case 'alignment':                        \r\n                        retList.push(<FormText key={selectedControl.i+'_'+key}\r\n                            name={namePrefix+key}\r\n                            label={splitWord(key)+':'}\r\n                            toolTip={foundSpecialProp.toolTip}\r\n                        />);\r\n                        break;                        \r\n                    default:\r\n                        break;            \r\n                }\r\n            }\r\n            else {\r\n                retList.push(<FormText key={selectedControl.i+'_'+key}\r\n                    name={namePrefix+key}\r\n                    label={splitWord(key)+':'}\r\n                />);\r\n            }\r\n        });\r\n    \r\n        return retList;\r\n    }\r\n    \r\n    const renderMetadataField = (metaFieldName, metaSpecialProps, namePrefix, propDisabled) => {\r\n        switch(metaSpecialProps.metadataPropType) {\r\n            case 'dropdown':\r\n                return <FormDropDown\r\n                        key={selectedControl.i+'_'+metaFieldName}\r\n                        name={namePrefix+metaFieldName}\r\n                        label={splitWord(metaFieldName)+\":\"}\r\n                        options={getMetadataOptions(metadata, metaSpecialProps.metadataField)}                    \r\n                    />\r\n            case 'treeDropdown':\r\n                return <FormTreeDropDown\r\n                    key={selectedControl.i+'_'+metaFieldName}\r\n                    name={namePrefix+metaFieldName}\r\n                    treeData={getMetadataTreeDropdownOptions(metadata, [metaSpecialProps.metadataField])} \r\n                    isRequired={false}\r\n                    label={splitWord(metaFieldName)+\":\"}\r\n                    dropdownStyle={{ height: 300, overflow: 'auto' }}\r\n                    multiple={metaSpecialProps.multiple}\r\n                    disabled={propDisabled}\r\n                    />\r\n            case 'textbox':\r\n                return <FormText\r\n                    key={selectedControl.i+'_'+metaFieldName}\r\n                    name={namePrefix+metaFieldName}\r\n                    label={splitWord(metaFieldName)+\":\"}\r\n                    toolTip={metaSpecialProps.toolTip}\r\n                    readOnly={metaSpecialProps.readOnly}\r\n                    />\r\n            default:\r\n                break;\r\n        }\r\n    \r\n        return null;\r\n    }\r\n    \r\n    const renderLayoutPropsForm = () => {\r\n        return <Form className=\"propsFormContainer ui small form\" key='formLayoutProps' onSubmit={onSubmitLayoutForm} inputObj={layoutData} setControlValues={setLayoutValues}>\r\n                <div className=\"propsForm\">\r\n                {renderLayoutProps(layoutData)}\r\n                </div>\r\n                <div className=\"footerToolbar\">\r\n                    <button key='submitBtn' type=\"submit\" className=\"ui button secondary mini\">Apply</button>\r\n                </div>\r\n        </Form>\r\n    }\r\n    \r\n    const renderLayoutProps = () => {\r\n        let retList = [];\r\n        for (var prop in layoutData) {\r\n            switch(prop) {\r\n                case 'name':\r\n                    retList.push(<FormText key={`layout_${prop}_prop`}\r\n                    name={prop}\r\n                    label={splitWord(prop)+':'}\r\n                    readOnly\r\n                    />);\r\n                    break;\r\n                case 'columns':\r\n                    retList.push(<FormText key={`layout_${prop}_prop`}\r\n                    numeric\r\n                    name={prop}\r\n                    label={splitWord(prop)+':'}\r\n                    readOnly\r\n                    toolTip={\"For this version, column size cannot be changed\"}\r\n                    />);\r\n                    break;\r\n                case 'rows':\r\n                    retList.push(<FormText key={`layout_${prop}_prop`}\r\n                    numeric\r\n                    name={prop}\r\n                    label={splitWord(prop)+':'}\r\n                    toolTip={\"For now, there is no validation. Make sure the value provided is sufficient. Otherwise some existing controls might be deleted.\"}\r\n                    />);\r\n                    break;\r\n                case 'pageFilterFields':\r\n                    // get the items from the metadata\r\n                    retList.push(<FormTreeDropDown \r\n                        key='pageFilterFields'\r\n                        name='pageFilterFields'\r\n                        treeData={getMetadataTreeDropdownOptions(metadata, ['requestParams', 'dimensions',])} \r\n                        isRequired={false}\r\n                        label={\"Page Filter Fields:\"}\r\n                        dropdownStyle={{ height: 300, overflow: 'auto' }}\r\n                        multiple\r\n                        />);\r\n                    break;\r\n                default:\r\n                    retList.push(<FormText key={prop}\r\n                        name={prop}\r\n                        label={splitWord(prop)+':'}\r\n                    />);\r\n                    break;\r\n            }\r\n        }\r\n    \r\n        return retList;\r\n    }\r\n\r\n    const getWatchableFieldName = () => {\r\n        // For now, assume the watchableField is inside data.dataProps\r\n        if (!selectedControl || !selectedControl.data || !selectedControl.data.dataProps) {\r\n            return null;\r\n        }\r\n\r\n        const specialProps = getSpecialProps();\r\n        if (!specialProps) {\r\n            return null;\r\n        }\r\n\r\n        let findWatchableField = specialProps.find(s => s.watchableField === true);\r\n        if (!findWatchableField) {\r\n            return null;\r\n        }\r\n\r\n        return findWatchableField.name;\r\n    }\r\n\r\n    // const getWatchedFieldInitialValue = () => {\r\n    //     if (!selectedControl || !selectedControl.data || !selectedControl.data.dataProps) {\r\n    //         return null;\r\n    //     }\r\n\r\n    //     const specialProps = getSpecialProps();\r\n    //     if (!specialProps) {\r\n    //         return null;\r\n    //     }\r\n\r\n    //     let findWatchableField = specialProps.find(s => s.watchableField === true);\r\n    //     if (!findWatchableField) {\r\n    //         return null;\r\n    //     }\r\n\r\n    //     let name = findWatchableField.name;\r\n\r\n    //     // For now, assume the watchableField is inside data.dataProps\r\n    //     let controlWatchedFieldValue = selectedControl.data.dataProps[name];\r\n    //     debugger\r\n    //     return controlWatchedFieldValue;\r\n    // }\r\n\r\n    /* START: actual function implementation */\r\n    let watchableFieldInitialValue = null;\r\n    const watchableFieldName = getWatchableFieldName();\r\n    if (!!watchableFieldName) {\r\n        // For now, assume the watchableField is inside data.dataProps\r\n        watchableFieldInitialValue = selectedControl.data.dataProps[watchableFieldName];\r\n    }\r\n\r\n    const [showConfigDialog, setShowConfigDialog] = useState(false);\r\n    const [watchedFieldValue, setWatchedFieldValue] = useState(watchableFieldInitialValue); // For now just allow one watchedField for the entire form\r\n\r\n    console.log('[PropertiesPanel] render', watchedFieldValue);\r\n\r\n    if (!selectedControl && !selectedPage) {\r\n        // return <div className=\"ui message warning\">No object selected in the Designer. Please select any control or click [Configure Page Settings] button to see the layout settings</div>\r\n        return <Message header='No object selected in the Designer' \r\n                        content='Please select either any control or click [Configure Page Settings] button to configure the layout'/>\r\n    }\r\n\r\n    if (selectedPage) {\r\n        return renderLayoutPropsForm();\r\n    }\r\n\r\n    return renderControlProps(PREFIX_DATAPROPS+watchableFieldName);\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    let masterHierarchyViews = state.mainApp.masterHierarchyViews;\r\n    let defaultView = masterHierarchyViews && masterHierarchyViews[0];\r\n    let treeDataNoUserSettings = defaultView && reconstructHierarchyStack(JSON.parse(defaultView.hierarchyJson));\r\n    let userSettings = defaultView && JSON.parse(defaultView.nodeSettingsJson);\r\n    let treeData = applyUserTreeSettings(treeDataNoUserSettings, userSettings);\r\n\r\n    return {\r\n        selectedControl: state.designer.layout.find(c => c.selected === true),\r\n        selectedPage: state.designer.pageSelected,\r\n        layoutData: state.designer.layoutData, // This just contains the number of rows, cols and filterFields selected by the user\r\n        metadata: state.mainApp.masterMetadata,\r\n        hierarchyTree: treeData,\r\n    }\r\n  }\r\n\r\n//We just let the individual controls take care of everything\r\nconst mapDispatchToProps = (dispatch) => {\r\n    return bindActionCreators({ updateControlProps, deleteControl, updateLayoutProps }, dispatch);\r\n}\r\n\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(PropertiesPanel);","import React from 'react';\r\nimport Split from 'react-split';\r\nimport Toolbox from './toolbox';\r\nimport DemoTree from './treeView';\r\nimport ToolAvailableData from './toolAvailableData';\r\n\r\nimport '../styles/Accordion.css';\r\nimport \"../styles/Split.css\";\r\n\r\nimport ScrollTracker from '../components/scrollTracker';\r\nimport PropertiesPanel from '../containers/propertiesPanel';\r\n\r\nconst DEFAULT_SIZES = [25, 75];\r\nconst CLASS_ACCORDION = \"accordionPanel\";\r\n\r\n// Basically this class contains the left hand panel that contains the toolbox and properties box\r\n\r\n// TODOS:\r\n// [1] Do not allow all panels to be collapsed\r\n// [2] Implement preferred ratio\r\n\r\nconst AccordionPanel = ({title, onClickCollapseExpand, id, isCollapsed, panelContent}) => {\r\n    //console.log('[render] AccordionPanel, id: ', id);\r\n    let iconName = isCollapsed ? \"down\" : \"up\";\r\n\r\n    return <div className={CLASS_ACCORDION}>        \r\n        <div className=\"titleBar\">\r\n            <div className=\"titleBarText\">{title}</div>\r\n            <div className=\"collExpBtn\" onClick={() => onClickCollapseExpand(id)}>\r\n                <i className={`icon angle ${iconName}`}></i>\r\n            </div>            \r\n        </div>\r\n        <div className=\"panelBody\">\r\n            {panelContent}\r\n        </div>\r\n    </div>;\r\n}\r\n\r\nconst defaultPanelItems = [\r\n    {\r\n        title: 'Toolbox',\r\n        id: 'toolbox',\r\n        isCollapsed: false,\r\n        size: 0,\r\n        helpText: 'Drag an item to the Designer Area'\r\n    },\r\n    {\r\n        // Show the Hierarchy tree view\r\n        // Underneath, add the available data (dfferent icon from folders and targets)\r\n        // When the user drags it to the designer, should popup the control appropriate control type\r\n        // Except for the size, there must be some preconfigurations already in the control\r\n        title: 'Hierarchy',\r\n        id: 'toolHierarchy',\r\n        isCollapsed: false,\r\n        size: 0,\r\n        helpText: 'Select an item in the hierarchy to show the available data below'\r\n    },\r\n    {\r\n        title: 'Available Data',\r\n        id: 'availableData',\r\n        isCollapsed: false,\r\n        size: 0,\r\n        helpText: 'Drag an item to the Designer Area'\r\n    },\r\n];\r\n\r\nclass ToolPanel extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        let panelItems = props.panelItems ? props.panelItems : defaultPanelItems;\r\n        let initializedPanelData = this.recalculatePanelSizes(panelItems);\r\n\r\n        this.onSplitDragEnd = this.onSplitDragEnd.bind(this);\r\n        this.onSplitDragStart = this.onSplitDragStart.bind(this);\r\n\r\n        this.state = {\r\n            panelsData: initializedPanelData,\r\n            sizes: initializedPanelData.map(panel => panel.size)\r\n        };\r\n    }\r\n\r\n    recalculatePanelSizes = (panelsData) => {\r\n        let expandedPanels = panelsData.filter(panel => panel.isCollapsed === false);\r\n        let oneSize = 100.0 / expandedPanels.length;\r\n        // If there is no panel collapsed, use the suggested DEFAULT_SIZE\r\n        // Sanity: if DEFAULT_SIZES length is not the same as the actual number of panels, we don't use DEFAULT_SIZES \r\n        if (panelsData.find(p => p.isCollapsed) || DEFAULT_SIZES.length !== panelsData.length) {\r\n            panelsData.forEach(panel => {\r\n                if (panel.isCollapsed) {\r\n                    panel.size = 0;\r\n                }\r\n                else {\r\n                    panel.size = oneSize;\r\n                }\r\n            })    \r\n        }\r\n        else {\r\n            for (let i=0; i < panelsData.length; i++) {\r\n                let currPanel = panelsData[i];\r\n                currPanel.size = DEFAULT_SIZES[i]\r\n            }\r\n        }\r\n\r\n        return panelsData;\r\n    }\r\n\r\n    getPanelSizes = () => {\r\n        return this.state.panelsData.map(panel => panel.size);\r\n    };\r\n\r\n    \r\n    onSplitDragEnd(args) {\r\n        console.log('[toolPanel] onSplitDrageEnd', args, this);\r\n        // If any of the panel becomes too small, just collapse it all the way\r\n        let clonePanelsData = [...this.state.panelsData];\r\n        for (let i = 0; i < args.length; i++) {\r\n            let currPanelData = clonePanelsData[i];\r\n            if (args[i] > 8) {\r\n                if (currPanelData.isCollapsed) {\r\n                    currPanelData.isCollapsed = false;\r\n                }\r\n            }\r\n            else if (!currPanelData.isCollapsed) {\r\n                currPanelData.isCollapsed = true;\r\n            }            \r\n        }\r\n        // let newPanelsData = this.recalculatePanelSizes(clonePanelsData);\r\n        // console.log(newPanelsData);\r\n        this.setState({\r\n            panelsData: clonePanelsData,\r\n            sizes: args\r\n        });\r\n\r\n        this.addRemovePanelTransition(false);\r\n    }\r\n\r\n    onSplitDragStart(args) {\r\n        console.log('[toolPanel] onSplitDrageStart', args);\r\n        this.addRemovePanelTransition(false);\r\n    }\r\n\r\n    addRemovePanelTransition = (bAdd) => {\r\n        //debugger\r\n        let panelEls = document.getElementsByClassName(CLASS_ACCORDION); \r\n        for (let i = 0; i < panelEls.length; i++) {\r\n            let panelEl = panelEls[i];\r\n            if (bAdd) {\r\n                panelEl.style.transition = \"0.5s\";\r\n            }\r\n            else {\r\n                panelEl.style.transition = \"0s\";\r\n            }    \r\n        }\r\n    }\r\n\r\n    onClickCollapseExpand = (id) => {\r\n        //console.log('onClickCollapseExpand', id);\r\n        this.addRemovePanelTransition(true);\r\n        let panelDataClone = [...this.state.panelsData];\r\n        let selectedPanelData = panelDataClone.find(panel => panel.id === id);\r\n        if (!selectedPanelData) {\r\n            console.error('Cannot find the panel expanded or collapsed!');\r\n            return;\r\n        }\r\n\r\n        //console.log('onClickCollapseExpand, selectedPanelData: ', selectedPanelData);\r\n        selectedPanelData.isCollapsed = !selectedPanelData.isCollapsed;\r\n\r\n        let newPanelsData = this.recalculatePanelSizes(panelDataClone);\r\n        this.setState({\r\n            panelsData: newPanelsData,\r\n            sizes: newPanelsData.map(p => p.size)\r\n        })\r\n    }\r\n\r\n    // TODO: can dynamically create the react component given the class name?\r\n    // Where to find the 'import' of that react component?\r\n    getPanelContent = (panelId, containerWidth) => {\r\n        switch(panelId) {\r\n            case 'toolbox':\r\n                return <Toolbox containerWidth={containerWidth}/>;\r\n            case 'toolHierarchy':\r\n                return <DemoTree/>\r\n            case 'availableData':\r\n                return <ToolAvailableData/>\r\n            case 'properties':\r\n                return <PropertiesPanel/>\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    createPanels = (containerWidth) => {\r\n        return this.state.panelsData.map(panel => {\r\n            let panelContent = this.getPanelContent(panel.id, containerWidth);            \r\n            return <AccordionPanel \r\n                        key={panel.id}\r\n                        id={panel.id}\r\n                        title={panel.title}\r\n                        isCollapsed={panel.isCollapsed}\r\n                        onClickCollapseExpand={this.onClickCollapseExpand}\r\n                        panelContent={panelContent}\r\n                    >\r\n                    </AccordionPanel>\r\n        })\r\n    }\r\n\r\n    render() {\r\n        console.log('[toolPanel] render', this.props.containerWidth);\r\n        return <Split className=\"split\"\r\n        direction=\"vertical\"\r\n        sizes={this.state.sizes}\r\n        minSize={33}\r\n        gutterSize={5}\r\n        snapOffset={0}\r\n        onDragEnd={this.onSplitDragEnd}\r\n        onDragStart={this.onSplitDragStart}\r\n        cursor=\"row-resize\"\r\n        >\r\n            {this.createPanels(this.props.containerWidth)}            \r\n        </Split>\r\n    }\r\n}\r\n\r\nexport default ToolPanel;","import React, {useEffect, useState} from \"react\";\r\nimport _ from \"lodash\";\r\nimport { Responsive, WidthProvider } from \"react-grid-layout\";\r\nimport { bindActionCreators } from \"redux\";\r\nimport \"./designerForm.css\";\r\nimport BarChart from '../charts/barChart';\r\nimport Example from '../charts/pieChart';\r\nimport Combobox from '../controls/combo';\r\nimport EditDialog from './editDialog';\r\nimport {selectedControl} from '../actions/index';\r\nimport { useDrop } from 'react-dnd';\r\n\r\n// controls import\r\nimport Section from '../controls/section';\r\nimport RichText from '../controls/richtext';\r\nimport Combo from '../controls/combo';\r\n\r\nimport {connect} from 'react-redux';\r\n\r\n// TODO: Delete this whole file...this is just for playing with RGL library\r\n// But we ended up implementing our own designer\r\n\r\n//const ResponsiveReactGridLayout = WidthProvider(Responsive);\r\nconst ResponsiveReactGridLayout = Responsive;\r\n\r\nconst defaultProps = {\r\n  className: \"layout\",\r\n  rowHeight: 30,\r\n  onLayoutChange: function(layout, layouts) {\r\n      console.log('layout changed');\r\n      // TODO: handle the layout changes to the other breakpoints here\r\n      // e.g. if curr display is big, fix the layout for xs\r\n  },\r\n  cols: { lg: 12, md: 12, sm: 2, xs: 1, xxs: 1 },\r\n  //initialLayout: generateLayout(),\r\n  initialLayout: [],\r\n  compactType: 'vertical', // It's better to have a vertical compaction, because the drag behaviour is weird without it\r\n\r\n  // temporarily set layout to fixed, to avoid conflict while experimenting with rich text editor's cursor/focus\r\n  // isDraggable: false,\r\n  // isResizable: false,\r\n};\r\n\r\n/*\r\nconst getRechartSample = (i) => {\r\n  if (i === 1)\r\n  {\r\n    let barInfo = {i: 'ctrl-pie0', x: 6, y: 1, w: 3, h: 4, ctrlType: 'pie',       \r\n      data: {\r\n          label: 'Pie:',\r\n      }\r\n    };           \r\n\r\n    return <div style={{width: \"100%\", height: \"100%\"}}>\r\n        <BarChart {...barInfo}/>\r\n    </div>\r\n  }\r\n  else if (i === 2) {    \r\n    let ctrlInfo = {i: 'ctrl-pie0', x: 6, y: 1, w: 3, h: 4, ctrlType: 'pie',       \r\n      data: {\r\n          label: 'Pie:',\r\n      }\r\n    };    \r\n    return <Example sample={1} {...ctrlInfo}/>\r\n  }\r\n  else if (i === 0) {\r\n    return <div className=\"Aligner\">\r\n        <div className=\"Aligner-item\" style={{fontSize: \"30px\"}}>Plant Overall Status</div>\r\n    </div>\r\n  }\r\n  else if (i === 3) {\r\n    return <Combo data={{\r\n      label: 'Courses',\r\n      options: [\r\n      { key: 'angular', text: 'Angular', value: 'angular' },\r\n      { key: 'css', text: 'CSS', value: 'css' },\r\n      { key: 'design', text: 'Graphic Design', value: 'design' },\r\n      { key: 'ember', text: 'Ember', value: 'ember' },\r\n      { key: 'html', text: 'HTML', value: 'html' },\r\n      { key: 'ia', text: 'Information Architecture', value: 'ia' },\r\n      { key: 'javascript', text: 'Javascript', value: 'javascript' },\r\n      { key: 'mech', text: 'Mechanical Engineering', value: 'mech' },\r\n      { key: 'meteor', text: 'Meteor', value: 'meteor' },\r\n      { key: 'node', text: 'NodeJS', value: 'node' },\r\n      { key: 'plumbing', text: 'Plumbing', value: 'plumbing' },\r\n      { key: 'python', text: 'Python', value: 'python' },\r\n      { key: 'rails', text: 'Rails', value: 'rails' },\r\n      { key: 'react', text: 'React', value: 'react' },\r\n      { key: 'repair', text: 'Kitchen Repair', value: 'repair' },\r\n      { key: 'ruby', text: 'Ruby', value: 'ruby' },\r\n      { key: 'ui', text: 'UI Design', value: 'ui' },\r\n      { key: 'ux', text: 'User Experience', value: 'ux' },\r\n    ]}}/>\r\n  }\r\n\r\n  return null;\r\n}\r\n*/\r\n\r\nconst dropdownOptions = [\r\n  { key: 'angular', text: 'Angular', value: 'angular' },\r\n  { key: 'css', text: 'CSS', value: 'css' },\r\n  { key: 'design', text: 'Graphic Design', value: 'design' },\r\n  { key: 'ember', text: 'Ember', value: 'ember' },\r\n  { key: 'html', text: 'HTML', value: 'html' },\r\n  { key: 'ia', text: 'Information Architecture', value: 'ia' },\r\n  { key: 'javascript', text: 'Javascript', value: 'javascript' },\r\n  { key: 'mech', text: 'Mechanical Engineering', value: 'mech' },\r\n  { key: 'meteor', text: 'Meteor', value: 'meteor' },\r\n  { key: 'node', text: 'NodeJS', value: 'node' },\r\n  { key: 'plumbing', text: 'Plumbing', value: 'plumbing' },\r\n  { key: 'python', text: 'Python', value: 'python' },\r\n  { key: 'rails', text: 'Rails', value: 'rails' },\r\n  { key: 'react', text: 'React', value: 'react' },\r\n  { key: 'repair', text: 'Kitchen Repair', value: 'repair' },\r\n  { key: 'ruby', text: 'Ruby', value: 'ruby' },\r\n  { key: 'ui', text: 'UI Design', value: 'ui' },\r\n  { key: 'ux', text: 'User Experience', value: 'ux' },\r\n  { key: 'test1', text: 'A quick brown fox jumps over the lazy dog', value: 'test1' },\r\n  { key: 'test2', text: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890!@#$%^&*()_+', value: 'test2' },\r\n  { key: 'test3', text: '', value: 'test3' },\r\n];\r\n\r\nconst onClickEditBtn= (id) => {\r\nconsole.log('onClickEditBtn', id);\r\n}\r\n\r\nconst renderContent = (control) => {\r\n  switch(control.ctrlType) {\r\n    case 'barchart':\r\n      let barInfo = {i: 'ctrl-bar0', x: 6, y: 1, w: 3, h: 4, ctrlType: 'barchart',       \r\n        data: {\r\n            label: 'Bar:',\r\n        }\r\n      };           \r\n\r\n    return <BarChart {...barInfo}/>\r\n    case 'pie':\r\n      let ctrlInfo = {i: 'ctrl-pie0', x: 6, y: 1, w: 3, h: 4, ctrlType: 'pie',       \r\n        data: {\r\n            label: 'Pie:',\r\n        }\r\n      };\r\n      return <Example {...ctrlInfo}/>\r\n    case 'section':\r\n      return <div className=\"Aligner\">\r\n      <div className=\"Aligner-item\" style={{fontSize: \"30px\"}}>Plant Overall Status</div>\r\n      </div>\r\n    case 'combo':\r\n      let comboInfo = {\r\n        i: 'ctrl-pie0', x: 6, y: 1, w: 3, h: 4, ctrlType: 'dummy',      \r\n        data: {\r\n          placeholder: 'Please select...',\r\n          options: dropdownOptions,\r\n          label: 'Combobox:'\r\n        }\r\n      };\r\n      return <Combobox {...comboInfo}></Combobox>\r\n  }\r\n}\r\n\r\nconst generateDOM = (layouts) => {  \r\n  console.log('[designerForm] generateDOM()...', layouts);\r\n  return _.map(layouts.lg, function(l, i) {\r\n    return (\r\n      <div key={l.i} className={l.static ? \"static\" : \"\"} style={{border: \"1px dashed lightgray\", borderRadius: \"3px\"}}>\r\n          {/* <span className=\"text\">{i} - {l.i}</span> */}\r\n          {/* <i className=\"editBtn icon cog large\" onClick={me.onClickEditBtn.bind(me, l)}/>             */}\r\n          <EditDialog controlInfo={l}/>\r\n          {/* {getRechartSample(i)} */}\r\n          {renderContent(l)}\r\n          {/* {me.renderControl(l)} */}\r\n      </div>\r\n    );\r\n  });\r\n}\r\n\r\nconst onBreakpointChange = breakpoint => {\r\n  console.log('onBreakpointChange', breakpoint);\r\n  this.setState({\r\n      currentBreakpoint: breakpoint\r\n  });\r\n};\r\n\r\nconst onCompactTypeChange = () => {\r\n  const { compactType: oldCompactType } = this.state;\r\n  const compactType =\r\n    oldCompactType === \"horizontal\"\r\n      ? \"vertical\"\r\n      : oldCompactType === \"vertical\" ? null : \"horizontal\";\r\n  this.setState({ compactType });\r\n};\r\n\r\nconst onLayoutChange = (layout, layouts) => {\r\n  this.props.onLayoutChange(layout, layouts);\r\n};\r\n\r\nconst onDragStart = (item) => {\r\n  this.props.onDragStart(item);\r\n}\r\n\r\nconst onDragStop = (item, item2) => {\r\n  this.props.onDragStop(item);\r\n}\r\n\r\nconst onNewLayout = () => {\r\n  this.setState({\r\n    layouts: { lg: generateLayout() }\r\n  });\r\n};\r\n\r\nconst onControlClicked = (control) => {\r\n  console.log('[designerForm] controlClicked fired by HOC', control);\r\n  this.props.selectedControl(control.i);\r\n}\r\n\r\nconst onDrop = (elemParams, arg2) => {\r\n  let internalLayout = null;\r\n  if (!arg2) {\r\n      // I manually modified the params of OnDrop from the STRML library\r\n      // The second arg is the temp layout\r\n      console.log('[onDrop] arg2 is null. Please modify the STRML library to pass the layout as 2nd argument');\r\n      return;\r\n  }\r\n  internalLayout = arg2;\r\n\r\n  if (!this.props.draggingToolItem) {\r\n    console.log('[onDrop] Did not detect any dragging item from toolbox');\r\n    return;\r\n  }\r\n\r\n  let newLayout = internalLayout.filter(x => x.i !== '__dropping-elem__').map(item => {\r\n      return {\r\n          x: item.x,\r\n          y: item.y,\r\n          w: item.w,\r\n          h: item.h,\r\n          i: item.i,\r\n          static: item.static\r\n      }\r\n  }) \r\n\r\n  this.setState({\r\n      layouts: {\r\n        lg: [...newLayout, {\r\n            x: elemParams.x,\r\n            y: elemParams.y,\r\n            w: elemParams.w,\r\n            h: elemParams.h,\r\n            i: this.props.draggingToolItem.name + this.state.layouts.lg.length,\r\n            static: false\r\n        }, ]\r\n      }\r\n    });\r\n};\r\n\r\n// try playing around recharts\r\nconst DesignerForm = (props) => {\r\n\r\n  // Note: this will cause a rerender\r\n  useEffect(() => {\r\n    // Set the initial values\r\n    console.log('RGL useEffect start');\r\n    // If this line of code was removed, it will become \"choppy\" while dragging elements\r\n    setMyState({ ...myState, mounted: true });\r\n  }, [props.controls]); // Means if controls value does not change, don't run useEffect again.\r\n\r\n  const [myState, setMyState] = useState({\r\n    mounted: false,\r\n    layouts: {\r\n      lg: props.controls\r\n    }\r\n  });\r\n\r\n\r\n  console.log('render RGL');\r\n  return (\r\n    // <div>HelloWorld</div>\r\n    <div style={{border: \"1px dashed dimgray\", position: 'relative', top: '30px'}}>\r\n      <ResponsiveReactGridLayout \r\n        width={props.containerWidth}\r\n        {...props}\r\n        initialLayout={props.controls}\r\n        layouts={myState.layouts}\r\n        // onBreakpointChange={this.onBreakpointChange}\r\n        // onLayoutChange={this.onLayoutChange}\r\n        // onDrop={this.onDrop}\r\n        // WidthProvider option\r\n        measureBeforeMount={false}\r\n        // I like to have it animate on mount. If you don't, delete `useCSSTransforms` (it's default `true`)\r\n        // and set `measureBeforeMount={true}`.\r\n        // Ray note: set this to false to avoid interfering with dropdown menu\r\n        // Actually, if not in design mode, this should be off\r\n        useCSSTransforms={myState.mounted}\r\n        //useCSSTransforms={false}\r\n      //   compactType={this.state.compactType}\r\n      //   preventCollision={!this.state.compactType}\r\n        isDroppable={true}\r\n      >\r\n        {generateDOM(myState.layouts)}\r\n      </ResponsiveReactGridLayout>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction generateLayout() {\r\n    // I think @design mode, do not allow small display size\r\n    // If want to design @small display size, when enlarged, everything is fully stretched out, width-wise\r\n      return [\r\n        {i: 'a', x: 0, y: 2, w: 4, h: 10},\r\n        {i: 'b', x: 4, y: 2, w: 4, h: 10},\r\n        {i: 'c', x: 0, y: 0, w: 12, h: 2},\r\n        {i: 'd', x: 8, y: 2, w: 4, h: 2},\r\n        {i: 'e', x: 8, y: 4, w: 4, h: 2},\r\n        {i: 'f', x: 8, y: 6, w: 4, h: 2},\r\n        {i: 'g', x: 8, y: 8, w: 4, h: 2},\r\n      ];\r\n}\r\n\r\n\r\nconst mapDispatchToProps = dispatch => {\r\n  return bindActionCreators({ selectedControl }, dispatch);\r\n}\r\n\r\nfunction mapStateToProps(state, ownProps) {\r\n  return { \r\n    //draggingToolItem: state.mainApp.draggingToolItem,\r\n    // Problem if you monitor this store variable:\r\n    // If user makes a selection, this entire grid and all its child items re-renders\r\n    // TODO: try this to potentially avoid rerender:\r\n    // - state design: controls dictionary <controlId, controlData>\r\n    // - control mapStateToProps: monitor control[id] only (get the id from ownProps)\r\n    // => Basically this will lead to a prop change, that's why whole component rerenders\r\n    //selectedControlId: state.designer.selectedControlId\r\n    // layout: state.designer.dashLayout\r\n  };\r\n}\r\n\r\nDesignerForm.defaultProps = defaultProps;\r\n\r\n//export default designerForm;\r\nexport default connect(mapStateToProps, mapDispatchToProps)(DesignerForm);\r\n","// TODO: Obsolete this class \r\n// Replaced by Toolbar.js where the buttons are defined by calling class\r\n\r\nimport React from 'react';\r\nimport './designerToolbar.css';\r\nimport {Popup, Dropdown, Menu} from 'semantic-ui-react';\r\nimport {WIDTH_LARGE} from '../constants';\r\n\r\nconst menuItems = {\r\n    'left': [\r\n        {key:'designertb_save', icon: 'save', text: 'Save'},\r\n        {key:'designertb_saveas', icon: 'save outline', text: 'Save As...'},\r\n        {key:'designertb_open', icon: 'open folder outline', text: 'Open...'},\r\n    ],\r\n    'right': [\r\n        {key:'designertb_preview', icon: 'eye', text: 'Hold to Preview', disabled: true},\r\n    ]\r\n}\r\n\r\nconst renderToolbarBtn = (item) => {\r\n    let clsName = \"toolbarButton\";\r\n    if (item.disabled) {\r\n        clsName += \" toolbarButton-disabled\"\r\n    }\r\n    return <div key={item.key} className={clsName}>\r\n        <i className={'ui icon ' + item.icon}/>\r\n        {item.text}\r\n    </div>\r\n}\r\n\r\nconst renderFullMenu = () => {\r\n    return <div className=\"designerToolbar\">\r\n        <div className=\"left\">\r\n            {menuItems.left.map(item => renderToolbarBtn(item))}\r\n        </div>\r\n\r\n        <div className=\"center\">\r\n            <div className=\"title\">Untitled</div>\r\n            <Popup \r\n                inverted\r\n                basic\r\n                size='tiny' style={{opacity: '0.8'}} \r\n                content='Form is not yet saved' \r\n                trigger={<div className=\"infoContainer\">\r\n                <i className=\"ui icon info circle\"/>\r\n            </div>} />\r\n            \r\n            \r\n        </div>\r\n\r\n        <div className=\"rightTb\">\r\n            {menuItems.right.map(item => renderToolbarBtn(item))}\r\n        </div>\r\n        \r\n    </div>\r\n}\r\n\r\nconst renderCollapsedMenu = () => {\r\n    return <div className=\"designerToolbar\">\r\n        <div className=\"desginerDropdown\">\r\n            <i className=\"desginerDropbtn ui icon th\"/>\r\n            <div className=\"desginerDropdown-content\">\r\n                {menuItems.left.map(item => (<div key={item.key} className=\"desginerDropdown-item\">\r\n                    <i className={'ui icon ' + item.icon}/>\r\n                    <a>{item.text}</a>\r\n                </div>))}\r\n            </div>\r\n        </div>\r\n        &nbsp;\r\n        &nbsp;\r\n        <div className=\"title\">Untitled</div>\r\n        <Popup \r\n            inverted\r\n            size='tiny' style={{opacity: '0.8'}} \r\n            content='Form is not yet saved' \r\n            trigger={<div className=\"infoContainer\">\r\n                <i className=\"ui icon info circle\"/>\r\n            </div>} \r\n        />\r\n    </div>\r\n}\r\n\r\n\r\n// TODO: Make it responsive\r\nconst DesignerToolbar = (props) => {\r\n    if (props.containerWidth > WIDTH_LARGE) {\r\n        return renderFullMenu();\r\n    }\r\n    else {\r\n        return renderCollapsedMenu();\r\n    }\r\n}\r\n\r\nexport default DesignerToolbar;","import React from 'react';\r\nimport NoobSplitter from '../components/noobSplitter';\r\nimport ToolPanel from '../components/toolPanel';\r\nimport DesignerForm from '../components/designerForm';\r\nimport DesignerContentbase from './designerContentBase';\r\nimport DesignerToolbar from '../components/designerToolbar';\r\nimport {connect} from 'react-redux';\r\n\r\nconst DEFAULT_SPLIT_SIZES = [15, 85];\r\n\r\n// Uses RGL for the layouting\r\nclass DashboardDesignerContent extends DesignerContentbase {\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n        this.defaultSizes = DEFAULT_SPLIT_SIZES;\r\n    }\r\n\r\n    render() {\r\n        console.log('render dashboard designerContent');\r\n        return <NoobSplitter id=\"designerPanel\" onDragEnd={this.onSplitDragEnd} defaultSize={DEFAULT_SPLIT_SIZES}>\r\n            <ToolPanel containerWidth={this.state.leftPixels}/>\r\n            <div>\r\n                <DesignerToolbar containerWidth={this.state.rightPixels}/>                    \r\n                <DesignerForm containerWidth={this.state.rightPixels} controls={this.props.layout}/>\r\n            </div>\r\n        </NoobSplitter>\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        layout: state.designer.dashLayout,\r\n        layoutData: state.designer.dashLayoutData,\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps)(DashboardDesignerContent);","import React, {useState} from 'react';\r\nimport {Modal, Header, Button, Icon} from 'semantic-ui-react';\r\nimport Form, {Text as FormText, IconSelector, ColorSelector} from '../form/Form';\r\n\r\nconst KEY_NAME = \"Name\";\r\n\r\nconst SaveAsDialog = ({showSaveForm, title, formLabel, onSave, onClose}) => {\r\n    // Watch the state, to disable the Save button if it's empty\r\n    const [myState, setMyState] = useState({\r\n        [KEY_NAME]: null});\r\n\r\n    // console.log('SaveAsDialog render', myState[KEY_NAME]);\r\n\r\n    return <Modal open={showSaveForm}    \r\n    size='mini'\r\n    closeOnDimmerClick={true}\r\n    className=\"saveAsModal\"\r\n    >\r\n    <Header icon='save' content={title} />\r\n    <Modal.Content scrolling>\r\n    <Form onSubmit={(args) => onSave(args[KEY_NAME])} \r\n        watchedField={KEY_NAME}\r\n        setStateCb={setMyState}>\r\n        <FormText key={'SaveAs-' + KEY_NAME}\r\n            name={KEY_NAME}\r\n            label={formLabel}\r\n        />\r\n    <Modal.Actions>\r\n        <Button floated={'right'} \r\n                color='green' \r\n                type=\"submit\"\r\n                disabled={!myState[KEY_NAME] || myState[KEY_NAME].length === 0}\r\n        >\r\n            Save\r\n        </Button>\r\n        <Button floated={'right'} onClick={onClose}>\r\n            Cancel            \r\n        </Button>\r\n    </Modal.Actions>    \r\n\r\n    </Form>                 \r\n    </Modal.Content>\r\n    </Modal>;\r\n}\r\n\r\nexport default SaveAsDialog;","import React, {useState} from 'react';\r\nimport {Modal, Header, Button, Icon} from 'semantic-ui-react';\r\nimport Form, {Text as FormText, Dropdown as FormDropdown} from '../form/Form';\r\n\r\nconst KEY_NAME = \"Name\";\r\n\r\nconst OpenDialog = ({showOpenForm, title, formLabel, onOpen, onClose, options}) => {\r\n    // Watch the state, to disable the Save button if it's empty\r\n    const [myState, setMyState] = useState({\r\n        [KEY_NAME]: null});\r\n\r\n    // console.log('SaveAsDialog render', myState[KEY_NAME]);\r\n\r\n    return <Modal open={showOpenForm}    \r\n    size='mini'\r\n    closeOnDimmerClick={true}\r\n    className=\"openModal\"\r\n    >\r\n    <Header icon='folder' content={title} />\r\n    <Modal.Content scrolling>\r\n    <Form onSubmit={(args) => onOpen(args[KEY_NAME])} \r\n        watchedField={KEY_NAME}\r\n        setStateCb={setMyState}>\r\n        <FormDropdown key={'Open-' + KEY_NAME}\r\n            name={KEY_NAME}\r\n            label={formLabel}\r\n            options={options}\r\n        />\r\n    <Modal.Actions>\r\n        <Button floated={'right'} \r\n                color='green' \r\n                type=\"submit\"      \r\n                disabled={!myState[KEY_NAME] || myState[KEY_NAME].length === 0}          \r\n        >\r\n            Open\r\n        </Button>\r\n        <Button floated={'right'} onClick={onClose}>\r\n            Cancel            \r\n        </Button>\r\n    </Modal.Actions>    \r\n\r\n    </Form>                 \r\n    </Modal.Content>\r\n    </Modal>;\r\n}\r\n\r\nexport default OpenDialog;","import React from 'react';\r\nimport { bindActionCreators } from \"redux\";\r\nimport NoobSplitter from '../components/noobSplitter';\r\nimport ToolPanel from '../components/toolPanel';\r\nimport DesignerForm from '../components/designerForm';\r\nimport DesignerContentbase from './designerContentBase';\r\n//import DesignerToolbar from '../components/designerToolbar';\r\nimport Toolbar from '../components/toolbar';\r\nimport NoobForm from '../components/noobForm';\r\nimport './designerCommon.css';\r\nimport {saveLayout, openLayout, selectedPage} from '../actions';\r\nimport ShowMessage, {NotifType} from '../helper/notification';\r\n\r\nimport {connect} from 'react-redux';\r\nimport SaveAsDialog from '../components/saveAs';\r\nimport OpenDialog from '../components/openDialog';\r\n\r\nconst DEFAULT_SPLIT_SIZES = [25, 75];\r\n\r\nconst panelItems = [\r\n    {\r\n        title: 'Toolbox',\r\n        id: 'toolbox',\r\n        isCollapsed: false,\r\n        size: 0,\r\n        helpText: 'Drag an item to the Designer Area'\r\n    },\r\n    {\r\n        title: 'Properties',\r\n        id: 'properties',\r\n        isCollapsed: false,\r\n        size: 0,\r\n        helpText: 'Please select an item from the Designer Area to view the properties'\r\n    },\r\n]\r\n\r\n\r\nclass formsDesignerContent extends DesignerContentbase {\r\n    constructor(props) {\r\n        super(props);\r\n        //this.defaultSizes = DEFAULT_SPLIT_SIZES;\r\n        this.menuItems = {\r\n            'left': [\r\n                {key:'designertb_save', icon: 'save', text: 'Save', callback: this.saveCallback},\r\n                {key:'designertb_saveas', icon: 'save outline', text: 'Save As...', callback: this.saveAsCallback},\r\n                {key:'designertb_open', icon: 'open folder outline', text: 'Open...', callback: this.openCallback},\r\n                \r\n            ],\r\n            'right': [\r\n                //{key:'designertb_preview', icon: 'eye', text: 'Hold to Preview', disabled: true},\r\n                {key:'designertb_configPage', icon: 'window maximize outline', text: 'Configure Page Settings', callback: this.configPageSettings},\r\n            ]\r\n        }\r\n\r\n        this.state = {\r\n            ...this.state,\r\n            showSaveForm: false,\r\n            showOpenForm: false,\r\n            openedLayoutName: null,            \r\n        }\r\n    }\r\n\r\n    configPageSettings = () => {\r\n        // Fire a redux action to select the page, and unselect any selected control\r\n        this.props.selectedPage();\r\n    }\r\n\r\n    saveCallback = () => {\r\n        console.log('Save callback', this.props.layoutData);\r\n        // If untitled, call Save As callback\r\n        if (!this.props.layoutData.name) {\r\n            this.saveAsCallback();\r\n        }\r\n        else {\r\n            this.handleSave(this.props.layoutData.name);\r\n        }\r\n    }\r\n    \r\n    saveAsCallback = () => {\r\n        console.log('Save As callback');\r\n        // Popup the dialog to ask user to input name\r\n        this.setState({\r\n            showSaveForm: true\r\n        })        \r\n    }\r\n\r\n    handleSave = async (layoutName) => {\r\n        console.log('Save the layout...', layoutName);\r\n        let result = await this.props.saveLayout(this.props.layout, layoutName, this.props.layoutData); // dispatch redux action\r\n        if (result === true) {\r\n            ShowMessage(\"Layout Saved!\");\r\n            // Also \"open\" this now\r\n            this.setState({\r\n                openedLayoutName: layoutName\r\n            })\r\n        }\r\n        else {\r\n            ShowMessage(\"Failed to Save Layout!\", NotifType.danger, result.message);\r\n        }\r\n        this.handleCloseSave();\r\n\r\n        // Also fire a redux action to \"open\" the newly saved form\r\n        let layoutToUse = this.getLayoutToUse(layoutName);\r\n        this.props.openLayout(layoutToUse.controls, layoutToUse.layoutData)\r\n    }\r\n\r\n    handleCloseSave = () => {\r\n        console.log('handleCloseSave');\r\n        if (this.state.showSaveForm) {\r\n            this.setState({\r\n                showSaveForm: false\r\n            })\r\n        }\r\n    }\r\n    \r\n    openCallback = () => {\r\n        console.log('Open callback');\r\n        this.setState({\r\n            showOpenForm: true\r\n        });\r\n    }\r\n\r\n    // For closing the Open-Layout Dialog\r\n    handleCloseOpenDlg = () => {\r\n        console.log('handleCloseSave');\r\n        if (this.state.showOpenForm) {\r\n            this.setState({\r\n                showOpenForm: false\r\n            })\r\n        }\r\n    }\r\n\r\n    // After the user has selected a layout, then clicked open\r\n    handleOpenLayout = (layoutName) => {\r\n        // \r\n        if (this.state.showOpenForm) {\r\n            this.setState({\r\n                openedLayoutName: layoutName,\r\n                showOpenForm: false\r\n            })\r\n        }\r\n\r\n        // Also fire a redux action to update\r\n        let layoutToUse = this.getLayoutToUse(layoutName);\r\n        this.props.openLayout(layoutToUse.controls, layoutToUse.layoutData)\r\n    }\r\n\r\n    getLayoutToUse = (openedLayoutName) => {\r\n        // If the user did not open, just use the default layout from the reducer\r\n        let defaultReturn = {\r\n            controls: this.props.layout,\r\n            layoutData: this.props.layoutData, \r\n            title: \"Untitled\",\r\n            titleTooltip: \"Form is not yet saved\"\r\n        };\r\n\r\n        if (!openedLayoutName) {\r\n            return defaultReturn;\r\n        }\r\n\r\n        // Find \r\n        let layoutFromApi = this.props.savedLayouts.find(x => x.name === openedLayoutName);\r\n        if (!layoutFromApi) {\r\n            return defaultReturn;\r\n        }\r\n        return {\r\n            controls: JSON.parse(layoutFromApi.layoutJson),\r\n            layoutData: {\r\n                name: layoutFromApi.name,\r\n                columns: layoutFromApi.numCols,\r\n                rows: layoutFromApi.numRows,\r\n                pageFilterFields: layoutFromApi.pageFilterFields && JSON.parse(layoutFromApi.pageFilterFields),\r\n                pageApiData: layoutFromApi.pageApiData && JSON.parse(layoutFromApi.pageApiData),\r\n            },\r\n            title: layoutFromApi.name,\r\n            titleTooltip: \"Last saved on \" + layoutFromApi.lastUpdateDate\r\n        };\r\n    }\r\n    \r\n    render() {\r\n        console.log('render designerContent', this.props.savedLayouts);\r\n        let options = Array.isArray(this.props.savedLayouts) &&\r\n                    this.props.savedLayouts.map((layout) => {return {key: `option_${layout.name}`, text: layout.name, value: layout.name}});\r\n        let layoutToUse = this.getLayoutToUse(this.state.openedLayoutName);\r\n\r\n        return <NoobSplitter id=\"designerPanel\" onDragEnd={this.onSplitDragEnd} defaultSize={DEFAULT_SPLIT_SIZES}>\r\n            <ToolPanel panelItems={panelItems} containerWidth={this.state.leftPixels}/>\r\n            <div id=\"rightContainer\" className=\"designerContainer\">\r\n                {/* <DesignerToolbar containerWidth={this.state.rightPixels}/> */}\r\n                <Toolbar \r\n                    containerWidth={this.state.rightPixels}\r\n                    menuItems={this.menuItems}\r\n                    title={layoutToUse.title}\r\n                    titleTooltip={layoutToUse.titleTooltip}\r\n                />\r\n                <div className=\"layoutEditorContainer\">\r\n                    <NoobForm \r\n                        containerWidth={this.state.rightPixels}\r\n                        // layoutData={layoutToUse.layoutData}\r\n                        // controls={layoutToUse.controls}\r\n                        layoutData={this.props.layoutData}\r\n                        controls={this.props.layout}\r\n                        />\r\n                </div>\r\n                <SaveAsDialog showSaveForm={this.state.showSaveForm}\r\n                            title={\"Save Layout\"}\r\n                            formLabel={\"Layout name:\"}\r\n                            onSave={this.handleSave}\r\n                            onClose={this.handleCloseSave}\r\n                />\r\n                <OpenDialog showOpenForm={this.state.showOpenForm}\r\n                            title={\"Open Layout\"}\r\n                            formLabel={\"Layout name:\"}\r\n                            onOpen={this.handleOpenLayout}\r\n                            onClose={this.handleCloseOpenDlg}\r\n                            options={options}\r\n                />\r\n            </div>\r\n        </NoobSplitter>\r\n    }\r\n}\r\n\r\nconst mapStateToProps = (state) => {\r\n    return {\r\n        layout: state.designer.layout,\r\n        layoutData: state.designer.layoutData,\r\n        metadata: state.designer.metadata,\r\n        savedLayouts: state.mainApp.masterLayouts\r\n    };\r\n}\r\n\r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({ saveLayout, openLayout, selectedPage }, dispatch);\r\n}\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(formsDesignerContent);","import React from 'react';\r\nimport './hierDesignerToolbar.css';\r\n\r\n// Toolbar for the Hierachy Designer.\r\n// It is permanently placed on top.\r\n// Houses the search bar and other buttons\r\nconst HierarchyToolbar = ({onDelete, onInsert, onSave, onSearchText, bEnableDelete}) => {\r\n    let clsNamesDeleteBtn = 'hierDesignerToolbarButton';\r\n    if (!bEnableDelete) {\r\n        clsNamesDeleteBtn += ' hierDesignerToolbarButton-disabled';\r\n    }\r\n    return <div className=\"hierDesignToolbar\">\r\n        <div className=\"ui icon input small fluid\" style={{margin: \"5px\", width: \"100%\"}}>\r\n            <input type=\"text\" placeholder=\"Search tree...\" onChange={onSearchText} disabled/>\r\n            <i className=\"inverted circular filter icon\"></i>\r\n        </div>\r\n        <div className=\"toolBarBtnContainer\">\r\n            <div className=\"hierDesignerToolbarButton\" onClick={onSave}>\r\n            <i className=\"ui icon save\"/>\r\n            Save\r\n            </div>\r\n            <div className=\"hierDesignerToolbarButton\" onClick={onInsert}>\r\n            <i className=\"ui icon plus insert\"/>\r\n            Insert\r\n            </div>\r\n            <div className={clsNamesDeleteBtn} onClick={onDelete}>\r\n            <i className=\"ui icon trash alternate\"/>\r\n            Delete\r\n            </div>\r\n        </div>\r\n    </div>\r\n}\r\n\r\nexport default HierarchyToolbar;","import React from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport NoobSplitter from '../components/noobSplitter';\r\nimport DesignerContentbase from './designerContentBase';\r\nimport HierarchyDesignerTree from './hierearchyTree';\r\nimport HierarchyToolbar from '../components/hierDesignerToolbar';\r\nimport HierConfigPanel from './hierarchyConfigPanel';\r\nimport { selectHierDesignerTree, \r\n        updateHierDesignerTree, \r\n        insertNewNode, \r\n        filterHierDesignerTree,\r\n        fetchHierarchyViews,\r\n        saveHierarchyView } from '../actions/index';\r\nimport {findNodeByKey, filterTree, filterTreeEx} from '../helper/treefilter';\r\n\r\n\r\nimport './hierarchyTree.css'; //temp only\r\nimport './hierarchyDesigner.css';\r\nimport ShowMessage, { NotifType } from '../helper/notification';\r\n\r\nconst DEFAULT_SPLIT_SIZES = [25, 75];\r\n\r\nconst ToolbarPanel = ({children, onDelete, onInsert, onSave, onSearchText, bEnableDelete}) => {\r\n    //console.log('[render] AccordionPanel, id: ', id);\r\n    return <div className=\"toolbarPanel\">        \r\n        <div className=\"toolbarContainer\">\r\n            <HierarchyToolbar \r\n                onDelete={onDelete} \r\n                onInsert={onInsert} \r\n                onSave={onSave} \r\n                onSearchText={onSearchText}\r\n                bEnableDelete={bEnableDelete}/>\r\n        </div>\r\n        <div className=\"toolbarPanelBody\">\r\n            {children}\r\n        </div>\r\n    </div>;\r\n}\r\n\r\nconst HierarchyPropsPanel = (containerWidth) => {\r\n    return <HierConfigPanel containerWidth={containerWidth}/>\r\n}\r\n\r\n// This will be the intelligent class that will hold\r\n// the state of the hierarchy tree, to handle deletion and insertion of new nodes\r\nclass HierarchyDesigner extends DesignerContentbase { \r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            searchText: null,\r\n            treeData: null, // make a copy for filtering purposes\r\n            ...this.state\r\n        }\r\n    }\r\n\r\n    // When a tree node is selected\r\n    onSelect = (selectedKeys, info) => {\r\n        console.log('selected', selectedKeys, info);\r\n        this.selKey = info.node.props.eventKey;\r\n        // Fire an action to save the selected node to Redux\r\n        //this.props.selectToolPanelTree(this.selKey);\r\n        if (selectedKeys.length > 0) {\r\n            this.props.selectHierDesignerTree({\r\n              key: selectedKeys[0], \r\n              ...info.selectedNodes[0].props\r\n            });\r\n        }\r\n        else {\r\n            this.props.selectHierDesignerTree(null);\r\n        }\r\n      };\r\n\r\n    onHierarchyChanged = (data) => {\r\n        this.props.updateHierDesignerTree(data);\r\n    }\r\n\r\n    onSave = async () => {\r\n        console.log('onSave');\r\n        let result = await this.props.saveHierarchyView(this.props.hierarchyTree, this.props.userSettings)\r\n        if (result === true) {\r\n            ShowMessage(\"Saved Hierarchy View!\");\r\n        }\r\n        else {\r\n            ShowMessage(\"Failed to Save Hierarchy View!\", NotifType.danger, result.message);\r\n        }\r\n    }\r\n\r\n    onInsert = () => {\r\n        console.log('onInsert');\r\n        // popup a dialog to ask the user to specify the title?\r\n        // for now, just implement the edit page\r\n\r\n        // For the underlying structure: just implement the logic in the reducer\r\n        this.props.insertNewNode();\r\n    }\r\n\r\n    onDelete = () => {\r\n        console.log('onDelete');\r\n        // Actually the logic can also be implemented @reducer side. Anyways, we save one more redux action to create.\r\n        let deletedNode = this.props.selectedNode;\r\n        let data = [...this.props.hierarchyTree]; // make a new copy\r\n        let deletedNodeObj = findNodeByKey(data, deletedNode.key);\r\n        if (!deletedNodeObj) {\r\n            return; // sanity only\r\n        }\r\n\r\n        deletedNodeObj.parentArr.splice(deletedNodeObj.index, 1);\r\n        this.props.updateHierDesignerTree(data);\r\n    }\r\n\r\n    onSearchText = (e) => {        \r\n        this.setState({\r\n            searchText: e.currentTarget.value\r\n        });\r\n        // this.props.filterHierDesignerTree(e.currentTarget.value);        \r\n    }\r\n    \r\n    render() {\r\n        console.log('render hierarchyDesigner', this.state.rightPixels);\r\n        // TODO: Put a minsize first. Should make the toolbar buttons responsive.\r\n        return <NoobSplitter id=\"hierarchyDesigner\" onDragEnd={this.onSplitDragEnd} defaultSize={DEFAULT_SPLIT_SIZES} minSize={230}>\r\n            <ToolbarPanel \r\n                onDelete={this.onDelete}\r\n                onInsert={this.onInsert}\r\n                onSave={this.onSave}\r\n                onSearchText={this.onSearchText}\r\n                bEnableDelete={!!this.props.selectedNode && !!this.props.selectedNode.key}                \r\n            >\r\n                {this.props.hierarchyTree && <HierarchyDesignerTree \r\n                    onSelectCb={this.onSelect} \r\n                    onHierarchyChanged={this.onHierarchyChanged}\r\n                    treeData={this.props.hierarchyTree}\r\n                    selectedNodeKey={this.props.selectedNode ? this.props.selectedNode.key : null}\r\n                    searchText={this.state.searchText}\r\n                    userSettings={this.props.userSettings}\r\n                    draggable\r\n                    defaultExpandAll={true}\r\n                    />\r\n                }\r\n            </ToolbarPanel>\r\n            {HierarchyPropsPanel(this.state.rightPixels)}\r\n        </NoobSplitter>\r\n\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        hierarchyTree: state.hierarchyDesigner.hierarchyTree,\r\n        selectedNode: state.hierarchyDesigner.selectedNode,\r\n        userSettings: state.hierarchyDesigner.userSettings,        \r\n    }\r\n}\r\n  \r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({ selectHierDesignerTree, \r\n                                updateHierDesignerTree, \r\n                                insertNewNode, \r\n                                filterHierDesignerTree,\r\n                                fetchHierarchyViews,\r\n                                saveHierarchyView }, dispatch);\r\n}\r\n  \r\nexport default connect(mapStateToProps, mapDispatchToProps)(HierarchyDesigner);","import React from 'react';\r\nimport { useSelector } from 'react-redux';\r\nimport './specialTabContent.css';\r\nimport ReportForm from '../components/reportForm';\r\n\r\n//hierarchyPropName: In the Hierarchy Designer, there is a checkbox for \"displayAsMapView\" and \"displayAsAnalysisView\"\r\n// Expectation is that user will tick the checkbox for ONE hierarchy.\r\n// Basically this tab will display the first hierarchy with that tick (if there are more than one).\r\nconst SpecialTabContent = ({hierarchyPropName}) => {\r\n\r\n    // Nested functions - START\r\n    const findFirstNode = (userSettings) => {\r\n        if (!userSettings) {\r\n            return null;\r\n        }\r\n\r\n        return userSettings.find(u => u[hierarchyPropName] === true);\r\n    }\r\n\r\n    const getLayoutObj = (layoutName, masterLayouts) => {\r\n        let findLayout = masterLayouts && masterLayouts.find(layout => layout.name === layoutName);\r\n        return {\r\n            controls: findLayout && JSON.parse(findLayout.layoutJson),\r\n            layoutData: findLayout && {\r\n                rows: findLayout.numRows,\r\n                columns: findLayout.numCols,\r\n                pageFilterFields: findLayout.pageFilterFields && JSON.parse(findLayout.pageFilterFields),\r\n                pageApiData: findLayout.pageApiData && JSON.parse(findLayout.pageApiData)\r\n            }\r\n        }\r\n    }\r\n    // Nested functions - END\r\n\r\n    // Find from the redux store the first hierarchy with {hierarchyPropName} checked\r\n    const masterHierarchyViews = useSelector(state => state.mainApp.masterHierarchyViews);\r\n    const masterLayouts = useSelector(state => state.mainApp.masterLayouts);\r\n    const metadata = useSelector(state => state.mainApp.masterMetadata);\r\n    let defaultView = masterHierarchyViews && masterHierarchyViews[0];\r\n    let userSettings = defaultView && JSON.parse(defaultView.nodeSettingsJson);\r\n\r\n    let findSettingNode = findFirstNode(userSettings);\r\n    if (!findSettingNode) {\r\n        return <div>Loading...</div>;\r\n    }\r\n\r\n    let layoutName = findSettingNode.pageAssoc;\r\n    // Note: For now, just assume that special tabs have a pageAssoc defined, instead of inherited page\r\n    // So that we don't need to go and find the inherited page from the hierarchy tree\r\n    let layoutObj = getLayoutObj(layoutName, masterLayouts);\r\n\r\n    return <div className=\"specialTabContainer\">\r\n        <ReportForm\r\n            containerWidth={window.innerWidth}\r\n            layoutData={layoutObj.layoutData}\r\n            controls={layoutObj.controls}\r\n            metadata={metadata}\r\n            layoutName={layoutName}\r\n            pageFilters={null}\r\n        />\r\n    </div>\r\n}\r\n\r\nexport default SpecialTabContent;","import React, {useState} from 'react';\r\nimport { useDispatch } from 'react-redux';\r\nimport Form, {FormDateRange} from '../form/Form';\r\nimport './downloadCenterContent.css'\r\nimport { Segment, Label, Button } from 'semantic-ui-react';\r\nimport FormDropDown from '../form/FormDropDown';\r\nimport {requestDownloadReport} from '../actions';\r\nimport {fetchPageDataSync, fetchPageDataAsync} from '../api/pageApiManager';\r\nimport {findExecSummaryRecords} from '../api/ExecutiveSummaryLogic';\r\nimport ShowMessage, {NotifType} from '../helper/notification';\r\nimport MyEditor from '../components/MyEditor';\r\n\r\n// Called to set the initial values\r\nconst setPdfFormValues = (setValueFunc, inputObj) => {\r\n    // Set the Analysis Period to Custom Range\r\n    setValueFunc(\"downloadCentreAnalysisPeriod\", \"CustomRange\");\r\n}\r\n\r\n// TODO: put this inside a settings config\r\nconst EXEC_SUMMARY_API = \"https://0kwuefbg37.execute-api.ap-south-1.amazonaws.com/Initial/execsummary\";\r\n\r\n// TODO: Create a Report Designer component.\r\n// The dropdown options will be the Report Hierarchy designed by the user\r\nconst downloadOptions = [\r\n    { key: 'ExecSummary', text: 'APR Executive Summary', value: 'ExecSummary'},\r\n    { key: 'Full APR Report', text: 'Full APR Report', value: 'Full APR Report',  disabled: true },\r\n];\r\n\r\nconst formatDate = (date) => {\r\n    return `${date.getFullYear()}-${date.getMonth()+1}`;\r\n}\r\n\r\nconst constructReportTitle = (execReport) => {\r\n    if (!execReport) {\r\n        return \"Report.pdf\";\r\n    }\r\n\r\n    let start = new Date(execReport.aprStart);\r\n    let end = new Date(execReport.aprEnd);\r\n\r\n    return `Report_${formatDate(start)}_${formatDate(end)}.pdf`;\r\n}\r\n\r\n\r\nconst DownloadCenterContent = () => {\r\n\r\n    const downloadExecReport = async (execReport) => {\r\n        let response = await dispatch(requestDownloadReport({\r\n            uuid: execReport.uuid,\r\n            start: execReport.aprStart,\r\n            end: execReport.aprEnd\r\n        }));\r\n        const url = window.URL.createObjectURL(new Blob([response.data], {type: \"application/octet-stream\"}));\r\n        const link = document.createElement('a');\r\n        link.href = url;\r\n        link.setAttribute('download', `${constructReportTitle(execReport)}`); //or any other extension\r\n        document.body.appendChild(link);\r\n        link.click();\r\n    }\r\n\r\n    const onSubmitDownloadReport = (args) => {\r\n        console.log('onSubmitDownloadReport', args);\r\n        // Disable the download button while fetching the report\r\n        setDownloading(true);\r\n        setDownloadProgress(\"Fetching Exec Summaries\");\r\n\r\n        // Get the Exec Summary API Data from the server first\r\n        fetchPageDataAsync(EXEC_SUMMARY_API)\r\n        .catch(error => {\r\n            setDownloading(false);\r\n            setDownloadProgress(\"Download Report\");    \r\n        })\r\n        .then(async apiResponse => {\r\n            // Determine the Exec Reports to print\r\n            let execReports = findExecSummaryRecords(apiResponse, args);\r\n            if (execReports.length === 0) {\r\n                ShowMessage(\"Did not find matching Executive Summary Record\", NotifType.warning, \"Please try another Analysis Period\")\r\n            }\r\n            // testing only, multiple pages\r\n            //execReports = execReports.concat(execReports);\r\n            for (let i = 0; i < execReports.length; i++) {\r\n                setDownloadProgress(`Downloading Report ${i+1} of ${execReports.length}`);   \r\n                await downloadExecReport(execReports[i]);\r\n            }\r\n            debugger\r\n            setDownloading(false);\r\n            setDownloadProgress(\"Download Report\");\r\n        });\r\n\r\n        \r\n\r\n        // For each exec report, send the request to the pdf service\r\n        // dispatch(requestDownloadReport(args.analysisPeriod)).then(response => {\r\n        //     debugger\r\n        //     const url = window.URL.createObjectURL(new Blob([response.data], {type: \"application/octet-stream\"}));\r\n        //     const link = document.createElement('a');\r\n        //     link.href = url;\r\n        //     link.setAttribute('download', 'file.pdf'); //or any other extension\r\n        //     document.body.appendChild(link);\r\n        //     link.click();\r\n\r\n        //     setDownloading(false);\r\n        // });\r\n    }\r\n\r\n    const dispatch = useDispatch();\r\n    const [downloading, setDownloading] = useState(false);\r\n    const [downloadProgress, setDownloadProgress] = useState(\"Download Report\");\r\n\r\n    //let buttonTitle = downloading ? \"Downloading Report. Please wait...\" : \"Download Report\";\r\n\r\n    return <div className=\"downloadCenterContent\">\r\n        <Segment>\r\n            <Form \r\n                setControlValues={setPdfFormValues}\r\n                onSubmit={onSubmitDownloadReport}\r\n                // action=\"http://localhost:5000/createpdf\"\r\n                // method=\"post\"\r\n            >\r\n                <div className=\"segmentTitle\">Request PDF Report</div>\r\n                <Label tag size=\"large\" color=\"brown\">Step 1:&nbsp;&nbsp;&nbsp;Enter the Analysis Period</Label>\r\n                <div className=\"downloadCenterFieldContainer\">                    \r\n                    <FormDateRange alwaysCustomRange key=\"downloadCentreAnalysisPeriod\" name=\"analysisPeriod\" label={null} showMonthYearPicker dateFormat=\"yyyy / MMM\"/>\r\n                </div>\r\n                \r\n                <Label tag size=\"large\" color=\"brown\">Step 2:&nbsp;&nbsp;&nbsp;Select the APR Download Type</Label>\r\n                <div className=\"downloadCenterFieldContainer\">\r\n                    <div></div>\r\n                    <FormDropDown key={'downloadCenterPdfOptions'}\r\n                        name={'downloadCenterPdfOptions'}\r\n                        label=\"\"\r\n                        options={downloadOptions}\r\n                        size=\"small\"\r\n                        //defaultValue={\"ExecSummary\"} // does not work...maybe need to bind to a state value, and call setState during componentWillXXX\r\n                    />\r\n                </div>\r\n\r\n                <Label tag size=\"large\" color=\"brown\">Step 3:&nbsp;&nbsp;&nbsp;Download Report</Label>\r\n                <div className=\"downloadCenterFieldContainer\">                    \r\n                    <div></div>\r\n                    <Button primary disabled={downloading}>{downloadProgress}</Button>\r\n                </div>\r\n\r\n            </Form>\r\n        </Segment>\r\n        {/* <MyEditor/> */}\r\n    </div>\r\n}\r\n\r\nexport default DownloadCenterContent;","import React, { useState } from \"react\";\r\nimport { EditorState } from \"draft-js\";\r\nimport \"draft-js/dist/Draft.css\";\r\nimport Editor from \"draft-js-plugins-editor\";\r\nimport createLinkifyPlugin from \"draft-js-linkify-plugin\";\r\n\r\nimport \"./MyEditor.css\";\r\n\r\nconst linkifyPlugin = createLinkifyPlugin({\r\n  target: \"_blank\",\r\n  component: props => {\r\n    const { contentState, ...rest } = props;\r\n    return <a {...rest} onClick={() => alert(\"link clickedxxx!!!\")} />;\r\n  }\r\n});\r\nconst plugins = [linkifyPlugin];\r\n\r\nconst MyEditor = () => {\r\n\r\n  const [editorState, setEditorState] = useState(EditorState.createEmpty());\r\n\r\n  const onChange = editorState => {\r\n    setEditorState(editorState);\r\n  };\r\n\r\n  const focus = () => {\r\n    //this.editor.focus();\r\n  };\r\n\r\n    return (\r\n      <div className=\"editor\">\r\n        <Editor\r\n          editorState={editorState}\r\n          onChange={onChange}\r\n          plugins={plugins}\r\n        />\r\n      </div>\r\n    );\r\n}\r\n\r\nexport default MyEditor;","import React, {useState} from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { bindActionCreators } from \"redux\";\r\nimport NoobSplitter from '../components/noobSplitter';\r\nimport DesignerContentbase from './designerContentBase';\r\nimport Form, {Text as FormText, FormCheckbox, Dropdown as FormDropDown, FormTreeDropDown, FormRadio, FormDateRange} from '../form/Form';\r\nimport { Form as SemanticForm, Segment} from \"semantic-ui-react\";\r\nimport ShowMessage, { NotifType } from '../helper/notification';\r\nimport Toolbar from '../components/toolbar';\r\nimport 'rc-tree-select/assets/index.css';\r\nimport TreeSelect, { SHOW_PARENT } from 'rc-tree-select';\r\nimport {findNodeByKey} from '../helper/treefilter';\r\nimport _ from \"lodash\";\r\nimport {Button, Icon, Label} from 'semantic-ui-react';\r\n\r\nimport './dataDesignerContent.css';\r\n\r\nconst DEFAULT_SPLIT_SIZES = [15, 85];\r\nconst defaultScope = 'self';\r\nconst ID_PREVIEW_BTN = 'dataDsgnPreview';\r\n\r\nconst DataListPanel = () => {\r\n    return <div>\r\n        Data List Panel (Under Construction)\r\n    </div>\r\n}\r\n\r\nconst menuItems = {\r\n    'left': [\r\n        {key:'datadesignertb_save', icon: 'save', text: 'Save', type:'submit'},\r\n        {key:'datadesignertb_saveas', icon: 'save outline', text: 'Save As', type:'submit'},\r\n    ],\r\n};\r\n\r\n/*\r\nconst addUniqueToArray = (srcArray, destArray) => {\r\n    if (!srcArray || !destArray) {\r\n        return;\r\n    }\r\n\r\n    for (let i = 0; i < srcArray.length; i++) {\r\n        if (destArray.includes(srcArray[i])) {\r\n            continue;\r\n        }\r\n        destArray.push(srcArray[i]);\r\n    }\r\n}\r\n\r\nconst addSelectedKpisToArray = (srcArray, destArray) => {\r\n    if (!srcArray || !destArray) {\r\n        return;\r\n    }\r\n\r\n    for (let i = 0; i < srcArray.length; i++) {\r\n        let currKpiGrp = srcArray[i];\r\n        \r\n        let findGrpQry = destArray.find(x => x.kpiGrp === currKpiGrp.kpiGrp);\r\n        if (!findGrpQry) {\r\n            destArray.push(currKpiGrp);\r\n            continue;\r\n        }\r\n\r\n        // If we find the group, check if it contains all KPI's\r\n        // Note: Do not assume all groups with same name necessarily have same set of KPI's\r\n        for (let j = 0; j < currKpiGrp.kpis.length; j++) {\r\n            if (!findGrpQry.kpis.includes(currKpiGrp.kpis[j])) {\r\n                findGrpQry.kpis.push(currKpiGrp.kpis[j]);\r\n            }\r\n        }        \r\n    }\r\n}\r\n\r\nconst filterObj = (obj, fields) => {\r\n    return _.pick(obj, fields);\r\n}\r\n\r\n\r\nconst gatherKpiGroupOptions = (selectedNode, scope, hierarchyKpi, selectedKpiGroups) => {\r\n    // If hierarchy is a target, just render all the KPI groups\r\n    let retObj = {};\r\n    if (!hierarchyKpi || !selectedNode) {\r\n        return retObj;\r\n    }\r\n    console.log('renderKpiGroups', selectedNode, scope);\r\n    \r\n    if (scope === 'self') {\r\n        let kpiGrps = hierarchyKpi[selectedNode.item.key] || [];\r\n        let kpiGrpsFiltered = filterObj(kpiGrps, selectedKpiGroups); // We only add the KPI's that belong to the selected KPI Groups\r\n        retObj.kpiGrps = Object.keys(kpiGrps);\r\n\r\n        retObj.kpis = getKpiObjects(kpiGrpsFiltered);\r\n        //retObj.kpis = [].concat.apply([], Object.values(kpiGrpsFiltered).map(x => Object.values(x)));\r\n    }\r\n    else {\r\n        // Gather all the uniq items from all its children (recursive)\r\n        // Assume that the path is the basis for now\r\n        retObj.kpiGrps = []; // All KPI Groups belonging to the hierarchy\r\n        retObj.kpis = []; // All KPI's belonging to the selected KPI groups only\r\n        for (var key in hierarchyKpi) {\r\n            \r\n            if (key === selectedNode.item.key || !key.includes(selectedNode.item.key)) {\r\n                continue;\r\n            }\r\n            let kpiGrps = hierarchyKpi[key] || [];\r\n            let currKpiGrps = Object.keys(kpiGrps);\r\n            \r\n            addUniqueToArray(currKpiGrps, retObj.kpiGrps);\r\n            \r\n            let kpiGrpsFiltered = filterObj(kpiGrps, selectedKpiGroups);\r\n            let currKpis = getKpiObjects(kpiGrpsFiltered);\r\n            addSelectedKpisToArray(currKpis, retObj.kpis);\r\n\r\n            // let currKpis = [].concat.apply([], Object.values(kpiGrpsFiltered).map(x => Object.values(x)));\r\n            // addUniqueToArray(currKpis, retObj.kpis);\r\n        }\r\n    }\r\n\r\n    return retObj;\r\n}\r\n\r\n// KPI's belonging to different KPI groups may have the same name\r\n// e.g. \"Time in Control\" can be from \"Loop Controllability\" or \"Valve Controllability\"\r\n// To differentiate, we include the KPI Group also.\r\nconst getKpiObjects = (kpiGroups) => {\r\n    if (!kpiGroups) {\r\n        return null;\r\n    }\r\n\r\n    let retList = [];\r\n    for (let kpiGrp in kpiGroups) {\r\n        if (!kpiGroups.hasOwnProperty(kpiGrp)) {\r\n            continue;\r\n        }\r\n\r\n        retList.push({\r\n            kpiGrp: kpiGrp,\r\n            kpis: kpiGroups[kpiGrp]\r\n        });        \r\n    }\r\n\r\n    return retList;\r\n}\r\n*/\r\n\r\nconst renderDropdown = (name, listItems) => {\r\n    let dropdownOpts = listItems ? listItems.map(x => {\r\n        return {\r\n        key: 'dataDsgn_' + name + '_' + x,\r\n        text: x,\r\n        value: x\r\n    }}) : [];\r\n\r\n    return <FormDropDown name={name} options={dropdownOpts} multiple/>;\r\n}\r\n\r\nconst renderPreviewTable = () => {\r\n\r\n}\r\n\r\n// converts the dimensions from metadata into a format the tree-select component expects\r\nconst convertApiMetadataDims = (apiMetadataDims, parent=null) => {\r\n    if (!apiMetadataDims) {\r\n        return null;\r\n    }\r\n\r\n    return apiMetadataDims.map(x => {\r\n        let {name, items, ...rest} = x;\r\n        return {\r\n            name: parent ? `${parent.name}.${name}` : name,\r\n            value: parent ? `${parent.name}.${name}` : name,\r\n            title: name,\r\n            children: convertApiMetadataDims(items, x),\r\n            ...rest\r\n        }\r\n    });\r\n}\r\n\r\nconst convertApiMetadataFilters = (apiMetadata) => {\r\n    // Basically, add the Request Params to the front (e.g. )\r\n    let metadataDims = convertApiMetadataDims(apiMetadata.Dimensions);\r\n    // Assume request params is single level only\r\n    let requestItems = apiMetadata.RequestParams.map(r => {\r\n        let {name, ...rest} = r;\r\n        return {\r\n            name: name,\r\n            value: name,\r\n            title: name,\r\n            children: [],\r\n            ...rest\r\n        }\r\n    });\r\n    metadataDims.unshift(...requestItems);    \r\n    return metadataDims;\r\n}\r\n\r\nconst onTreeSelect = (value, node, extra) => {\r\n    // TODO:\r\n    // [1] If the parent node is selected, unselect all child nodes (implicitly, all child nodes are already included)\r\n}\r\n\r\nconst renderFilterFields = (state, props) => {\r\n    if (!state || !state.filterFields) {\r\n        return null;\r\n    }\r\n\r\n    let filterFields = state.filterFields.map((filter, i) => <div className=\"filterRow\" key={\"filterField\" + i}>\r\n        <SemanticForm.Field className=\"filterField\">\r\n            <FormTreeDropDown \r\n                name={\"filterField\" + i}\r\n                treeData={props.filtersMetadata} \r\n                isRequired={false}\r\n                label={\"Field Name\"}                     \r\n            />\r\n        </SemanticForm.Field>\r\n        <SemanticForm.Field className=\"filterField\">\r\n            <FormText\r\n                label={\"Filter Value\"}\r\n                small\r\n            />\r\n        </SemanticForm.Field>\r\n        <SemanticForm.Field className=\"filterFieldAligner\">\r\n            <Button type=\"button\" className=\"filterFieldBtn\">Delete</Button>\r\n        </SemanticForm.Field>\r\n    </div>);\r\n\r\n    return <div className=\"filterTable\">{filterFields}\r\n        </div>\r\n}\r\n\r\nconst renderFilterSegment = (state, props) => {\r\n    return <Segment><SemanticForm.Field>\r\n        <div className=\"segmentTitle\">Filters:</div>\r\n        {renderFilterFields(state, props)}\r\n        <Button type=\"button\">Add Filter</Button>\r\n    </SemanticForm.Field>\r\n    </Segment>\r\n}\r\n\r\nconst renderDataDesignerPanelContent = (props, state, errors) => {\r\n    let findSelNode = findNodeByKey(props.hierarchyConso, state.hierarchyTree);\r\n    //let selNodeIsFolder = !!findSelNode && findSelNode.item.unitType !== 'Target';    \r\n    //let kpiGroupOptions = gatherKpiGroupOptions(findSelNode, state.HierarchyScope, props.hierarchyKpi, state.hierDsgnKpiGroup);    \r\n\r\n    let previewIcon = \"eye\";\r\n    let previewText = \"Preview Data\";\r\n    if (state.fetchingPreview) {\r\n        previewText = \"Fetching Preview Data...\";\r\n        previewIcon = \"hourglass half\";\r\n    }\r\n\r\n    return <div className=\"dataDesignerPanelContainer\">\r\n        <Segment>\r\n        <div className=\"segmentTitle\">Analysis Period Test</div>\r\n        <FormDateRange  name=\"AnalysisPeriod\"\r\n        />\r\n        </Segment>   \r\n\r\n        <Segment>\r\n        <div className=\"segmentTitle\">Data Source</div>\r\n        <FormDropDown \r\n            // label=\"Select Dimensions:\"\r\n            name=\"dataSource\" \r\n            isRequired={false} \r\n            onSelect={onTreeSelect}\r\n            options={[]}            \r\n        />\r\n        </Segment>        \r\n\r\n        <Segment>\r\n        <div className=\"segmentTitle\">Metadata Name</div>\r\n        <FormDropDown \r\n            // label=\"Select Dimensions:\"\r\n            name=\"metadataName\" \r\n            isRequired={false} \r\n            onSelect={onTreeSelect}\r\n            options={[]}\r\n        />\r\n        </Segment>                \r\n\r\n        <Segment>\r\n        <div className=\"segmentTitle\">Dimensions</div>\r\n        <FormTreeDropDown \r\n            // label=\"Select Dimensions:\"\r\n            name=\"hierarchyTree\" \r\n            treeData={convertApiMetadataDims(props.metadata.Dimensions)} \r\n            isRequired={false} \r\n            multiple\r\n            onSelect={onTreeSelect}\r\n        />\r\n        </Segment>\r\n\r\n        {renderFilterSegment(state, props)}\r\n\r\n        <Segment>\r\n        <div className=\"segmentTitle\">Other Settings</div>\r\n        <FormTreeDropDown \r\n            label=\"Sort:\"\r\n            name=\"hierarchyTreeSort\" \r\n            treeData={convertApiMetadataDims(props.metadata.Dimensions)} \r\n            isRequired={false} \r\n            multiple\r\n            onSelect={onTreeSelect}\r\n        />\r\n        <FormText\r\n            label={\"Size\"}\r\n            name={\"datasetSize\"}\r\n            small\r\n        />\r\n        </Segment>\r\n\r\n        {state.formInvalid && \r\n            <div><Label basic color='red' pointing>\r\n            {state.formInvalid}\r\n            </Label></div>\r\n        }\r\n\r\n        {/* <button id={ID_PREVIEW_BTN} className={previewBtnClassName} icon=\"search\">{previewText}</button> */}\r\n        <Button id={ID_PREVIEW_BTN} primary disabled={state.fetchingPreview}>\r\n            <Icon name={previewIcon}/>\r\n            {previewText}</Button>\r\n        {renderPreviewTable()}\r\n    </div>\r\n}\r\n\r\nconst getValidationError = (formData) => {\r\n    if (!formData) {\r\n        return \"Form is empty!\"\r\n    }\r\n\r\n    // Either Dimension or Kpi must be present\r\n    // If both are not present, return error\r\n    if (!formData.dataDsgnDimensions && \r\n        !((formData.hierDsgnKpiGroup && formData.hierDsgnKpiGroup.length) || \r\n            (formData.hierDsgnKpi && formData.hierDsgnKpi.length)\r\n        )\r\n    ) {\r\n            return \"Either Dimension or Kpi must be selected\";\r\n    }\r\n\r\n    return null;\r\n}\r\n\r\nconst onSubmit = (formData, setStateCb) => {\r\n    //debugger\r\n    console.log('Data Designer Submit', formData);\r\n    // [1] Perform some validation first\r\n    let validationError = getValidationError(formData);\r\n    if (validationError) {\r\n        setStateCb({\r\n            formInvalid: validationError\r\n        });\r\n        return;\r\n    }\r\n\r\n    if (document.activeElement.id === ID_PREVIEW_BTN) {\r\n        // Assume that if preview button was clicked, that would be the activeElement\r\n        setStateCb({\r\n            fetchingPreview: true,\r\n            formInvalid: null,            \r\n        });\r\n    }\r\n    else {\r\n\r\n    }\r\n\r\n}\r\n\r\nconst DataDesignerForm = (props, containerWidth, state, setStateCb) => {\r\n    return <Form \r\n        className=\"hierConfigPanelContainer\" \r\n        key='formDataDesigner' \r\n        //onSubmit={(formData) => {onSubmit(formData, setStateCb)}} \r\n        onSubmit={data => {debugger}}\r\n        setControlValues={setControlValues}\r\n        watchedField={[]}\r\n        // inputObj: set it to the loaded data source when saving is implemented\r\n        inputObj={null} \r\n        setStateCb={setStateCb}\r\n        >        \r\n        <Toolbar \r\n            containerWidth={containerWidth}\r\n            menuItems={menuItems}\r\n        />\r\n        {renderDataDesignerPanelContent(props, state)}\r\n    </Form>\r\n}\r\n\r\n// Called when component mounts\r\n// Purpose is to set the initial values\r\nconst setControlValues = (setValueFunc, inputObj) => {\r\n    if (!inputObj) {\r\n        return;\r\n    }\r\n\r\n    //setValueFunc('HierarchyScope', 'children');\r\n    //setValueFunc('hierDsgnKpiGroup', []);\r\n\r\n    //setValueFunc('AnalysisPeriodStart', new Date());\r\n}\r\n\r\n// This is where the user configures the datasources that can be linked to the controls\r\nclass DataDesignerContainer extends DesignerContentbase { \r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            hierarchyTree: null,\r\n            HierarchyScope: defaultScope,\r\n            hierDsgnKpiGroup: [],       // The currently selected KPI Group\r\n            fetchingPreview: false,\r\n            formInvalid: null,\r\n            filterFields: [{\r\n                name: '',\r\n                value: null\r\n            },\r\n            {\r\n                name: '',\r\n                value: null\r\n            },\r\n            {\r\n                name: '',\r\n                value: null\r\n            }],\r\n            ...this.state\r\n        }\r\n    }\r\n    \r\n    render() {\r\n        console.log('render DataDesignerContainer', this.props.metadata);\r\n        // TODO: Put a minsize first. Should make the toolbar buttons responsive.\r\n        return <NoobSplitter id=\"hierarchyDesigner\" onDragEnd={this.onSplitDragEnd} defaultSize={DEFAULT_SPLIT_SIZES} minSize={230}>\r\n            {DataListPanel()}\r\n            {DataDesignerForm(this.props, this.state.rightPixels, this.state, this.setState.bind(this))}\r\n        </NoobSplitter>\r\n\r\n    }\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        hierarchyConso: state.dataDesigner.hierarchyConso,\r\n        dimensions: state.dataDesigner.dimensions,\r\n        hierarchyKpi: state.dataDesigner.hierarchyKpi,\r\n        metadata: state.designer.metadata,\r\n        dimensionsMetadata: convertApiMetadataDims(state.designer.metadata.Dimensions),\r\n        filtersMetadata: convertApiMetadataFilters(state.designer.metadata),\r\n    }\r\n}\r\n  \r\nfunction mapDispatchToProps(dispatch) {\r\n    return bindActionCreators({ }, dispatch);\r\n}\r\n  \r\nexport default connect(mapStateToProps, mapDispatchToProps)(DataDesignerContainer);","import React from 'react';\r\nimport './trialPage.css';\r\nimport {PieWithData} from '../charts/pieChart';\r\nimport {BarChartWithData} from '../charts/barChart';\r\nimport { render } from 'react-dom';\r\nimport crossfilter from 'crossfilter2';\r\nimport Form, {Text as FormText, FormCheckbox, Dropdown as FormDropDown, FormTreeDropDown, FormRadio} from '../form/Form';\r\nimport { Button } from 'semantic-ui-react';\r\nimport {findNodeByKey} from '../helper/treefilter';\r\nimport TreeDropdown from '../controls/treeDropdown';\r\nimport ImageMap from '../controls/imageMap';\r\nimport _ from \"lodash\";\r\n\r\nconst dataPie = [\r\n    { name: 'Good', value: 400 },\r\n    { name: 'Bad', value: 300 },\r\n    { name: 'Fair', value: 300 },\r\n    { name: 'Uncertain', value: 200 },\r\n  ];\r\n\r\nconst dummyVendorModels = {\r\n    'Apple': ['iMac', 'iPhone', 'Macbook', 'iPad'],\r\n    'Samsung': ['Galaxy S', 'Galaxy Note', 'Galaxy Tab'],\r\n    'Huawei': ['P30', 'Mate30',]\r\n}\r\n\r\nconst dummyBarchartData = [\r\n    {'Brand new': 50, 'Used': 30, vendor: 'Apple'},\r\n    {'Brand new': 40, 'Used': 20, vendor: 'Samsung'},\r\n    {'Brand new': 20, 'Used': 10, vendor: 'Huawei'},\r\n]\r\n\r\nconst categoryLookup = {\r\n    'iMac': 'Computer',\r\n    'iPhone': 'Phone',\r\n    'Macbook': 'Computer',\r\n    'iPad': 'Tablet',\r\n    'Galaxy S':'Phone',\r\n    'Galaxy Note':'Phone',\r\n    'Galaxy Tab':'Tablet',\r\n    'P30': 'Phone',\r\n    'Mate30': 'Phone',\r\n}\r\n\r\nconst itemConds = ['Brand new', 'Used']\r\n\r\nconst generateApiData = () => {\r\n    let retlist = [];\r\n    for (let prop in dummyVendorModels) {\r\n        let currVendor = dummyVendorModels[prop];\r\n        for (let i = 0; i < currVendor.length; i++) {\r\n            let currModel = currVendor[i];\r\n            for (let n = 0; n < 10; n++) {\r\n                retlist.push({\r\n                    deviceId: `${prop}-${currModel}-${n}`,\r\n                    vendor: prop,\r\n                    model: currModel,\r\n                    itemCond: itemConds[n % itemConds.length],\r\n                    category: categoryLookup[currModel]\r\n                });        \r\n            }\r\n        }\r\n    }\r\n\r\n    return retlist;\r\n}\r\n\r\nconst filterObj = (obj, fields) => {\r\n    return _.pick(obj, fields);\r\n}\r\n\r\nconst getDimensionObj = (cfData, groupingsList) => {\r\n    return cfData.dimension( d => {\r\n        let pickedData = filterObj(d, groupingsList);\r\n        return JSON.stringify(pickedData);\r\n    });\r\n}\r\n\r\nconst getDimGroupCount = (dim) => {\r\n    let groupedDimCounts = dim.group().reduceCount().all();\r\n\r\n    return groupedDimCounts.map(x => {\r\n        return {\r\n            name: x.key,\r\n            value: x.value\r\n        }\r\n    })\r\n}\r\n\r\nconst groupData = (cfDataIn, groupingsList) => {\r\n    let cfData = cfDataIn;\r\n    let dimGrouping = cfData.dimension( d => {\r\n        let pickedData = filterObj(d, groupingsList);\r\n        return JSON.stringify(pickedData);\r\n    });\r\n\r\n    let dimFiltering = cfData.dimension( d => {\r\n        let pickedData = filterObj(d, groupingsList);\r\n        return JSON.stringify(pickedData);\r\n    });\r\n\r\n    let filterAppleIphone = {\r\n        vendor: \"Apple\",\r\n        //model: \"iPhone\"\r\n    };\r\n    //dimFiltering.filter(JSON.stringify(filterAppleIphone));\r\n    //let grpVendorModels = dimVendorModel.group().reduceCount().all();\r\n    let grpVendorModels = dimGrouping.group().reduceCount().all();\r\n    \r\n    return grpVendorModels.map(x => {\r\n        return {\r\n            name: x.key,\r\n            value: x.value\r\n        }\r\n    })\r\n}\r\n\r\n// Expected to be a user config\r\nconst metaDimHier4Pie = [\r\n    {\r\n        key: 'vendor',\r\n        value: 'vendor',\r\n        title: 'Vendor',\r\n        children: [{\r\n            key: 'model',\r\n            value: 'model',\r\n            title: 'Model',    \r\n        }],        \r\n    }\r\n]\r\n\r\n// Expected to be a user config\r\nconst metaDimHier4Bar = [\r\n    {\r\n        key: 'vendor',\r\n        value: 'vendor',\r\n        title: 'Vendor',\r\n        children: [{\r\n            key: 'category',\r\n            value: 'category',\r\n            title: 'Category',    \r\n        }],        \r\n    }\r\n]\r\n\r\nconst getBottomMostGroup = (groupings) => {\r\n    if (!groupings || !groupings.length) {\r\n        return null;\r\n    }\r\n\r\n    // Just return the last item\r\n    return groupings[groupings.length - 1];\r\n}\r\n\r\n// old\r\nconst formatBarchartDataOld = (groupedData, primaryAxis, secondaryGroup) => {\r\n    let retList = [];\r\n    for (let i = 0; i < groupedData.length; i++) {\r\n        let currGroupedData = groupedData[i];\r\n        let jsonStrObj = JSON.parse(currGroupedData.name);\r\n        let primAxisVal = jsonStrObj[primaryAxis];\r\n        let secondaryName = jsonStrObj[secondaryGroup];\r\n        let secondaryVal = currGroupedData.value;\r\n\r\n        let findItem = retList.find(x => x[primaryAxis] === primAxisVal);\r\n        if (!findItem) {\r\n            findItem = {\r\n                [primaryAxis]: primAxisVal\r\n            }\r\n            retList.push(findItem);\r\n        }\r\n        findItem[`${secondaryName}`] = secondaryVal;\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\nconst formatBarchartData = (groupedData, primaryAxes, secondaryGroup) => {\r\n    let retList = [];\r\n    let primaryAxis = JSON.stringify(primaryAxes);\r\n    for (let i = 0; i < groupedData.length; i++) {\r\n        let currGroupedData = groupedData[i];\r\n        let jsonStrObj = JSON.parse(currGroupedData.name);\r\n\r\n        // let primAxisVal = jsonStrObj[primaryAxis];\r\n        let secondaryName = jsonStrObj[secondaryGroup];\r\n        let secondaryVal = currGroupedData.value;\r\n\r\n        let primAxisVal = JSON.stringify(filterObj(jsonStrObj, primaryAxes));\r\n\r\n        let findItem = retList.find(x => x[primaryAxis] === primAxisVal);\r\n        if (!findItem) {\r\n            findItem = {\r\n                [primaryAxis]: primAxisVal\r\n            }\r\n            retList.push(findItem);\r\n        }\r\n        findItem[`${secondaryName}`] = secondaryVal;\r\n    }\r\n\r\n    return retList;\r\n}\r\n\r\n// Just add a parent field to the existing metaDimArray\r\n// To make it easier to get the hierarchical value\r\nconst reformatMetaDim = (metaDimArray, parent=null) => {\r\n    if (!metaDimArray) {\r\n        return null;\r\n    }\r\n    \r\n    for(let i = 0; i < metaDimArray.length; i++) {\r\n        let metaNode = metaDimArray[i];\r\n        metaNode.parent = parent;\r\n        reformatMetaDim(metaNode.children, metaNode);\r\n    }\r\n    \r\n    return metaDimArray;\r\n}\r\n\r\nclass TrialPage extends React.Component {\r\n    \r\n    constructor(props) {\r\n        super(props);\r\n        let reformattedMetaDimPie = reformatMetaDim(metaDimHier4Pie);\r\n        let reformattedMetaDimBar = reformatMetaDim(metaDimHier4Bar);\r\n        let cfData = crossfilter(generateApiData());\r\n        let defaultGrouping = metaDimHier4Pie[0].key;\r\n\r\n        let initialPiechartDim = this.preparePieChartDim([defaultGrouping], cfData);\r\n        let initialBarchartDim = this.prepareBarChartDim([defaultGrouping], cfData);\r\n\r\n        this.state = {\r\n            dimHierMaster: {\r\n                pieChart: reformattedMetaDimPie,\r\n                barChart: reformattedMetaDimBar\r\n            },\r\n            cfData: cfData,\r\n            data: generateApiData(),\r\n            pageFilters: [], // For each control ID, one filter only\r\n            //overallGroupings: [defaultGrouping], // The grouping set in the tree drop down\r\n            groupingBoundVal: {\r\n                pieChart: defaultGrouping, \r\n                barChart: defaultGrouping, \r\n            },\r\n            controlDims: {\r\n                pieChart: [initialPiechartDim],\r\n                barChart: [initialBarchartDim]\r\n            }\r\n        }\r\n\r\n        this.onGroupSelectPie = this.onGroupSelectPie.bind(this);\r\n        this.onGroupSelectBar = this.onGroupSelectBar.bind(this);\r\n    }\r\n\r\n    preparePieChartDim = (defaultGroupings, cfData) => {\r\n        let dim = getDimensionObj(cfData,defaultGroupings);\r\n        return {\r\n            groupingInfo: JSON.stringify(defaultGroupings),\r\n            dimension: dim\r\n        }\r\n\r\n        //return cfData.dimension(d => d.vendor);\r\n    }\r\n\r\n    prepareBarChartDim = (defaultGroupings, cfData) => {\r\n        //let primaryAxis = 'vendor'; // let this be the configurable axis\r\n        let secondaryGroup = 'itemCond';\r\n        let dim = getDimensionObj(cfData,[...defaultGroupings, secondaryGroup]);\r\n        return {\r\n            groupingInfo: '', // TODO, since we haven't implemented grouping for bar chart yet\r\n            dimension: dim\r\n        }\r\n    }\r\n\r\n    renderPageFilters = () => {\r\n        return <div className=\"trialPageFilters\">\r\n            <div><b>Page filters:</b></div>\r\n            {/* {this.state.pageFilters.map()} */}\r\n            {this.state.pageFilters.map(filter => <div>{JSON.stringify(filter)}</div>)}\r\n            <Button size='mini' primary type=\"button\" \r\n                onClick={e => {\r\n                    this.setState({pageFilters:[]});\r\n                    let allControlDims = [...this.state.controlDims.pieChart, ...this.state.controlDims.barChart];\r\n                    allControlDims.forEach(d => {\r\n                        d.dimension.filter(null);\r\n                    })\r\n                }\r\n                }>Clear Filters</Button>\r\n        </div>\r\n    }\r\n\r\n    pieClickHandler = (pieWedgeInfo) => {\r\n        let currGroup = this.state.groupingBoundVal.pieChart;\r\n        let groupings = this.getGroupings(currGroup, 'pieChart');\r\n        let filterObj = {\r\n            filterVal: JSON.parse(pieWedgeInfo.name),\r\n            source: \"pieChart\",\r\n            groupingInfo: JSON.stringify(groupings)\r\n        };\r\n        console.log('pieClickHandler', pieWedgeInfo, filterObj);\r\n\r\n        // Remove any existing filter from pie chart dimension before applying a new one\r\n        // E.g. Previous filter is Vendor:Apple + Model:iPhone\r\n        // If new filter is Vendor: Apple, remove the previous filter first\r\n        // let treeDropdownVal = this.state.groupingBoundVal;\r\n        // let groupStr = JSON.stringify(this.getGroupings(treeDropdownVal));\r\n        // let otherPieDims = this.state.controlDims.pieChart.filter(d => \r\n        //     d.groupingInfo !== groupStr \r\n        //     && d.groupingInfo.length > groupStr.length);\r\n        // otherPieDims.forEach(otherDim => {\r\n        //     // If other dimension is lower (more complex), remove. If higher, retain.\r\n        //     otherDim.dimension.filter(null);\r\n        // })\r\n\r\n        // If the same source && grouping Info, replace the existing one.\r\n        // Else, just push new item\r\n\r\n        // TODO (nice to have): if everything exactly same, remove it instead\r\n        let findSameSourceAndGroupingInfoIndex = this.state.pageFilters.findIndex(f => f.source === 'pieChart' && f.groupingInfo === filterObj.groupingInfo);\r\n        if (findSameSourceAndGroupingInfoIndex >= 0) {\r\n            this.state.pageFilters.splice(findSameSourceAndGroupingInfoIndex, 1);\r\n        }\r\n\r\n        this.setState({\r\n            pageFilters: [...this.state.pageFilters, filterObj]\r\n        });\r\n    }\r\n\r\n    onGroupSelectPie = (value) => {\r\n        let groupings = this.getGroupings(value, 'pieChart');\r\n        let groupingsStr = JSON.stringify(groupings);\r\n\r\n        // Remove the filter from previous lower groups\r\n        // let prevGroup = this.state.groupingBoundVal;\r\n        // let prevGroupStr = JSON.stringify(this.getGroupings(prevGroup));\r\n        debugger\r\n        let lowerDims = this.state.controlDims.pieChart.filter(d => d.groupingInfo.length > groupingsStr.length);\r\n        let removedFilters = [];\r\n        lowerDims.forEach(lowerDim => {\r\n            lowerDim.dimension.filter(null);\r\n            removedFilters.push(lowerDim.groupingInfo);\r\n        });\r\n\r\n        this.setState({\r\n            pageFilters: this.state.pageFilters.filter(f => !removedFilters.includes(f.groupingInfo))\r\n        });\r\n\r\n\r\n        // Update the dimension of the controls also....maybe we need to keep the old dimensions too in case the user switches back to the previous grouping\r\n        // Check if this grouping is already in the state\r\n        // If not, create a new one and push\r\n        let findGrouping = this.state.controlDims.pieChart.find(g => g.groupingInfo === groupingsStr);\r\n\r\n        if (!findGrouping) {\r\n            let newPiechartDim = this.preparePieChartDim(groupings, this.state.cfData);\r\n            this.setState({\r\n                groupingBoundVal: {\r\n                    ...this.state.groupingBoundVal, \r\n                    pieChart: value\r\n                },\r\n                controlDims: {\r\n                    ...this.state.controlDims,\r\n                    pieChart: [...this.state.controlDims.pieChart, newPiechartDim]\r\n                }\r\n            })\r\n        }\r\n        else {\r\n            this.setState({\r\n                groupingBoundVal: {\r\n                    ...this.state.groupingBoundVal,\r\n                    pieChart: value\r\n                },\r\n            });\r\n        }      \r\n    }\r\n\r\n    onGroupSelectBar = (value) => {\r\n        let groupings = this.getGroupings(value, 'barChart');\r\n        let groupingsStr = JSON.stringify(groupings);\r\n\r\n        // Remove the filter from previous lower groups\r\n        // let prevGroup = this.state.groupingBoundVal;\r\n        // let prevGroupStr = JSON.stringify(this.getGroupings(prevGroup));\r\n        debugger\r\n        let lowerDims = this.state.controlDims.barChart.filter(d => d.groupingInfo.length > groupingsStr.length);\r\n        let removedFilters = [];\r\n        lowerDims.forEach(lowerDim => {\r\n            lowerDim.dimension.filter(null);\r\n            removedFilters.push(lowerDim.groupingInfo);\r\n        });\r\n\r\n        this.setState({\r\n            pageFilters: this.state.pageFilters.filter(f => !removedFilters.includes(f.groupingInfo))\r\n        });\r\n\r\n\r\n        // Update the dimension of the controls also....maybe we need to keep the old dimensions too in case the user switches back to the previous grouping\r\n        // Check if this grouping is already in the state\r\n        // If not, create a new one and push\r\n        let findGrouping = this.state.controlDims.barChart.find(g => g.groupingInfo === groupingsStr);\r\n\r\n        if (!findGrouping) {\r\n            let newBarchartDim = this.prepareBarChartDim(groupings, this.state.cfData);\r\n            this.setState({\r\n                groupingBoundVal: {\r\n                    ...this.state.groupingBoundVal,\r\n                    barChart: value\r\n                },\r\n                controlDims: {\r\n                    ...this.state.controlDims,\r\n                    barChart: [...this.state.controlDims.barChart, newBarchartDim]\r\n                }\r\n            })\r\n        }\r\n        else {\r\n            this.setState({\r\n                groupingBoundVal: {\r\n                    ...this.state.groupingBoundVal, \r\n                    barChart: value\r\n                },\r\n            });\r\n        }      \r\n    }\r\n\r\n    getGroupings = (treeDropdownVal, controlId) => {\r\n        //let  = this.state.groupingBoundVal;\r\n        let treeNodeSel = findNodeByKey(this.state.dimHierMaster[controlId], treeDropdownVal);\r\n        if (!treeNodeSel) {\r\n            return [];\r\n        }\r\n\r\n        let retList = [treeDropdownVal];\r\n        let currParent = treeNodeSel.item.parent;\r\n        while (!!currParent) {\r\n            retList.unshift(currParent.key);\r\n            currParent = currParent.parent;\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n    calculateActiveIndex = (groupData, controlId, groupingsStr, pageFilters) => {\r\n\r\n        let findFilterForControl = pageFilters.find(f => f.source === controlId && f.groupingInfo === groupingsStr);\r\n        if (!findFilterForControl) {\r\n            return null;\r\n        }\r\n\r\n        let dataIndex = groupData.findIndex(data => {\r\n            let nameStr = data.name;\r\n            let nameObj = JSON.parse(nameStr);\r\n\r\n            // This data must satisfy all filter props\r\n            for (let prop in findFilterForControl.filterVal) {\r\n                if (findFilterForControl.filterVal[prop] !== nameObj[prop]) {\r\n                    return false;\r\n                }\r\n            }\r\n\r\n            return true;\r\n        });\r\n\r\n        if (dataIndex >= 0) {\r\n            return dataIndex;\r\n        }\r\n\r\n        return null;        \r\n    }\r\n\r\n    renderPieChart = () => {\r\n        // [1] Group the data \r\n        // [1A] Get the groupings from the tree dropdown first\r\n        let dimArr = this.state.controlDims.pieChart;\r\n        let treeDropdownVal = this.state.groupingBoundVal.pieChart;\r\n        let groupings = this.getGroupings(treeDropdownVal, 'pieChart');\r\n        let groupingsStr = JSON.stringify(groupings);\r\n        let dimFind = dimArr.find(g => g.groupingInfo === groupingsStr);\r\n        \r\n        let groupedData = getDimGroupCount(dimFind.dimension);\r\n        let activeIndex = this.calculateActiveIndex(groupedData, 'pieChart', groupingsStr, this.state.pageFilters);\r\n    \r\n        // TODO: we need to set the correct active index if there is a filter on this control and group\r\n        // Maybe we can assume that recharts will use the groupedData index as-as.\r\n        // If that's the case we can calculate\r\n        return <div className=\"trialPieContainer\">\r\n            <TreeDropdown \r\n                treeData={metaDimHier4Pie} \r\n                value={this.state.groupingBoundVal.pieChart}\r\n                onSelect={this.onGroupSelectPie}\r\n                treeDefaultExpandAll\r\n                // defaultValue={getBottomMostGroup(this.state.overallGroupings)}\r\n            />\r\n            <PieWithData \r\n                apiData={groupedData}\r\n                pieClickCallback={this.pieClickHandler}\r\n                activeIndex={activeIndex}/>\r\n        </div>\r\n    }\r\n\r\n    renderTable = () => {\r\n        let dimensions = ['deviceId', 'vendor', 'model', 'itemCond', 'category']; // configed by user\r\n        let data = this.state.cfData.allFiltered();\r\n        \r\n        return <div className=\"trialChartContainer trialChartContainer\">\r\n            <b>Num Records: {data.length}</b>\r\n            <table className=\"trialTable\">\r\n            <thead>\r\n                <tr>\r\n                {dimensions.map(d => <th key={`trialTableHeader-${d}`}>{d}</th>)}\r\n                </tr>\r\n            </thead>\r\n            <tbody>\r\n                {data.map((d, index) => { return <tr key={`trialTableData-${index}`}>\r\n                    {\r\n                        Object.keys(d).map(k => <td key={`trialTableData-${index}-${d[k]}`}>{d[k]}</td>)\r\n                    }\r\n                    </tr>})\r\n                }\r\n            </tbody>\r\n        </table>\r\n        </div>\r\n    }\r\n\r\n    renderBarchart = () => {        \r\n        //let data = dummyBarchartData;\r\n        //let primaryAxis = 'vendor';        \r\n        let treeDropdownVal = this.state.groupingBoundVal.barChart;\r\n        let groupings = this.getGroupings(treeDropdownVal, 'barChart');\r\n\r\n        let secondaryGroup = 'itemCond';\r\n        let groupedData = groupData(this.state.cfData, [...groupings,secondaryGroup]);\r\n        //let groupedData = groupData(this.state.cfData, ['vendor', secondaryGroup]);\r\n        let formattedGroupData = formatBarchartData(groupedData, groupings, secondaryGroup);\r\n        let primaryAxis = JSON.stringify(groupings);\r\n        let secondaryKeyVals = groupedData.map(grpData => {\r\n            let nameJson = grpData.name;\r\n            let keyObj = JSON.parse(nameJson);\r\n            return keyObj[secondaryGroup];\r\n        });\r\n        let uniqSecondaryVals = _.uniq(secondaryKeyVals);\r\n\r\n        return <div className=\"trialPieContainer trialChartContainer\">\r\n            <TreeDropdown \r\n                treeData={metaDimHier4Bar} \r\n                value={this.state.groupingBoundVal.barChart}\r\n                onSelect={this.onGroupSelectBar}\r\n                treeDefaultExpandAll\r\n                // defaultValue={getBottomMostGroup(this.state.overallGroupings)}\r\n            />\r\n            <BarChartWithData\r\n                apiData={formattedGroupData}\r\n                primary={primaryAxis}\r\n                secondaryList={uniqSecondaryVals}\r\n            />\r\n        </div>\r\n    }\r\n\r\n    filterData = () => {\r\n        if (!this.state.pageFilters || !this.state.pageFilters.length) {\r\n            return;\r\n        }\r\n\r\n        debugger\r\n        // let dimObj = this.state.controlDims.pieChart;\r\n        // dimObj.filter('{\"vendor\":\"Apple\"}');  \r\n\r\n        // Apply the filter on the source only\r\n        // E.g. Pie chart applied filter\r\n        // -> Look for the pie chart's dimension from State, then apply the filter on that only\r\n        for (let i = 0; i < this.state.pageFilters.length; i++) {\r\n            let currFilter = this.state.pageFilters[i];\r\n\r\n            // a. Find the source of the filter. It will return an array of dims (one per grouping)\r\n            let filterSource = currFilter.source;\r\n            let filterGroupingInfo = currFilter.groupingInfo;\r\n            let dimArr = this.state.controlDims[filterSource];   \r\n            let dimObj = null;\r\n\r\n            // b. Find the dim based on the current grouping\r\n            if (filterSource === 'pieChart') {\r\n                let currGrouping = this.state.groupingBoundVal[filterSource];\r\n                let groupingVal = this.getGroupings(currGrouping, filterSource);\r\n                let groupingValStr = JSON.stringify(groupingVal);\r\n                if (filterGroupingInfo !== groupingValStr) {\r\n                    // We don't perform filter if the currently selected group is not the same\r\n                    continue;\r\n                }\r\n\r\n                let dimFind = dimArr.find(x => x.groupingInfo === groupingValStr);\r\n                if (!dimFind) {\r\n                    // Not expected to be here\r\n                    debugger\r\n                    continue;\r\n                }\r\n                dimObj = dimFind.dimension;\r\n            }\r\n            else {\r\n                // Not yet implemented filter for bar chart. todo...\r\n            }\r\n\r\n            let currFilterVal = currFilter.filterVal;\r\n\r\n            // c. Iterate through each of the filter and check if the data satisfies each filter\r\n            dimObj.filter( dJsonStr => {\r\n                let jsonObj = JSON.parse(dJsonStr);\r\n                \r\n                for (let prop in currFilterVal) {\r\n                    let jsonObjVal = jsonObj[prop];\r\n                    if (jsonObjVal !== currFilterVal[prop]) {\r\n                        return false\r\n                    }\r\n                }\r\n                return true;\r\n            });\r\n        }        \r\n\r\n    }\r\n\r\n    \r\n    renderMap = (useOther=null) => {\r\n        return <ImageMap useOther={useOther}/>;\r\n    }\r\n\r\n    testFilter = () => {\r\n        debugger\r\n        let cfData = this.state.cfData;\r\n        let dimPie = cfData.dimension(d => d.vendor);\r\n        let dimBar = cfData.dimension(d => d.itemCond);\r\n\r\n        let grpPie1 = dimPie.group().reduceCount().all();\r\n        let grpBar1 = dimBar.group().reduceCount().all();\r\n        let cfData1 = cfData.allFiltered();\r\n\r\n        dimPie.filter(\"Apple\");\r\n        let grpPie2 = dimPie.group().reduceCount().all();\r\n        let grpBar2 = dimBar.group().reduceCount().all();\r\n        let cfData2 = cfData.allFiltered();\r\n    }\r\n\r\n    render() {\r\n        // Perform filtering if there is a pagefilter\r\n        //this.testFilter();\r\n        this.filterData();\r\n\r\n        return <div className=\"trialPageContainer\">\r\n            {this.renderPageFilters()}\r\n            <div className=\"trialPageCharts\">\r\n            {this.renderMap(true)}\r\n            {this.renderPieChart()}\r\n            {this.renderBarchart()}\r\n            {this.renderTable()}\r\n            </div>\r\n        </div>\r\n    }\r\n}\r\n\r\nexport default TrialPage;\r\n\r\n","import React from 'react';\r\nimport \"../styles/App.css\";\r\nimport \"../styles/MainContent.css\";\r\n//import HomeContent from './homeContent';\r\nimport DashboardContent from './dashboardContent';\r\nimport DesignerContent from './dashboardDesignerContent';\r\nimport FormsDesignerContent from './formsDesignerContent';\r\nimport SettingsContent from './settingsContent';\r\nimport HierarchyDesigner from './hierarchyDesigner';\r\nimport MapViewContent from './mapViewContent';\r\nimport AnalysisViewContent from './analysisViewContent';\r\nimport SpecialTabContent from './specialTabContent';\r\nimport DownloadCenterContent from './downloadCenterContent';\r\nimport {connect} from 'react-redux';\r\nimport {Tab} from 'semantic-ui-react';\r\nimport DataDesignerContent from './dataDesignerContent';\r\nimport DataSourcesContent from './dataSourceContent';\r\nimport TrialPage from './trialPage';\r\nimport ExternalContainer from '../containers/externalContainer';\r\n\r\nconst panes = [\r\n    {\r\n        menuItem: 'MapViewContent',\r\n        pane: (\r\n        <Tab.Pane key='mapView' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n            {/* <MapViewContent/> */}\r\n            <SpecialTabContent hierarchyPropName=\"displayAsMapView\"/>\r\n        </Tab.Pane>\r\n        ),\r\n    },\r\n    {\r\n      menuItem: 'AnalysisViewContent',\r\n      pane: (\r\n      <Tab.Pane key='analysisView' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n          {/* <AnalysisViewContent/> */}\r\n          <SpecialTabContent hierarchyPropName=\"displayAsAnalysisView\"/>\r\n      </Tab.Pane>\r\n      ),\r\n  },\r\n    {\r\n        menuItem: 'Home',\r\n        pane: (\r\n        <Tab.Pane key='home' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n            {/* <HomeContent/> */}\r\n            <DashboardContent defaultSizes={[15, 85]}/>\r\n        </Tab.Pane>\r\n        ),\r\n    },\r\n    {\r\n      menuItem: 'DownloadCenterContent',\r\n      pane: (\r\n      <Tab.Pane key='downloadCenter' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n          <DownloadCenterContent/>\r\n      </Tab.Pane>\r\n      ),\r\n  },\r\n    {\r\n        menuItem: 'formsDesigner',\r\n        pane: (\r\n          <Tab.Pane key='formsDesigner' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n            <FormsDesignerContent defaultSizes={[25, 75]}/>\r\n          </Tab.Pane>\r\n        ),\r\n      },\r\n      {\r\n        menuItem: 'HierarchyDesigner',\r\n        pane: (\r\n          <Tab.Pane key='hierarchyDesigner' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n            <HierarchyDesigner/>\r\n          </Tab.Pane>\r\n        ),\r\n      },          \r\n      // {\r\n      //   menuItem: 'dataSources',\r\n      //   pane: (\r\n      //     <Tab.Pane key='dataSources' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n      //       <DataSourcesContent/>\r\n      //     </Tab.Pane>\r\n      //   ),\r\n      // },          \r\n      // {\r\n      //   menuItem: 'affiliate',\r\n      //   pane: (\r\n      //     <Tab.Pane key='affiliate' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n      //       <ExternalContainer/>\r\n      //     </Tab.Pane>\r\n      //   ),\r\n      // },\r\n      // {\r\n      //   menuItem: 'dashboardDesigner',\r\n      //   pane: (\r\n      //     <Tab.Pane key='dashboardDesigner' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n      //       <DesignerContent/>\r\n      //     </Tab.Pane>\r\n      //   ),\r\n      // },\r\n      // {\r\n      //   menuItem: 'dataDesigner',\r\n      //   pane: (\r\n      //     <Tab.Pane key='dataDesigner' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n      //       <DataDesignerContent/>\r\n      //     </Tab.Pane>\r\n      //   ),\r\n      // },    \r\n      // {\r\n      //   menuItem: 'trialPage',\r\n      //   pane: (\r\n      //     <Tab.Pane key='trialPage' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n      //       <TrialPage/>\r\n      //     </Tab.Pane>\r\n      //   ),\r\n      // },               \r\n      {\r\n        menuItem: 'Settings',\r\n        pane: (\r\n          <Tab.Pane key='settings' style={{height: '100%', width: '100%', padding: '0px'}}>\r\n            <SettingsContent/>\r\n          </Tab.Pane>\r\n        ),\r\n      },\r\n  ]\r\n\r\nconst MainContent = (props) => {\r\n    // Decide which content to show as active, based on selected item from NavBar (stored in the redux store)    \r\n    return <div id=\"mainContent\">\r\n        <Tab id=\"mainTab\" panes={panes} renderActiveOnly={false} style={{height: '100%'}} activeIndex={props.mainAppState.tabIndex}/>\r\n    </div>;\r\n}\r\n\r\nfunction mapStateToProps(state) {\r\n    return {\r\n        mainAppState: state.mainApp\r\n    };\r\n  }\r\n\r\n//export default MainContent;\r\nexport default connect(mapStateToProps)(MainContent);","import React from 'react';\r\nimport ReportForm from './components/reportForm';\r\nimport {connect} from 'react-redux';\r\nimport './ReportApp.css'\r\nimport {findInheritedPage} from './containers/hierarchyConfigPanel';\r\nimport {findNodeByKey} from './helper/treefilter';\r\nimport {uuidv4, getMonthEndDate, getMonthStartDate} from './helper/util';\r\n\r\nconst ReportApp = ({layoutData, layout, metadata, hierarchyView, masterLayouts}) => {\r\n\r\n    const getLayoutName = (findUserSetting, currNode) => {\r\n        if (!findUserSetting) {\r\n            return null;\r\n        }\r\n\r\n        if (findUserSetting.inherit === false) {\r\n            return findUserSetting.pageAssoc;\r\n        }\r\n        else {\r\n            // otherwise, use the inherited page\r\n            let findNode = findNodeByKey(treeData, currNode.key);\r\n            if (!!findNode && findNode.item) {\r\n                return findInheritedPage(findNode.item, userSettings);\r\n            }\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    // Returns an array of layouts\r\n    const extractLayouts = (nodesArr) => {\r\n        if (!Array.isArray(nodesArr) || !Array.isArray(userSettings)) {\r\n            return null;\r\n        }\r\n\r\n        let retList = [];\r\n        for (let i=0; i < nodesArr.length; i++) {\r\n            let currNode = nodesArr[i];\r\n            // Find the corresponding userSetting and layoutObj\r\n            // We cannot call continue in the loop if cannot find the setting/layout, because we still need to process the children\r\n            let findUserSetting = userSettings.find(u => u.key === currNode.key);\r\n            if (findUserSetting && findUserSetting.displayReport === true) {\r\n                let layoutName = getLayoutName(findUserSetting, currNode);\r\n                let findNodeLayout = masterLayouts.find(m => m.name === layoutName);\r\n                if (findNodeLayout) {\r\n                    let controlsArr = findNodeLayout.layoutJson && JSON.parse(findNodeLayout.layoutJson);\r\n                    let pageApiData = findNodeLayout.pageApiData && JSON.parse(findNodeLayout.pageApiData);\r\n                    retList.push({\r\n                        layoutName: layoutName,\r\n                        controls: controlsArr,\r\n                        pageApiData: pageApiData\r\n                    });\r\n                    console.log(\"[extractLayouts] Adding: \", layoutName);\r\n                }\r\n            }\r\n\r\n            // process the node's children (always process the children no matter what)\r\n            let childrenControls = extractLayouts(currNode.children);\r\n            if (Array.isArray(childrenControls) && childrenControls.length > 0) {\r\n                retList = retList.concat(childrenControls);\r\n            }\r\n        }\r\n\r\n        return retList;\r\n    }\r\n\r\n    const adjustControlCoords = (currLayoutControls, currRowOffset, currLayoutName) => {\r\n        let retVal = {\r\n            lastNonEmptyRow: 0,\r\n            adjustedControls: []\r\n        };\r\n        \r\n        for (let i=0; i < currLayoutControls.length; i++) {\r\n            let currControl = currLayoutControls[i];\r\n            let newY = currControl.y + currRowOffset;\r\n            let bottom = newY + currControl.h;\r\n            retVal.adjustedControls.push({\r\n                ...currControl,\r\n                y: newY,\r\n                layoutName: currLayoutName // needed for external API data mapping\r\n            })\r\n\r\n            if (bottom > retVal.lastNonEmptyRow) {\r\n                retVal.lastNonEmptyRow = bottom;\r\n            }\r\n        }\r\n\r\n        return retVal;\r\n    }\r\n\r\n    const mergeLayoutControls = (allLayouts) => {\r\n        if (!Array.isArray(allLayouts)) {\r\n            return [];\r\n        }\r\n\r\n        let retVal = {\r\n            controls: [],\r\n            lastNonEmptyRow: 0,\r\n            apiDataMap:  {}\r\n        };\r\n        let currRowOffset = 0;\r\n        for (let iLayout = 0; iLayout < allLayouts.length; iLayout++) {\r\n            let currLayoutName = allLayouts[iLayout].layoutName;\r\n            let currLayoutControls = allLayouts[iLayout].controls;\r\n            let currApiData = allLayouts[iLayout].pageApiData;\r\n            if (currApiData) {\r\n                retVal.apiDataMap[currLayoutName] = currApiData;\r\n            }\r\n            \r\n            let reformattedControls = adjustControlCoords(currLayoutControls, currRowOffset, currLayoutName);\r\n            console.log('[mergeLayoutControls], layout: ', currLayoutName, 'last empty row', reformattedControls.lastNonEmptyRow, \"currRowOffset:\", currRowOffset);\r\n            // Add a pagebreak\r\n            reformattedControls.adjustedControls.push({\r\n                i: 'ctrl-pagebreak-report'+uuidv4(),\r\n                x: 0,\r\n                y: reformattedControls.lastNonEmptyRow+1,\r\n                w: 12,\r\n                h: 1,\r\n                ctrlType: 'pagebreak',\r\n                data: {}\r\n            });\r\n\r\n            currRowOffset = reformattedControls.lastNonEmptyRow + 2; // +1 for the page break we added just now\r\n            retVal.controls = retVal.controls.concat(reformattedControls.adjustedControls);\r\n        }\r\n\r\n        retVal.lastNonEmptyRow = currRowOffset;\r\n\r\n        return retVal;\r\n    }\r\n\r\n    const gatherAllControls = () => {        \r\n        if (!treeData || treeData.length === 0) {\r\n            return [];\r\n        }\r\n\r\n        // Extract all layouts first\r\n        let allLayouts = extractLayouts(treeData);\r\n\r\n        // Stitch together all controls, but need to readjust the x, y coordinates\r\n        // and put a page break control in between each layout\r\n        return mergeLayoutControls(allLayouts);\r\n    }\r\n\r\n    // For now, we hardcode that if report parameters include \"start\" and \"end\", it is for Analysis Period\r\n    // Since Analysis Period is already part of the DashboardContent's state.pageFilters, we just mimic the format.\r\n    // Future: may include report name, or username\r\n    const getRequestParamsOld = () => {\r\n        let url = new URL(document.URL);\r\n        let searchParams = url.searchParams;\r\n        const start = searchParams.get('start');\r\n        const end = searchParams.get('end');\r\n        let pageFilters = [];\r\n\r\n        // TODO: Not sure if backend server can understand the start and end date format\r\n        if (start && end) {\r\n            pageFilters.push({\r\n                name: \"AnalysisPeriod\", \r\n                value: \"CustomRange\", \r\n                startDate: start,\r\n                endDate: end\r\n            });\r\n        }\r\n\r\n        return pageFilters;\r\n    }\r\n\r\n    // For now, we hardcode that the request parameter shall be the Exec Report UUID, start and end MONTH\r\n    // Since Analysis Period is already part of the DashboardContent's state.pageFilters, we just mimic the format.\r\n    // Future: may include report name, or username\r\n    const getRequestParams = () => {\r\n        let url = new URL(document.URL);\r\n        let searchParams = url.searchParams;\r\n        const start = searchParams.get('start');\r\n        const end = searchParams.get('end');\r\n        const uuid = searchParams.get('uuid');\r\n        let pageFilters = [];\r\n\r\n        if (uuid) {\r\n            pageFilters.push({\r\n                name: 'uuid',\r\n                value: uuid\r\n            });\r\n        }\r\n        if (start && end) {\r\n            pageFilters.push({\r\n                name: \"AnalysisPeriod\", \r\n                value: \"CustomRange\", \r\n                startDate: getMonthStartDate(new Date(start)),\r\n                endDate: getMonthEndDate(new Date(end))\r\n            });\r\n        }\r\n\r\n        return pageFilters;\r\n    }\r\n\r\n    // temp function\r\n    const getFirstVal = (obj) => {\r\n        if (!obj) {\r\n            return null;\r\n        }\r\n\r\n        let vals = Object.values(obj);\r\n        if (vals && vals.length > 0) {\r\n            return vals[0];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    // Gather all controls from all layouts in the hierarchy and pass them as controls and layoutData\r\n    let treeData = hierarchyView && JSON.parse(hierarchyView.hierarchyJson);\r\n    let userSettings = hierarchyView && JSON.parse(hierarchyView.nodeSettingsJson);\r\n    \r\n    let allControls = gatherAllControls();\r\n    let allControlsLayoutData = {\r\n        columns: 12,\r\n        rows: allControls.lastNonEmptyRow + 1,\r\n        // TODO: For now, don't send the whole apiDataMap first. Assume in all layouts selected, only one of them has external API Data\r\n        pageApiData: getFirstVal(allControls.apiDataMap)\r\n    };\r\n\r\n    // Parse the URL for the query string\r\n    let requestParams = getRequestParams();\r\n    console.log('requestParams: ', requestParams);\r\n\r\n    return <div className=\"ReportApp\">\r\n        <ReportForm \r\n            containerWidth={window.innerWidth}\r\n            // layoutData={layoutData}\r\n            // controls={layout}\r\n            layoutData={allControlsLayoutData}\r\n            controls={allControls.controls}            \r\n            metadata={metadata}\r\n            pageFilters={requestParams}\r\n            />\r\n    </div>\r\n}\r\n\r\nconst mapStateToProps = (state) => {    \r\n    let masterHierarchyViews = state.mainApp.masterHierarchyViews;\r\n    let defaultView = masterHierarchyViews && masterHierarchyViews[0];\r\n\r\n    return {\r\n        layout: state.reportApp.layout,\r\n        layoutData: state.reportApp.layoutData,\r\n        metadata: state.mainApp.masterMetadata,\r\n        hierarchyView: defaultView,\r\n        masterLayouts: state.mainApp.masterLayouts,\r\n    };\r\n}\r\n\r\nexport default connect(mapStateToProps)(ReportApp);","import React from 'react';\r\n\r\n// Project imports\r\nimport Navbar from '../src/components/navbar';\r\nimport MainContent from './containers/mainContent';\r\nimport \"../src/styles/App.css\";\r\n//import masterData from './api/masterData';\r\nimport {fetchHierarchy, \r\n    fetchSavedLayouts, \r\n    fetchHierarchyViews, \r\n    fetchDimensions,\r\n    fetchHierarchyKpi,\r\n    fetchHierarchyConso,\r\n    fetchImages} from './actions';\r\nimport {connect} from 'react-redux';\r\n\r\nimport TouchBackend from 'react-dnd-touch-backend';\r\nimport HTML5Backend from 'react-dnd-html5-backend';\r\nimport { DndProvider } from 'react-dnd'\r\nimport ShowMessage, {NotifType} from '../src/helper/notification';\r\nimport ReactNotification from 'react-notifications-component'\r\nimport ReportApp from './ReportApp';\r\n\r\nclass App extends React.Component {\r\n\r\n    componentDidMount() {\r\n        console.log('[App][componentDidMount] fetch master data...');\r\n        // Fetch master data:\r\n        // Hierarchy, layouts, saved data\r\n\r\n        // POC: No need to fetch the hierarchy. User will manually build the hierarchy.\r\n        //this.props.fetchHierarchyConso();\r\n        //this.props.fetchHierarchy()\r\n            // Fetch the view after fetching the real hierarchy. Because the user may not necessarily have saved\r\n            // a user hierarchy. In that case, we show the real hierarchy.\r\n            // Is there a guarantee that when the Reducer starts processing the hierarchy view, the hierarchy was already finished?\r\n            // Note: we are using redux thunk...Will the then() function be executed after network fetch or after reducer is done?\r\n            //.then(() => this.props.fetchHierarchyViews())\r\n            //.catch( err => ShowMessage(\"Unable to fetch hierarchy\", NotifType.danger, err.message));\r\n        //this.props.fetchHierarchyKpi();\r\n        //this.props.fetchDimensions();\r\n        this.props.fetchHierarchyViews();\r\n        this.props.fetchSavedLayouts();\r\n        this.props.fetchImages();\r\n    }\r\n\r\n    render() {\r\n        var isTouch = ('ontouchstart' in document.documentElement);\r\n        console.log('[App] render(), touch?', isTouch);\r\n        console.log('URL Params', document.URL);\r\n\r\n        if (document.URL.toLowerCase().includes('reporting')) {\r\n            return <DndProvider backend={HTML5Backend}>\r\n                <div id=\"reportApp\">\r\n                <ReportApp/>\r\n                </div>\r\n            </DndProvider>\r\n        }\r\n        else {\r\n            return(<DndProvider backend={isTouch? TouchBackend : HTML5Backend}>\r\n                <div id=\"app\" style={{height: 'calc(100%)'}}>\r\n                    <ReactNotification />\r\n                    <Navbar>        \r\n                        <MainContent/>\r\n                    </Navbar>\r\n                </div>\r\n                </DndProvider>)        \r\n        }\r\n    }\r\n}\r\n\r\n//dndBackend = DragDropContext(TouchBackend);\r\nexport default connect(null, {fetchHierarchy, \r\n    fetchSavedLayouts, \r\n    fetchHierarchyViews, \r\n    fetchHierarchyKpi, \r\n    fetchHierarchyConso,\r\n    fetchDimensions,\r\n    fetchImages})(App);\r\n","// React imports\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\n// Redux imports\r\nimport { createStore,applyMiddleware } from 'redux'\r\nimport { Provider } from 'react-redux'\r\nimport thunk from 'redux-thunk';\r\n\r\nimport reducers from \"./reducers\";\r\nimport App from './App';\r\nimport \"draft-js-linkify-plugin/lib/plugin.css\";\r\n\r\nconst store = createStore(reducers, applyMiddleware(thunk));\r\n\r\nconst main = () => {\r\n    return (<Provider store={store}>\r\n            <App/>\r\n        </Provider>);\r\n}\r\n\r\nReactDOM.render(main(), document.getElementById('root'))"],"sourceRoot":""}